<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ThemisDSMPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Themis Core Project Framework</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.themis.lethe.ui</a> &gt; <span class="el_source">ThemisDSMPanel.java</span></div><h1>ThemisDSMPanel.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Themis: Java Project Framework
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
package net.sourceforge.joceanus.themis.lethe.ui;

import java.io.File;
import java.util.prefs.BackingStoreException;
import java.util.prefs.Preferences;

import net.sourceforge.joceanus.oceanus.base.OceanusException;
import net.sourceforge.joceanus.tethys.api.base.TethysUIEvent;
import net.sourceforge.joceanus.tethys.api.button.TethysUIButton;
import net.sourceforge.joceanus.tethys.api.button.TethysUIButtonFactory;
import net.sourceforge.joceanus.tethys.api.button.TethysUIScrollButtonManager;
import net.sourceforge.joceanus.tethys.api.control.TethysUIControlFactory;
import net.sourceforge.joceanus.tethys.api.control.TethysUIHTMLManager;
import net.sourceforge.joceanus.tethys.api.dialog.TethysUIDialogFactory;
import net.sourceforge.joceanus.tethys.api.dialog.TethysUIDirectorySelector;
import net.sourceforge.joceanus.tethys.api.factory.TethysUIFactory;
import net.sourceforge.joceanus.tethys.api.factory.TethysUILogTextArea;
import net.sourceforge.joceanus.tethys.api.factory.TethysUIMainPanel;
import net.sourceforge.joceanus.tethys.api.menu.TethysUIScrollMenu;
import net.sourceforge.joceanus.tethys.api.pane.TethysUIBorderPaneManager;
import net.sourceforge.joceanus.tethys.api.pane.TethysUIBoxPaneManager;
import net.sourceforge.joceanus.tethys.api.pane.TethysUIPaneFactory;
import net.sourceforge.joceanus.tethys.api.pane.TethysUITabPaneManager;
import net.sourceforge.joceanus.tethys.api.pane.TethysUITabPaneManager.TethysUITabItem;
import net.sourceforge.joceanus.themis.exc.ThemisIOException;
import net.sourceforge.joceanus.themis.lethe.analysis.ThemisAnalysisProject;
import net.sourceforge.joceanus.themis.lethe.dsm.ThemisDSMModule;
import net.sourceforge.joceanus.themis.lethe.dsm.ThemisDSMPackage;
import net.sourceforge.joceanus.themis.lethe.dsm.ThemisDSMProject;
import net.sourceforge.joceanus.themis.lethe.dsm.ThemisDSMReport;
import net.sourceforge.joceanus.themis.lethe.statistics.ThemisStatsParser;
import net.sourceforge.joceanus.themis.lethe.statistics.ThemisStatsProject;

/**
 * DSMPanel.
 */
public class ThemisDSMPanel
    implements TethysUIMainPanel {
    /**
     * The GUI Factory.
     */
    private final TethysUIFactory&lt;?&gt; theGuiFactory;

    /**
     * The Tab Manager Pane.
     */
    private final TethysUITabPaneManager theTabPane;

    /**
     * The Matrix HTML Pane.
     */
    private final TethysUIHTMLManager theMatrixHTML;

    /**
     * The Dependency HTML Pane.
     */
    private final TethysUIHTMLManager theDependencyHTML;

    /**
     * The Dependency Tab.
     */
    private final TethysUITabItem theDependencyTab;

    /**
     * The Statistics Panel.
     */
    private final ThemisStatsPanel theStatsPanel;

    /**
     * The Source Panel.
     */
    private final ThemisSourcePanel theSourcePanel;

    /**
     * The Log Tab.
     */
    private final TethysUITabItem theLogTab;

    /**
     * The log sink.
     */
    private final TethysUILogTextArea theLogSink;

    /**
     * The ProjectButton.
     */
    private final TethysUIButton theProjectButton;

    /**
     * The ModuleButton.
     */
    private final TethysUIScrollButtonManager&lt;ThemisDSMModule&gt; theModuleButton;

    /**
     * The FromButton.
     */
    private final TethysUIScrollButtonManager&lt;ThemisDSMPackage&gt; theFromButton;

    /**
     * The ToButton.
     */
    private final TethysUIScrollButtonManager&lt;ThemisDSMPackage&gt; theToButton;

    /**
     * The current project.
     */
    private ThemisDSMProject theProject;

    /**
     * The current module.
     */
    private ThemisDSMModule theModule;

    /**
     * The current from package.
     */
    private ThemisDSMPackage theFrom;

    /**
     * The error.
     */
    private OceanusException theError;

    /**
     * Constructor.
     * @param pFactory the GuiFactory
     * @throws OceanusException on error
     */
<span class="nc" id="L145">    public ThemisDSMPanel(final TethysUIFactory&lt;?&gt; pFactory) throws OceanusException {</span>
        /* Access GuiFactory */
<span class="nc" id="L147">        theGuiFactory = pFactory;</span>

        /* Create the HTML Panes */
<span class="nc" id="L150">        final TethysUIControlFactory myControls = theGuiFactory.controlFactory();</span>
<span class="nc" id="L151">        final TethysUIButtonFactory&lt;?&gt; myButtons = theGuiFactory.buttonFactory();</span>
<span class="nc" id="L152">        theDependencyHTML = myControls.newHTMLManager();</span>
<span class="nc" id="L153">        theDependencyHTML.setCSSContent(ThemisDSMStyleSheet.CSS_DSM);</span>
<span class="nc" id="L154">        theMatrixHTML = myControls.newHTMLManager();</span>
<span class="nc" id="L155">        theMatrixHTML.setCSSContent(ThemisDSMStyleSheet.CSS_DSM);</span>
<span class="nc" id="L156">        theMatrixHTML.getEventRegistrar().addEventListener(TethysUIEvent.BUILDPAGE, e -&gt; {</span>
<span class="nc" id="L157">            processReference(e.getDetails(String.class));</span>
<span class="nc" id="L158">            e.consume();</span>
<span class="nc" id="L159">        });</span>

        /* Create the module selection panel */
<span class="nc" id="L162">        final TethysUIPaneFactory myPanes = theGuiFactory.paneFactory();</span>
<span class="nc" id="L163">        final TethysUIBoxPaneManager myModuleSelect = myPanes.newHBoxPane();</span>
<span class="nc" id="L164">        myModuleSelect.addNode(myControls.newLabel(&quot;Module:&quot;));</span>
<span class="nc" id="L165">        theModuleButton = myButtons.newScrollButton(ThemisDSMModule.class);</span>
<span class="nc" id="L166">        myModuleSelect.addNode(theModuleButton);</span>
<span class="nc" id="L167">        theModuleButton.getEventRegistrar().addEventListener(TethysUIEvent.NEWVALUE, e -&gt; handleNewModule());</span>
<span class="nc" id="L168">        theModuleButton.setMenuConfigurator(e -&gt; buildModuleMenu());</span>

        /* Create the project selection panel */
<span class="nc" id="L171">        final TethysUIBoxPaneManager myProjectSelect = myPanes.newHBoxPane();</span>
<span class="nc" id="L172">        myProjectSelect.addNode(myControls.newLabel(&quot;Project:&quot;));</span>
<span class="nc" id="L173">        theProjectButton = myButtons.newButton();</span>
<span class="nc" id="L174">        theProjectButton.setTextOnly();</span>
<span class="nc" id="L175">        myProjectSelect.addNode(theProjectButton);</span>
<span class="nc" id="L176">        theProjectButton.getEventRegistrar().addEventListener(e -&gt; selectProject());</span>

        /* create the overall matrix status panel */
<span class="nc" id="L179">        final TethysUIBoxPaneManager myMatrixControl = myPanes.newHBoxPane();</span>
<span class="nc" id="L180">        myMatrixControl.addSpacer();</span>
<span class="nc" id="L181">        myMatrixControl.addNode(myProjectSelect);</span>
<span class="nc" id="L182">        myMatrixControl.addSpacer();</span>
<span class="nc" id="L183">        myMatrixControl.addNode(myModuleSelect);</span>
<span class="nc" id="L184">        myMatrixControl.addSpacer();</span>

        /* create the matrix panel */
<span class="nc" id="L187">        final TethysUIBorderPaneManager myMatrixPanel = myPanes.newBorderPane();</span>
<span class="nc" id="L188">        myMatrixPanel.setCentre(theMatrixHTML);</span>
<span class="nc" id="L189">        myMatrixPanel.setNorth(myMatrixControl);</span>

        /* Create the from selection panel */
<span class="nc" id="L192">        final TethysUIBoxPaneManager myFromSelect = myPanes.newHBoxPane();</span>
<span class="nc" id="L193">        myFromSelect.addNode(myControls.newLabel(&quot;From:&quot;));</span>
<span class="nc" id="L194">        theFromButton = myButtons.newScrollButton(ThemisDSMPackage.class);</span>
<span class="nc" id="L195">        myFromSelect.addNode(theFromButton);</span>
<span class="nc" id="L196">        theFromButton.getEventRegistrar().addEventListener(TethysUIEvent.NEWVALUE, e -&gt; handleNewFrom());</span>
<span class="nc" id="L197">        theFromButton.setMenuConfigurator(e -&gt; buildFromMenu());</span>

        /* Create the project selection panel */
<span class="nc" id="L200">        final TethysUIBoxPaneManager myToSelect = myPanes.newHBoxPane();</span>
<span class="nc" id="L201">        myToSelect.addNode(myControls.newLabel(&quot;To:&quot;));</span>
<span class="nc" id="L202">        theToButton = myButtons.newScrollButton(ThemisDSMPackage.class);</span>
<span class="nc" id="L203">        myToSelect.addNode(theToButton);</span>
<span class="nc" id="L204">        theToButton.getEventRegistrar().addEventListener(TethysUIEvent.NEWVALUE, e -&gt; handleNewTo());</span>
<span class="nc" id="L205">        theToButton.setMenuConfigurator(e -&gt; buildToMenu());</span>

        /* create the overall matrix status panel */
<span class="nc" id="L208">        final TethysUIBoxPaneManager myDependencyControl = myPanes.newHBoxPane();</span>
<span class="nc" id="L209">        myDependencyControl.addSpacer();</span>
<span class="nc" id="L210">        myDependencyControl.addNode(myFromSelect);</span>
<span class="nc" id="L211">        myDependencyControl.addSpacer();</span>
<span class="nc" id="L212">        myDependencyControl.addNode(myToSelect);</span>
<span class="nc" id="L213">        myDependencyControl.addSpacer();</span>

        /* create the matrix panel */
<span class="nc" id="L216">        final TethysUIBorderPaneManager myDependencyPanel = myPanes.newBorderPane();</span>
<span class="nc" id="L217">        myDependencyPanel.setCentre(theDependencyHTML);</span>
<span class="nc" id="L218">        myDependencyPanel.setNorth(myDependencyControl);</span>

        /* Create the TabPane */
<span class="nc" id="L221">        theTabPane = myPanes.newTabPane();</span>
<span class="nc" id="L222">        theTabPane.addTabItem(&quot;Matrix&quot;, myMatrixPanel);</span>
<span class="nc" id="L223">        theDependencyTab = theTabPane.addTabItem(&quot;Dependencies&quot;, myDependencyPanel);</span>

        /* Create the Stats panel */
<span class="nc" id="L226">        theStatsPanel = new ThemisStatsPanel(theGuiFactory);</span>
<span class="nc" id="L227">        theTabPane.addTabItem(&quot;Stats&quot;, theStatsPanel.getComponent());</span>

        /* Create the Source panel */
<span class="nc" id="L230">        theSourcePanel = new ThemisSourcePanel(theGuiFactory);</span>
<span class="nc" id="L231">        theTabPane.addTabItem(&quot;Source&quot;, theSourcePanel.getComponent());</span>

        /* Create the log tab */
<span class="nc" id="L234">        theLogSink = theGuiFactory.getLogSink();</span>
<span class="nc" id="L235">        theLogTab = theTabPane.addTabItem(&quot;Log&quot;, theLogSink);</span>
<span class="nc" id="L236">        theLogSink.getEventRegistrar().addEventListener(TethysUIEvent.NEWVALUE, e -&gt; theLogTab.setVisible(true));</span>
<span class="nc" id="L237">        theLogSink.getEventRegistrar().addEventListener(TethysUIEvent.WINDOWCLOSED, e -&gt; theLogTab.setVisible(false));</span>
<span class="nc" id="L238">        theLogTab.setVisible(theLogSink.isActive());</span>

        /* Initialise status */
<span class="nc" id="L241">        theProjectButton.setText(&quot;None&quot;);</span>
<span class="nc" id="L242">        theDependencyTab.setVisible(false);</span>
<span class="nc" id="L243">        theModuleButton.setEnabled(false);</span>
<span class="nc" id="L244">        theFromButton.setEnabled(false);</span>
<span class="nc" id="L245">        theToButton.setEnabled(false);</span>

        /* Handle the default location */
<span class="nc" id="L248">        final File myLocation = getDefaultLocation();</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (myLocation != null) {</span>
<span class="nc" id="L250">            handleNewProject(myLocation);</span>
        }
<span class="nc" id="L252">    }</span>

    @Override
    public TethysUITabPaneManager getComponent() {
<span class="nc" id="L256">        return theTabPane;</span>
    }

    /**
     * Handle select project.
     */
    void selectProject() {
        /* Determine initial directory */
<span class="nc" id="L264">        File myInit = getDefaultLocation();</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">        if (myInit == null) {</span>
<span class="nc" id="L266">            myInit = new File(System.getProperty(&quot;user.home&quot;));</span>
        }

        /* Determine the name of the directory to load */
<span class="nc" id="L270">        final TethysUIDialogFactory myDialogs = theGuiFactory.dialogFactory();</span>
<span class="nc" id="L271">        final TethysUIDirectorySelector myDialog = myDialogs.newDirectorySelector();</span>
<span class="nc" id="L272">        myDialog.setTitle(&quot;Select Project&quot;);</span>
<span class="nc" id="L273">        myDialog.setInitialDirectory(myInit);</span>
<span class="nc" id="L274">        final File myFile = myDialog.selectDirectory();</span>

        /* If we selected a file */
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (myFile != null) {</span>
            /* Handle the new project */
<span class="nc" id="L279">            handleNewProject(myFile);</span>
        }
<span class="nc" id="L281">    }</span>

    /**
     * Handle the new project.
     * @param pProjectDir the new project directory
     */
    private void handleNewProject(final File pProjectDir) {
        /* Parse the project*/
<span class="nc" id="L289">        theError = null;</span>
<span class="nc" id="L290">        final ThemisDSMProject myProject  = new ThemisDSMProject(pProjectDir);</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">        if (myProject.getError()  != null) {</span>
<span class="nc" id="L292">            theError = myProject.getError();</span>

<span class="nc bnc" id="L294" title="All 2 branches missed.">        } else if (myProject.hasModules()) {</span>
            /* Save details */
<span class="nc" id="L296">            storeDefaultLocation(pProjectDir);</span>

            /* Store details */
<span class="nc" id="L299">            theProject = myProject;</span>
<span class="nc" id="L300">            theProjectButton.setText(theProject.toString());</span>

            /* Set the new module */
<span class="nc" id="L303">            processNewModule(theProject.getDefaultModule());</span>

            /* Load statistics */
<span class="nc" id="L306">            handleNewStats(pProjectDir);</span>
        }

        /* Display the error */
<span class="nc bnc" id="L310" title="All 2 branches missed.">        if (theError != null) {</span>
<span class="nc" id="L311">            theLogSink.writeLogMessage(theError.getMessage());</span>
<span class="nc" id="L312">            theLogTab.setVisible(true);</span>
        }
<span class="nc" id="L314">    }</span>

    /**
     * Handle the new project.
     * @param pProjectDir the new project directory
     */
    private void handleNewStats(final File pProjectDir) {
        /* Analyse source of project */
<span class="nc" id="L322">        final ThemisAnalysisProject myProj = new ThemisAnalysisProject(pProjectDir);</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">        if (myProj.getError() != null) {</span>
<span class="nc" id="L324">            theError = myProj.getError();</span>
        } else {
            /* Parse the base project */
<span class="nc" id="L327">            final ThemisStatsParser myParser = new ThemisStatsParser();</span>
<span class="nc" id="L328">            final ThemisStatsProject myProject = myParser.parseProject(myProj);</span>
<span class="nc" id="L329">            theStatsPanel.initialiseTree(myProject);</span>
<span class="nc" id="L330">            theSourcePanel.initialiseTree(myProj);</span>
        }
<span class="nc" id="L332">    }</span>

    /**
     * Handle the new module.
     */
    private void handleNewModule() {
<span class="nc" id="L338">        processNewModule(theModuleButton.getValue());</span>
<span class="nc" id="L339">    }</span>

    /**
     * Process new module.
     * @param pModule the new Module
     */
    private void processNewModule(final ThemisDSMModule pModule) {
        /* Store the module */
<span class="nc" id="L347">        theModule = pModule;</span>
<span class="nc" id="L348">        theModuleButton.setValue(pModule);</span>
<span class="nc" id="L349">        theModuleButton.setEnabled(true);</span>

        /* Build matrix report */
<span class="nc" id="L352">        final String myDoc = ThemisDSMReport.reportOnModule(theModule);</span>
<span class="nc" id="L353">        theMatrixHTML.setHTMLContent(myDoc, &quot;&quot;);</span>

        /* Process the new from Package */
<span class="nc" id="L356">        processNewFrom(theModule.getDefaultPackage());</span>
<span class="nc" id="L357">    }</span>

    /**
     * Build the module menu.
     */
    private void buildModuleMenu() {
        /* Access builder */
<span class="nc" id="L364">        final TethysUIScrollMenu&lt;ThemisDSMModule&gt; myBuilder = theModuleButton.getMenu();</span>
<span class="nc" id="L365">        myBuilder.removeAllItems();</span>

        /* Loop through to add each module */
<span class="nc bnc" id="L368" title="All 2 branches missed.">        for (ThemisDSMModule myModule : theProject.listModules()) {</span>
<span class="nc" id="L369">            myBuilder.addItem(myModule);</span>
<span class="nc" id="L370">        }</span>
<span class="nc" id="L371">    }</span>

    /**
     * Handle the new fromPackage.
     */
    private void handleNewFrom() {
<span class="nc" id="L377">        processNewFrom(theFromButton.getValue());</span>
<span class="nc" id="L378">    }</span>

    /**
     * Process new module.
     * @param pPackage the new fromPackage
     */
    private void processNewFrom(final ThemisDSMPackage pPackage) {
        /* Store the module */
<span class="nc" id="L386">        theFrom = pPackage;</span>
<span class="nc" id="L387">        theFromButton.setValue(pPackage);</span>
<span class="nc" id="L388">        theFromButton.setEnabled(true);</span>
<span class="nc" id="L389">        theDependencyTab.setVisible(true);</span>

        /* Process the new from Package */
<span class="nc" id="L392">        processNewTo(theFrom.getDefaultReference());</span>
<span class="nc" id="L393">    }</span>

    /**
     * Build the from menu.
     */
    private void buildFromMenu() {
        /* Access builder */
<span class="nc" id="L400">        final TethysUIScrollMenu&lt;ThemisDSMPackage&gt; myBuilder = theFromButton.getMenu();</span>
<span class="nc" id="L401">        myBuilder.removeAllItems();</span>

        /* Loop through to add each package */
<span class="nc bnc" id="L404" title="All 2 branches missed.">        for (ThemisDSMPackage myPackage : theModule.listPackages()) {</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">            if (myPackage.hasReferences()) {</span>
<span class="nc" id="L406">                myBuilder.addItem(myPackage);</span>
            }
<span class="nc" id="L408">        }</span>
<span class="nc" id="L409">    }</span>

    /**
     * Handle the new toPackage.
     */
    private void handleNewTo() {
<span class="nc" id="L415">        processNewTo(theToButton.getValue());</span>
<span class="nc" id="L416">    }</span>

    /**
     * Process new toPackage.
     * @param pPackage the new toPackage
     */
    private void processNewTo(final ThemisDSMPackage pPackage) {
        /* Store the package */
<span class="nc" id="L424">        theToButton.setValue(pPackage);</span>
<span class="nc" id="L425">        theToButton.setEnabled(true);</span>

        /* Build matrix report */
<span class="nc" id="L428">        final String myDoc = ThemisDSMReport.reportOnPackageLinks(theFrom, pPackage);</span>
<span class="nc" id="L429">        theDependencyHTML.setHTMLContent(myDoc, &quot;&quot;);</span>
<span class="nc" id="L430">    }</span>

    /**
     * Build the to menu.
     */
    private void buildToMenu() {
        /* Access builder */
<span class="nc" id="L437">        final TethysUIScrollMenu&lt;ThemisDSMPackage&gt; myBuilder = theToButton.getMenu();</span>
<span class="nc" id="L438">        myBuilder.removeAllItems();</span>

        /* Loop through to add each package */
<span class="nc bnc" id="L441" title="All 2 branches missed.">        for (ThemisDSMPackage myPackage : theFrom.listReferences()) {</span>
<span class="nc" id="L442">            myBuilder.addItem(myPackage);</span>
<span class="nc" id="L443">        }</span>
<span class="nc" id="L444">    }</span>

    /**
     * Process the reference.
     * @param pReference the reference
     */
    private void processReference(final String pReference) {
        /* Split on the &quot;-&quot; */
<span class="nc" id="L452">        final String[] myTokens = pReference.split(ThemisDSMReport.SEP_REF);</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">        if (myTokens.length == 2) {</span>
            /* Access the relevant packages */
<span class="nc" id="L455">            final ThemisDSMPackage myFrom = theModule.getIndexedPackage(ThemisDSMReport.getIndexForKey(myTokens[0]));</span>
<span class="nc" id="L456">            final ThemisDSMPackage myTo = theModule.getIndexedPackage(ThemisDSMReport.getIndexForKey(myTokens[1]));</span>

            /* Set the new details */
<span class="nc" id="L459">            processNewFrom(myFrom);</span>
<span class="nc" id="L460">            processNewTo(myTo);</span>

            /* Select the tab */
<span class="nc" id="L463">            theDependencyTab.selectItem();</span>
        }
<span class="nc" id="L465">    }</span>

    /**
     * Obtain the default location.
     * @return the default location
     */
    private File getDefaultLocation() {
<span class="nc" id="L472">        final Preferences myPreferences = deriveHandle();</span>
<span class="nc" id="L473">        final String myLocation = myPreferences.get(&quot;DefaultProject&quot;, null);</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">        return myLocation == null ? null : new File(myLocation);</span>
    }

    /**
     * Store the default location.
     * @param pLocation the default location
     */
    private void storeDefaultLocation(final File pLocation) {
        /* Protect against exceptions */
        try {
<span class="nc" id="L484">            final Preferences myPreferences = deriveHandle();</span>
<span class="nc" id="L485">            myPreferences.put(&quot;DefaultProject&quot;, pLocation.getAbsolutePath());</span>
<span class="nc" id="L486">            myPreferences.flush();</span>
<span class="nc" id="L487">        } catch (BackingStoreException e) {</span>
<span class="nc" id="L488">            theError = new ThemisIOException(&quot;Failed to save preference&quot;, e);</span>
<span class="nc" id="L489">        }</span>
<span class="nc" id="L490">    }</span>

    /**
     * Derive handle for node.
     * @return the class name
     */
    private Preferences deriveHandle() {
        /* Obtain the class name */
<span class="nc" id="L498">        final Class&lt;?&gt; myClass = this.getClass();</span>
<span class="nc" id="L499">        String myName = myClass.getCanonicalName();</span>

        /* Obtain the package name */
<span class="nc" id="L502">        final String myPackage = myClass.getPackage().getName();</span>

        /* Strip off the package name */
<span class="nc" id="L505">        myName = myName.substring(myPackage.length() + 1);</span>

        /* Derive the handle */
<span class="nc" id="L508">        final Preferences myHandle = Preferences.userNodeForPackage(myClass);</span>
<span class="nc" id="L509">        return myHandle.node(myName);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>