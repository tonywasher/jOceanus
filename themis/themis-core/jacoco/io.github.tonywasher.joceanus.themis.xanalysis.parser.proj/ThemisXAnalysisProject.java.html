<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ThemisXAnalysisProject.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Themis Core Project Framework</a> &gt; <a href="index.source.html" class="el_package">io.github.tonywasher.joceanus.themis.xanalysis.parser.proj</a> &gt; <span class="el_source">ThemisXAnalysisProject.java</span></div><h1>ThemisXAnalysisProject.java</h1><pre class="source lang-java linenums">/*
 * Themis: Java Project Framework
 * Copyright 2012-2026. Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package io.github.tonywasher.joceanus.themis.xanalysis.parser.proj;

import io.github.tonywasher.joceanus.oceanus.base.OceanusException;
import io.github.tonywasher.joceanus.themis.exc.ThemisIOException;
import io.github.tonywasher.joceanus.themis.xanalysis.parser.base.ThemisXAnalysisParserDef;
import io.github.tonywasher.joceanus.themis.xanalysis.parser.proj.ThemisXAnalysisMaven.ThemisXAnalysisMavenId;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

/**
 * Project.
 */
public class ThemisXAnalysisProject {
    /**
     * Consolidation Pass error.
     */
    private static final String CONSOLIDATION_ERROR = &quot;Failed on consolidation Pass&quot;;

    /**
     * The project name.
     */
    private final String theName;

    /**
     * The location.
     */
    private final File theLocation;

    /**
     * The module map.
     */
    private final Map&lt;ThemisXAnalysisMavenId, ThemisXAnalysisModule&gt; theModules;

    /**
     * The dependencies.
     */
    private final List&lt;ThemisXAnalysisMavenId&gt; theDependencies;

    /**
     * Constructor.
     *
     * @param pLocation the project location
     * @throws OceanusException on error
     */
<span class="fc" id="L68">    public ThemisXAnalysisProject(final File pLocation) throws OceanusException {</span>
        /* Store the name and location */
<span class="fc" id="L70">        theLocation = pLocation;</span>

        /* Create the list */
<span class="fc" id="L73">        theModules = new LinkedHashMap&lt;&gt;();</span>
<span class="fc" id="L74">        theDependencies = new ArrayList&lt;&gt;();</span>

        /* Initiate search for modules */
<span class="fc" id="L77">        final ThemisXAnalysisMaven myPom = parseProjectFile(null, new File(theLocation, ThemisXAnalysisMaven.POM));</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">        theName = myPom == null ? null : myPom.getMavenId().getArtifactId();</span>

        /* Remove own mavenIds from dependency list */
<span class="fc" id="L81">        theDependencies.removeIf(theModules::containsKey);</span>

        /* For all dependencies */
<span class="fc" id="L84">        final List&lt;ThemisXAnalysisMavenId&gt; myDependencies = new ArrayList&lt;&gt;(theDependencies);</span>
<span class="fc bfc" id="L85" title="All 2 branches covered.">        for (ThemisXAnalysisMavenId myId : myDependencies) {</span>
<span class="fc" id="L86">            processDependency(myId);</span>
<span class="fc" id="L87">        }</span>
<span class="fc" id="L88">    }</span>

    /**
     * Process dependency.
     *
     * @param pId the maven id
     */
    private void processDependency(final ThemisXAnalysisMavenId pId) throws OceanusException {
<span class="fc" id="L96">        final File myFile = pId.getMavenPomPath();</span>
        /* Protect against exceptions */
<span class="fc" id="L98">        try (InputStream myInStream = new FileInputStream(myFile)) {</span>
            /* Parse the Project definition file */
<span class="fc" id="L100">            final ThemisXAnalysisMaven myPom = new ThemisXAnalysisMaven(null, myInStream);</span>

            /* Add any unique dependencies */
<span class="fc bfc" id="L103" title="All 2 branches covered.">            for (final ThemisXAnalysisMavenId myDepId : myPom.getDependencies()) {</span>
<span class="fc bfc" id="L104" title="All 2 branches covered.">                if (!theDependencies.contains(myDepId)) {</span>
<span class="fc" id="L105">                    theDependencies.add(myDepId);</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">                    if (myDepId.getClassifier() == null) {</span>
<span class="fc" id="L107">                        processDependency(myDepId);</span>
                    }
                }
<span class="fc" id="L110">            }</span>
<span class="nc" id="L111">        } catch (IOException e) {</span>
<span class="nc" id="L112">            throw new ThemisIOException(&quot;Failed to parse pom file&quot;, e);</span>
<span class="fc" id="L113">        }</span>
<span class="fc" id="L114">    }</span>

    /**
     * Obtain the name.
     *
     * @return the name
     */
    public String getName() {
<span class="nc" id="L122">        return theName;</span>
    }

    /**
     * Obtain the location.
     *
     * @return the location
     */
    File getLocation() {
<span class="nc" id="L131">        return theLocation;</span>
    }

    /**
     * Obtain the modules.
     *
     * @return the modules
     */
    public List&lt;ThemisXAnalysisModule&gt; getModules() {
<span class="fc" id="L140">        return new ArrayList&lt;&gt;(theModules.values());</span>
    }

    /**
     * Obtain the dependencies.
     *
     * @return the dependencies
     */
    public List&lt;ThemisXAnalysisMavenId&gt; getDependencies() {
<span class="fc" id="L149">        return theDependencies;</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L154">        return theName;</span>
    }

    /**
     * Parse the maven project file.
     *
     * @param pParent the parent
     * @param pPom    the project file
     * @return the artifact name
     * @throws OceanusException on error
     */
    private ThemisXAnalysisMaven parseProjectFile(final ThemisXAnalysisMaven pParent,
                                                  final File pPom) throws OceanusException {
        /* If the pom file does not exist, just return */
<span class="pc bpc" id="L168" title="1 of 2 branches missed.">        if (!pPom.exists()) {</span>
<span class="nc" id="L169">            return null;</span>
        }

        /* Protect against exceptions */
<span class="fc" id="L173">        try (InputStream myInStream = new FileInputStream(pPom)) {</span>
            /* Parse the Project definition file */
<span class="fc" id="L175">            final ThemisXAnalysisMaven myPom = new ThemisXAnalysisMaven(pParent, myInStream);</span>

            /* If source directory exists */
<span class="fc" id="L178">            final File mySrc = new File(pPom.getParent(), ThemisXAnalysisModule.PATH_XTRA);</span>
<span class="fc bfc" id="L179" title="All 2 branches covered.">            if (mySrc.exists()</span>
<span class="pc bpc" id="L180" title="1 of 2 branches missed.">                    &amp;&amp; mySrc.isDirectory()) {</span>
                /* Add the module to the list */
<span class="fc" id="L182">                theModules.put(myPom.getMavenId(), new ThemisXAnalysisModule(new File(pPom.getParent()), myPom));</span>

                /* Add any unique dependencies */
<span class="fc bfc" id="L185" title="All 2 branches covered.">                for (final ThemisXAnalysisMavenId myDepId : myPom.getDependencies()) {</span>
<span class="fc bfc" id="L186" title="All 2 branches covered.">                    if (!theDependencies.contains(myDepId)) {</span>
<span class="fc" id="L187">                        theDependencies.add(myDepId);</span>
                    }
<span class="fc" id="L189">                }</span>
            }

            /* Loop through the modules */
<span class="fc bfc" id="L193" title="All 2 branches covered.">            for (final String myModuleName : myPom.getModules()) {</span>
                /* Access module directory */
<span class="fc" id="L195">                final File myModuleDir = new File(pPom.getParentFile(), myModuleName);</span>

                /* Process the project file */
<span class="fc" id="L198">                parseProjectFile(myPom, new File(myModuleDir, ThemisXAnalysisMaven.POM));</span>
<span class="fc" id="L199">            }</span>

            /* Return the POM */
<span class="fc" id="L202">            return myPom;</span>

            /* Catch exceptions */
<span class="nc" id="L205">        } catch (IOException e) {</span>
            /* Convert Exception */
<span class="nc" id="L207">            throw new ThemisIOException(&quot;Failed to parse Project file&quot;, e);</span>
        }
    }

    /**
     * parse the java code.
     *
     * @param pParser the parser
     * @throws OceanusException on error
     */
    public void parseJavaCode(final ThemisXAnalysisParserDef pParser) throws OceanusException {
        /* Loop through the modules */
<span class="fc bfc" id="L219" title="All 2 branches covered.">        for (ThemisXAnalysisModule myModule : theModules.values()) {</span>
            /* Process the module */
<span class="fc" id="L221">            myModule.parseJavaCode(pParser);</span>
<span class="fc" id="L222">        }</span>
<span class="fc" id="L223">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>