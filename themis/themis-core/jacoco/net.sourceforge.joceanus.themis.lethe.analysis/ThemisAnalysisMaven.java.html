<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ThemisAnalysisMaven.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Themis Core Project Framework</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.themis.lethe.analysis</a> &gt; <span class="el_source">ThemisAnalysisMaven.java</span></div><h1>ThemisAnalysisMaven.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Themis: Java Project Framework
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
package net.sourceforge.joceanus.themis.lethe.analysis;

import net.sourceforge.joceanus.oceanus.base.OceanusException;
import net.sourceforge.joceanus.themis.exc.ThemisDataException;
import net.sourceforge.joceanus.themis.exc.ThemisIOException;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.xml.sax.SAXException;

import javax.xml.XMLConstants;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import java.io.BufferedInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.List;
import java.util.Objects;

/**
 * Maven pom.xml parser.
 */
public class ThemisAnalysisMaven {
    /**
     * Project filename.
     */
    public static final String POM = &quot;pom.xml&quot;;

    /**
     * Document name.
     */
    private static final String DOC_NAME = &quot;project&quot;;

    /**
     * Parent element.
     */
    private static final String EL_PARENT = &quot;parent&quot;;

    /**
     * Modules element.
     */
    private static final String EL_MODULES = &quot;modules&quot;;

    /**
     * Module element.
     */
    private static final String EL_MODULE = &quot;module&quot;;

    /**
     * Dependencies element.
     */
    private static final String EL_DEPENDENCIES = &quot;dependencies&quot;;

    /**
     * Dependency element.
     */
    private static final String EL_DEPENDENCY = &quot;dependency&quot;;

    /**
     * The Id.
     */
    private final ThemisAnalysisMavenId theId;

    /**
     * The modules.
     */
    private final List&lt;String&gt; theModules;

    /**
     * The dependencies.
     */
    private final List&lt;ThemisAnalysisMavenId&gt; theDependencies;

    /**
     * Constructor.
     * @param pInputStream the input stream to read
     * @throws OceanusException on error
     */
<span class="nc" id="L97">    public ThemisAnalysisMaven(final InputStream pInputStream) throws OceanusException {</span>
        /* Create the module list */
<span class="nc" id="L99">        theModules = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L100">        theDependencies = new ArrayList&lt;&gt;();</span>

        /* Protect against exceptions */
<span class="nc" id="L103">        try (BufferedInputStream myInBuffer = new BufferedInputStream(pInputStream)) {</span>
<span class="nc" id="L104">            final DocumentBuilderFactory myFactory = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L105">            myFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</span>
<span class="nc" id="L106">            myFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, &quot;&quot;);</span>
<span class="nc" id="L107">            myFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, &quot;&quot;);</span>
<span class="nc" id="L108">            final DocumentBuilder myBuilder = myFactory.newDocumentBuilder();</span>

            /* Build the document from the input stream */
<span class="nc" id="L111">            final Document myDocument = myBuilder.parse(myInBuffer);</span>
<span class="nc" id="L112">            theId = parseProjectFile(myDocument);</span>

            /* Handle exceptions */
<span class="nc" id="L115">        } catch (IOException</span>
                | ParserConfigurationException
                | SAXException e) {
<span class="nc" id="L118">            throw new ThemisIOException(&quot;Exception accessing Pom file&quot;, e);</span>
<span class="nc" id="L119">        }</span>
<span class="nc" id="L120">    }</span>

    @Override
    public String toString() {
<span class="nc" id="L124">        return theId.toString();</span>
    }

    /**
     * Obtain the list of modules.
     * @return the list
     */
    public ThemisAnalysisMavenId getMavenId() {
<span class="nc" id="L132">        return theId;</span>
    }

    /**
     * Obtain the list of modules.
     * @return the list
     */
    public List&lt;String&gt; getModules() {
<span class="nc" id="L140">        return theModules;</span>
    }

    /**
     * Parse the project file.
     * @param pDocument the document
     * @return the MavenId
     * @throws OceanusException on error
     */
    public ThemisAnalysisMavenId parseProjectFile(final Document pDocument) throws OceanusException {
        /* Access the document element */
<span class="nc" id="L151">        final Element myDoc = pDocument.getDocumentElement();</span>

        /* Check that the document name is correct */
<span class="nc bnc" id="L154" title="All 2 branches missed.">        if (!Objects.equals(myDoc.getNodeName(), DOC_NAME)) {</span>
<span class="nc" id="L155">            throw new ThemisDataException(&quot;Invalid document type&quot;);</span>
        }

        /* Obtain parent definition if any */
<span class="nc" id="L159">        final Element myParentEl = getElement(myDoc, EL_PARENT);</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">        final ThemisAnalysisMavenId myParent = myParentEl == null</span>
<span class="nc" id="L161">                ? null</span>
<span class="nc" id="L162">                : new ThemisAnalysisMavenId(myParentEl);</span>

        /* Obtain our mavenId */
<span class="nc" id="L165">        final ThemisAnalysisMavenId myId = new ThemisAnalysisMavenId(myDoc, myParent);</span>

        /* Process modules */
<span class="nc" id="L168">        final Element myModules = getElement(myDoc, EL_MODULES);</span>
<span class="nc" id="L169">        processModules(myModules);</span>

        /* Process dependencies */
<span class="nc" id="L172">        final Element myDependencies = getElement(myDoc, EL_DEPENDENCIES);</span>
<span class="nc" id="L173">        processDependencies(myDependencies, myId);</span>

        /* Return the Id */
<span class="nc" id="L176">        return myId;</span>
    }

    /**
     * Obtain element value.
     * @param pElement the element
     * @param pValue the value name
     * @return the value
     */
    static String getElementValue(final Element pElement,
                                  final String pValue) {
        /* Return null if no element */
<span class="nc bnc" id="L188" title="All 2 branches missed.">        if (pElement == null) {</span>
<span class="nc" id="L189">            return null;</span>
        }

        /* Loop through the children */
<span class="nc" id="L193">        for (Node myChild = pElement.getFirstChild();</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">             myChild != null;</span>
<span class="nc" id="L195">             myChild = myChild.getNextSibling()) {</span>
            /* Return result if we have a match */
<span class="nc bnc" id="L197" title="All 2 branches missed.">            if (myChild instanceof Element</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">                    &amp;&amp; pValue.equals(myChild.getNodeName())) {</span>
<span class="nc" id="L199">                return myChild.getTextContent();</span>
            }
        }

        /* Not found */
<span class="nc" id="L204">        return null;</span>
    }

    /**
     * Obtain element value.
     * @param pElement the element
     * @param pValue the value name
     * @return the value
     */
    static Element getElement(final Element pElement,
                              final String pValue) {
        /* Return null if no element */
<span class="nc bnc" id="L216" title="All 2 branches missed.">        if (pElement == null) {</span>
<span class="nc" id="L217">            return null;</span>
        }

        /* Loop through the children */
<span class="nc" id="L221">        for (Node myChild = pElement.getFirstChild();</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">             myChild != null;</span>
<span class="nc" id="L223">             myChild = myChild.getNextSibling()) {</span>
            /* Return result if we have a match */
<span class="nc bnc" id="L225" title="All 2 branches missed.">            if (myChild instanceof Element myElement</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">                    &amp;&amp; pValue.equals(myChild.getNodeName())) {</span>
<span class="nc" id="L227">                return myElement;</span>
            }
        }

        /* Not found */
<span class="nc" id="L232">        return null;</span>
    }

    /**
     * Process modules.
     * @param pModules the modules
     */
    private void processModules(final Element pModules) {
        /* Return if no element */
<span class="nc bnc" id="L241" title="All 2 branches missed.">        if (pModules == null) {</span>
<span class="nc" id="L242">            return;</span>
        }

        /* Loop through the children */
<span class="nc" id="L246">        for (Node myChild = pModules.getFirstChild();</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">             myChild != null;</span>
<span class="nc" id="L248">             myChild = myChild.getNextSibling()) {</span>
            /* Return result if we have a match */
<span class="nc bnc" id="L250" title="All 2 branches missed.">            if (myChild instanceof Element</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">                    &amp;&amp; EL_MODULE.equals(myChild.getNodeName())) {</span>
<span class="nc" id="L252">                theModules.add(myChild.getTextContent());</span>
            }
        }
<span class="nc" id="L255">    }</span>

    /**
     * Process dependencies.
     * @param pDependencies the dependencies
     * @param pParent the parentId
     */
    private void processDependencies(final Element pDependencies,
                                     final ThemisAnalysisMavenId pParent) {
        /* Return if no element */
<span class="nc bnc" id="L265" title="All 2 branches missed.">        if (pDependencies == null) {</span>
<span class="nc" id="L266">            return;</span>
        }

        /* Loop through the children */
<span class="nc" id="L270">        for (Node myChild = pDependencies.getFirstChild();</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">             myChild != null;</span>
<span class="nc" id="L272">             myChild = myChild.getNextSibling()) {</span>
            /* Return result if we have a match */
<span class="nc bnc" id="L274" title="All 2 branches missed.">            if (myChild instanceof Element myElement</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">                    &amp;&amp; EL_DEPENDENCY.equals(myChild.getNodeName())) {</span>
<span class="nc" id="L276">                theDependencies.add(new ThemisAnalysisMavenId(myElement, pParent));</span>
            }
        }
<span class="nc" id="L279">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>