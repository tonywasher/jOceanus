<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OceanusDateConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Oceanus Java Core Utilities</a> &gt; <a href="index.source.html" class="el_package">io.github.tonywasher.joceanus.oceanus.date</a> &gt; <span class="el_source">OceanusDateConfig.java</span></div><h1>OceanusDateConfig.java</h1><pre class="source lang-java linenums">/*
 * Oceanus: Java Utilities
 * Copyright 2012-2026. Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package io.github.tonywasher.joceanus.oceanus.date;

import io.github.tonywasher.joceanus.oceanus.event.OceanusEventManager;
import io.github.tonywasher.joceanus.oceanus.event.OceanusEventRegistrar;
import io.github.tonywasher.joceanus.oceanus.event.OceanusEventRegistrar.OceanusEventProvider;

import java.time.LocalDate;
import java.util.Locale;
import java.util.function.Predicate;

/**
 * Date Configuration.
 */
public class OceanusDateConfig
        implements OceanusEventProvider&lt;OceanusDateEvent&gt; {
    /**
     * The Event Manager.
     */
    private final OceanusEventManager&lt;OceanusDateEvent&gt; theEventManager;

    /**
     * The formatter.
     */
    private final OceanusDateFormatter theFormatter;

    /**
     * The Locale.
     */
    private Locale theLocale;

    /**
     * Show Narrow days.
     */
    private boolean doShowNarrowDays;

    /**
     * Allow null date selection.
     */
    private boolean allowNullDateSelection;

    /**
     * The selected date.
     */
    private OceanusDate theSelected;

    /**
     * The earliest select-able date (or null if no lower bound).
     */
    private OceanusDate theEarliest;

    /**
     * The latest select-able date (or null if no upper bound).
     */
    private OceanusDate theLatest;

    /**
     * The list of disallowed dates.
     */
    private Predicate&lt;OceanusDate&gt; theAllowed;

    /**
     * The active display month.
     */
    private OceanusDate theMonth;

    /**
     * Constructor.
     *
     * @param pFormatter the date formatter
     */
<span class="nc" id="L87">    public OceanusDateConfig(final OceanusDateFormatter pFormatter) {</span>
        /* Create resources */
<span class="nc" id="L89">        theFormatter = pFormatter;</span>
<span class="nc" id="L90">        theEventManager = new OceanusEventManager&lt;&gt;();</span>
<span class="nc" id="L91">        setLocale(pFormatter.getLocale());</span>

        /* Initialise the allowed predicate */
<span class="nc" id="L94">        theAllowed = d -&gt; true;</span>

        /* Listen to locale changes */
<span class="nc" id="L97">        theFormatter.getEventRegistrar().addEventListener(e -&gt; setLocale(theFormatter.getLocale()));</span>
<span class="nc" id="L98">    }</span>

    @Override
    public OceanusEventRegistrar&lt;OceanusDateEvent&gt; getEventRegistrar() {
<span class="nc" id="L102">        return theEventManager.getEventRegistrar();</span>
    }

    /**
     * Get the locale.
     *
     * @return the locale
     */
    public Locale getLocale() {
<span class="nc" id="L111">        return theLocale;</span>
    }

    /**
     * Get the selected date.
     *
     * @return the Selected date
     */
    public OceanusDate getSelectedDate() {
<span class="nc" id="L120">        return theSelected;</span>
    }

    /**
     * Get the earliest select-able date.
     *
     * @return the Earliest date
     */
    public OceanusDate getEarliestDate() {
<span class="nc" id="L129">        return theEarliest;</span>
    }

    /**
     * Get the latest select-able date.
     *
     * @return the Latest date
     */
    public OceanusDate getLatestDate() {
<span class="nc" id="L138">        return theLatest;</span>
    }

    /**
     * Get the current month.
     *
     * @return the current month
     */
    public OceanusDate getCurrentMonth() {
<span class="nc" id="L147">        return theMonth;</span>
    }

    /**
     * Allow Null Date selection.
     *
     * @return true/false
     */
    public boolean allowNullDateSelection() {
<span class="nc" id="L156">        return allowNullDateSelection;</span>
    }

    /**
     * Show Narrow Days.
     *
     * @return true/false
     */
    public boolean showNarrowDays() {
<span class="nc" id="L165">        return doShowNarrowDays;</span>
    }

    /**
     * Set the Allowed predicate.
     *
     * @param pAllowed the predicate
     */
    public void setAllowed(final Predicate&lt;OceanusDate&gt; pAllowed) {
<span class="nc" id="L174">        theAllowed = pAllowed;</span>
<span class="nc" id="L175">    }</span>

    /**
     * Determine whether the day in the month is allowed.
     *
     * @param pDay the day of the current month
     * @return true/false
     */
    public boolean isAllowed(final int pDay) {
<span class="nc" id="L184">        final OceanusDate myDate = new OceanusDate(theMonth);</span>
<span class="nc" id="L185">        myDate.adjustDay(pDay - 1);</span>
<span class="nc" id="L186">        return theAllowed.test(myDate);</span>
    }

    /**
     * Set the Locale.
     *
     * @param pLocale the Locale
     */
    public final void setLocale(final Locale pLocale) {
        /* Store locale */
<span class="nc" id="L196">        theLocale = pLocale;</span>

        /* Request rebuild of names */
<span class="nc" id="L199">        rebuildNames();</span>
<span class="nc" id="L200">    }</span>

    /**
     * Allow null date selection. If this flag is set an additional button will be displayed
     * allowing the user to explicitly select no date, thus setting the SelectedDate to null.
     *
     * @param pAllowNullDateSelection true/false
     */
    public void setAllowNullDateSelection(final boolean pAllowNullDateSelection) {
<span class="nc" id="L209">        allowNullDateSelection = pAllowNullDateSelection;</span>
<span class="nc" id="L210">    }</span>

    /**
     * Show Narrow Days. If this flag is set Days are show in narrow rather than short form.
     *
     * @param pShowNarrowDays true/false
     */
    public void setShowNarrowDays(final boolean pShowNarrowDays) {
        /* Set options */
<span class="nc" id="L219">        doShowNarrowDays = pShowNarrowDays;</span>

        /* Request rebuild of names */
<span class="nc" id="L222">        rebuildNames();</span>
<span class="nc" id="L223">    }</span>

    /**
     * Rebuild names.
     */
    protected final void rebuildNames() {
        /* Fire event */
<span class="nc" id="L230">        theEventManager.fireEvent(OceanusDateEvent.FORMATCHANGED);</span>
<span class="nc" id="L231">    }</span>

    /**
     * Set the earliest date. This is the earliest date that may be selected. If the configured
     * latest date is earlier than this date, it will be set to this date to ensure a valid range.
     *
     * @param pEarliest the Earliest select-able date (or null if unlimited)
     */
    public final void setEarliestDate(final OceanusDate pEarliest) {
        /* Default the field to null */
<span class="nc" id="L241">        theEarliest = null;</span>

        /* If we have an earliest */
<span class="nc bnc" id="L244" title="All 2 branches missed.">        if (pEarliest != null) {</span>
            /* Store the date */
<span class="nc" id="L246">            theEarliest = pEarliest;</span>

            /* If we have a latest date, reset if necessary */
<span class="nc bnc" id="L249" title="All 2 branches missed.">            if (theLatest != null</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">                    &amp;&amp; theLatest.compareTo(theEarliest) &lt; 0) {</span>
<span class="nc" id="L251">                theLatest = theEarliest;</span>
            }
        }
<span class="nc" id="L254">    }</span>

    /**
     * Set the latest date. This is the latest date that may be selected. If the configured earliest
     * date is later than this date, it will be set to this date to ensure a valid range.
     *
     * @param pLatest the Latest select-able date (or null if unlimited)
     */
    public final void setLatestDate(final OceanusDate pLatest) {
        /* Null the field */
<span class="nc" id="L264">        theLatest = null;</span>

        /* If we have an earliest */
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (pLatest != null) {</span>
            /* Store the date */
<span class="nc" id="L269">            theLatest = pLatest;</span>

            /* If we have an earliest date, reset if necessary */
<span class="nc bnc" id="L272" title="All 2 branches missed.">            if (theEarliest != null</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">                    &amp;&amp; theLatest.compareTo(theEarliest) &lt; 0) {</span>
<span class="nc" id="L274">                theEarliest = theLatest;</span>
            }
        }
<span class="nc" id="L277">    }</span>

    /**
     * Format a date according to configured rules.
     *
     * @param pDate the date to format
     * @return the formatted date
     */
    public String formatDate(final LocalDate pDate) {
        /* Handle null */
<span class="nc bnc" id="L287" title="All 2 branches missed.">        if (pDate == null) {</span>
<span class="nc" id="L288">            return null;</span>
        }

        /* Format the date */
<span class="nc" id="L292">        return theFormatter.formatLocalDate(pDate);</span>
    }

    /**
     * Capitalise first letter of string.
     *
     * @param pValue the string to capitalise the first letter of
     * @return the capitalised string
     */
    public String capitaliseString(final String pValue) {
<span class="nc" id="L302">        String myValue = pValue;</span>

        /* If the first UniCode item is lowerCase */
<span class="nc bnc" id="L305" title="All 2 branches missed.">        if (Character.isLowerCase(pValue.codePointAt(0))) {</span>
            /* Locate the length of the first character */
<span class="nc" id="L307">            final int iCharLen = pValue.offsetByCodePoints(0, 1);</span>

            /* UpperCase the first iCharLen letters */
<span class="nc" id="L310">            myValue = pValue.substring(0, iCharLen).toUpperCase(theLocale)</span>
<span class="nc" id="L311">                    + pValue.substring(iCharLen);</span>
        }

        /* Return the capitalised value */
<span class="nc" id="L315">        return myValue;</span>
    }

    /**
     * Obtain current date.
     *
     * @return the current date
     */
    public OceanusDate currentDate() {
<span class="nc" id="L324">        return new OceanusDate();</span>
    }

    /**
     * Obtain current day of month or zero if not current month.
     *
     * @return the current month day
     */
    public int getCurrentDay() {
<span class="nc" id="L333">        final OceanusDate myDate = currentDate();</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">        return isSameMonth(myDate, theMonth)</span>
<span class="nc" id="L335">                ? myDate.getDay()</span>
<span class="nc" id="L336">                : 0;</span>
    }

    /**
     * Obtain Selected day of month or zero if not current month.
     *
     * @return the selected month day
     */
    public int getSelectedDay() {
<span class="nc" id="L345">        final OceanusDate myDate = getSelectedDate();</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">        return isSameMonth(myDate, theMonth)</span>
<span class="nc" id="L347">                ? myDate.getDay()</span>
<span class="nc" id="L348">                : 0;</span>
    }

    /**
     * Obtain Earliest day of month or zero if not current month.
     *
     * @return the earliest month day
     */
    public int getEarliestDay() {
<span class="nc bnc" id="L357" title="All 2 branches missed.">        return isSameMonth(theEarliest, theMonth)</span>
<span class="nc" id="L358">                ? theEarliest.getDay()</span>
<span class="nc" id="L359">                : 0;</span>
    }

    /**
     * Obtain Latest day of month or zero if not current month.
     *
     * @return the latest month day
     */
    public int getLatestDay() {
<span class="nc bnc" id="L368" title="All 2 branches missed.">        return isSameMonth(theLatest, theMonth)</span>
<span class="nc" id="L369">                ? theLatest.getDay()</span>
<span class="nc" id="L370">                : 0;</span>
    }

    /**
     * Adjust current month to previous month.
     */
    public void previousMonth() {
<span class="nc" id="L377">        theMonth.adjustMonth(-1);</span>
<span class="nc" id="L378">    }</span>

    /**
     * Adjust current month to next month.
     */
    public void nextMonth() {
<span class="nc" id="L384">        theMonth.adjustMonth(1);</span>
<span class="nc" id="L385">    }</span>

    /**
     * Adjust current month to previous year.
     */
    public void previousYear() {
<span class="nc" id="L391">        theMonth.adjustYear(-1);</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">        if (theEarliest != null</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">                &amp;&amp; theMonth.compareTo(theEarliest) &lt; 0) {</span>
<span class="nc" id="L394">            theMonth = new OceanusDate(theEarliest);</span>
<span class="nc" id="L395">            theMonth.startCalendarMonth();</span>
        }
<span class="nc" id="L397">    }</span>

    /**
     * Adjust current month to next year.
     */
    public void nextYear() {
<span class="nc" id="L403">        theMonth.adjustYear(1);</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">        if (theLatest != null</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">                &amp;&amp; theMonth.compareTo(theLatest) &gt; 0) {</span>
<span class="nc" id="L406">            theMonth = new OceanusDate(theLatest);</span>
<span class="nc" id="L407">            theMonth.startCalendarMonth();</span>
        }
<span class="nc" id="L409">    }</span>

    /**
     * Set the selected date.
     *
     * @param pDate the Selected date
     */
    public final void setSelectedDate(final OceanusDate pDate) {
        /* Store the date */
<span class="nc" id="L418">        theSelected = pDate;</span>
<span class="nc" id="L419">    }</span>

    /**
     * Set selected day in current month (called from dialog).
     *
     * @param pDay the selected day
     */
    public void setSelectedDay(final int pDay) {
<span class="nc" id="L427">        final OceanusDate myOld = getSelectedDate();</span>
<span class="nc" id="L428">        OceanusDate myNew = null;</span>

        /* If we are selecting a proper date */
<span class="nc bnc" id="L431" title="All 2 branches missed.">        if (pDay &gt; 0) {</span>
            /* Build the new selected date */
<span class="nc" id="L433">            myNew = new OceanusDate(theMonth);</span>
<span class="nc" id="L434">            myNew.adjustDay(pDay - 1);</span>
        }

        /* Ignore if there is no change */
<span class="nc bnc" id="L438" title="All 2 branches missed.">        if (!isDateChanged(myOld, myNew)) {</span>
<span class="nc" id="L439">            return;</span>
        }

        /* Store the explicitly selected date */
<span class="nc" id="L443">        theSelected = myNew;</span>
<span class="nc" id="L444">    }</span>

    /**
     * Initialise the current month.
     */
    public void initialiseCurrent() {
        /* Access Selected Date */
<span class="nc" id="L451">        OceanusDate myDate = theSelected;</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">        if (myDate == null) {</span>
<span class="nc" id="L453">            myDate = currentDate();</span>
        }

        /* Move to start date if we are earlier */
<span class="nc bnc" id="L457" title="All 2 branches missed.">        if (theEarliest != null</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">                &amp;&amp; myDate.compareTo(theEarliest) &lt; 0) {</span>
<span class="nc" id="L459">            myDate = theEarliest;</span>
        }

        /* Move to end date if we are later */
<span class="nc bnc" id="L463" title="All 2 branches missed.">        if (theLatest != null</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">                &amp;&amp; myDate.compareTo(theLatest) &gt; 0) {</span>
<span class="nc" id="L465">            myDate = theLatest;</span>
        }

        /* Set to 1st of month and record it */
<span class="nc" id="L469">        theMonth = new OceanusDate(myDate);</span>
<span class="nc" id="L470">        theMonth.startCalendarMonth();</span>
<span class="nc" id="L471">    }</span>

    /**
     * Has the date changed?
     *
     * @param pFirst  the first date
     * @param pSecond the second date
     * @return &lt;code&gt;true/false&lt;/code&gt;
     */
    public static boolean isDateChanged(final OceanusDate pFirst,
                                        final OceanusDate pSecond) {
<span class="nc bnc" id="L482" title="All 2 branches missed.">        if (pFirst == null) {</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">            return pSecond != null;</span>
        } else {
<span class="nc bnc" id="L485" title="All 2 branches missed.">            return !pFirst.equals(pSecond);</span>
        }
    }

    /**
     * Are the dates in the same month.
     *
     * @param pFirst  the first date (maybe null)
     * @param pSecond the second date
     * @return true/false
     */
    public static boolean isSameMonth(final OceanusDate pFirst,
                                      final OceanusDate pSecond) {
<span class="nc bnc" id="L498" title="All 2 branches missed.">        if (!isSameYear(pFirst, pSecond)) {</span>
<span class="nc" id="L499">            return false;</span>
        } else {
<span class="nc bnc" id="L501" title="All 2 branches missed.">            return pFirst.getMonth() == pSecond.getMonth();</span>
        }
    }

    /**
     * Are the dates in the same year.
     *
     * @param pFirst  the first date (maybe null)
     * @param pSecond the second date
     * @return true/false
     */
    public static boolean isSameYear(final OceanusDate pFirst,
                                     final OceanusDate pSecond) {
<span class="nc bnc" id="L514" title="All 2 branches missed.">        if (pFirst == null) {</span>
<span class="nc" id="L515">            return false;</span>
        }
<span class="nc bnc" id="L517" title="All 2 branches missed.">        return pFirst.getYear() == pSecond.getYear();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>