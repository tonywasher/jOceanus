<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OceanusDateRangeState.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Oceanus Java Core Utilities</a> &gt; <a href="index.source.html" class="el_package">io.github.tonywasher.joceanus.oceanus.date</a> &gt; <span class="el_source">OceanusDateRangeState.java</span></div><h1>OceanusDateRangeState.java</h1><pre class="source lang-java linenums">/*
 * Oceanus: Java Utilities
 * Copyright 2012-2026. Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package io.github.tonywasher.joceanus.oceanus.date;

import java.util.Locale;

/**
 * State for JDateDayRange Selection panel.
 */
public class OceanusDateRangeState {
    /**
     * base date is start of period?
     */
    private final boolean isBaseStartOfPeriod;

    /**
     * The Overall Range.
     */
    private OceanusDateRange theOverallRange;

    /**
     * The Range.
     */
    private OceanusDateRange theRange;

    /**
     * The start Date.
     */
    private OceanusDate theStartDate;

    /**
     * The end Date.
     */
    private OceanusDate theEndDate;

    /**
     * The base Date.
     */
    private OceanusDate theBaseDate;

    /**
     * The Date Period.
     */
    private OceanusDatePeriod thePeriod;

    /**
     * Is the period locked?
     */
    private boolean isLocked;

    /**
     * Can we select a next period within the available range.
     */
    private boolean isNextOK;

    /**
     * Can we select a previous period within the available range.
     */
    private boolean isPrevOK;

    /**
     * Constructor.
     *
     * @param pBaseIsStart is the baseDate the start of the period? (true/false)
     */
<span class="nc" id="L80">    public OceanusDateRangeState(final boolean pBaseIsStart) {</span>
        /* Record parameters */
<span class="nc" id="L82">        isBaseStartOfPeriod = pBaseIsStart;</span>

        /* Default the period and overall range */
<span class="nc" id="L85">        thePeriod = OceanusDatePeriod.ONEMONTH;</span>
<span class="nc" id="L86">        theOverallRange = new OceanusDateRange();</span>

        /* Record the initial date */
<span class="nc" id="L89">        theBaseDate = new OceanusDate();</span>

        /* build the range */
<span class="nc" id="L92">        buildRange();</span>
<span class="nc" id="L93">    }</span>

    /**
     * Constructor.
     *
     * @param pState state to copy from
     */
<span class="nc" id="L100">    public OceanusDateRangeState(final OceanusDateRangeState pState) {</span>
        /* Copy values */
<span class="nc" id="L102">        isBaseStartOfPeriod = pState.isBaseStartOfPeriod();</span>
<span class="nc" id="L103">        thePeriod = pState.getPeriod();</span>
<span class="nc" id="L104">        theOverallRange = pState.getOverallRange();</span>
<span class="nc" id="L105">        theStartDate = pState.getStartDate();</span>
<span class="nc" id="L106">        theEndDate = pState.getEndDate();</span>
<span class="nc" id="L107">        theBaseDate = pState.getBaseDate();</span>
<span class="nc" id="L108">        theRange = pState.getRange();</span>
<span class="nc" id="L109">        isLocked = pState.isLocked();</span>
<span class="nc" id="L110">        isNextOK = pState.isNextOK();</span>
<span class="nc" id="L111">        isPrevOK = pState.isPrevOK();</span>
<span class="nc" id="L112">    }</span>

    /**
     * Is the baseDate the start of the range.
     *
     * @return the range
     */
    public boolean isBaseStartOfPeriod() {
<span class="nc" id="L120">        return isBaseStartOfPeriod;</span>
    }

    /**
     * Get the range.
     *
     * @return the range
     */
    public OceanusDateRange getRange() {
<span class="nc" id="L129">        return theRange;</span>
    }

    /**
     * Get the overall range.
     *
     * @return the start date
     */
    public OceanusDateRange getOverallRange() {
<span class="nc" id="L138">        return theOverallRange;</span>
    }

    /**
     * Get the start date.
     *
     * @return the start date
     */
    public OceanusDate getStartDate() {
<span class="nc" id="L147">        return theStartDate;</span>
    }

    /**
     * Get the end date.
     *
     * @return the end date
     */
    public OceanusDate getEndDate() {
<span class="nc" id="L156">        return theEndDate;</span>
    }

    /**
     * Get the base date.
     *
     * @return the base date
     */
    public OceanusDate getBaseDate() {
<span class="nc" id="L165">        return theBaseDate;</span>
    }

    /**
     * Get the DatePeriod.
     *
     * @return the date period
     */
    public OceanusDatePeriod getPeriod() {
<span class="nc" id="L174">        return thePeriod;</span>
    }

    /**
     * Can we select a next period within the available range.
     *
     * @return true/false
     */
    public boolean isNextOK() {
<span class="nc" id="L183">        return isNextOK;</span>
    }

    /**
     * Can we select a previous period within the available range.
     *
     * @return true/false
     */
    public boolean isPrevOK() {
<span class="nc" id="L192">        return isPrevOK;</span>
    }

    /**
     * Is the period locked?
     *
     * @return true/false
     */
    public boolean isLocked() {
<span class="nc" id="L201">        return isLocked;</span>
    }

    /**
     * Is this an UpTo range?
     *
     * @return true/false
     */
    public boolean isUpTo() {
<span class="nc bnc" id="L210" title="All 2 branches missed.">        return thePeriod == OceanusDatePeriod.DATESUPTO;</span>
    }

    /**
     * Is this a custom range?
     *
     * @return true/false
     */
    public boolean isCustom() {
<span class="nc bnc" id="L219" title="All 2 branches missed.">        return thePeriod == OceanusDatePeriod.CUSTOM;</span>
    }

    /**
     * Is this a full range?
     *
     * @return true/false
     */
    public boolean isFull() {
<span class="nc bnc" id="L228" title="All 2 branches missed.">        return thePeriod == OceanusDatePeriod.ALLDATES;</span>
    }

    /**
     * Is this an adjustable range?
     *
     * @return true/false
     */
    public boolean isAdjustable() {
<span class="nc" id="L237">        return thePeriod.adjustPeriod();</span>
    }

    /**
     * Is this a containing range?
     *
     * @return true/false
     */
    public boolean isContaining() {
<span class="nc" id="L246">        return thePeriod.isContaining();</span>
    }

    /**
     * Lock the period.
     *
     * @param pLocked true/false
     */
    public void lockPeriod(final boolean pLocked) {
<span class="nc" id="L255">        isLocked = pLocked;</span>
<span class="nc" id="L256">    }</span>

    /**
     * Set new Period.
     *
     * @param pPeriod the new period
     */
    public void setPeriod(final OceanusDatePeriod pPeriod) {
        /* Adjust the period and build the new range */
<span class="nc" id="L265">        thePeriod = pPeriod;</span>
<span class="nc" id="L266">        buildRange();</span>
<span class="nc" id="L267">    }</span>

    /**
     * Set new Start Date.
     *
     * @param pStartDate the new start date
     */
    public void setStartDate(final OceanusDate pStartDate) {
        /* Adjust the start date and build the new range */
<span class="nc" id="L276">        theStartDate = pStartDate;</span>
<span class="nc" id="L277">        buildRange();</span>
<span class="nc" id="L278">    }</span>

    /**
     * Set new End Date.
     *
     * @param pEndDate the new end date
     */
    public void setEndDate(final OceanusDate pEndDate) {
        /* Adjust the end date and build the new range */
<span class="nc" id="L287">        theEndDate = pEndDate;</span>
<span class="nc" id="L288">        buildRange();</span>
<span class="nc" id="L289">    }</span>

    /**
     * Set new base Date.
     *
     * @param pBaseDate the new base date
     */
    public void setBaseDate(final OceanusDate pBaseDate) {
        /* Adjust the base date and build the new range */
<span class="nc" id="L298">        theBaseDate = pBaseDate;</span>
<span class="nc" id="L299">        buildRange();</span>
<span class="nc" id="L300">    }</span>

    /**
     * Set next Date.
     */
    public void setNextDate() {
        /* Adjust the date and build the new range */
<span class="nc" id="L307">        nextPeriod();</span>
<span class="nc" id="L308">        buildRange();</span>
<span class="nc" id="L309">    }</span>

    /**
     * Set previous Date.
     */
    public void setPreviousDate() {
        /* Adjust the date and build the new range */
<span class="nc" id="L316">        previousPeriod();</span>
<span class="nc" id="L317">        buildRange();</span>
<span class="nc" id="L318">    }</span>

    /**
     * adjust the overall range.
     *
     * @param pRange the overallRange
     */
    public void adjustOverallRange(final OceanusDateRange pRange) {
        /* record the range */
<span class="nc" id="L327">        theOverallRange = new OceanusDateRange(pRange);</span>

        /* Access range parameters */
<span class="nc" id="L330">        final OceanusDate myFirst = theOverallRange.getStart();</span>
<span class="nc" id="L331">        final OceanusDate myLast = theOverallRange.getEnd();</span>

        /* Make sure that no dates are before the first date */
<span class="nc bnc" id="L334" title="All 2 branches missed.">        if (myFirst != null) {</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">            if (theBaseDate.compareTo(myFirst) &lt; 0) {</span>
<span class="nc" id="L336">                theBaseDate = myFirst;</span>
            }
<span class="nc bnc" id="L338" title="All 2 branches missed.">            if ((theStartDate == null)</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">                    || (theStartDate.compareTo(myFirst) &lt; 0)) {</span>
<span class="nc" id="L340">                theStartDate = myFirst;</span>
            }
<span class="nc bnc" id="L342" title="All 2 branches missed.">            if ((theEndDate != null)</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">                    &amp;&amp; (theEndDate.compareTo(myFirst) &lt; 0)) {</span>
<span class="nc" id="L344">                theEndDate = myFirst;</span>
            }
        }

        /* Make sure that no dates are past the final date */
<span class="nc bnc" id="L349" title="All 2 branches missed.">        if (myLast != null) {</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">            if (theBaseDate.compareTo(myLast) &gt; 0) {</span>
<span class="nc" id="L351">                theBaseDate = myLast;</span>
            }
<span class="nc bnc" id="L353" title="All 2 branches missed.">            if ((theStartDate != null)</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">                    &amp;&amp; (theStartDate.compareTo(myLast) &gt; 0)) {</span>
<span class="nc" id="L355">                theStartDate = myLast;</span>
            }
<span class="nc bnc" id="L357" title="All 2 branches missed.">            if ((theEndDate == null)</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">                    || (theEndDate.compareTo(myLast) &gt; 0)) {</span>
<span class="nc" id="L359">                theEndDate = myLast;</span>
            }
        }

        /* Build the range */
<span class="nc" id="L364">        buildRange();</span>
<span class="nc" id="L365">    }</span>

    /**
     * Set the locale.
     *
     * @param pLocale the locale
     */
    public void setLocale(final Locale pLocale) {
<span class="nc" id="L373">        theStartDate.setLocale(pLocale);</span>
<span class="nc" id="L374">        theEndDate.setLocale(pLocale);</span>
<span class="nc" id="L375">        theBaseDate.setLocale(pLocale);</span>
<span class="nc" id="L376">        theOverallRange.setLocale(pLocale);</span>
<span class="nc" id="L377">        theRange.setLocale(pLocale);</span>
<span class="nc" id="L378">    }</span>

    /**
     * Build the range represented by the selection.
     */
    private void buildRange() {
        /* Determine action for period */
<span class="nc bnc" id="L385" title="All 5 branches missed.">        switch (thePeriod) {</span>
            case ALLDATES:
<span class="nc" id="L387">                buildFullRange();</span>
<span class="nc" id="L388">                break;</span>
            case CUSTOM:
<span class="nc" id="L390">                buildCustomRange();</span>
<span class="nc" id="L391">                break;</span>
            case DATESUPTO:
<span class="nc" id="L393">                buildUpToRange();</span>
<span class="nc" id="L394">                break;</span>
            case CALENDARMONTH:
            case CALENDARQUARTER:
            case CALENDARYEAR:
            case FISCALYEAR:
<span class="nc" id="L399">                buildContainingRange();</span>
<span class="nc" id="L400">                break;</span>
            default:
<span class="nc" id="L402">                buildStandardRange();</span>
                break;
        }
<span class="nc" id="L405">    }</span>

    /**
     * Build the standard range.
     */
    private void buildStandardRange() {
<span class="nc bnc" id="L411" title="All 2 branches missed.">        if (isBaseStartOfPeriod) {</span>
<span class="nc" id="L412">            buildStartingRange();</span>
        } else {
<span class="nc" id="L414">            buildEndingRange();</span>
        }
<span class="nc" id="L416">    }</span>

    /**
     * Build the full range.
     */
    private void buildFullRange() {
        /* Previous and next are not allowed */
<span class="nc" id="L423">        isPrevOK = false;</span>
<span class="nc" id="L424">        isNextOK = false;</span>

        /* Create the range */
<span class="nc" id="L427">        theRange = new OceanusDateRange(theOverallRange);</span>
<span class="nc" id="L428">    }</span>

    /**
     * Build the custom range.
     */
    private void buildCustomRange() {
        /* Previous and next are disallowed */
<span class="nc" id="L435">        isPrevOK = false;</span>
<span class="nc" id="L436">        isNextOK = false;</span>

        /* Reset anomalies */
<span class="nc bnc" id="L439" title="All 2 branches missed.">        if (theEndDate.compareTo(theStartDate) &lt; 0) {</span>
<span class="nc" id="L440">            theEndDate = theStartDate;</span>
        }
<span class="nc bnc" id="L442" title="All 2 branches missed.">        if (theBaseDate.compareTo(theStartDate) &lt; 0) {</span>
<span class="nc" id="L443">            theBaseDate = theStartDate;</span>
        }
<span class="nc bnc" id="L445" title="All 2 branches missed.">        if (theBaseDate.compareTo(theEndDate) &lt; 0) {</span>
<span class="nc" id="L446">            theBaseDate = theEndDate;</span>
        }

        /* Create the range */
<span class="nc" id="L450">        theRange = new OceanusDateRange(theStartDate, theEndDate);</span>
<span class="nc" id="L451">    }</span>

    /**
     * Build the upTo range.
     */
    private void buildUpToRange() {
        /* Previous and next are disallowed */
<span class="nc" id="L458">        isPrevOK = false;</span>
<span class="nc" id="L459">        isNextOK = false;</span>

        /* Record start and end dates */
<span class="nc" id="L462">        theStartDate = theOverallRange.getStart();</span>
<span class="nc" id="L463">        theEndDate = theBaseDate;</span>

        /* Create the range */
<span class="nc" id="L466">        theRange = new OceanusDateRange(theStartDate, theEndDate);</span>
<span class="nc" id="L467">    }</span>

    /**
     * Build the containing range.
     */
    private void buildContainingRange() {
        /* Initialise the start date */
<span class="nc" id="L474">        theStartDate = new OceanusDate(theBaseDate);</span>

        /* Adjust the date to the start of the relevant period */
<span class="nc" id="L477">        theStartDate.startPeriod(thePeriod);</span>

        /* Initialise the end date */
<span class="nc" id="L480">        theEndDate = new OceanusDate(theStartDate);</span>

        /* Adjust the date to cover the relevant period */
<span class="nc" id="L483">        theEndDate.adjustForwardByPeriod(thePeriod);</span>
<span class="nc" id="L484">        theEndDate.adjustDay(-1);</span>

        /* Reset anomalies */
<span class="nc" id="L487">        resetBaseAnomalies();</span>

        /* Create the range */
<span class="nc" id="L490">        theRange = new OceanusDateRange(theStartDate, theEndDate);</span>
<span class="nc" id="L491">    }</span>

    /**
     * Reset anomalies.
     */
    private void resetBaseAnomalies() {
        /* Reset anomalies */
<span class="nc" id="L498">        final OceanusDate myFirstDate = theOverallRange.getStart();</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">        if (myFirstDate != null</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">                &amp;&amp; theStartDate.compareTo(myFirstDate) &lt; 0) {</span>
<span class="nc" id="L501">            theStartDate = myFirstDate;</span>
        }
<span class="nc" id="L503">        final OceanusDate myLastDate = theOverallRange.getEnd();</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">        if (myLastDate != null</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">                &amp;&amp; theEndDate.compareTo(myLastDate) &gt; 0) {</span>
<span class="nc" id="L506">            theEndDate = myLastDate;</span>
        }

        /* Previous is only allowed if we have not hit the first date */
<span class="nc bnc" id="L510" title="All 2 branches missed.">        isPrevOK = (myFirstDate == null)</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">                || (myFirstDate.compareTo(theStartDate) != 0);</span>

        /* Next is only allowed if we have not hit the last date */
<span class="nc bnc" id="L514" title="All 2 branches missed.">        isNextOK = (myLastDate == null)</span>
<span class="nc bnc" id="L515" title="All 2 branches missed.">                || (myLastDate.compareTo(theEndDate) != 0);</span>
<span class="nc" id="L516">    }</span>

    /**
     * Build the starting range.
     */
    private void buildStartingRange() {
        /* Initialise the start date */
<span class="nc" id="L523">        theStartDate = theBaseDate;</span>

        /* Initialise the end date */
<span class="nc" id="L526">        theEndDate = new OceanusDate(theBaseDate);</span>

        /* Adjust the date to cover the relevant period */
<span class="nc" id="L529">        theEndDate.adjustForwardByPeriod(thePeriod);</span>
<span class="nc" id="L530">        theEndDate.adjustDay(-1);</span>

        /* Reset anomalies */
<span class="nc" id="L533">        resetBaseAnomalies();</span>

        /* Create the range */
<span class="nc" id="L536">        theRange = new OceanusDateRange(theStartDate, theEndDate);</span>
<span class="nc" id="L537">    }</span>

    /**
     * Build the ending range.
     */
    private void buildEndingRange() {
        /* Initialise the end date */
<span class="nc" id="L544">        theEndDate = theBaseDate;</span>

        /* Initialise the start date */
<span class="nc" id="L547">        theStartDate = new OceanusDate(theBaseDate);</span>

        /* Adjust the date to cover the relevant period */
<span class="nc" id="L550">        theStartDate.adjustBackwardByPeriod(thePeriod);</span>
<span class="nc" id="L551">        theStartDate.adjustDay(1);</span>

        /* Reset anomalies */
<span class="nc" id="L554">        resetBaseAnomalies();</span>

        /* Create the range */
<span class="nc" id="L557">        theRange = new OceanusDateRange(theStartDate, theEndDate);</span>
<span class="nc" id="L558">    }</span>

    /**
     * Adjust forwards to the next period.
     */
    private void nextPeriod() {
        /* Initialise the date */
<span class="nc" id="L565">        OceanusDate myDate = new OceanusDate(theBaseDate);</span>

        /* Adjust the date appropriately */
<span class="nc" id="L568">        myDate.adjustForwardByPeriod(thePeriod);</span>

        /* Make sure that we do not go beyond the date range */
<span class="nc" id="L571">        final OceanusDate myLastDate = theOverallRange.getEnd();</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">        if (myLastDate != null</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">                &amp;&amp; myDate.compareTo(myLastDate) &gt; 0) {</span>
<span class="nc" id="L574">            myDate = myLastDate;</span>
        }

        /* Store the date */
<span class="nc" id="L578">        theBaseDate = myDate;</span>
<span class="nc" id="L579">    }</span>

    /**
     * Adjust backwards to the previous period.
     */
    private void previousPeriod() {
        /* Initialise the date */
<span class="nc" id="L586">        OceanusDate myDate = new OceanusDate(theBaseDate);</span>

        /* Adjust the date appropriately */
<span class="nc" id="L589">        myDate.adjustBackwardByPeriod(thePeriod);</span>

        /* Make sure that we do not go beyond the date range */
<span class="nc" id="L592">        final OceanusDate myFirstDate = theOverallRange.getStart();</span>
<span class="nc bnc" id="L593" title="All 2 branches missed.">        if (myFirstDate != null</span>
<span class="nc bnc" id="L594" title="All 2 branches missed.">                &amp;&amp; myDate.compareTo(myFirstDate) &lt; 0) {</span>
<span class="nc" id="L595">            myDate = myFirstDate;</span>
        }

        /* Store the date */
<span class="nc" id="L599">        theBaseDate = myDate;</span>
<span class="nc" id="L600">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>