<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OceanusDecimalParser.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Oceanus Java Core Utilities</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.oceanus.decimal</a> &gt; <span class="el_source">OceanusDecimalParser.java</span></div><h1>OceanusDecimalParser.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Oceanus: Java Utilities
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
package net.sourceforge.joceanus.oceanus.decimal;

import net.sourceforge.joceanus.oceanus.base.OceanusLocale;

import java.util.Currency;
import java.util.Locale;

/**
 * Parsing methods for decimals in a particular locale.
 * @author Tony Washer
 */
public class OceanusDecimalParser {
    /**
     * Parse Error message.
     */
    private static final String ERROR_PARSE = &quot;Non Decimal Numeric Value: &quot;;

    /**
     * Bounds Error message.
     */
    private static final String ERROR_BOUNDS = &quot;Value out of range: &quot;;

    /**
     * PerCent adjustment.
     */
    public static final int ADJUST_PERCENT = 2;

    /**
     * PerMille adjustment.
     */
    public static final int ADJUST_PERMILLE = 3;

    /**
     * The locale.
     */
    private OceanusDecimalLocale theLocale;

    /**
     * Do we use strict # of decimals?
     */
<span class="nc" id="L57">    private boolean useStrictDecimals = true;</span>

    /**
     * Constructor.
     */
    public OceanusDecimalParser() {
        /* Use default locale */
<span class="nc" id="L64">        this(OceanusLocale.getDefaultLocale());</span>
<span class="nc" id="L65">    }</span>

    /**
     * Constructor.
     * @param pLocale the locale
     */
<span class="nc" id="L71">    public OceanusDecimalParser(final Locale pLocale) {</span>
        /* Store locale */
<span class="nc" id="L73">        setLocale(pLocale);</span>
<span class="nc" id="L74">    }</span>

    /**
     * Should we parse to strict decimals.
     * @param bStrictDecimals true/false
     */
    public void setStrictDecimals(final boolean bStrictDecimals) {
        /* Set accounting mode on and set the width */
<span class="nc" id="L82">        useStrictDecimals = bStrictDecimals;</span>
<span class="nc" id="L83">    }</span>

    /**
     * Set the locale.
     * @param pLocale the locale
     */
    public final void setLocale(final Locale pLocale) {
        /* Store the locale */
<span class="nc" id="L91">        theLocale = new OceanusDecimalLocale(pLocale);</span>
<span class="nc" id="L92">    }</span>

    /**
     * Obtain the default currency.
     * @return the default currency
     */
    public final Currency getDefaultCurrency() {
<span class="nc" id="L99">        return theLocale.getDefaultCurrency();</span>
    }

    /**
     * Parse a string into a decimal.
     * @param pValue The value to parse.
     * @param pResult the decimal to hold the result in
     * @throws IllegalArgumentException on invalid decimal
     */
    protected static void parseDecimalValue(final String pValue,
                                            final OceanusDecimal pResult) {
<span class="fc" id="L110">        parseDecimalValue(pValue, OceanusDecimalFormatter.LOCALE_DEFAULT, false, pResult);</span>
<span class="fc" id="L111">    }</span>

    /**
     * Parse a string into a decimal.
     * @param pValue The value to parse.
     * @param pLocale the Decimal locale
     * @param useMoneyDecimal use money decimal rather than standard decimal true/false
     * @param pResult the decimal to hold the result in
     * @throws IllegalArgumentException on invalid decimal
     */
    protected static void parseDecimalValue(final String pValue,
                                            final OceanusDecimalLocale pLocale,
                                            final boolean useMoneyDecimal,
                                            final OceanusDecimal pResult) {
        /* Handle null value */
<span class="pc bpc" id="L126" title="1 of 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L127">            throw new IllegalArgumentException();</span>
        }

        /* Create a working copy */
<span class="fc" id="L131">        final StringBuilder myWork = new StringBuilder(pValue.trim());</span>

        /* If the value is negative, strip the leading minus sign */
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">        final boolean isNegative = !myWork.isEmpty()</span>
<span class="fc bfc" id="L135" title="All 2 branches covered.">                                   &amp;&amp; myWork.charAt(0) == pLocale.getMinusSign();</span>
<span class="fc bfc" id="L136" title="All 2 branches covered.">        if (isNegative) {</span>
<span class="fc" id="L137">            myWork.deleteCharAt(0);</span>
        }

        /* Remove any grouping characters from the value */
<span class="fc" id="L141">        final String myGrouping = pLocale.getGrouping();</span>
        int myPos;
        for (;;) {
<span class="fc" id="L144">            myPos = myWork.indexOf(myGrouping);</span>
<span class="pc bpc" id="L145" title="1 of 2 branches missed.">            if (myPos == -1) {</span>
<span class="fc" id="L146">                break;</span>
            }
<span class="nc" id="L148">            myWork.deleteCharAt(myPos);</span>
        }

        /* Trim leading and trailing blanks again */
<span class="fc" id="L152">        trimBuffer(myWork);</span>

        /* Locate the exponent if present */
<span class="fc" id="L155">        int myExponent = 0;</span>
<span class="fc" id="L156">        myPos = myWork.indexOf(&quot;e&quot;);</span>
<span class="pc bpc" id="L157" title="1 of 2 branches missed.">        if (myPos != -1) {</span>
            /* Obtain the exponent and remove from decimals */
<span class="nc" id="L159">            final String myExp = myWork.substring(myPos + 1);</span>
<span class="nc" id="L160">            myWork.setLength(myPos);</span>

            /* Parse the integral part */
            try {
<span class="nc" id="L164">                myExponent = Integer.parseInt(myExp);</span>
<span class="nc" id="L165">            } catch (NumberFormatException e) {</span>
<span class="nc" id="L166">                throw new IllegalArgumentException(ERROR_PARSE</span>
                                                   + pValue, e);
<span class="nc" id="L168">            }</span>
        }

        /* Locate the decimal point if present */
<span class="pc bpc" id="L172" title="1 of 2 branches missed.">        myPos = myWork.indexOf(useMoneyDecimal</span>
<span class="nc" id="L173">                                               ? pLocale.getMoneyDecimal()</span>
<span class="fc" id="L174">                                               : pLocale.getDecimal());</span>

        /* Assume no decimals */
<span class="fc" id="L177">        StringBuilder myDecimals = null;</span>
<span class="fc" id="L178">        int myScale = 0;</span>

        /* If we have a decimal point */
<span class="fc bfc" id="L181" title="All 2 branches covered.">        if (myPos != -1) {</span>
            /* Split into the two parts being careful of a trailing decimal point */
<span class="pc bpc" id="L183" title="1 of 2 branches missed.">            if ((myPos + 1) &lt; myWork.length()) {</span>
<span class="fc" id="L184">                myDecimals = new StringBuilder(myWork.substring(myPos + 1));</span>
            }
<span class="fc" id="L186">            myWork.setLength(myPos);</span>
        }

        /* If we have a positive exponent */
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">        if (myExponent &gt; 0) {</span>
            /* Determine the number of decimals */
<span class="nc bnc" id="L192" title="All 2 branches missed.">            int myNumDec = myDecimals == null</span>
<span class="nc" id="L193">                                              ? 0</span>
<span class="nc" id="L194">                                              : myDecimals.length();</span>

            /* Shift decimals across */
<span class="nc bnc" id="L197" title="All 4 branches missed.">            while (myExponent &gt; 0 &amp;&amp; myNumDec &gt; 0) {</span>
                /* Copy decimal across */
<span class="nc" id="L199">                final char myChar = myDecimals.charAt(0);</span>
<span class="nc" id="L200">                myDecimals.deleteCharAt(0);</span>
<span class="nc" id="L201">                myWork.append(myChar);</span>

                /* Adjust counters */
<span class="nc" id="L204">                myExponent--;</span>
<span class="nc" id="L205">                myNumDec--;</span>
<span class="nc" id="L206">            }</span>

            /* Finish off with zeroes */
<span class="nc bnc" id="L209" title="All 2 branches missed.">            while (myExponent &gt; 0) {</span>
<span class="nc" id="L210">                myWork.append(OceanusDecimalFormatter.CHAR_ZERO);</span>
<span class="nc" id="L211">                myExponent--;</span>
            }

            /* If we now have no decimals remove decimal indication */
<span class="nc bnc" id="L215" title="All 2 branches missed.">            if (myNumDec == 0) {</span>
<span class="nc" id="L216">                myDecimals = null;</span>
            }
            /* If we have a negative exponent */
<span class="pc bpc" id="L219" title="1 of 2 branches missed.">        } else if (myExponent &lt; 0) {</span>
            /* Determine the number of integer digits */
<span class="nc" id="L221">            int myNumDigits = myWork.length();</span>
<span class="nc" id="L222">            final StringBuilder myCopy = new StringBuilder();</span>

            /* Shift decimals across */
<span class="nc bnc" id="L225" title="All 4 branches missed.">            while (myExponent &lt; 0 &amp;&amp; myNumDigits &gt; 0) {</span>
                /* Copy digit across */
<span class="nc" id="L227">                final char myChar = myWork.charAt(myNumDigits - 1);</span>
<span class="nc" id="L228">                myWork.deleteCharAt(myNumDigits - 1);</span>
<span class="nc" id="L229">                myCopy.insert(0, myChar);</span>

                /* Adjust counters */
<span class="nc" id="L232">                myExponent++;</span>
<span class="nc" id="L233">                myNumDigits--;</span>
<span class="nc" id="L234">            }</span>

            /* Finish off with zeroes */
<span class="nc bnc" id="L237" title="All 2 branches missed.">            while (myExponent &lt; 0) {</span>
<span class="nc" id="L238">                myCopy.insert(0, OceanusDecimalFormatter.CHAR_ZERO);</span>
<span class="nc" id="L239">                myExponent++;</span>
            }

            /* If we have decimals already */
<span class="nc bnc" id="L243" title="All 2 branches missed.">            if (myDecimals != null) {</span>
<span class="nc" id="L244">                myDecimals.insert(0, myCopy);</span>
            } else {
<span class="nc" id="L246">                myDecimals = myCopy;</span>
            }
        }

        /* Handle leading decimal point on value */
<span class="pc bpc" id="L251" title="1 of 2 branches missed.">        if (myWork.isEmpty()) {</span>
<span class="nc" id="L252">            myWork.append(OceanusDecimalFormatter.CHAR_ZERO);</span>
        }

        /* Parse the integral part */
        long myValue;
        try {
<span class="fc" id="L258">            myValue = Long.parseLong(myWork.toString());</span>
<span class="nc" id="L259">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L260">            throw new IllegalArgumentException(ERROR_PARSE</span>
                                               + pValue, e);
<span class="fc" id="L262">        }</span>

        /* If we have a decimal part */
<span class="fc bfc" id="L265" title="All 2 branches covered.">        if (myDecimals != null) {</span>
            /* If we have too many decimals */
<span class="fc" id="L267">            char myLastDigit = OceanusDecimalFormatter.CHAR_ZERO;</span>
<span class="fc" id="L268">            myScale = myDecimals.length();</span>
<span class="pc bpc" id="L269" title="1 of 2 branches missed.">            if (myScale &gt; OceanusDecimal.MAX_DECIMALS) {</span>
                /* Extract most significant trailing digit and truncate the value */
<span class="nc" id="L271">                myLastDigit = myDecimals.charAt(OceanusDecimal.MAX_DECIMALS);</span>
<span class="nc" id="L272">                myDecimals.setLength(OceanusDecimal.MAX_DECIMALS);</span>
<span class="nc" id="L273">                myScale = myDecimals.length();</span>
            }

            /* Adjust the value to make room for the decimals */
<span class="fc" id="L277">            myValue *= OceanusDecimal.getFactor(myScale);</span>

            /* Parse the decimals */
            try {
<span class="fc" id="L281">                myValue += Long.parseLong(myDecimals.toString());</span>
<span class="nc" id="L282">            } catch (NumberFormatException e) {</span>
<span class="nc" id="L283">                throw new IllegalArgumentException(ERROR_PARSE</span>
                                                   + pValue, e);
<span class="fc" id="L285">            }</span>

            /* Round value according to most significant discarded decimal digit */
<span class="pc bpc" id="L288" title="1 of 2 branches missed.">            if (myLastDigit &gt;= Character.forDigit(OceanusDecimal.RADIX_TEN &gt;&gt; 1, OceanusDecimal.RADIX_TEN)) {</span>
<span class="nc" id="L289">                myValue++;</span>
            }
        }

        /* If the value is negative, negate the number */
<span class="fc bfc" id="L294" title="All 2 branches covered.">        if (isNegative) {</span>
<span class="fc" id="L295">            myValue = -myValue;</span>
        }

        /* Store the result into the decimal */
<span class="fc" id="L299">        pResult.setValue(myValue, myScale);</span>
<span class="fc" id="L300">    }</span>

    /**
     * Adjust to desired decimals.
     * @param pValue the value to adjust
     * @param pDecimals the desired decimals
     */
    private void adjustDecimals(final OceanusDecimal pValue,
                                final int pDecimals) {
        /* If we are using strict decimals */
<span class="nc bnc" id="L310" title="All 2 branches missed.">        if (useStrictDecimals) {</span>
            /* Correct the scale */
<span class="nc" id="L312">            pValue.adjustToScale(pDecimals);</span>

            /* else we should honour what we can */
        } else {
            /* Calculate the standard correction */
<span class="nc" id="L317">            final int myAdjust = pDecimals</span>
<span class="nc" id="L318">                                 - pValue.scale();</span>

            /* If we have too few decimals */
<span class="nc bnc" id="L321" title="All 2 branches missed.">            if (myAdjust &gt; 0) {</span>
                /* Adjust the value appropriately */
<span class="nc" id="L323">                pValue.movePointLeft(myAdjust);</span>

                /* else if we have too many */
<span class="nc bnc" id="L326" title="All 2 branches missed.">            } else if (myAdjust &lt; 0) {</span>
                /* remove redundant decimal places */
<span class="nc" id="L328">                pValue.reduceScale(pDecimals);</span>
            }
        }
<span class="nc" id="L331">    }</span>

    /**
     * Parse a string to extract currency information.
     * @param pWork the buffer to parse
     * @param pDeemedCurrency the assumed currency if no currency identifier
     * @return the parsed currency
     * @throws IllegalArgumentException on invalid currency
     */
    private Currency parseCurrency(final StringBuilder pWork,
                                   final Currency pDeemedCurrency) {
        /* Look for a currency separator */
<span class="nc" id="L343">        final int iPos = pWork.indexOf(OceanusDecimalFormatter.STR_CURRSEP);</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">        if (iPos &gt; -1) {</span>
            /* Extract currency detail and determine currency */
<span class="nc" id="L346">            final String myCurr = pWork.substring(0, iPos);</span>
<span class="nc" id="L347">            pWork.delete(0, iPos + 1);</span>
<span class="nc" id="L348">            return Currency.getInstance(myCurr);</span>
        }

        /* Set default currency */
<span class="nc" id="L352">        Currency myCurrency = pDeemedCurrency;</span>
<span class="nc" id="L353">        final char myMinus = theLocale.getMinusSign();</span>

        /* If we have a leading minus sign */
<span class="nc" id="L356">        int iNumChars = pWork.length();</span>
<span class="nc" id="L357">        boolean isNegative = false;</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">        if ((iNumChars &gt; 0)</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">            &amp;&amp; (pWork.charAt(0) == myMinus)) {</span>
            /* Delete it and note the presence */
<span class="nc" id="L361">            pWork.deleteCharAt(0);</span>
<span class="nc" id="L362">            iNumChars--;</span>
<span class="nc" id="L363">            isNegative = true;</span>
        }

        /* Look for currency symbol as leading non-digits and non-whitespace */
<span class="nc" id="L367">        int iNumSymbols = 0;</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">        while (iNumSymbols &lt; iNumChars) {</span>
<span class="nc" id="L369">            final char c = pWork.charAt(iNumSymbols);</span>
<span class="nc bnc" id="L370" title="All 4 branches missed.">            if (Character.isDigit(c)</span>
                || (c == OceanusDecimalFormatter.CHAR_MINUS)
<span class="nc bnc" id="L372" title="All 2 branches missed.">                || Character.isWhitespace(c)) {</span>
<span class="nc" id="L373">                break;</span>
            }
<span class="nc" id="L375">            iNumSymbols++;</span>
<span class="nc" id="L376">        }</span>

        /* If we have a symbol */
<span class="nc bnc" id="L379" title="All 2 branches missed.">        if (iNumSymbols &gt; 0) {</span>
            /* Extract Symbol from buffer */
<span class="nc" id="L381">            final String mySymbol = pWork.substring(0, iNumSymbols);</span>
<span class="nc" id="L382">            pWork.delete(0, iNumSymbols);</span>

            /* Parse the currency symbol */
<span class="nc" id="L385">            myCurrency = theLocale.parseCurrencySymbol(mySymbol);</span>
        }

        /* If we were negative */
<span class="nc bnc" id="L389" title="All 2 branches missed.">        if (isNegative) {</span>
            /* Reinsert the minus sign */
<span class="nc" id="L391">            pWork.insert(0, myMinus);</span>
        }

        /* Return the currency */
<span class="nc" id="L395">        return myCurrency;</span>
    }

    /**
     * Parse a long value.
     * @param pValue The value to parse.
     * @param pLocale the Decimal locale
     * @return the long value
     * @throws IllegalArgumentException on invalid decimal
     */
    protected static long parseLongValue(final String pValue,
                                         final OceanusDecimalLocale pLocale) {
        /* Handle null value */
<span class="nc bnc" id="L408" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L409">            throw new IllegalArgumentException();</span>
        }

        /* Create a working copy */
<span class="nc" id="L413">        final StringBuilder myWork = new StringBuilder(pValue.trim());</span>

        /* If the value is negative, strip the leading minus sign */
<span class="nc bnc" id="L416" title="All 2 branches missed.">        final boolean isNegative = !myWork.isEmpty()</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">                                   &amp;&amp; myWork.charAt(0) == pLocale.getMinusSign();</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">        if (isNegative) {</span>
<span class="nc" id="L419">            myWork.deleteCharAt(0);</span>
        }

        /* Remove any grouping characters from the value */
<span class="nc" id="L423">        final String myGrouping = pLocale.getGrouping();</span>
        int myPos;
        for (;;) {
<span class="nc" id="L426">            myPos = myWork.indexOf(myGrouping);</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">            if (myPos == -1) {</span>
<span class="nc" id="L428">                break;</span>
            }
<span class="nc" id="L430">            myWork.deleteCharAt(myPos);</span>
        }

        /* Trim leading and trailing blanks again */
<span class="nc" id="L434">        trimBuffer(myWork);</span>

        /* Parse the long value */
        long myValue;
        try {
<span class="nc" id="L439">            myValue = Long.parseLong(myWork.toString());</span>
<span class="nc" id="L440">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L441">            throw new IllegalArgumentException(ERROR_PARSE</span>
                                               + pValue, e);
<span class="nc" id="L443">        }</span>

        /* If the value is negative, negate the number */
<span class="nc bnc" id="L446" title="All 2 branches missed.">        if (isNegative) {</span>
<span class="nc" id="L447">            myValue = -myValue;</span>
        }

        /* return the result */
<span class="nc" id="L451">        return myValue;</span>
    }

    /**
     * Obtain a new zero money value for the default currency.
     * @return the new money
     */
    public OceanusMoney zeroMoney() {
<span class="nc" id="L459">        return new OceanusMoney(theLocale.getDefaultCurrency());</span>
    }

    /**
     * Obtain a new zero money value for the currency.
     * @param pCurrency the currency
     * @return the new money
     */
    public OceanusMoney zeroMoney(final Currency pCurrency) {
<span class="nc" id="L468">        return new OceanusMoney(pCurrency);</span>
    }

    /**
     * Parse Money value.
     * @param pValue the string value to parse.
     * @return the parsed money
     * @throws IllegalArgumentException on invalid money value
     */
    public OceanusMoney parseMoneyValue(final String pValue) {
<span class="nc" id="L478">        return parseMoneyValue(pValue, null);</span>
    }

    /**
     * Parse Money value.
     * @param pValue the string value to parse.
     * @param pDeemedCurrency the assumed currency if no currency identifier
     * @return the parsed money
     * @throws IllegalArgumentException on invalid money value
     */
    public OceanusMoney parseMoneyValue(final String pValue,
                                        final Currency pDeemedCurrency) {
        /* Handle null value */
<span class="nc bnc" id="L491" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L492">            return null;</span>
        }

        /* Create a working trimmed copy */
<span class="nc" id="L496">        final StringBuilder myWork = new StringBuilder(pValue.trim());</span>

        /* Determine currency */
<span class="nc bnc" id="L499" title="All 2 branches missed.">        final Currency myCurrency = parseCurrency(myWork, pDeemedCurrency == null</span>
<span class="nc" id="L500">                                                                                  ? getDefaultCurrency()</span>
<span class="nc" id="L501">                                                                                  : pDeemedCurrency);</span>
<span class="nc" id="L502">        final char myMinus = theLocale.getMinusSign();</span>

        /* If we have a leading minus sign */
<span class="nc bnc" id="L505" title="All 2 branches missed.">        if (!myWork.isEmpty()</span>
<span class="nc bnc" id="L506" title="All 2 branches missed.">            &amp;&amp; myWork.charAt(0) == myMinus) {</span>
            /* Ensure there is no whitespace between minus sign and number */
<span class="nc" id="L508">            myWork.deleteCharAt(0);</span>
<span class="nc" id="L509">            trimBuffer(myWork);</span>
<span class="nc" id="L510">            myWork.insert(0, myMinus);</span>
        }

        /* Create the new Money object */
<span class="nc" id="L514">        final OceanusMoney myMoney = new OceanusMoney(myCurrency);</span>

        /* Parse the remaining string */
<span class="nc" id="L517">        parseDecimalValue(myWork.toString(), theLocale, true, myMoney);</span>

        /* Correct the scale */
<span class="nc" id="L520">        adjustDecimals(myMoney, myCurrency.getDefaultFractionDigits());</span>

        /* return the parsed money object */
<span class="nc" id="L523">        return myMoney;</span>
    }

    /**
     * Obtain a new zero price value for the default currency.
     * @return the new price
     */
    public OceanusPrice zeroPrice() {
<span class="nc" id="L531">        return new OceanusPrice(theLocale.getDefaultCurrency());</span>
    }

    /**
     * Obtain a new zero price value for the currency.
     * @param pCurrency the currency
     * @return the new price
     */
    public OceanusPrice zeroPrice(final Currency pCurrency) {
<span class="nc" id="L540">        return new OceanusPrice(pCurrency);</span>
    }

    /**
     * Parse Price value.
     * @param pValue the string value to parse.
     * @return the parsed price
     * @throws IllegalArgumentException on invalid price value
     */
    public OceanusPrice parsePriceValue(final String pValue) {
<span class="nc" id="L550">        return parsePriceValue(pValue, null);</span>
    }

    /**
     * Parse Price value.
     * @param pValue the string value to parse.
     * @param pDeemedCurrency the assumed currency if no currency identifier
     * @return the parsed price
     * @throws IllegalArgumentException on invalid price value
     */
    public OceanusPrice parsePriceValue(final String pValue,
                                        final Currency pDeemedCurrency) {
        /* Handle null value */
<span class="nc bnc" id="L563" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L564">            return null;</span>
        }

        /* Create a working trimmed copy */
<span class="nc" id="L568">        final StringBuilder myWork = new StringBuilder(pValue.trim());</span>

        /* Look for explicit currency */
<span class="nc bnc" id="L571" title="All 2 branches missed.">        final Currency myCurrency = parseCurrency(myWork, pDeemedCurrency == null</span>
<span class="nc" id="L572">                                                                                  ? getDefaultCurrency()</span>
<span class="nc" id="L573">                                                                                  : pDeemedCurrency);</span>
<span class="nc" id="L574">        final char myMinus = theLocale.getMinusSign();</span>

        /* If we have a leading minus sign */
<span class="nc bnc" id="L577" title="All 2 branches missed.">        if (myWork.charAt(0) == myMinus) {</span>
            /* Ensure there is no whitespace between minus sign and number */
<span class="nc" id="L579">            myWork.deleteCharAt(0);</span>
<span class="nc" id="L580">            trimBuffer(myWork);</span>
<span class="nc" id="L581">            myWork.insert(0, myMinus);</span>
        }

        /* Create the new Price object */
<span class="nc" id="L585">        final OceanusPrice myPrice = new OceanusPrice(myCurrency);</span>

        /* Parse the remaining string */
<span class="nc" id="L588">        parseDecimalValue(myWork.toString(), theLocale, true, myPrice);</span>

        /* Correct the scale */
<span class="nc" id="L591">        adjustDecimals(myPrice, myCurrency.getDefaultFractionDigits()</span>
                                + OceanusPrice.XTRA_DECIMALS);

        /* return the parsed price object */
<span class="nc" id="L595">        return myPrice;</span>
    }

    /**
     * Parse Rate value.
     * @param pValue the string value to parse.
     * @return the parsed rate
     * @throws IllegalArgumentException on invalid rate value
     */
    public OceanusRate parseRateValue(final String pValue) {
        /* Handle null value */
<span class="nc bnc" id="L606" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L607">            return null;</span>
        }

        /* Create a working trimmed copy */
<span class="nc" id="L611">        final StringBuilder myWork = new StringBuilder(pValue.trim());</span>
<span class="nc" id="L612">        int myXtraDecimals = 0;</span>

        /* If there is a trailing perCent, remove any percent sign from the end of the string */
<span class="nc" id="L615">        final int myLast = myWork.length() - 1;</span>
<span class="nc bnc" id="L616" title="All 2 branches missed.">        if (myWork.charAt(myLast) == theLocale.getPerCent()) {</span>
<span class="nc" id="L617">            myWork.deleteCharAt(myLast);</span>
<span class="nc" id="L618">            myXtraDecimals = ADJUST_PERCENT;</span>

            /*
             * If there is a trailing perMille, remove any percent sign from the end of the string
             */
<span class="nc bnc" id="L623" title="All 2 branches missed.">        } else if (myWork.charAt(myLast) == theLocale.getPerMille()) {</span>
<span class="nc" id="L624">            myWork.deleteCharAt(myLast);</span>
<span class="nc" id="L625">            myXtraDecimals = ADJUST_PERMILLE;</span>
        }

        /* Create the new Rate object */
<span class="nc" id="L629">        final OceanusRate myRate = new OceanusRate();</span>

        /* Parse the remaining string */
<span class="nc" id="L632">        parseDecimalValue(myWork.toString(), theLocale, false, myRate);</span>

        /* If we have extra Decimals to add */
<span class="nc bnc" id="L635" title="All 2 branches missed.">        if (myXtraDecimals &gt; 0) {</span>
            /* Adjust the value appropriately */
<span class="nc" id="L637">            myRate.recordScale(myXtraDecimals</span>
<span class="nc" id="L638">                               + myRate.scale());</span>
        }

        /* Correct the scale */
<span class="nc" id="L642">        adjustDecimals(myRate, OceanusRate.NUM_DECIMALS);</span>

        /* return the parsed rate object */
<span class="nc" id="L645">        return myRate;</span>
    }

    /**
     * Parse Units value.
     * @param pValue the string value to parse.
     * @return the parsed units
     * @throws IllegalArgumentException on invalid units value
     */
    public OceanusUnits parseUnitsValue(final String pValue) {
        /* Handle null value */
<span class="nc bnc" id="L656" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L657">            return null;</span>
        }

        /* Create the new Units object */
<span class="nc" id="L661">        final OceanusUnits myUnits = new OceanusUnits();</span>

        /* Parse the remaining string */
<span class="nc" id="L664">        parseDecimalValue(pValue.trim(), theLocale, false, myUnits);</span>

        /* Correct the scale */
<span class="nc" id="L667">        adjustDecimals(myUnits, OceanusUnits.NUM_DECIMALS);</span>

        /* return the parsed units object */
<span class="nc" id="L670">        return myUnits;</span>
    }

    /**
     * Parse Ratio value.
     * @param pValue the string value to parse.
     * @return the parsed ratio
     * @throws IllegalArgumentException on invalid ratio value
     */
    public OceanusRatio parseRatioValue(final String pValue) {
        /* Handle null value */
<span class="nc bnc" id="L681" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L682">            return null;</span>
        }

        /* Create the new Ratio object */
<span class="nc" id="L686">        final OceanusRatio myRatio = new OceanusRatio();</span>

        /* Parse the remaining string */
<span class="nc" id="L689">        parseDecimalValue(pValue.trim(), theLocale, false, myRatio);</span>

        /* Correct the scale */
<span class="nc" id="L692">        adjustDecimals(myRatio, OceanusRatio.NUM_DECIMALS);</span>

        /* return the parsed ratio object */
<span class="nc" id="L695">        return myRatio;</span>
    }

    /**
     * Parse Decimal value.
     * @param pValue the string value to parse.
     * @param pScale the scale of the resulting decimal
     * @return the parsed decimal
     * @throws IllegalArgumentException on invalid decimal value
     */
    public OceanusDecimal parseDecimalValue(final String pValue,
                                            final int pScale) {
        /* Handle null value */
<span class="nc bnc" id="L708" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L709">            return null;</span>
        }

        /* Create the new Decimal object */
<span class="nc" id="L713">        final OceanusDecimal myDecimal = new OceanusDecimal();</span>

        /* Parse the remaining string */
<span class="nc" id="L716">        parseDecimalValue(pValue.trim(), theLocale, false, myDecimal);</span>
<span class="nc" id="L717">        adjustDecimals(myDecimal, pScale);</span>

        /* return the parsed decimal object */
<span class="nc" id="L720">        return myDecimal;</span>
    }

    /**
     * Parse Long value.
     * @param pValue the string value to parse.
     * @return the parsed value
     * @throws IllegalArgumentException on invalid value
     */
    public Long parseLongValue(final String pValue) {
        /* Handle null value */
<span class="nc bnc" id="L731" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L732">            return null;</span>
        }

        /* Parse the value */
<span class="nc" id="L736">        return parseLongValue(pValue, theLocale);</span>
    }

    /**
     * Parse Integer value.
     * @param pValue the string value to parse.
     * @return the parsed value
     * @throws IllegalArgumentException on invalid value
     */
    public Integer parseIntegerValue(final String pValue) {
        /* Handle null value */
<span class="nc bnc" id="L747" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L748">            return null;</span>
        }

        /* Parse the value */
<span class="nc" id="L752">        final long myValue = parseLongValue(pValue, theLocale);</span>

        /* Check bounds */
<span class="nc bnc" id="L755" title="All 4 branches missed.">        if (myValue &gt; Integer.MAX_VALUE || myValue &lt; Integer.MIN_VALUE) {</span>
<span class="nc" id="L756">            throw new IllegalArgumentException(ERROR_BOUNDS</span>
                                               + pValue);
        }

        /* Return value */
<span class="nc" id="L761">        return (int) myValue;</span>
    }

    /**
     * Parse Short value.
     * @param pValue the string value to parse.
     * @return the parsed value
     * @throws IllegalArgumentException on invalid value
     */
    public Short parseShortValue(final String pValue) {
        /* Handle null value */
<span class="nc bnc" id="L772" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L773">            return null;</span>
        }

        /* Parse the value */
<span class="nc" id="L777">        final long myValue = parseLongValue(pValue, theLocale);</span>

        /* Check bounds */
<span class="nc bnc" id="L780" title="All 4 branches missed.">        if ((myValue &gt; Short.MAX_VALUE) || (myValue &lt; Short.MIN_VALUE)) {</span>
<span class="nc" id="L781">            throw new IllegalArgumentException(ERROR_BOUNDS</span>
                                               + pValue);
        }

        /* Return value */
<span class="nc" id="L786">        return (short) myValue;</span>
    }

    /**
     * Trim parsing buffer.
     * @param pBuffer the buffer to trim
     */
    private static void trimBuffer(final StringBuilder pBuffer) {
        /* Remove leading blanks */
<span class="pc bpc" id="L795" title="1 of 2 branches missed.">        while (!pBuffer.isEmpty()</span>
<span class="pc bpc" id="L796" title="1 of 2 branches missed.">               &amp;&amp; Character.isWhitespace(pBuffer.charAt(0))) {</span>
<span class="nc" id="L797">            pBuffer.deleteCharAt(0);</span>
        }

        /* Remove trailing blanks */
<span class="fc" id="L801">        int myLen = pBuffer.length();</span>
<span class="pc bpc" id="L802" title="1 of 2 branches missed.">        while (myLen-- &gt; 0) {</span>
<span class="pc bpc" id="L803" title="1 of 2 branches missed.">            if (!Character.isWhitespace(pBuffer.charAt(myLen))) {</span>
<span class="fc" id="L804">                break;</span>
            }
<span class="nc" id="L806">            pBuffer.deleteCharAt(myLen);</span>
        }
<span class="fc" id="L808">    }</span>

    /**
     * create Money from double.
     * @param pValue the double value.
     * @return the parsed money
     * @throws IllegalArgumentException on invalid money value
     */
    public OceanusMoney createMoneyFromDouble(final Double pValue) {
        /* Handle null value */
<span class="nc bnc" id="L818" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L819">            return null;</span>
        }

        /* Use default currency */
<span class="nc" id="L823">        final Currency myCurrency = theLocale.getDefaultCurrency();</span>
<span class="nc" id="L824">        return createMoneyFromDouble(pValue, myCurrency.getCurrencyCode());</span>
    }

    /**
     * create Money from double.
     * @param pValue the double value.
     * @param pCurrCode the currency code
     * @return the parsed money
     * @throws IllegalArgumentException on invalid money value
     */
    public OceanusMoney createMoneyFromDouble(final Double pValue,
                                              final String pCurrCode) {
        /* Handle null value */
<span class="nc bnc" id="L837" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L838">            return null;</span>
        }

        /* Determine currency */
<span class="nc" id="L842">        final Currency myCurrency = Currency.getInstance(pCurrCode);</span>

        /* Create the new Money object */
<span class="nc" id="L845">        final OceanusMoney myMoney = new OceanusMoney(myCurrency);</span>

        /* Parse the remaining string */
<span class="nc" id="L848">        parseDecimalValue(pValue.toString(), theLocale, true, myMoney);</span>

        /* Correct the scale */
<span class="nc" id="L851">        adjustDecimals(myMoney, myCurrency.getDefaultFractionDigits());</span>

        /* return the parsed money object */
<span class="nc" id="L854">        return myMoney;</span>
    }

    /**
     * create Price from double.
     * @param pValue the double value.
     * @return the parsed price
     * @throws IllegalArgumentException on invalid price value
     */
    public OceanusPrice createPriceFromDouble(final Double pValue) {
        /* Handle null value */
<span class="nc bnc" id="L865" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L866">            return null;</span>
        }

        /* Use default currency */
<span class="nc" id="L870">        final Currency myCurrency = theLocale.getDefaultCurrency();</span>
<span class="nc" id="L871">        return createPriceFromDouble(pValue, myCurrency.getCurrencyCode());</span>
    }

    /**
     * create Price from double.
     * @param pValue the double value.
     * @param pCurrCode the currency code
     * @return the parsed price
     * @throws IllegalArgumentException on invalid price value
     */
    public OceanusPrice createPriceFromDouble(final Double pValue,
                                              final String pCurrCode) {
        /* Handle null value */
<span class="nc bnc" id="L884" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L885">            return null;</span>
        }

        /* Determine currency */
<span class="nc" id="L889">        final Currency myCurrency = Currency.getInstance(pCurrCode);</span>

        /* Create the new Price object */
<span class="nc" id="L892">        final OceanusPrice myPrice = new OceanusPrice(myCurrency);</span>

        /* Parse the remaining string */
<span class="nc" id="L895">        parseDecimalValue(pValue.toString(), theLocale, false, myPrice);</span>

        /* Correct the scale */
<span class="nc" id="L898">        adjustDecimals(myPrice, myCurrency.getDefaultFractionDigits()</span>
                                + OceanusPrice.XTRA_DECIMALS);

        /* return the parsed price object */
<span class="nc" id="L902">        return myPrice;</span>
    }

    /**
     * create Rate from double.
     * @param pValue the double value.
     * @return the parsed rate
     * @throws IllegalArgumentException on invalid rate value
     */
    public OceanusRate createRateFromDouble(final Double pValue) {
        /* Handle null value */
<span class="nc bnc" id="L913" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L914">            return null;</span>
        }

        /* Create the new Rate object */
<span class="nc" id="L918">        final OceanusRate myRate = new OceanusRate();</span>

        /* Parse the remaining string */
<span class="nc" id="L921">        parseDecimalValue(pValue.toString(), theLocale, false, myRate);</span>

        /* Correct the scale */
<span class="nc" id="L924">        adjustDecimals(myRate, OceanusRate.NUM_DECIMALS);</span>

        /* return the parsed rate object */
<span class="nc" id="L927">        return myRate;</span>
    }

    /**
     * create Units from double.
     * @param pValue the double value.
     * @return the parsed units
     * @throws IllegalArgumentException on invalid units value
     */
    public OceanusUnits createUnitsFromDouble(final Double pValue) {
        /* Handle null value */
<span class="nc bnc" id="L938" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L939">            return null;</span>
        }

        /* Create the new Units object */
<span class="nc" id="L943">        final OceanusUnits myUnits = new OceanusUnits();</span>

        /* Parse the remaining string */
<span class="nc" id="L946">        parseDecimalValue(pValue.toString(), theLocale, false, myUnits);</span>

        /* Correct the scale */
<span class="nc" id="L949">        adjustDecimals(myUnits, OceanusUnits.NUM_DECIMALS);</span>

        /* return the parsed units object */
<span class="nc" id="L952">        return myUnits;</span>
    }

    /**
     * create Ratio from double.
     * @param pValue the double value.
     * @return the parsed ratio
     * @throws IllegalArgumentException on invalid ratio value
     */
    public OceanusRatio createRatioFromDouble(final Double pValue) {
        /* Handle null value */
<span class="nc bnc" id="L963" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L964">            return null;</span>
        }

        /* Create the new Ratio object */
<span class="nc" id="L968">        final OceanusRatio myRatio = new OceanusRatio();</span>

        /* Parse the remaining string */
<span class="nc" id="L971">        parseDecimalValue(pValue.toString(), theLocale, false, myRatio);</span>

        /* Correct the scale */
<span class="nc" id="L974">        adjustDecimals(myRatio, OceanusRatio.NUM_DECIMALS);</span>

        /* return the parsed ratio object */
<span class="nc" id="L977">        return myRatio;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>