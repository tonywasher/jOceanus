<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OceanusDecimalLocale.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Oceanus Java Core Utilities</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.oceanus.decimal</a> &gt; <span class="el_source">OceanusDecimalLocale.java</span></div><h1>OceanusDecimalLocale.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Oceanus: Java Utilities
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
package net.sourceforge.joceanus.oceanus.decimal;

import net.sourceforge.joceanus.oceanus.base.OceanusLocale;

import java.text.DecimalFormat;
import java.text.DecimalFormatSymbols;
import java.text.NumberFormat;
import java.util.Currency;
import java.util.HashMap;
import java.util.Locale;
import java.util.Map;

/**
 * Locale constants.
 */
public class OceanusDecimalLocale {
    /**
     * The dollar.
     */
    private static final String DOLLAR = &quot;$&quot;;

    /**
     * The pound.
     */
    private static final String POUND = &quot;Â£&quot;;

    /**
     * The locale.
     */
    private final Locale theLocale;

    /**
     * The currencies map.
     */
    private final Map&lt;String, Currency&gt; theCurrencyMap;

    /**
     * The currency symbols map.
     */
    private final Map&lt;String, String&gt; theSymbolMap;

    /**
     * The grouping size.
     */
    private final int theGroupingSize;

    /**
     * The grouping separator.
     */
    private final String theGrouping;

    /**
     * The minus sign.
     */
    private final char theMinusSign;

    /**
     * The perCent symbol.
     */
    private final char thePerCent;

    /**
     * The perMille symbol.
     */
    private final char thePerMille;

    /**
     * The decimal separator.
     */
    private final String theDecimal;

    /**
     * The money decimal separator.
     */
    private final String theMoneyDecimal;

    /**
     * The default currency.
     */
    private final Currency theCurrency;

    /**
     * Constructor.
     */
    protected OceanusDecimalLocale() {
        /* Use default locale */
<span class="fc" id="L103">        this(OceanusLocale.getDefaultLocale());</span>
<span class="fc" id="L104">    }</span>

    /**
     * Constructor.
     * @param pLocale the locale
     */
<span class="fc" id="L110">    protected OceanusDecimalLocale(final Locale pLocale) {</span>
        /* Default to UK locale if the locale only has a pseudo-currency */
<span class="fc" id="L112">        DecimalFormatSymbols mySymbols = DecimalFormatSymbols.getInstance(pLocale);</span>
<span class="fc" id="L113">        final Currency myCurrency = mySymbols.getCurrency();</span>
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">        theLocale = myCurrency.getDefaultFractionDigits() == -1</span>
<span class="nc" id="L115">                ? Locale.UK</span>
<span class="fc" id="L116">                : pLocale;</span>

        /* Create currency maps */
<span class="fc" id="L119">        theCurrencyMap = new HashMap&lt;&gt;();</span>
<span class="fc" id="L120">        theSymbolMap = new HashMap&lt;&gt;();</span>

        /* Access decimal formats */
<span class="fc" id="L123">        mySymbols = DecimalFormatSymbols.getInstance(theLocale);</span>
<span class="fc" id="L124">        final DecimalFormat myFormat = (DecimalFormat) NumberFormat.getInstance(theLocale);</span>
<span class="fc" id="L125">        theGroupingSize = myFormat.getGroupingSize();</span>

        /* Access various interesting formats */
<span class="fc" id="L128">        theMinusSign = mySymbols.getMinusSign();</span>
<span class="fc" id="L129">        thePerCent = mySymbols.getPercent();</span>
<span class="fc" id="L130">        thePerMille = mySymbols.getPerMill();</span>
<span class="fc" id="L131">        theGrouping = Character.toString(mySymbols.getGroupingSeparator());</span>
<span class="fc" id="L132">        theDecimal = Character.toString(mySymbols.getDecimalSeparator());</span>
<span class="fc" id="L133">        theMoneyDecimal = Character.toString(mySymbols.getMonetaryDecimalSeparator());</span>

        /* Access the default currency */
<span class="fc" id="L136">        theCurrency = mySymbols.getCurrency();</span>
<span class="fc" id="L137">        final String myCurrSymbol = theCurrency.getSymbol(theLocale);</span>
<span class="fc" id="L138">        declareSymbol(myCurrSymbol, theCurrency);</span>

        /* Declare simplified USD/GBP if possible */
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">        if (!DOLLAR.equals(myCurrSymbol)) {</span>
<span class="fc" id="L142">            declareSymbol(DOLLAR, Currency.getInstance(Locale.US));</span>
        }
<span class="pc bpc" id="L144" title="1 of 2 branches missed.">        if (!POUND.equals(myCurrSymbol)) {</span>
<span class="nc" id="L145">            declareSymbol(POUND, Currency.getInstance(Locale.UK));</span>
        }
<span class="fc" id="L147">    }</span>

    /**
     * Obtain the grouping size.
     * @return the size
     */
    protected int getGroupingSize() {
<span class="nc" id="L154">        return theGroupingSize;</span>
    }

    /**
     * Obtain the grouping string.
     * @return the string
     */
    protected String getGrouping() {
<span class="fc" id="L162">        return theGrouping;</span>
    }

    /**
     * Obtain the minus sign.
     * @return the sign
     */
    protected char getMinusSign() {
<span class="fc" id="L170">        return theMinusSign;</span>
    }

    /**
     * Obtain the perCent sign.
     * @return the sign
     */
    protected char getPerCent() {
<span class="nc" id="L178">        return thePerCent;</span>
    }

    /**
     * Obtain the perMille sign.
     * @return the sign
     */
    protected char getPerMille() {
<span class="nc" id="L186">        return thePerMille;</span>
    }

    /**
     * Obtain the decimal string.
     * @return the string
     */
    protected String getDecimal() {
<span class="fc" id="L194">        return theDecimal;</span>
    }

    /**
     * Obtain the grouping string.
     * @return the string
     */
    protected String getMoneyDecimal() {
<span class="nc" id="L202">        return theMoneyDecimal;</span>
    }

    /**
     * Obtain the default currency.
     * @return the currency
     */
    protected Currency getDefaultCurrency() {
<span class="nc" id="L210">        return theCurrency;</span>
    }

    /**
     * Parse currency symbol.
     * @param pSymbol the symbol
     * @return the currency
     * @throws IllegalArgumentException on invalid currency
     */
    protected Currency parseCurrencySymbol(final String pSymbol) {
        /* Look for the currency in the map */
<span class="nc" id="L221">        Currency myCurrency = theCurrencyMap.get(pSymbol);</span>

        /* If this is a new currency */
<span class="nc bnc" id="L224" title="All 2 branches missed.">        if (myCurrency == null) {</span>
            /* Loop through all the currencies */
<span class="nc bnc" id="L226" title="All 2 branches missed.">            for (Currency myCurr : Currency.getAvailableCurrencies()) {</span>
                /* If the symbol matches */
<span class="nc bnc" id="L228" title="All 2 branches missed.">                if (pSymbol.equals(myCurr.getSymbol(theLocale))) {</span>
                    /* Record currency and break the loop */
<span class="nc" id="L230">                    myCurrency = myCurr;</span>
<span class="nc" id="L231">                    declareSymbol(pSymbol, myCurrency);</span>
<span class="nc" id="L232">                    break;</span>
                }
<span class="nc" id="L234">            }</span>

            /* If we did not find a currency */
<span class="nc bnc" id="L237" title="All 2 branches missed.">            if (myCurrency == null) {</span>
                /* Reject the currency */
<span class="nc" id="L239">                throw new IllegalArgumentException(&quot;Invalid currency: &quot;</span>
                                                   + pSymbol);
            }
        }

        /* Return the currency */
<span class="nc" id="L245">        return myCurrency;</span>
    }

    /**
     * Declare symbol.
     * @param pSymbol the symbol
     * @param pCurrency the currency
     */
    private void declareSymbol(final String pSymbol,
                               final Currency pCurrency) {
        /* Store in currency map */
<span class="fc" id="L256">        theCurrencyMap.put(pSymbol, pCurrency);</span>

        /* Store symbol if not already declared */
<span class="fc" id="L259">        final String myCode = pCurrency.getCurrencyCode();</span>
<span class="fc" id="L260">        theSymbolMap.computeIfAbsent(myCode, c -&gt; pSymbol);</span>
<span class="fc" id="L261">    }</span>

    /**
     * Get currency symbol.
     * @param pCurrency the currency
     * @return the symbol
     */
    protected String getSymbol(final Currency pCurrency) {
        /* Look for the currency in the map */
<span class="nc" id="L270">        final String mySymbol = theSymbolMap.get(pCurrency.getCurrencyCode());</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">        return mySymbol == null</span>
<span class="nc" id="L272">                                ? pCurrency.getSymbol(theLocale)</span>
<span class="nc" id="L273">                                : mySymbol;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>