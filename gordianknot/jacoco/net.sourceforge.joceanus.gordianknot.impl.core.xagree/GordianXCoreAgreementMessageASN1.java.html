<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GordianXCoreAgreementMessageASN1.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GordianKnot Security Framework</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.gordianknot.impl.core.xagree</a> &gt; <span class="el_source">GordianXCoreAgreementMessageASN1.java</span></div><h1>GordianXCoreAgreementMessageASN1.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * GordianKnot: Security Suite
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.gordianknot.impl.core.xagree;

import net.sourceforge.joceanus.gordianknot.api.base.GordianException;
import net.sourceforge.joceanus.gordianknot.impl.core.base.GordianASN1Util.GordianASN1Object;
import net.sourceforge.joceanus.gordianknot.impl.core.exc.GordianDataException;
import net.sourceforge.joceanus.gordianknot.impl.core.exc.GordianIOException;
import org.bouncycastle.asn1.ASN1EncodableVector;
import org.bouncycastle.asn1.ASN1Integer;
import org.bouncycastle.asn1.ASN1OctetString;
import org.bouncycastle.asn1.ASN1Primitive;
import org.bouncycastle.asn1.ASN1Sequence;
import org.bouncycastle.asn1.ASN1TaggedObject;
import org.bouncycastle.asn1.BEROctetString;
import org.bouncycastle.asn1.DERSequence;
import org.bouncycastle.asn1.DERTaggedObject;
import org.bouncycastle.asn1.x509.AlgorithmIdentifier;
import org.bouncycastle.asn1.x509.Certificate;
import org.bouncycastle.asn1.x509.SubjectPublicKeyInfo;

import java.io.IOException;
import java.security.spec.X509EncodedKeySpec;
import java.util.Arrays;
import java.util.Enumeration;
import java.util.Objects;

/**
 * ASN1 Encoding of Agreement Messages.
 * &lt;pre&gt;
 * GordianAgreementMessageASN1 ::= SEQUENCE  {
 *      Id Identification
 *      Algs Specifications
 *      clientCertificate [1] Certificate OPTIONAL
 *      serverCertificate [2] Certificate OPTIONAL
 *      signerCertificate [3] Certificate OPTIONAL
 *      initVector [4] OCTET STRING OPTIONAL
 *      encapsulated [5] OCTET STRING OPTIONAL
 *      ephemeral [6] SubjectPublicKeyInfo OPTIONAL
 *      confirmation [7] OCTET STRING OPTIONAL
 *      signature [8] OCTET STRING OPTIONAL
 * }
 *
 * Identification ::= SEQUENCE  {
 *      messageType INTEGER
 *      clientId [1] INTEGER OPTIONAL
 *      serverId [2] INTEGER OPTIONAL
 * }
 *
 * Specification ::= SEQUENCE  {
 *      agreeId AlgorithmIdentifier
 *      resultId [1] AlgorithmIdentifier OPTIONAL
 *      signId [2] lgorithmIdentifier OPTIONAL
 *  }
 * &lt;/pre&gt;
 */
public final class GordianXCoreAgreementMessageASN1
        extends GordianASN1Object {
    /**
     * The clientCertificate tag.
     */
    private static final int TAG_CLIENTCERTIFICATE = 1;

    /**
     * The serverCertificate tag.
     */
    private static final int TAG_SERVERCERTIFICATE = 2;

    /**
     * The signingCertificate tag.
     */
    private static final int TAG_SIGNERCERTIFICATE = 3;

    /**
     * The initVector tag.
     */
    private static final int TAG_INITVECTOR = 4;

    /**
     * The encapsulated tag.
     */
    private static final int TAG_ENCAPSULATED = 5;

    /**
     * The ephemeral tag.
     */
    private static final int TAG_EPHEMERAL = 6;

    /**
     * The confirmation tag.
     */
    private static final int TAG_CONFIRMATION = 7;

    /**
     * The signature tag.
     */
    private static final int TAG_SIGNATURE = 8;

    /**
     * The clientId tag.
     */
    private static final int TAG_CLIENTID = 1;

    /**
     * The serverId tag.
     */
    private static final int TAG_SERVERID = 2;


    /**
     * The resultAlgId tag.
     */
    private static final int TAG_RESULTALGID = 1;

    /**
     * The signAlgId tag.
     */
    private static final int TAG_SIGNALGID = 2;

    /**
     * The MessageType.
     */
    private final GordianXMessageType theMessageType;

    /**
     * The ClientId.
     */
    private Long theClientId;

    /**
     * The ServerId.
     */
    private Long theServerId;

    /**
     * The Agreement AlgorithmId.
     */
    private AlgorithmIdentifier theAgreementId;

    /**
     * The ResultId.
     */
    private AlgorithmIdentifier theResultId;

    /**
     * The SignatureId.
     */
    private AlgorithmIdentifier theSignatureId;

    /**
     * The Client Certificate.
     */
    private Certificate theClientCertificate;

    /**
     * The Server Certificate.
     */
    private Certificate theServerCertificate;

    /**
     * The Signer Certificate.
     */
    private Certificate theSignerCertificate;

    /**
     * The InitVector.
     */
    private byte[] theInitVector;

    /**
     * The Encapsulated.
     */
    private byte[] theEncapsulated;

    /**
     * The Ephemeral.
     */
    private X509EncodedKeySpec theEphemeral;

    /**
     * The Confirmation.
     */
    private byte[] theConfirmation;

    /**
     * The Signature.
     */
    private byte[] theSignature;

    /**
     * Constructor.
     * @param pType the messageType
     */
<span class="nc" id="L208">    private GordianXCoreAgreementMessageASN1(final GordianXMessageType pType) {</span>
<span class="nc" id="L209">        theMessageType = pType;</span>
<span class="nc" id="L210">    }</span>

    /**
     * Constructor.
     * @param pSequence the Sequence
     * @throws GordianException on error
     */
<span class="nc" id="L217">    private GordianXCoreAgreementMessageASN1(final ASN1Sequence pSequence) throws GordianException {</span>
        /* Protect against exceptions */
        try {
            /* Access the sequence */
<span class="nc" id="L221">            final ASN1Sequence mySequence = ASN1Sequence.getInstance(pSequence);</span>
<span class="nc" id="L222">            final Enumeration&lt;?&gt; en = mySequence.getObjects();</span>

            /* Access id element */
<span class="nc" id="L225">            final ASN1Sequence myId = ASN1Sequence.getInstance(en.nextElement());</span>
<span class="nc" id="L226">            final Enumeration&lt;?&gt; enIds = myId.getObjects();</span>
<span class="nc" id="L227">            theMessageType = GordianXMessageType.determineType(ASN1Integer.getInstance(enIds.nextElement()).intValueExact());</span>

            /* Loop through the optional id elements */
<span class="nc bnc" id="L230" title="All 2 branches missed.">            while (enIds.hasMoreElements()) {</span>
<span class="nc" id="L231">                final ASN1TaggedObject myTagged = ASN1TaggedObject.getInstance(enIds.nextElement());</span>
<span class="nc bnc" id="L232" title="All 3 branches missed.">                switch (myTagged.getTagNo()) {</span>
                    case TAG_CLIENTID:
<span class="nc" id="L234">                        theClientId = ASN1Integer.getInstance(myTagged, false).longValueExact();</span>
<span class="nc" id="L235">                        break;</span>
                    case TAG_SERVERID:
<span class="nc" id="L237">                        theServerId = ASN1Integer.getInstance(myTagged, false).longValueExact();</span>
<span class="nc" id="L238">                        break;</span>
                    default:
<span class="nc" id="L240">                        throw new GordianDataException(&quot;Unexpected id tag&quot;);</span>
                }
<span class="nc" id="L242">            }</span>

            /* Access algorithms element */
<span class="nc" id="L245">            final ASN1Sequence myAlgs = ASN1Sequence.getInstance(en.nextElement());</span>
<span class="nc" id="L246">            final Enumeration&lt;?&gt; enAlgs = myAlgs.getObjects();</span>
<span class="nc" id="L247">            theAgreementId = AlgorithmIdentifier.getInstance(enAlgs.nextElement());</span>

            /* Loop through the optional algorithm elements */
<span class="nc bnc" id="L250" title="All 2 branches missed.">            while (enIds.hasMoreElements()) {</span>
<span class="nc" id="L251">                final ASN1TaggedObject myTagged = ASN1TaggedObject.getInstance(enIds.nextElement());</span>
<span class="nc bnc" id="L252" title="All 3 branches missed.">                switch (myTagged.getTagNo()) {</span>
                    case TAG_RESULTALGID:
<span class="nc" id="L254">                        theResultId = AlgorithmIdentifier.getInstance(myTagged, false);</span>
<span class="nc" id="L255">                        break;</span>
                    case TAG_SIGNALGID:
<span class="nc" id="L257">                        theSignatureId = AlgorithmIdentifier.getInstance(myTagged, false);</span>
<span class="nc" id="L258">                        break;</span>
                    default:
<span class="nc" id="L260">                        throw new GordianDataException(&quot;Unexpected algorithm tag&quot;);</span>
                }
<span class="nc" id="L262">            }</span>

            /* Loop through the optional elements */
<span class="nc bnc" id="L265" title="All 2 branches missed.">            while (en.hasMoreElements()) {</span>
<span class="nc" id="L266">                final ASN1TaggedObject myTagged = ASN1TaggedObject.getInstance(en.nextElement());</span>
<span class="nc bnc" id="L267" title="All 9 branches missed.">                switch (myTagged.getTagNo()) {</span>
                    case TAG_CLIENTCERTIFICATE:
<span class="nc" id="L269">                        theClientCertificate = Certificate.getInstance(myTagged, false);</span>
<span class="nc" id="L270">                        break;</span>
                    case TAG_SERVERCERTIFICATE:
<span class="nc" id="L272">                        theServerCertificate = Certificate.getInstance(myTagged, false);</span>
<span class="nc" id="L273">                        break;</span>
                    case TAG_SIGNERCERTIFICATE:
<span class="nc" id="L275">                        theSignerCertificate = Certificate.getInstance(myTagged, false);</span>
<span class="nc" id="L276">                        break;</span>
                    case TAG_INITVECTOR:
<span class="nc" id="L278">                        theInitVector = ASN1OctetString.getInstance(myTagged, false).getOctets();</span>
<span class="nc" id="L279">                        break;</span>
                    case TAG_ENCAPSULATED:
<span class="nc" id="L281">                        theEncapsulated = ASN1OctetString.getInstance(myTagged, false).getOctets();</span>
<span class="nc" id="L282">                        break;</span>
                    case TAG_EPHEMERAL:
<span class="nc" id="L284">                        theEphemeral = new X509EncodedKeySpec(SubjectPublicKeyInfo.getInstance(myTagged, false).getEncoded());</span>
<span class="nc" id="L285">                        break;</span>
                    case TAG_CONFIRMATION:
<span class="nc" id="L287">                        theConfirmation = ASN1OctetString.getInstance(myTagged, false).getOctets();</span>
<span class="nc" id="L288">                        break;</span>
                    case TAG_SIGNATURE:
<span class="nc" id="L290">                        theSignature = ASN1OctetString.getInstance(myTagged, false).getOctets();</span>
<span class="nc" id="L291">                        break;</span>
                    default:
<span class="nc" id="L293">                        throw new GordianDataException(&quot;Unexpected tag&quot;);</span>
                }
<span class="nc" id="L295">            }</span>

            /* handle exceptions */
<span class="nc" id="L298">        } catch (IllegalArgumentException</span>
                 | IOException e) {
<span class="nc" id="L300">            throw new GordianIOException(&quot;Unable to parse ASN1 sequence&quot;, e);</span>
<span class="nc" id="L301">        }</span>
<span class="nc" id="L302">    }</span>

    /**
     * Create a client hello.
     * @return the clientHello
     */
    public static GordianXCoreAgreementMessageASN1 newClientHello()  {
<span class="nc" id="L309">        return new GordianXCoreAgreementMessageASN1(GordianXMessageType.CLIENTHELLO);</span>
    }

    /**
     * Create a server hello.
     * @return the serverHello
     */
    public static GordianXCoreAgreementMessageASN1 newServerHello()  {
<span class="nc" id="L317">        return new GordianXCoreAgreementMessageASN1(GordianXMessageType.SERVERHELLO);</span>
    }

    /**
     * Create a client confirm.
     * @return the clientConfirm
     */
    public static GordianXCoreAgreementMessageASN1 newClientConfirm()  {
<span class="nc" id="L325">        return new GordianXCoreAgreementMessageASN1(GordianXMessageType.CLIENTCONFIRM);</span>
    }

    /**
     * Parse the ASN1 object.
     * @param pObject the object to parse
     * @return the parsed object
     * @throws GordianException on error
     */
    public static GordianXCoreAgreementMessageASN1 getInstance(final Object pObject) throws GordianException {
<span class="nc bnc" id="L335" title="All 2 branches missed.">        if (pObject instanceof GordianXCoreAgreementMessageASN1 myASN1) {</span>
<span class="nc" id="L336">            return myASN1;</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">        } else if (pObject != null) {</span>
<span class="nc" id="L338">            return new GordianXCoreAgreementMessageASN1(ASN1Sequence.getInstance(pObject));</span>
        }
<span class="nc" id="L340">        throw new GordianDataException(&quot;Null sequence&quot;);</span>
    }

    /**
     * Get the messageType.
     * @return the messageType
     */
    GordianXMessageType getMessageType() {
<span class="nc" id="L348">        return theMessageType;</span>
    }

    /**
     * Check the message type.
     * @param pMessageType the message type
     * @throws GordianException on error
     */
    public void checkMessageType(final GordianXMessageType pMessageType) throws GordianException {
<span class="nc bnc" id="L357" title="All 2 branches missed.">        if (!theMessageType.equals(pMessageType)) {</span>
<span class="nc" id="L358">            throw new GordianDataException(&quot;Unexpected Message type: &quot; + pMessageType);</span>
        }
<span class="nc" id="L360">    }</span>

    /**
     * Get the clientId.
     * @return the clientId
     */
    Long getClientId() {
<span class="nc" id="L367">        return theClientId;</span>
    }

    /**
     * Set the clientId.
     * @param pClientId the clientId
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setClientId(final Long pClientId) {
<span class="nc" id="L376">        theClientId = pClientId;</span>
<span class="nc" id="L377">        return this;</span>
    }

    /**
     * Get the clientId.
     * @return the clientId
     */
    Long getServerId() {
<span class="nc" id="L385">        return theServerId;</span>
    }

    /**
     * Set the serverId.
     * @param pServerId the serverId
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setServerId(final Long pServerId) {
<span class="nc" id="L394">        theServerId = pServerId;</span>
<span class="nc" id="L395">        return this;</span>
    }

    /**
     * Get the agreement algorithmId.
     * @return the agreement algorithmId (or null)
     */
    AlgorithmIdentifier getAgreementId() {
<span class="nc" id="L403">        return theAgreementId;</span>
    }

    /**
     * Set the agreement algorithmId.
     * @param pAgreeId the agreementId
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setAgreementId(final AlgorithmIdentifier pAgreeId) {
<span class="nc" id="L412">        theAgreementId = pAgreeId;</span>
<span class="nc" id="L413">        return this;</span>
    }

    /**
     * Get the result algorithmId.
     * @return the result algorithmId (or null)
     */
    AlgorithmIdentifier getResultId() {
<span class="nc" id="L421">        return theResultId;</span>
    }

    /**
     * Set the result algorithmId.
     * @param pResultId the resultId
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setResultId(final AlgorithmIdentifier pResultId) {
<span class="nc" id="L430">        theResultId = pResultId;</span>
<span class="nc" id="L431">        return this;</span>
    }

    /**
     * Get the client certificate.
     * @return the certificate (or null)
     */
    Certificate getClientCertificate() {
<span class="nc" id="L439">        return theServerCertificate;</span>
    }

    /**
     * Set the client certificate.
     * @param pCertificate the certificate
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setClientCertificate(final Certificate pCertificate) {
<span class="nc" id="L448">        theClientCertificate = pCertificate;</span>
<span class="nc" id="L449">        return this;</span>
    }

    /**
     * Get the server certificate.
     * @return the certificate (or null)
     */
    Certificate getServerCertificate() {
<span class="nc" id="L457">        return theServerCertificate;</span>
    }

    /**
     * Set the server certificate.
     * @param pCertificate the certificate
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setServerCertificate(final Certificate pCertificate) {
<span class="nc" id="L466">        theServerCertificate = pCertificate;</span>
<span class="nc" id="L467">        return this;</span>
    }

    /**
     * Get the signer certificate.
     * @return the certificate (or null)
     */
    Certificate getSignerCertificate() {
<span class="nc" id="L475">        return theSignerCertificate;</span>
    }

    /**
     * Set the signer certificate.
     * @param pCertificate the certificate
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setSignerCertificate(final Certificate pCertificate) {
<span class="nc" id="L484">        theSignerCertificate = pCertificate;</span>
<span class="nc" id="L485">        return this;</span>
    }

    /**
     * Get the initVector.
     * @return the initVector (or null)
     */
    byte[] getInitVector() {
<span class="nc" id="L493">        return theInitVector;</span>
    }

    /**
     * Set the initVector.
     * @param pInitVector the initVector Tag
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setInitVector(final byte[] pInitVector) {
<span class="nc" id="L502">        theInitVector = pInitVector;</span>
<span class="nc" id="L503">        return this;</span>
    }

    /**
     * Get the encapsulated.
     * @return the encapsulated (or null)
     */
    public byte[] getEncapsulated() {
<span class="nc" id="L511">        return theEncapsulated;</span>
    }

    /**
     * Set the encapsulated.
     * @param pEncapsulated the encapsulated
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setEncapsulated(final byte[] pEncapsulated) {
<span class="nc" id="L520">        theEncapsulated = pEncapsulated;</span>
<span class="nc" id="L521">        return this;</span>
    }

    /**
     * Get the ephemeral.
     * @return the ephemeral (or null)
     */
    public X509EncodedKeySpec getEphemeral() {
<span class="nc" id="L529">        return theEphemeral;</span>
    }

    /**
     * Set the ephemeral.
     * @param pEphemeral the ephemeral
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setEphemeral(final X509EncodedKeySpec pEphemeral) {
<span class="nc" id="L538">        theEphemeral = pEphemeral;</span>
<span class="nc" id="L539">        return this;</span>
    }

    /**
     * Get the confirmation.
     * @return the confirmation Tag (or null)
     */
    byte[] getConfirmation() {
<span class="nc" id="L547">        return theConfirmation;</span>
    }

    /**
     * Set the confirmation.
     * @param pConfirmation the confirmation Tag
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setConfirmation(final byte[] pConfirmation) {
<span class="nc" id="L556">        theConfirmation = pConfirmation;</span>
<span class="nc" id="L557">        return this;</span>
    }

    /**
     * Get the signature algorithmId.
     * @return the signature algorithmId (or null)
     */
    AlgorithmIdentifier getSignatureId() {
<span class="nc" id="L565">        return theSignatureId;</span>
    }

    /**
     * Get the signature.
     * @return the signature (or null)
     */
    byte[] getSignature() {
<span class="nc" id="L573">        return theSignature;</span>
    }

    /**
     * Set the signature and algorithmId.
     * @param pSignatureId the signature algorithmId
     * @param pSignature the signature
     * @return this object
     */
    GordianXCoreAgreementMessageASN1 setSignature(final AlgorithmIdentifier pSignatureId,
                                                  final byte[] pSignature) {
<span class="nc" id="L584">        theSignatureId = pSignatureId;</span>
<span class="nc" id="L585">        theSignature = pSignature;</span>
<span class="nc" id="L586">        return this;</span>
    }

    @Override
    public ASN1Primitive toASN1Primitive() {
        /* Create the vector */
<span class="nc" id="L592">        final ASN1EncodableVector v = new ASN1EncodableVector();</span>

        /* Add id section */
<span class="nc" id="L595">        final ASN1EncodableVector vId = new ASN1EncodableVector();</span>
<span class="nc" id="L596">        vId.add(new ASN1Integer(theMessageType.getId()));</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">        if (theClientId != null) {</span>
<span class="nc" id="L598">            vId.add(new DERTaggedObject(false, TAG_CLIENTID, new ASN1Integer(theClientId)));</span>
        }
<span class="nc bnc" id="L600" title="All 2 branches missed.">        if (theServerId != null) {</span>
<span class="nc" id="L601">            vId.add(new DERTaggedObject(false, TAG_CLIENTID, new ASN1Integer(theServerId)));</span>
        }
<span class="nc" id="L603">        v.add(new DERSequence(vId));</span>

        /* Add algorithm section */
<span class="nc" id="L606">        final ASN1EncodableVector vAlg = new ASN1EncodableVector();</span>
<span class="nc" id="L607">        vAlg.add(theAgreementId);</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">        if (theResultId != null) {</span>
<span class="nc" id="L609">            vAlg.add(new DERTaggedObject(false, TAG_RESULTALGID, theResultId));</span>
        }
<span class="nc bnc" id="L611" title="All 2 branches missed.">        if (theSignatureId != null) {</span>
<span class="nc" id="L612">            vAlg.add(new DERTaggedObject(false, TAG_SIGNALGID, theSignatureId));</span>
        }
<span class="nc" id="L614">        v.add(new DERSequence(vAlg));</span>

        /* Add optional components */
<span class="nc bnc" id="L617" title="All 2 branches missed.">        if (theClientCertificate != null) {</span>
<span class="nc" id="L618">            v.add(new DERTaggedObject(false, TAG_CLIENTCERTIFICATE, theClientCertificate));</span>
        }
<span class="nc bnc" id="L620" title="All 2 branches missed.">        if (theServerCertificate != null) {</span>
<span class="nc" id="L621">            v.add(new DERTaggedObject(false, TAG_SERVERCERTIFICATE, theServerCertificate));</span>
        }
<span class="nc bnc" id="L623" title="All 2 branches missed.">        if (theSignerCertificate != null) {</span>
<span class="nc" id="L624">            v.add(new DERTaggedObject(false, TAG_SIGNERCERTIFICATE, theSignerCertificate));</span>
        }
<span class="nc bnc" id="L626" title="All 2 branches missed.">        if (theInitVector != null) {</span>
<span class="nc" id="L627">            v.add(new DERTaggedObject(false, TAG_INITVECTOR, new BEROctetString(theInitVector)));</span>
        }
<span class="nc bnc" id="L629" title="All 2 branches missed.">        if (theEncapsulated != null) {</span>
<span class="nc" id="L630">            v.add(new DERTaggedObject(false, TAG_ENCAPSULATED, new BEROctetString(theEncapsulated)));</span>
        }
<span class="nc bnc" id="L632" title="All 2 branches missed.">        if (theEphemeral != null) {</span>
<span class="nc" id="L633">            v.add(new DERTaggedObject(false, TAG_EPHEMERAL, SubjectPublicKeyInfo.getInstance(theEphemeral.getEncoded())));</span>
        }
<span class="nc bnc" id="L635" title="All 2 branches missed.">        if (theConfirmation != null) {</span>
<span class="nc" id="L636">            v.add(new DERTaggedObject(false, TAG_CONFIRMATION, new BEROctetString(theConfirmation)));</span>
        }
<span class="nc bnc" id="L638" title="All 2 branches missed.">        if (theSignature != null) {</span>
<span class="nc" id="L639">            v.add(new DERTaggedObject(false, TAG_SIGNATURE, new BEROctetString(theSignature)));</span>
        }

<span class="nc" id="L642">        return new DERSequence(v);</span>
    }


    @Override
    public boolean equals(final Object pThat) {
        /* Handle trivial cases */
<span class="nc bnc" id="L649" title="All 2 branches missed.">        if (this == pThat) {</span>
<span class="nc" id="L650">            return true;</span>
        }
<span class="nc bnc" id="L652" title="All 2 branches missed.">        if (pThat == null) {</span>
<span class="nc" id="L653">            return false;</span>
        }

        /* Check that the fields are equal */
<span class="nc" id="L657">        return pThat instanceof GordianXCoreAgreementMessageASN1 myThat</span>
<span class="nc bnc" id="L658" title="All 2 branches missed.">                &amp;&amp; Objects.equals(getMessageType(), myThat.getMessageType())</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">                &amp;&amp; Objects.equals(getClientId(), myThat.getClientId())</span>
<span class="nc bnc" id="L660" title="All 2 branches missed.">                &amp;&amp; Objects.equals(getServerId(), myThat.getServerId())</span>
<span class="nc bnc" id="L661" title="All 2 branches missed.">                &amp;&amp; Objects.equals(getAgreementId(), myThat.getAgreementId())</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">                &amp;&amp; Objects.equals(getResultId(), myThat.getResultId())</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">                &amp;&amp; Objects.equals(getSignatureId(), myThat.getSignatureId())</span>
<span class="nc bnc" id="L664" title="All 2 branches missed.">                &amp;&amp; Objects.equals(getClientCertificate(), myThat.getClientCertificate())</span>
<span class="nc bnc" id="L665" title="All 2 branches missed.">                &amp;&amp; Objects.equals(getServerCertificate(), myThat.getServerCertificate())</span>
<span class="nc bnc" id="L666" title="All 2 branches missed.">                &amp;&amp; Objects.equals(getSignerCertificate(), myThat.getSignerCertificate())</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">                &amp;&amp; Objects.equals(getEphemeral(), myThat.getEphemeral())</span>
<span class="nc bnc" id="L668" title="All 2 branches missed.">                &amp;&amp; Arrays.equals(getSignature(), myThat.getSignature())</span>
<span class="nc bnc" id="L669" title="All 2 branches missed.">                &amp;&amp; Arrays.equals(getEncapsulated(), myThat.getEncapsulated())</span>
<span class="nc bnc" id="L670" title="All 2 branches missed.">                &amp;&amp; Arrays.equals(getConfirmation(), myThat.getConfirmation())</span>
<span class="nc bnc" id="L671" title="All 4 branches missed.">                &amp;&amp; Arrays.equals(getInitVector(), myThat.getInitVector());</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L676">        return Objects.hash(getMessageType(), getClientId(), getServerId(),</span>
<span class="nc" id="L677">                getAgreementId(), getResultId(), getSignatureId(),</span>
<span class="nc" id="L678">                getClientCertificate(), getServerCertificate(), getSignerCertificate(), getEphemeral())</span>
<span class="nc" id="L679">                ^ Arrays.hashCode(getSignature())</span>
<span class="nc" id="L680">                ^ Arrays.hashCode(getEncapsulated())</span>
<span class="nc" id="L681">                ^ Arrays.hashCode(getConfirmation())</span>
<span class="nc" id="L682">                ^ Arrays.hashCode(getInitVector());</span>
    }

    /**
     * The messageType.
     */
<span class="nc" id="L688">    public enum GordianXMessageType {</span>
        /**
         * ClientHello.
         */
<span class="nc" id="L692">        CLIENTHELLO(1),</span>

        /**
         * ServerHello.
         */
<span class="nc" id="L697">        SERVERHELLO(2),</span>

        /**
         * ClientConfirm.
         */
<span class="nc" id="L702">        CLIENTCONFIRM(3);</span>

        /**
         * The messageId.
         */
        private final int theId;

        /**
         * Constructor.
         * @param pId the id
         */
<span class="nc" id="L713">        GordianXMessageType(final int pId) {</span>
<span class="nc" id="L714">            theId = pId;</span>
<span class="nc" id="L715">        }</span>

        /**
         * Obtain id for messageType.
         * @return the id
         */
        int getId() {
<span class="nc" id="L722">            return theId;</span>
        }

        /**
         * Determine the MessageType from the id.
         * @param pId the id
         * @return the messageType
         * @throws GordianException on error
         */
        private static GordianXMessageType determineType(final int pId) throws GordianException {
<span class="nc bnc" id="L732" title="All 2 branches missed.">            for (GordianXMessageType myType : values()) {</span>
<span class="nc bnc" id="L733" title="All 2 branches missed.">                if (pId == myType.getId()) {</span>
<span class="nc" id="L734">                    return myType;</span>
                }
            }
<span class="nc" id="L737">            throw new GordianDataException(&quot;Unexpected messageType: &quot; + pId);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>