<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BouncyCipherFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GordianKnot Security Framework</a> &gt; <a href="index.source.html" class="el_package">io.github.tonywasher.joceanus.gordianknot.impl.bc</a> &gt; <span class="el_source">BouncyCipherFactory.java</span></div><h1>BouncyCipherFactory.java</h1><pre class="source lang-java linenums">/*
 * GordianKnot: Security Suite
 * Copyright 2012-2026. Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package io.github.tonywasher.joceanus.gordianknot.impl.bc;

import io.github.tonywasher.joceanus.gordianknot.api.base.GordianException;
import io.github.tonywasher.joceanus.gordianknot.api.base.GordianKeySpec;
import io.github.tonywasher.joceanus.gordianknot.api.base.GordianLength;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianCipherMode;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianPadding;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamCipher;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamCipherSpec;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamKeySpec;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamKeySpec.GordianBlakeXofKey;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamKeySpec.GordianChaCha20Key;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamKeySpec.GordianElephantKey;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamKeySpec.GordianISAPKey;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamKeySpec.GordianRomulusKey;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamKeySpec.GordianSalsa20Key;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamKeySpec.GordianSkeinXofKey;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamKeySpec.GordianSparkleKey;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianStreamKeySpec.GordianVMPCKey;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianSymCipher;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianSymCipherSpec;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianSymCipherSpecBuilder;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianSymKeySpec;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianSymKeyType;
import io.github.tonywasher.joceanus.gordianknot.api.cipher.GordianWrapper;
import io.github.tonywasher.joceanus.gordianknot.api.key.GordianKey;
import io.github.tonywasher.joceanus.gordianknot.impl.core.base.GordianBaseData;
import io.github.tonywasher.joceanus.gordianknot.impl.core.base.GordianBaseFactory;
import io.github.tonywasher.joceanus.gordianknot.impl.core.cipher.GordianCoreCipherFactory;
import io.github.tonywasher.joceanus.gordianknot.impl.core.exc.GordianDataException;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.digests.GordianBlake2bDigest;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.digests.GordianBlake2sDigest;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianAnubisEngine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianBlake2XEngine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianBlake3Engine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianLeaEngine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianMARSEngine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianRabbitEngine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianSimonEngine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianSkeinXofEngine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianSnow3GEngine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianSosemanukEngine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianSpeckEngine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianXChaCha20Engine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianZuc128Engine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.engines.GordianZuc256Engine;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.modes.GordianChaChaPoly1305;
import io.github.tonywasher.joceanus.gordianknot.impl.ext.modes.GordianGCMSIVBlockCipher;
import org.bouncycastle.crypto.BlockCipher;
import org.bouncycastle.crypto.BufferedBlockCipher;
import org.bouncycastle.crypto.CipherKeyGenerator;
import org.bouncycastle.crypto.DefaultBufferedBlockCipher;
import org.bouncycastle.crypto.StreamCipher;
import org.bouncycastle.crypto.engines.AESEngine;
import org.bouncycastle.crypto.engines.ARIAEngine;
import org.bouncycastle.crypto.engines.AsconAEAD128;
import org.bouncycastle.crypto.engines.BlowfishEngine;
import org.bouncycastle.crypto.engines.CAST5Engine;
import org.bouncycastle.crypto.engines.CAST6Engine;
import org.bouncycastle.crypto.engines.CamelliaEngine;
import org.bouncycastle.crypto.engines.ChaCha7539Engine;
import org.bouncycastle.crypto.engines.ChaChaEngine;
import org.bouncycastle.crypto.engines.DESedeEngine;
import org.bouncycastle.crypto.engines.DSTU7624Engine;
import org.bouncycastle.crypto.engines.ElephantEngine;
import org.bouncycastle.crypto.engines.GOST28147Engine;
import org.bouncycastle.crypto.engines.GOST3412_2015Engine;
import org.bouncycastle.crypto.engines.Grain128Engine;
import org.bouncycastle.crypto.engines.HC128Engine;
import org.bouncycastle.crypto.engines.HC256Engine;
import org.bouncycastle.crypto.engines.IDEAEngine;
import org.bouncycastle.crypto.engines.ISAACEngine;
import org.bouncycastle.crypto.engines.ISAPEngine;
import org.bouncycastle.crypto.engines.NoekeonEngine;
import org.bouncycastle.crypto.engines.PhotonBeetleEngine;
import org.bouncycastle.crypto.engines.PhotonBeetleEngine.PhotonBeetleParameters;
import org.bouncycastle.crypto.engines.RC2Engine;
import org.bouncycastle.crypto.engines.RC4Engine;
import org.bouncycastle.crypto.engines.RC532Engine;
import org.bouncycastle.crypto.engines.RC564Engine;
import org.bouncycastle.crypto.engines.RC6Engine;
import org.bouncycastle.crypto.engines.RomulusEngine;
import org.bouncycastle.crypto.engines.SEEDEngine;
import org.bouncycastle.crypto.engines.SM4Engine;
import org.bouncycastle.crypto.engines.Salsa20Engine;
import org.bouncycastle.crypto.engines.SerpentEngine;
import org.bouncycastle.crypto.engines.Shacal2Engine;
import org.bouncycastle.crypto.engines.SkipjackEngine;
import org.bouncycastle.crypto.engines.SparkleEngine;
import org.bouncycastle.crypto.engines.TEAEngine;
import org.bouncycastle.crypto.engines.ThreefishEngine;
import org.bouncycastle.crypto.engines.TwofishEngine;
import org.bouncycastle.crypto.engines.VMPCEngine;
import org.bouncycastle.crypto.engines.VMPCKSA3Engine;
import org.bouncycastle.crypto.engines.XSalsa20Engine;
import org.bouncycastle.crypto.engines.XTEAEngine;
import org.bouncycastle.crypto.engines.XoodyakEngine;
import org.bouncycastle.crypto.generators.DESedeKeyGenerator;
import org.bouncycastle.crypto.modes.AEADBlockCipher;
import org.bouncycastle.crypto.modes.AEADCipher;
import org.bouncycastle.crypto.modes.CBCBlockCipher;
import org.bouncycastle.crypto.modes.CCMBlockCipher;
import org.bouncycastle.crypto.modes.CFBBlockCipher;
import org.bouncycastle.crypto.modes.CTSBlockCipher;
import org.bouncycastle.crypto.modes.EAXBlockCipher;
import org.bouncycastle.crypto.modes.G3413CBCBlockCipher;
import org.bouncycastle.crypto.modes.G3413CFBBlockCipher;
import org.bouncycastle.crypto.modes.G3413CTRBlockCipher;
import org.bouncycastle.crypto.modes.G3413OFBBlockCipher;
import org.bouncycastle.crypto.modes.GCFBBlockCipher;
import org.bouncycastle.crypto.modes.GCMBlockCipher;
import org.bouncycastle.crypto.modes.GOFBBlockCipher;
import org.bouncycastle.crypto.modes.KCTRBlockCipher;
import org.bouncycastle.crypto.modes.OCBBlockCipher;
import org.bouncycastle.crypto.modes.OFBBlockCipher;
import org.bouncycastle.crypto.modes.SICBlockCipher;
import org.bouncycastle.crypto.paddings.ISO7816d4Padding;
import org.bouncycastle.crypto.paddings.PKCS7Padding;
import org.bouncycastle.crypto.paddings.PaddedBufferedBlockCipher;
import org.bouncycastle.crypto.paddings.TBCPadding;
import org.bouncycastle.crypto.paddings.X923Padding;
import org.bouncycastle.crypto.patch.modes.GordianKCCMBlockCipher;
import org.bouncycastle.crypto.patch.modes.GordianKGCMBlockCipher;

import java.util.HashMap;
import java.util.Map;

/**
 * Factory for BouncyCastle Ciphers.
 */
public class BouncyCipherFactory
        extends GordianCoreCipherFactory {
    /**
     * KeyPairGenerator Cache.
     */
    private final Map&lt;GordianKeySpec, BouncyKeyGenerator&lt;? extends GordianKeySpec&gt;&gt; theCache;

    /**
     * Constructor.
     *
     * @param pFactory the factory
     */
    BouncyCipherFactory(final GordianBaseFactory pFactory) {
        /* Initialise underlying class */
<span class="fc" id="L161">        super(pFactory);</span>

        /* Create the cache */
<span class="fc" id="L164">        theCache = new HashMap&lt;&gt;();</span>
<span class="fc" id="L165">    }</span>

    @Override
    @SuppressWarnings(&quot;unchecked&quot;)
    public &lt;T extends GordianKeySpec&gt; BouncyKeyGenerator&lt;T&gt; getKeyGenerator(final T pKeySpec) throws GordianException {
        /* Look up in the cache */
<span class="fc" id="L171">        BouncyKeyGenerator&lt;T&gt; myGenerator = (BouncyKeyGenerator&lt;T&gt;) theCache.get(pKeySpec);</span>
<span class="fc bfc" id="L172" title="All 2 branches covered.">        if (myGenerator == null) {</span>
            /* Create the new generator */
<span class="fc" id="L174">            final CipherKeyGenerator myBCGenerator = getBCKeyGenerator(pKeySpec);</span>
<span class="fc" id="L175">            myGenerator = new BouncyKeyGenerator&lt;&gt;(getFactory(), pKeySpec, myBCGenerator);</span>

            /* Add to cache */
<span class="fc" id="L178">            theCache.put(pKeySpec, myGenerator);</span>
        }
<span class="fc" id="L180">        return myGenerator;</span>
    }

    @Override
    public GordianSymCipher createSymKeyCipher(final GordianSymCipherSpec pCipherSpec) throws GordianException {
        /* Check validity of SymKeySpec */
<span class="fc" id="L186">        checkSymCipherSpec(pCipherSpec);</span>

        /* If this is an AAD cipher */
<span class="fc bfc" id="L189" title="All 2 branches covered.">        if (pCipherSpec.isAAD()) {</span>
            /* Create the AAD cipher */
<span class="fc" id="L191">            final AEADBlockCipher myBCCipher = getBCAADCipher(pCipherSpec);</span>
<span class="fc" id="L192">            return new BouncySymKeyAEADCipher(getFactory(), pCipherSpec, myBCCipher);</span>

            /* else create the standard cipher */
        } else {
            /* Create the cipher */
<span class="fc" id="L197">            final BufferedBlockCipher myBCCipher = getBCBlockCipher(pCipherSpec);</span>
<span class="fc" id="L198">            return new BouncySymKeyCipher(getFactory(), pCipherSpec, myBCCipher);</span>
        }
    }

    @Override
    public GordianStreamCipher createStreamKeyCipher(final GordianStreamCipherSpec pCipherSpec) throws GordianException {
        /* Check validity of StreamKeySpec */
<span class="fc" id="L205">        checkStreamCipherSpec(pCipherSpec);</span>

        /* Create the cipher */
<span class="fc bfc" id="L208" title="All 2 branches covered.">        return pCipherSpec.isAEAD()</span>
<span class="fc" id="L209">                ? new BouncyStreamKeyAEADCipher(getFactory(), pCipherSpec, getBCAEADStreamCipher(pCipherSpec))</span>
<span class="fc" id="L210">                : new BouncyStreamKeyCipher(getFactory(), pCipherSpec, getBCStreamCipher(pCipherSpec));</span>
    }

    @Override
    public GordianWrapper createKeyWrapper(final GordianKey&lt;GordianSymKeySpec&gt; pKey) throws GordianException {
        /* Create the cipher */
<span class="fc" id="L216">        final BouncyKey&lt;GordianSymKeySpec&gt; myKey = BouncyKey.accessKey(pKey);</span>
<span class="fc" id="L217">        final GordianSymCipherSpec mySpec = GordianSymCipherSpecBuilder.ecb(myKey.getKeyType(), GordianPadding.NONE);</span>
<span class="fc" id="L218">        final BouncySymKeyCipher myBCCipher = (BouncySymKeyCipher) createSymKeyCipher(mySpec);</span>
<span class="fc" id="L219">        return createKeyWrapper(myKey, myBCCipher);</span>
    }

    /**
     * Create the BouncyCastle KeyGenerator.
     *
     * @param pKeySpec the keySpec
     * @return the KeyGenerator
     * @throws GordianException on error
     */
    private CipherKeyGenerator getBCKeyGenerator(final GordianKeySpec pKeySpec) throws GordianException {
<span class="fc" id="L230">        checkKeySpec(pKeySpec);</span>
<span class="fc" id="L231">        return pKeySpec instanceof GordianSymKeySpec mySpec</span>
<span class="fc bfc" id="L232" title="All 4 branches covered.">                &amp;&amp; GordianSymKeyType.DESEDE.equals(mySpec.getSymKeyType())</span>
<span class="fc" id="L233">                ? new DESedeKeyGenerator()</span>
<span class="fc" id="L234">                : new CipherKeyGenerator();</span>
    }

    /**
     * Create the BouncyCastle Block Cipher.
     *
     * @param pCipherSpec the cipherSpec
     * @return the Cipher
     * @throws GordianException on error
     */
    private static BufferedBlockCipher getBCBlockCipher(final GordianSymCipherSpec pCipherSpec) throws GordianException {
        /* Build the cipher */
<span class="fc" id="L246">        final BlockCipher myEngine = getBCSymEngine(pCipherSpec.getKeyType());</span>
<span class="fc" id="L247">        final BlockCipher myMode = getBCSymModeCipher(myEngine, pCipherSpec.getCipherMode());</span>
<span class="fc" id="L248">        return getBCSymBufferedCipher(myMode, pCipherSpec.getPadding());</span>
    }

    /**
     * Create the BouncyCastle Stream Cipher.
     *
     * @param pCipherSpec the cipherSpec
     * @return the Cipher
     * @throws GordianException on error
     */
    private static StreamCipher getBCStreamCipher(final GordianStreamCipherSpec pCipherSpec) throws GordianException {
<span class="fc" id="L259">        final GordianStreamKeySpec mySpec = pCipherSpec.getKeyType();</span>
<span class="pc bpc" id="L260" title="1 of 15 branches missed.">        switch (mySpec.getStreamKeyType()) {</span>
            case HC:
<span class="fc bfc" id="L262" title="All 2 branches covered.">                return GordianLength.LEN_128 == mySpec.getKeyLength()</span>
<span class="fc" id="L263">                        ? new HC128Engine()</span>
<span class="fc" id="L264">                        : new HC256Engine();</span>
            case CHACHA20:
<span class="fc bfc" id="L266" title="All 3 branches covered.">                switch ((GordianChaCha20Key) mySpec.getSubKeyType()) {</span>
                    case XCHACHA:
<span class="fc" id="L268">                        return new GordianXChaCha20Engine();</span>
                    case ISO7539:
<span class="fc" id="L270">                        return new ChaCha7539Engine();</span>
                    default:
<span class="fc" id="L272">                        return new ChaChaEngine();</span>
                }
            case SALSA20:
<span class="fc bfc" id="L275" title="All 2 branches covered.">                return mySpec.getSubKeyType() == GordianSalsa20Key.STD</span>
<span class="fc" id="L276">                        ? new Salsa20Engine()</span>
<span class="fc" id="L277">                        : new XSalsa20Engine();</span>
            case VMPC:
<span class="fc bfc" id="L279" title="All 2 branches covered.">                return mySpec.getSubKeyType() == GordianVMPCKey.STD</span>
<span class="fc" id="L280">                        ? new VMPCEngine()</span>
<span class="fc" id="L281">                        : new VMPCKSA3Engine();</span>
            case GRAIN:
<span class="fc" id="L283">                return new Grain128Engine();</span>
            case ISAAC:
<span class="fc" id="L285">                return new ISAACEngine();</span>
            case RC4:
<span class="fc" id="L287">                return new RC4Engine();</span>
            case SOSEMANUK:
<span class="fc" id="L289">                return new GordianSosemanukEngine();</span>
            case RABBIT:
<span class="fc" id="L291">                return new GordianRabbitEngine();</span>
            case SNOW3G:
<span class="fc" id="L293">                return new GordianSnow3GEngine();</span>
            case ZUC:
<span class="fc bfc" id="L295" title="All 2 branches covered.">                return GordianLength.LEN_128 == mySpec.getKeyLength()</span>
<span class="fc" id="L296">                        ? new GordianZuc128Engine()</span>
<span class="fc" id="L297">                        : new GordianZuc256Engine();</span>
            case SKEINXOF:
<span class="fc" id="L299">                final GordianSkeinXofKey mySkeinKeyType = (GordianSkeinXofKey) mySpec.getSubKeyType();</span>
<span class="fc" id="L300">                return new GordianSkeinXofEngine(mySkeinKeyType.getLength().getLength());</span>
            case BLAKE2XOF:
<span class="fc" id="L302">                final GordianBlakeXofKey myBlakeKeyType = (GordianBlakeXofKey) mySpec.getSubKeyType();</span>
<span class="fc bfc" id="L303" title="All 2 branches covered.">                return new GordianBlake2XEngine(GordianBlakeXofKey.BLAKE2XB == myBlakeKeyType</span>
<span class="fc" id="L304">                        ? new GordianBlake2bDigest()</span>
<span class="fc" id="L305">                        : new GordianBlake2sDigest());</span>
            case BLAKE3XOF:
<span class="fc" id="L307">                return new GordianBlake3Engine();</span>
            default:
<span class="nc" id="L309">                throw new GordianDataException(GordianBaseData.getInvalidText(pCipherSpec));</span>
        }
    }

    /**
     * Create the BouncyCastle AEAD Stream Cipher.
     *
     * @param pCipherSpec the cipherSpec
     * @return the Cipher
     * @throws GordianException on error
     */
    private static AEADCipher getBCAEADStreamCipher(final GordianStreamCipherSpec pCipherSpec) throws GordianException {
<span class="fc" id="L321">        final GordianStreamKeySpec mySpec = pCipherSpec.getKeyType();</span>
<span class="pc bpc" id="L322" title="1 of 9 branches missed.">        switch (mySpec.getStreamKeyType()) {</span>
            case CHACHA20:
<span class="fc bfc" id="L324" title="All 2 branches covered.">                switch ((GordianChaCha20Key) mySpec.getSubKeyType()) {</span>
                    case XCHACHA:
<span class="fc" id="L326">                        return new GordianChaChaPoly1305(new GordianXChaCha20Engine());</span>
                    case ISO7539:
                    default:
<span class="fc" id="L329">                        return new GordianChaChaPoly1305(new ChaCha7539Engine());</span>
                }
            case ASCON:
<span class="fc" id="L332">                return new AsconAEAD128();</span>
            case ELEPHANT:
<span class="fc" id="L334">                return new ElephantEngine(((GordianElephantKey) mySpec.getSubKeyType()).getParameters());</span>
            case ISAP:
<span class="fc" id="L336">                return new ISAPEngine(((GordianISAPKey) mySpec.getSubKeyType()).getType());</span>
            case PHOTONBEETLE:
<span class="fc" id="L338">                return new PhotonBeetleEngine(PhotonBeetleParameters.pb128);</span>
            case ROMULUS:
<span class="fc" id="L340">                return new RomulusEngine(((GordianRomulusKey) mySpec.getSubKeyType()).getParameters());</span>
            case SPARKLE:
<span class="fc" id="L342">                return new SparkleEngine(((GordianSparkleKey) mySpec.getSubKeyType()).getParameters());</span>
            case XOODYAK:
<span class="fc" id="L344">                return new XoodyakEngine();</span>
            default:
<span class="nc" id="L346">                throw new GordianDataException(GordianBaseData.getInvalidText(pCipherSpec));</span>
        }
    }

    /**
     * Create the BouncyCastle Cipher Engine.
     *
     * @param pKeySpec the SymKeySpec
     * @return the Engine
     * @throws GordianException on error
     */
    static BlockCipher getBCSymEngine(final GordianSymKeySpec pKeySpec) throws GordianException {
<span class="pc bpc" id="L358" title="1 of 30 branches missed.">        switch (pKeySpec.getSymKeyType()) {</span>
            case AES:
<span class="fc" id="L360">                return AESEngine.newInstance();</span>
            case SERPENT:
<span class="fc" id="L362">                return new SerpentEngine();</span>
            case TWOFISH:
<span class="fc" id="L364">                return new TwofishEngine();</span>
            case CAMELLIA:
<span class="fc" id="L366">                return new CamelliaEngine();</span>
            case RC6:
<span class="fc" id="L368">                return new RC6Engine();</span>
            case CAST6:
<span class="fc" id="L370">                return new CAST6Engine();</span>
            case ARIA:
<span class="fc" id="L372">                return new ARIAEngine();</span>
            case THREEFISH:
<span class="fc" id="L374">                return new ThreefishEngine(pKeySpec.getBlockLength().getLength());</span>
            case KALYNA:
<span class="fc" id="L376">                return new DSTU7624Engine(pKeySpec.getBlockLength().getLength());</span>
            case SM4:
<span class="fc" id="L378">                return new SM4Engine();</span>
            case NOEKEON:
<span class="fc" id="L380">                return new NoekeonEngine();</span>
            case SEED:
<span class="fc" id="L382">                return new SEEDEngine();</span>
            case BLOWFISH:
<span class="fc" id="L384">                return new BlowfishEngine();</span>
            case SKIPJACK:
<span class="fc" id="L386">                return new SkipjackEngine();</span>
            case IDEA:
<span class="fc" id="L388">                return new IDEAEngine();</span>
            case TEA:
<span class="fc" id="L390">                return new TEAEngine();</span>
            case XTEA:
<span class="fc" id="L392">                return new XTEAEngine();</span>
            case RC2:
<span class="fc" id="L394">                return new RC2Engine();</span>
            case RC5:
<span class="fc bfc" id="L396" title="All 2 branches covered.">                return GordianLength.LEN_128.equals(pKeySpec.getBlockLength())</span>
<span class="fc" id="L397">                        ? new RC564Engine()</span>
<span class="fc" id="L398">                        : new RC532Engine();</span>
            case CAST5:
<span class="fc" id="L400">                return new CAST5Engine();</span>
            case DESEDE:
<span class="fc" id="L402">                return new DESedeEngine();</span>
            case GOST:
<span class="fc" id="L404">                return new GOST28147Engine();</span>
            case KUZNYECHIK:
<span class="fc" id="L406">                return new GOST3412_2015Engine();</span>
            case SHACAL2:
<span class="fc" id="L408">                return new Shacal2Engine();</span>
            case SPECK:
<span class="fc" id="L410">                return new GordianSpeckEngine();</span>
            case ANUBIS:
<span class="fc" id="L412">                return new GordianAnubisEngine();</span>
            case SIMON:
<span class="fc" id="L414">                return new GordianSimonEngine();</span>
            case MARS:
<span class="fc" id="L416">                return new GordianMARSEngine();</span>
            case LEA:
<span class="fc" id="L418">                return new GordianLeaEngine();</span>
            default:
<span class="nc" id="L420">                throw new GordianDataException(GordianBaseData.getInvalidText(pKeySpec));</span>
        }
    }

    /**
     * Create the BouncyCastle Buffered Cipher.
     *
     * @param pEngine the underlying engine
     * @param pMode   the cipher mode
     * @return the Cipher
     * @throws GordianException on error
     */
    private static BlockCipher getBCSymModeCipher(final BlockCipher pEngine,
                                                  final GordianCipherMode pMode) throws GordianException {
<span class="pc bpc" id="L434" title="1 of 15 branches missed.">        switch (pMode) {</span>
            case ECB:
<span class="fc" id="L436">                return pEngine;</span>
            case CBC:
<span class="fc" id="L438">                return CBCBlockCipher.newInstance(pEngine);</span>
            case SIC:
<span class="fc" id="L440">                return SICBlockCipher.newInstance(pEngine);</span>
            case KCTR:
<span class="fc" id="L442">                return new KCTRBlockCipher(pEngine);</span>
            case CFB:
<span class="fc" id="L444">                return CFBBlockCipher.newInstance(pEngine, Byte.SIZE * pEngine.getBlockSize());</span>
            case CFB8:
<span class="fc" id="L446">                return CFBBlockCipher.newInstance(pEngine, Byte.SIZE);</span>
            case GCFB:
<span class="fc" id="L448">                return new GCFBBlockCipher(pEngine);</span>
            case OFB:
<span class="fc" id="L450">                return new OFBBlockCipher(pEngine, Byte.SIZE * pEngine.getBlockSize());</span>
            case OFB8:
<span class="fc" id="L452">                return new OFBBlockCipher(pEngine, Byte.SIZE);</span>
            case GOFB:
<span class="fc" id="L454">                return new GOFBBlockCipher(pEngine);</span>
            case G3413CBC:
<span class="fc" id="L456">                return new G3413CBCBlockCipher(pEngine);</span>
            case G3413CTR:
<span class="fc" id="L458">                return new G3413CTRBlockCipher(pEngine);</span>
            case G3413CFB:
<span class="fc" id="L460">                return new G3413CFBBlockCipher(pEngine, Byte.SIZE * pEngine.getBlockSize());</span>
            case G3413OFB:
<span class="fc" id="L462">                return new G3413OFBBlockCipher(pEngine);</span>
            default:
<span class="nc" id="L464">                throw new GordianDataException(GordianBaseData.getInvalidText(pMode));</span>
        }
    }

    /**
     * Create the BouncyCastle Buffered Cipher.
     *
     * @param pCipherSpec the cipherSpec
     * @return the Cipher
     * @throws GordianException on error
     */
    private static AEADBlockCipher getBCAADCipher(final GordianSymCipherSpec pCipherSpec) throws GordianException {
<span class="fc" id="L476">        final GordianSymKeySpec mySpec = pCipherSpec.getKeyType();</span>
<span class="pc bpc" id="L477" title="1 of 8 branches missed.">        switch (pCipherSpec.getCipherMode()) {</span>
            case EAX:
<span class="fc" id="L479">                return new EAXBlockCipher(getBCSymEngine(mySpec));</span>
            case CCM:
<span class="fc" id="L481">                return CCMBlockCipher.newInstance(getBCSymEngine(mySpec));</span>
            case KCCM:
<span class="fc" id="L483">                return new GordianKCCMBlockCipher(getBCSymEngine(mySpec));</span>
            case GCM:
<span class="fc" id="L485">                return GCMBlockCipher.newInstance(getBCSymEngine(mySpec));</span>
            case GCMSIV:
<span class="fc" id="L487">                return new GordianGCMSIVBlockCipher(getBCSymEngine(mySpec));</span>
            case KGCM:
<span class="fc" id="L489">                return new GordianKGCMBlockCipher(getBCSymEngine(mySpec));</span>
            case OCB:
<span class="fc" id="L491">                return new OCBBlockCipher(getBCSymEngine(mySpec), getBCSymEngine(mySpec));</span>
            default:
<span class="nc" id="L493">                throw new GordianDataException(GordianBaseData.getInvalidText(pCipherSpec));</span>
        }
    }

    /**
     * Create the BouncyCastle Mode Cipher.
     *
     * @param pEngine  the underlying engine
     * @param pPadding use padding true/false
     * @return the Cipher
     */
    private static BufferedBlockCipher getBCSymBufferedCipher(final BlockCipher pEngine,
                                                              final GordianPadding pPadding) {
<span class="fc bfc" id="L506" title="All 6 branches covered.">        switch (pPadding) {</span>
            case CTS:
<span class="fc" id="L508">                return new CTSBlockCipher(pEngine);</span>
            case X923:
<span class="fc" id="L510">                return new PaddedBufferedBlockCipher(pEngine, new X923Padding());</span>
            case PKCS7:
<span class="fc" id="L512">                return new PaddedBufferedBlockCipher(pEngine, new PKCS7Padding());</span>
            case ISO7816D4:
<span class="fc" id="L514">                return new PaddedBufferedBlockCipher(pEngine, new ISO7816d4Padding());</span>
            case TBC:
<span class="fc" id="L516">                return new PaddedBufferedBlockCipher(pEngine, new TBCPadding());</span>
            case NONE:
            default:
<span class="fc" id="L519">                return new DefaultBufferedBlockCipher(pEngine);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>