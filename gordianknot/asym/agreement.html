<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 from src/site/xdoc/asym/agreement.xml at 2026-01-08
 | Rendered using Apache Maven Fluido Skin 2.0.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0" />
    <meta name="author" content="Tony Washer" />
    <title>GordianKnot Asymmetric Agreements – GordianKnot Security Framework</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-2.0.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-2.0.1.min.js"></script>
  </head>
  <body class="topBarEnabled">
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">GordianKnot <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../index.html">Introduction</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Parent Project <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../index.html">Java Oceanus package</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../project-info.html">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="../dependencies.html">Dependencies</a></li>
                  <li><a href="../dependency-info.html">Maven Coordinates</a></li>
                  <li><a href="../distribution-management.html">Distribution Management</a></li>
                  <li><a href="../index.html">About</a></li>
                  <li><a href="../issue-management.html">Issue Management</a></li>
                  <li><a href="../licenses.html">Licenses</a></li>
                  <li><a href="../plugin-management.html">Plugin Management</a></li>
                  <li><a href="../plugins.html">Plugins</a></li>
                  <li><a href="../scm.html">Source Code Management</a></li>
                  <li><a href="../summary.html">Summary</a></li>
                  <li><a href="../team.html">Team</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../project-reports.html">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="../checkstyle.html">Checkstyle</a></li>
                  <li><a href="../cpd.html">CPD</a></li>
                  <li><a href="../pmd.html">PMD</a></li>
                  <li><a href="../jacoco/index.html">JaCoCo</a></li>
                  <li><a href="../surefire.html">Surefire</a></li>
              </ul>
            </li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2026-01-08<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.6.3-SNAPSHOT</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">GordianKnot</li>
    <li><a href="../index.html">Introduction</a></li>
   <li class="nav-header">Parent Project</li>
    <li><a href="../../index.html">Java Oceanus package</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">

    
        <section><a id="GordianKnot_Asymmetric_Agreements"></a>
<h1>GordianKnot Asymmetric Agreements</h1>
            <section><a id="Overview"></a>
<h2>Overview</h2>
                
<p>Agreements are supported via the <strong>GordianAgreementFactory</strong> interface.</p>
                
<p>Algorithms are represented by <b>GordianAgreementSpec</b>. A <b>GordianAgreement</b> is obtained via the agreementSpec,
                    and then agreements are created between the two parties depending on the type of the agreement and the resultType.
                    The resultTypes can be any of the following</p>
                
<table class="defTable">
                    
<tr class="a">
<th>ResultType</th>
<th>Description</th></tr>
                    
<tr class="b">
<td>GordianParameters</td>
<td>The underlying agreement is used as the input to the HKDF algorithm to
                        generate a new personalised <strong>GordianFactory</strong></td></tr>
                    
<tr class="a">
<td>GordianKeySetSpec</td>
<td>The underlying agreement is used as the input to the HKDF algorithm to generate a new
                        <strong>GordianKeySet</strong> of the specified type, belonging to an agreed BC factory.</td></tr>
                    
<tr class="b">
<td>GordianSymCipherSpec</td>
<td>The underlying agreement is used as the input to the HKDF algorithm to generate a new
                        <strong>GordianSymCipher</strong> Key and InitVector (if required),
                        belonging to an agreed BC factory. A pair of <strong>GordianSymCipher</strong>s are returned as the result, one for encryption
                        and one for decryption</td></tr>
                    
<tr class="a">
<td>GordianStreamCipherSpec</td>
<td>Similar to <strong>GordianSymKeySpec</strong>.</td></tr>
                    
<tr class="b">
<td>Integer</td>
<td>The underlying agreement is used as the input to the HKDF algorithm to generate a byte array
                        of the desired length</td></tr>
                    
<tr class="a">
<td>null</td>
<td>The raw agreement bytes are returned.</td></tr>
                </table>
                
<p>Agreements are always targeted by a <strong>Client</strong> towards a <strong>Server</strong>. The <strong>GordianAgreement</strong>
                    that is created will implement an appropriate interface as per the following sections</p>
            </section>
            <section><a id="Anonymous_Agreement"></a>
<h2>Anonymous Agreement</h2>
                
<p><strong>GordianAnonymousAgreement</strong> is a oneShot process where the <strong>Client</strong> must already
                    know the publicKey of the <strong>Server</strong>. It will generate a <strong>ClientHello</strong> message that is sent to
                    the <strong>Server</strong>. The <strong>Server</strong> knows nothing about the <strong>Client</strong>. A random client InitVector
                    is included in the message to randomise the result.</p>
                </section><section><a id="Sample"></a>
<h2>Sample</h2>
                    
<pre class="prettyprint"><code>
/* Access factory */
final GordianFactory myBaseFactory = GordianGenerator.createFactory();
final GordianAsyncFactory myAsyncFactory = myBase.getAsyncFactory();
final GordianKeyPairFactory myKeyPairFactory = myAsyncFactory.getKeyPairFactory();
final GordianAgreementFactory myAgreementFactory = myAsyncFactory.getAgreementFactory();

/* Access keyPairGenerator and create sending/receiving pairs */
final GordianKeyPairSpec mySpec = GordianKeyPairSpecBuilder.dh(GordianDHGroup.FFDHE2048);
final GordianKeyPairGenerator myGenerator = myKeyPairFactory.getKeyPairGenerator(mySpec);
final GordianKeyPair myClientPair = myGenerator.generateKeyPair();
final GordianKeyPair myServerPair = myGenerator.generateKeyPair();

/* Create anonymous agreement */
final GordianAgreementSpec myAgreeSpec = GordianAgreementSpecBuilder.anon(mySpec, GordianKDFType.SHA256KDF);
final GordianSymCipherSpec myCipherSpec = GordianSymCipherSpecBuilder.cbc(GordianGordianSymKeySpec.aes(GordianLength.LEN_256), GordianPadding.PKCS7);
final GordianAnonymousAgreement myAnonClient = (GordianAnonymousAgreement) myAgreementFactory.createAgreement(myAgreeSpec);
final GordianAnonymousAgreement myAnonServer = (GordianAnonymousAgreement) myAgreementFactory.createAgreement(myAgreeSpec);

/* Client side */
myAnonClient.setResultType(myCipherSpec);
final byte[] myClientHello = myAnonClient.createClientHello(myServerPair);
final GordianSymCipher[] myClientCiphers = (GordianSymCipher[]) myAnonClient.getResult();

/* Send myClientHello to server */

/* Server side */
myAnonServer.acceptClientHello(myServerPair, myClientHello);
final GordianSymCipherSpec myResultCipherSpec = (GordianSymCipherSpec) myAnonServer.getResultType();
final GordianSymCipher[] myServerCiphers = (GordianSymCipher[]) myAnonServer.getResult();
                    </code></pre>
                </section>
            
            <section><a id="Handshake_Agreement"></a>
<h2>Handshake Agreement</h2>
                
<p><strong>GordianHandshakeAgreement</strong> requires the <strong>Client</strong> to generate a <strong>ClientHello</strong>
                    message that is sent to the <strong>Server</strong>. The <strong>Server</strong> will process the <strong>ClientHello</strong> and generate
                    a <strong>ServerHello</strong> message in response which is returned to the <strong>Client</strong>. Generally both parties should know
                    the publicKey of the partner, and it is expected that the user would pass the certificates for the publicKeys along with the
                    <strong>ClientHello</strong> and <strong>ServerHello</strong> messages. A random client InitVector is included in the <strong>ClientHello</strong>
                    message and a random server InitVector in the <strong>ServerHello</strong> message to randomise the result.</p>
                
<p>Confirmation can also be required by the agreementSpec. In this case the <strong>Client</strong> will send an additional <strong>ClientConfirm</strong> message to the <strong>Server</strong>
                    after processing the <strong>ServerHello</strong> message. The <strong>Server</strong> can determine that a confirmation is due either by
                    checking the agreementSpec or by checking the status of the agreement. The <strong>SM2</strong> confirm is defined by the SM2 algorithm.
                    For <strong>UNIFIED</strong> and <strong>MQV</strong> agreements the confirmation tags are calculated over the well-known and ephemeral keyPairs
                    using an hMac keyed by the agreed result.</p>
                </section><section><a id="Sample_1"></a>
<h2>Sample</h2>
                    
<pre class="prettyprint"><code>
/* Access factory */
final GordianFactory myBaseFactory = GordianGenerator.createFactory();
final GordianAsyncFactory myAsyncFactory = myBase.getAsyncFactory();
final GordianKeyPairFactory myKeyPairFactory = myAsyncFactory.getKeyPairFactory();
final GordianAgreementFactory myAgreementFactory = myAsyncFactory.getAgreementFactory();

/* Access keyPairGenerator and create sending/receiving pairs */
final GordianKeyPairSpec mySpec = GordianKeyPairSpecBuilder.dh(GordianDHGroup.FFDHE2048);
final GordianKeyPairGenerator myGenerator = myKeyPairFactory.getKeyPairGenerator(mySpec);
final GordianKeyPair myClientPair = myGenerator.generateKeyPair();
final GordianKeyPair myServerPair = myGenerator.generateKeyPair();

/* Create handshake agreement */
final GordianAgreementSpec myAgreeSpec = GordianAgreementSpecBuilder.unified(mySpec, GordianKDFType.SHA256KDF);
final GordianKeySetSpec myKeySetSpec = new GordianKeySetSpec(GordianLength.LEN_256);
final GordianHandshakeAgreement myHandshakeClient = (GordianHandshakeAgreement) myAgreementFactory.createAgreement(myAgreeSpec);
final GordianHandshakeAgreement myHandshakeServer = (GordianHandshakeAgreement) myAgreementFactory.createAgreement(myAgreeSpec);

/* Client side */
myHandshakeClient.setResultType(myKeySetSpec);
final byte[] myClientHello = myHandshakeClient.createClientHello(myClientPair);

/* Send myClientHello (plus Client Certificate) to server */

/* Server side */
final byte[] myServerHello = myHandshakeServer.acceptClientHello(myClientPair, myServerPair, myClientHello);
if (myHandshakeServer.getStatus() == GordianAgreementStatus.RESULT_AVAILABLE) {
    /* Can access result now without waiting for confirmation */
}

/* Send myServerHello (plus Server Certificate) to server */

/* Client side */
final byte[] myClientConfirm = myHandshakeClient.acceptServerHello(myServerPair, myServerHello);
final GordianKeySet myClientKeySet = (GordianKeySet) myHandshakeClient.getResult();

/* If we are performing a confirm */
if (myClientConfirm != null) {
    /* Send myClientConfirm to server */

    /* Server side */
    myHandshakeServer.processClientConfirm(myClientConfirm);
}

/* Server side */
final GordianKeySetSpec myResultKeySetSpec = (GordianKeySetSpec) myHandshakeServer.getResultType();
final GordianKeySet myServerKeySet = (GordianKeySet) myHandshakeServer.getResult();
                    </code></pre>
                </section>
            
            <section><a id="Signed_Agreement"></a>
<h2>Signed Agreement</h2>
                
<p><strong>GordianSignedAgreement</strong> works similarly to the Handshake agreement without the confirmation message. The difference is that
                    the keys used in the agreement are ephemeral and the only well-known key is the publicKey of the server which is used to authenticate the
                    <strong>ServerHello</strong> message. A pair of random InitVectors are included in the messages as per the handshake agreement to randomise
                    the result.</p>
                
<p>The signature is calculated over the two ephemeral keys and the initVectors</p>
                </section><section><a id="Sample_2"></a>
<h2>Sample</h2>
                    
<pre class="prettyprint"><code>
/* Access factory */
final GordianFactory myBaseFactory = GordianGenerator.createFactory();
final GordianAsyncFactory myAsyncFactory = myBase.getAsyncFactory();
final GordianKeyPairFactory myKeyPairFactory = myAsyncFactory.getKeyPairFactory();
final GordianAgreementFactory myAgreementFactory = myAsyncFactory.getAgreementFactory();

/* Access keyPairGenerator and create server pair */
final GordianKeyPairSpec mySpec = GordianKeyPairSpecBuilder.ed448();
final GordianKeyPairGenerator myGenerator = myKeyPairFactory.getKeyPairGenerator(mySpec);
final GordianKeyPair myServerPair = myGenerator.generateKeyPair();

/* Create signed agreement */
final GordianAgreementSpec myAgreeSpec = GordianAgreementSpecBuilder.signed(mySpec, GordianKDFType.SHA256KDF);
final GordianKeySetSpec myKeySetSpec = new GordianKeySetSpec(GordianLength.LEN_256);
final GordianSignedAgreement myHandshakeClient = (GordianSignedAgreement) myAgreementFactory.createAgreement(myAgreeSpec);
final GordianSignedAgreement myHandshakeServer = (GordianSignedAgreement) myAgreementFactory.createAgreement(myAgreeSpec);

/* Client side */
myHandshakeClient.setResultType(myKeySetSpec);
final byte[] myClientHello = myHandshakeClient.createClientHello(GordianAsymKeySpec.dh(GordianDHGroup.rfc7919_ffdhe2048));

/* Send myClientHello (plus Client Certificate) to server */

/* Server side */
final byte[] myServerHello = myHandshakeServer.acceptClientHello(myServerPair, myClientHello);
final GordianKeySetSpec myResultKeySetSpec = (GordianKeySetSpec) myHandshakeServer.getResultType();
final GordianKeySet myServerKeySet = (GordianKeySet) myHandshakeServer.getResult();

/* Send myServerHello (plus Server Certificate) to server */

/* Client side */
myHandshakeClient.acceptServerHello(myServerPair, myServerHello);
final GordianKeySet myClientKeySet = (GordianKeySet) myHandshakeClient.getResult();
                    </code></pre>
                </section>
            
            <section><a id="Receiving_a_ClientHello"></a>
<h2>Receiving a ClientHello</h2>
                
<p>In all the above examples the server supports a single <strong>GordianAgreementSpec</strong>. In reality it might support a number
                    of different specs. It can obtain the required <strong>GordianAgreementSpec</strong> from the ClientHello and switch strategies accordingly.
                    It can also interrogate the KeyPairType should it support multiple keyPairs.</p>
                </section><section><a id="Sample_3"></a>
<h2>Sample</h2>
                    
<pre class="prettyprint"><code>
/* Access factory */
final GordianFactory myBaseFactory = GordianGenerator.createFactory();
final GordianAsyncFactory myAsyncFactory = myBase.getAsyncFactory();
final GordianKeyPairFactory myKeyPairFactory = myAsyncFactory.getKeyPairFactory();
final GordianAgreementFactory myAgreementFactory = myAsyncFactory.getAgreementFactory();

/* Access clientHello and determine the agreementSpec that it represents */
final byte[] myClientHello = .....
final GordianAgreement myAgreement = myAgreementFactory.createAgreement(myClientHello);
if (myAgreement instanceof GordianAnonymousAgreement) {
    ....
} else if (myAgreement instanceof GordianHandshakeAgreement) {
    ....
} else if (myAgreement instanceof GordianSignedAgreement) {
    ....
}
                    </code></pre>
                </section>
            
            <section><a id="Composite_Agreements"></a>
<h2>Composite Agreements</h2>
                
<p>Composite agreements may be created by a composite keyPair, as long as each element of the composite keyPair is capable of supporting the
                    desired AgreementSpec. There are three small variations.
                    </p>
<ol style="list-style-type: decimal;">
                        
<li>Confirm is not supported for <strong>SM2</strong> agreements</li>
                        
<li>Signed agreements are implemented as a set of <strong>Basic</strong> Agreements with the results signed.</li>
                        
<li>The various individual agreements are used as inputs to the HKDF algorithm to extract a combined agreement secret</li>
                    </ol>
                
                </section><section><a id="Sample_4"></a>
<h2>Sample</h2>
                    
<pre class="prettyprint"><code>
/* Access factory */
final GordianFactory myBaseFactory = GordianGenerator.createFactory();
final GordianAsyncFactory myAsyncFactory = myBase.getAsyncFactory();
final GordianKeyPairFactory myKeyPairFactory = myAsyncFactory.getKeyPairFactory();
final GordianAgreementFactory myAgreementFactory = myAsyncFactory.getAgreementFactory();

/* Access keyPairGenerator */
final GordianKeyPairSpec mySpec = GordianKeyPairSpecBuilder.composite(GordianKeyPairSpec.dh(GordianDGroup.FFDHE2048),
                                                                      GordianKeyPairSpec.ec(GordianDSAElliptic.SECP256R1));
final GordianKeyPairGenerator myGenerator = myKeyPairFactory.getKeyPairGenerator(mySpec);
final GordianKeyPair myKeyPair = myGenerator.generateKeyPair();
GordianKeyPair mySigningPair = myKeyPair;

/* Access agreement */
final GordianAgreementSpec myAgreeSpec = GordianAgreementSpecBuilder.composite(mySpec, GordianKDFType.SHA256KDF);
final GordianAgreement myAgree = myAgreementFactory.createAgreement(myAgreeSpec);

/* Handle as standard */
....
                    </code></pre>
                </section>
            
            <section><a id="Algorithms"></a>
<h2>Algorithms</h2>
                
<p>The following agreement algorithms are supported.</p>
                
<table class="defTable">
                    
<tr class="a">
<th class="defHdr">Algorithm</th>
<th>Type</th>
<th class="defHdr">KeyTypes</th>
<th>Notes</th></tr>
                    
<tr class="b">
<td>KEM</td>
<td>Anonymous</td>
<td>RSA, EC, GOST2012, DSTU4145, SM2, CMCE, Frodo, SABER
                            MLKEM, BIKE, HQC, NTRU, NTRUPRIME, NEWHOPE</td>
<td>RSA, EC, GOST2012, DSTU4145 and SM2 are not available on JCA</td></tr>
                    
<tr class="a">
<td>Anonymous</td>
<td>Anonymous</td>
<td>DH, EC, GOST2012, DSTU4145, SM2, XDH</td>
<td></td></tr>
                    
<tr class="b">
<td>Basic</td>
<td>Handshake</td>
<td>DH, EC, GOST2012, DSTU4145, SM2, XDH</td>
<td></td></tr>
                    
<tr class="a">
<td>Signed</td>
<td>Signed</td>
<td>DH, EC, GOST2012, DSTU4145, SM2, XDH</td>
<td></td></tr>
                    
<tr class="b">
<td>MQV</td>
<td>Handshake</td>
<td>DH, EC, GOST2012, DSTU4145, SM2</td>
<td></td></tr>
                    
<tr class="a">
<td>Unified</td>
<td>Handshake</td>
<td>DH, EC, GOST2012, DSTU4145, SM2, XDH</td>
<td></td></tr>
                    
<tr class="b">
<td>SM2</td>
<td>Handshake</td>
<td>EC, GOST2012, SM2</td>
<td>Not available on JCA</td></tr>
                </table>
            </section>
        </section>
    
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2012–2026
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
