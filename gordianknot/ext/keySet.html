<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 from src/site/xdoc/ext/keySet.xml at 2026-01-08
 | Rendered using Apache Maven Fluido Skin 2.0.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0" />
    <meta name="author" content="Tony Washer" />
    <title>GordianKnot KeySets – GordianKnot Security Framework</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-2.0.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-2.0.1.min.js"></script>
  </head>
  <body class="topBarEnabled">
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">GordianKnot <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../index.html">Introduction</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Parent Project <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../index.html">Java Oceanus package</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../project-info.html">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="../dependencies.html">Dependencies</a></li>
                  <li><a href="../dependency-info.html">Maven Coordinates</a></li>
                  <li><a href="../distribution-management.html">Distribution Management</a></li>
                  <li><a href="../index.html">About</a></li>
                  <li><a href="../issue-management.html">Issue Management</a></li>
                  <li><a href="../licenses.html">Licenses</a></li>
                  <li><a href="../plugin-management.html">Plugin Management</a></li>
                  <li><a href="../plugins.html">Plugins</a></li>
                  <li><a href="../scm.html">Source Code Management</a></li>
                  <li><a href="../summary.html">Summary</a></li>
                  <li><a href="../team.html">Team</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../project-reports.html">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="../checkstyle.html">Checkstyle</a></li>
                  <li><a href="../cpd.html">CPD</a></li>
                  <li><a href="../pmd.html">PMD</a></li>
                  <li><a href="../jacoco/index.html">JaCoCo</a></li>
                  <li><a href="../surefire.html">Surefire</a></li>
              </ul>
            </li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2026-01-08<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.6.3-SNAPSHOT</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">GordianKnot</li>
    <li><a href="../index.html">Introduction</a></li>
   <li class="nav-header">Parent Project</li>
    <li><a href="../../index.html">Java Oceanus package</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">

    
        <section><a id="GordianKnot_KeySets"></a>
<h1>GordianKnot KeySets</h1>
            <section><a id="Overview"></a>
<h2>Overview</h2>
                
<p>KeySets are supported via the <strong>GordianKeySetFactory</strong> interface.</p>
                
<p>GordianKnot supports the notion of a KeySet, which is a set of keys of each available algorithm with a 128-bit blockSize.
                The keySet may be used to encrypt/decrypt and to secure/derive keys or keySets</p>
            </section>
            <section><a id="KeySet_Generation"></a>
<h2>KeySet Generation</h2>
                
<p>A keySet can be generated by specifying a <strong>GordianKeySetSpec</strong>. Each key in the keySet is generated randomly.</p>
                </section><section><a id="Sample"></a>
<h2>Sample</h2>
                    
<pre class="prettyprint"><code>
/* Access factory */
final GordianFactory myBaseFactory = GordianGenerator.createFactory();
final GordianKeySetFactory myKeySetFactory = myBaseFactory.getKeySetFactory();

/* Create keySet */
final GordianKeySetSpec mySpec = new GordianKeySetSpec(GordianLength.LEN_256);
final GordianKeySet myKeySet = myKeySetFactory.generateKeySet(mySpec);
                    </code></pre>
                </section>
            
            <section><a id="KeySet_Derivation"></a>
<h2>KeySet Derivation</h2>
                
<p>The keySet derivation algorithm that generates each of the keys <strong>K<sub>A</sub></strong> for an algorithm <strong>A</strong>
                    from a secret <strong>S</strong> is as follows.</p>
                
<ol style="list-style-type: decimal;">
                    
<li>Obtain a seed <strong>X</strong> from the first 4 bytes of <strong>S</strong> and obtain a seeded random <strong>R</strong> using
                        <strong>X</strong> and <strong>P<sub>1</sub></strong></li>
                    
<li>Obtain a set of two distinct HMACs <strong>H<sub>1</sub></strong> and <strong>H<sub>2</sub></strong> from the seededRandom <strong>R</strong></li>
                    
<li>Use HKDF with the two HMACs to expand the result <strong>S</strong> into <strong>K<sub>A</sub></strong>.
                        Use the following info to personalise and differentiate the keys.
                        
<ol style="list-style-type: decimal;">
                            
<li>Algorithm Name.</li>
                            
<li>Key Length.</li>
                            
<li>8 bytes from seeded random.</li>
                            
<li>Personalisation value <strong>P</strong>.</li>
                            
<li>Personalisation value <strong>I</strong>.</li>
                        </ol>
                    </li>
                </ol>
            </section>
            <section><a id="KeySet_Encryption"></a>
<h2>KeySet Encryption</h2>
                </section><section><a id="Algorithm"></a>
<h2>Algorithm</h2>
                    
<p>Encryption works by selecting a subSet of the available keys and encrypting the message using each key in turn. The number of keys selected and
                        hence the number of encryption steps is specified in the <strong>GordianKeySetSpec</strong> and can vary betweeen 3 and 6</p>
                    
<ol style="list-style-type: decimal;">
                        
<li>A random 32-bit seed <strong>S</strong> and a random 128-bit initVector <strong>V</strong> are generated.</li>
                        
<li>A subSet of <strong>n</strong> keys is selected (all different) using a seededRandom based on <strong>S</strong> and the personalisation value
                            <strong>I<sub>2</sub></strong></li>
                        
<li>Two initiation vectors <strong>V<sub>1</sub></strong> and <strong>V<sub>2</sub></strong> are calculated by xor-ing <strong>V</strong> with
                            <strong>IV<sub>1</sub></strong> and <strong>IV<sub>2</sub></strong> respectively</li>
                        
<li>The first encryption is performed on the message <strong>M</strong> using <strong>K<sub>1</sub></strong> in <strong>SIC</strong> mode
                            using <strong>V<sub>1</sub></strong> as the initialisation vector to create <strong>C<sub>1</sub></strong></li>
                        
<li>The second encryption is performed on <strong>C<sub>1</sub></strong> using <strong>K<sub>2</sub></strong> in
                            <strong>ECB</strong> mode with <strong>PKCS7</strong> padding to create <strong>C<sub>2</sub></strong>.</li>
                        
<li>Further intermediate encryptions are performed on <strong>C<sub>x-1</sub></strong> using <strong>K<sub>x</sub></strong>
                            in <strong>ECB</strong> mode with no padding to produce <strong>C<sub>x</sub></strong>.</li>
                        
<li>The final encryption is performed on <strong>C<sub>n-1</sub></strong> using <strong>K<sub>n</sub></strong> in <strong>SIC</strong> mode
                            using <strong>V<sub>2</sub></strong> as the initialisation vector to create <strong>C<sub>n</sub></strong></li>
                        
<li>The result is the concatenation of <strong>S||V||C<sub>n</sub></strong></li>
                    </ol>
                </section>
                <section><a id="Sample_1"></a>
<h2>Sample</h2>
                    
<pre class="prettyprint"><code>
/* Access factory */
final GordianFactory myBaseFactory = GordianGenerator.createFactory();
final GordianKeySetFactory myKeySetFactory = myBaseFactory.getKeySetFactory();

/* Create keySet */
final GordianKeySetSpec mySpec = new GordianKeySetSpec(GordianLength.LEN_256);
final GordianKeySet myKeySet = myKeySetFactory.generateKeySet(mySpec);

/* Encrypt data as one-off */
final byte[] myMessage = ...
byte[] myEncrypted = myKeySet.encryptBytes(myMessage);
byte[] myResult = myKeySet.decryptBytes(myEncrypted);

/* Encrypt data as cipher */
final GordianKeySetCipher myCipher = myKeySet.createCipher();
myCipher.initForEncrypt();
myEncrypted = myCipher.finish(myMessage, 0, myMessage.length);
myCipher.initForDecrypt();
myResult = myCipher.finish(myEncrypted, 0, myEncrypted.length);
                    </code></pre>
                </section>
            
            <section><a id="KeySet_AAD_Encryption"></a>
<h2>KeySet AAD Encryption</h2>
                </section><section><a id="Algorithm_1"></a>
<h2>Algorithm</h2>
                    
<p>AAD is supported by calculating a Mac and appending it to the encrypted cipherText. On decryption the Mac is recalculated and compared to
                        the trailing bytes of the cipherText. Encryption works as per normal and the only difference is in the calculation of the Mac.
                        The Mac used is a raw <strong>Poly1305</strong> instance, and the algorithm is as follows.</p>
                    
<ol style="list-style-type: decimal;">
                        
<li>A random 512-bit digest <strong>D</strong> is selected from the seededRandom used to select keys for the keySet algorithm.</li>
                        
<li>A random SymKey <strong>K<sub>S</sub></strong> is selected via the seededRandom from the keys in the keySet that have not been
                            used for the encryption.</li>
                        
<li>Two input values <strong>X<sub>1</sub></strong> and <strong>X<sub>2</sub></strong> are calculated by xor-ing <strong>V</strong> with
                            <strong>IV<sub>3</sub></strong> and <strong>IV<sub>4</sub></strong> respectively</li>
                        
<li>The input values are encrypted using <strong>K<sub>S</sub></strong> in <strong>ECB</strong> mode with no padding to produce
                            <strong>K<sub>1</sub></strong> and <strong>K<sub>2</sub></strong></li>
                        
<li>The key for the Poly1305 Mac is the concatenation of <strong>K<sub>1</sub>||K<sub>2</sub></strong>.</li>
                        
<li>The digest <strong>D</strong> is calculated on the plainText</li>
                        
<li>The Mac is calculated on data in a similar fashion to ChaCha20Poly1305 with minor differences as follows
                            
<ul>
                                
<li>The AAD data <strong>A</strong></li>
                                
<li>From 0 to 15 zeroes to bring data up to 16-byte boundary</li>
                                
<li>The cipherText <strong>C</strong></li>
                                
<li>From 0 to 15 zeroes to bring data up to 16-byte boundary</li>
                                
<li>AAD dataLength as 8-byte big-endian long</li>
                                
<li>PlainText dataLength as 8-byte big-endian long</li>
                                
<li>The result of the digest <strong>D</strong></li>
                            </ul>
                        </li>
                        
<li>Finally the Mac result <strong>M</strong> is encrypted using <strong>K<sub>S</sub></strong> in <strong>ECB</strong> mode with no padding
                            to produce <strong>M<sub>K</sub></strong>, and the result in the concatenation of <strong>C||M<sub>K</sub></strong></li>
                    </ol>
                </section>
                <section><a id="Sample_2"></a>
<h2>Sample</h2>
                    
<pre class="prettyprint"><code>
/* Access factory */
final GordianFactory myBaseFactory = GordianGenerator.createFactory();
final GordianKeySetFactory myKeySetFactory = myBaseFactory.getKeySetFactory();

/* Create keySet */
final GordianKeySetSpec mySpec = new GordianKeySetSpec(GordianLength.LEN_256);
final GordianKeySet myKeySet = myKeySetFactory.generateKeySet(mySpec);

/* Encrypt data as one-off */
final byte[] myAADe = ...
final byte[] myMessage = ...
byte[] myEncrypted = myKeySet.encryptAADBytes(myMessage, myAAD);
byte[] myResult = myKeySet.decryptAADBytes(myEncrypted, myAAD);

/* Encrypt data as cipher */
final GordianKeySetAADCipher myCipher = myKeySet.createAADCipher();
myCipher.initForEncrypt(myAAD);
myEncrypted = myCipher.finish(myMessage, 0, myMessage.length);
myCipher.initForDecrypt(myAAD);
myResult = myCipher.finish(myEncrypted, 0, myEncrypted.length);
                    </code></pre>
                </section>
            
            <section><a id="KeySet_Wrapping"></a>
<h2>KeySet Wrapping</h2>
                </section><section><a id="Algorithm_2"></a>
<h2>Algorithm</h2>
                    
<p>Wrapping works by selecting a subSet of the available keys and initially encrypting the message with the first key and then using the remaining
                        keys to wrap the result using the standard wrapping algorithm. In each case where the normal cipher is used to encrypt/decrypt, the remaining set
                        of keys is used to encrypt/decrypt in turn.</p>
                    
<ol style="list-style-type: decimal;">
                        
<li>A random 32-bit seed <strong>S</strong> and a random 128-bit initVector <strong>V</strong> are generated.</li>
                        
<li>A subSet of <strong>n</strong> keys is selected (all different) using a seededRandom based on <strong>S</strong> and the personalisation value
                            <strong>I<sub>2</sub></strong></li>
                        
<li>An initiation vector <strong>V<sub>1</sub></strong> is calculated by xor-ing <strong>V</strong> with <strong>IV<sub>1</sub></strong></li>
                        
<li>The first encryption is performed on the bytes <strong>B</strong> using <strong>K<sub>1</sub></strong> in <strong>SIC</strong>
                            mode using <strong>V<sub>1</sub></strong> as the initialisation vector to create <strong>W<sub>1</sub></strong></li>
                        
<li>The result <strong>W<sub>1</sub></strong> is then wrapped using keys <strong>K<sub>2</sub></strong> to <strong>K<sub>x</sub></strong>
                            to produce <strong>W<sub>2</sub></strong></li>
                        
<li>The result is the concatenation of <strong>S||V||W<sub>2</sub></strong></li>
                    </ol>
                </section>
                <section><a id="Sample_3"></a>
<h2>Sample</h2>
                    
<pre class="prettyprint"><code>
/* Access factory */
final GordianFactory myBaseFactory = GordianGenerator.createFactory();
final GordianKeySetFactory myKeySetFactory = myBaseFactory.getKeySetFactory();

/* Create keySet */
final GordianKeySetSpec mySpec = new GordianKeySetSpec(GordianLength.LEN_256);
final GordianKeySet myKeySet = myKeySetFactory.generateKeySet(mySpec);

/* Secure key */
final GordianKey&lt;GordianSymKeySpec&gt; myKey =  ...
final byte[] mySecured = myKeySet.secureKey(myKey);
final GordianKey&lt;GordianSymKeySpec&gt; myKResult = myKeySet.deriveKey(mySecured, myKeySpec);

/* Secure keySet */
final GordianKeySet myOtherKeySet =  ...
final byte[] mySecured = myKeySet.secureKeySet(myOtherKeySet);
final GordianKeySet myKSResult = myKeySet.deriveKeySet(mySecured);

/* Secure keyPair */
final GordianKeyPair myKeyPair =  ...
final GordianKeyPairGenerator myGenerator = ...;
final byte[] mySecured = myKeySet.securePrivateKey(myKeyPair);
final X509EncodedKeySpec myEncoded = myGenerator.getX509Encoding(myKeyPair);
final GordianKeyPair myKPResult = myKeySet.deriveKeyPair(myEncoded, mySecured);
                    </code></pre>
                </section>
            
        </section>
    
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2012–2026
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
