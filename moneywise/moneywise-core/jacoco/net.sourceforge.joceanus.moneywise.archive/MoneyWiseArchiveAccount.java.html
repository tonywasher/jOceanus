<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MoneyWiseArchiveAccount.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MoneyWise Personal Finance - Core</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.moneywise.archive</a> &gt; <span class="el_source">MoneyWiseArchiveAccount.java</span></div><h1>MoneyWiseArchiveAccount.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * MoneyWise: Finance Application
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.moneywise.archive;

import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseBasicResource;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseCash;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseCategoryBase;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseDeposit;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseLoan;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWisePayee;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWisePortfolio;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseSecurity;
import net.sourceforge.joceanus.moneywise.data.statics.MoneyWiseAccountInfoClass;
import net.sourceforge.joceanus.moneywise.data.statics.MoneyWiseCurrency;
import net.sourceforge.joceanus.moneywise.data.statics.MoneyWisePayeeClass;
import net.sourceforge.joceanus.moneywise.data.statics.MoneyWiseStaticDataType;
import net.sourceforge.joceanus.moneywise.exc.MoneyWiseIOException;
import net.sourceforge.joceanus.moneywise.exc.MoneyWiseLogicException;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseBasicDataType;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseCash.MoneyWiseCashList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseCashInfo.MoneyWiseCashInfoList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseDataSet;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseDeposit.MoneyWiseDepositList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseDepositInfo.MoneyWiseDepositInfoList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseLoan.MoneyWiseLoanList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseLoanInfo.MoneyWiseLoanInfoList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWisePayee.MoneyWisePayeeList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWisePayeeInfo.MoneyWisePayeeInfoList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWisePortfolio.MoneyWisePortfolioList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWisePortfolioInfo.MoneyWisePortfolioInfoList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseSecurity.MoneyWiseSecurityList;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseSecurityInfo.MoneyWiseSecurityInfoList;
import net.sourceforge.joceanus.oceanus.date.OceanusDate;
import net.sourceforge.joceanus.oceanus.profile.OceanusProfile;
import net.sourceforge.joceanus.prometheus.data.PrometheusDataResource;
import net.sourceforge.joceanus.prometheus.data.PrometheusDataValues;
import net.sourceforge.joceanus.prometheus.service.sheet.PrometheusSheetCell;
import net.sourceforge.joceanus.prometheus.service.sheet.PrometheusSheetRow;
import net.sourceforge.joceanus.prometheus.service.sheet.PrometheusSheetView;
import net.sourceforge.joceanus.prometheus.service.sheet.PrometheusSheetWorkBook;
import net.sourceforge.joceanus.oceanus.base.OceanusException;
import net.sourceforge.joceanus.tethys.api.thread.TethysUIThreadStatusReport;
import net.sourceforge.joceanus.tethys.api.thread.TethysUIThreadCancelException;

/**
 * ArchiveLoader extension for Accounts.
 * @author Tony Washer
 */
public final class MoneyWiseArchiveAccount {
    /**
     * Sheet Area name.
     */
    private static final String SHEET_AREA = &quot;AccountInfo&quot;;

    /**
     * Report processor.
     */
    private final TethysUIThreadStatusReport theReport;

    /**
     * Workbook.
     */
    private final PrometheusSheetWorkBook theWorkBook;

    /**
     * DataSet.
     */
    private final MoneyWiseDataSet theData;

    /**
     * Cache.
     */
    private final MoneyWiseArchiveCache theCache;

    /**
     * Constructor.
     * @param pReport the report
     * @param pWorkBook the workbook
     * @param pData the data set to load into
     * @param pCache the cache
     */
    MoneyWiseArchiveAccount(final TethysUIThreadStatusReport pReport,
                            final PrometheusSheetWorkBook pWorkBook,
                            final MoneyWiseDataSet pData,
<span class="nc" id="L99">                            final MoneyWiseArchiveCache pCache) {</span>
<span class="nc" id="L100">        theReport = pReport;</span>
<span class="nc" id="L101">        theWorkBook = pWorkBook;</span>
<span class="nc" id="L102">        theData = pData;</span>
<span class="nc" id="L103">        theCache = pCache;</span>
<span class="nc" id="L104">    }</span>

    /**
     * Load the AccountCategories from an archive.
     * @param pStage the stage
     * @throws OceanusException on error
     */
    void loadArchive(final OceanusProfile pStage) throws OceanusException {
        /* Protect against exceptions */
        try {
            /* Find the range of cells */
<span class="nc" id="L115">            pStage.startTask(&quot;Accounts&quot;);</span>
<span class="nc" id="L116">            final PrometheusSheetView myView = theWorkBook.getRangeView(SHEET_AREA);</span>

            /* Declare the new stage */
<span class="nc" id="L119">            theReport.setNewStage(SHEET_AREA);</span>

            /* Count the number of accounts */
<span class="nc" id="L122">            final int myTotal = myView.getRowCount();</span>

            /* Declare the number of steps (*2) */
<span class="nc" id="L125">            theReport.setNumSteps(myTotal &lt;&lt; 1);</span>

            /* Loop through the rows of the table */
<span class="nc bnc" id="L128" title="All 2 branches missed.">            for (int i = 0; i &lt; myTotal; i++) {</span>
                /* Access the row by reference */
<span class="nc" id="L130">                final PrometheusSheetRow myRow = myView.getRowByIndex(i);</span>

                /* Process payee account */
<span class="nc" id="L133">                processPayee(myView, myRow);</span>

                /* Report the progress */
<span class="nc" id="L136">                theReport.setNextStep();</span>
            }

            /* Resolve Payee lists */
<span class="nc" id="L140">            resolvePayeeLists();</span>

            /* Loop through the rows of the table */
<span class="nc bnc" id="L143" title="All 2 branches missed.">            for (int i = 0; i &lt; myTotal; i++) {</span>
                /* Access the row by reference */
<span class="nc" id="L145">                final PrometheusSheetRow myRow = myView.getRowByIndex(i);</span>

                /* Process account */
<span class="nc" id="L148">                processAccount(myView, myRow);</span>

                /* Report the progress */
<span class="nc" id="L151">                theReport.setNextStep();</span>
            }

            /* Resolve Account lists */
<span class="nc" id="L155">            resolveAccountLists();</span>

            /* Handle exceptions */
<span class="nc" id="L158">        } catch (TethysUIThreadCancelException e) {</span>
<span class="nc" id="L159">            throw e;</span>
<span class="nc" id="L160">        } catch (OceanusException e) {</span>
<span class="nc" id="L161">            throw new MoneyWiseIOException(&quot;Failed to Load &quot; + SHEET_AREA, e);</span>
<span class="nc" id="L162">        }</span>
<span class="nc" id="L163">    }</span>

    /**
     * Process account row.
     * @param pView the spreadsheet view
     * @param pRow the spreadsheet row
     * @throws OceanusException on error
     */
    private void processPayee(final PrometheusSheetView pView,
                              final PrometheusSheetRow pRow) throws OceanusException {
        /* Skip name and type column */
<span class="nc" id="L174">        int iAdjust = -1;</span>
<span class="nc" id="L175">        ++iAdjust;</span>
<span class="nc" id="L176">        ++iAdjust;</span>

        /* Access account class */
<span class="nc" id="L179">        final String myClass = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* If this is a Payee */
<span class="nc bnc" id="L182" title="All 2 branches missed.">        if (myClass.equals(MoneyWiseBasicDataType.PAYEE.toString())) {</span>
            /* Process as a payee */
<span class="nc" id="L184">            processStdPayee(pView, pRow);</span>

            /* If this is a cash */
<span class="nc bnc" id="L187" title="All 2 branches missed.">        } else if (myClass.equals(MoneyWiseBasicDataType.CASH.toString())) {</span>
            /* Process as a cash payee */
<span class="nc" id="L189">            processCashPayee(pView, pRow);</span>
        }
<span class="nc" id="L191">    }</span>

    /**
     * Process account row.
     * @param pView the spreadsheet view
     * @param pRow the spreadsheet row
     * @throws OceanusException on error
     */
    private void processAccount(final PrometheusSheetView pView,
                                final PrometheusSheetRow pRow) throws OceanusException {
        /* Skip name and type column */
<span class="nc" id="L202">        int iAdjust = -1;</span>
<span class="nc" id="L203">        ++iAdjust;</span>
<span class="nc" id="L204">        ++iAdjust;</span>

        /* Access account class */
<span class="nc" id="L207">        final String myClass = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* If this is a deposit */
<span class="nc bnc" id="L210" title="All 2 branches missed.">        if (myClass.equals(MoneyWiseBasicDataType.DEPOSIT.toString())) {</span>
            /* Process as a deposit */
<span class="nc" id="L212">            processDeposit(pView, pRow);</span>

            /* If this is a cash */
<span class="nc bnc" id="L215" title="All 2 branches missed.">        } else if (myClass.equals(MoneyWiseBasicDataType.CASH.toString())) {</span>
            /* Process as a cash */
<span class="nc" id="L217">            processCash(pView, pRow);</span>

            /* If this is a loan */
<span class="nc bnc" id="L220" title="All 2 branches missed.">        } else if (myClass.equals(MoneyWiseBasicDataType.LOAN.toString())) {</span>
            /* Process as a loan */
<span class="nc" id="L222">            processLoan(pView, pRow);</span>

            /* If this is a security */
<span class="nc bnc" id="L225" title="All 2 branches missed.">        } else if (myClass.equals(MoneyWiseBasicDataType.SECURITY.toString())) {</span>
            /* Process as a security */
<span class="nc" id="L227">            processSecurity(pView, pRow);</span>

            /* If this is a portfolio */
<span class="nc bnc" id="L230" title="All 2 branches missed.">        } else if (myClass.equals(MoneyWiseBasicDataType.PORTFOLIO.toString())) {</span>
            /* Process as a portfolio */
<span class="nc" id="L232">            processPortfolio(pView, pRow);</span>

            /* else reject if not payee */
<span class="nc bnc" id="L235" title="All 2 branches missed.">        } else if (!myClass.equals(MoneyWiseBasicDataType.PAYEE.toString())) {</span>
<span class="nc" id="L236">            throw new MoneyWiseLogicException(&quot;Unexpected Account Class &quot; + myClass);</span>
        }
<span class="nc" id="L238">    }</span>

    /**
     * Resolve payee account lists.
     * @throws OceanusException on error
     */
    private void resolvePayeeLists() throws OceanusException {
        /* PostProcess the Payees */
<span class="nc" id="L246">        final MoneyWisePayeeList myPayeeList = theData.getPayees();</span>
<span class="nc" id="L247">        final MoneyWisePayeeInfoList myPayeeInfoList = theData.getPayeeInfo();</span>
<span class="nc" id="L248">        myPayeeList.postProcessOnLoad();</span>
<span class="nc" id="L249">        myPayeeInfoList.postProcessOnLoad();</span>
<span class="nc" id="L250">    }</span>

    /**
     * Resolve non-payee account lists.
     * @throws OceanusException on error
     */
    private void resolveAccountLists() throws OceanusException {
        /* PostProcess the securities */
<span class="nc" id="L258">        final MoneyWiseSecurityList mySecurityList = theData.getSecurities();</span>
<span class="nc" id="L259">        final MoneyWiseSecurityInfoList mySecInfoList = theData.getSecurityInfo();</span>
<span class="nc" id="L260">        mySecurityList.postProcessOnLoad();</span>
<span class="nc" id="L261">        mySecInfoList.postProcessOnLoad();</span>

        /* PostProcess the deposits */
<span class="nc" id="L264">        final MoneyWiseDepositList myDepositList = theData.getDeposits();</span>
<span class="nc" id="L265">        final MoneyWiseDepositInfoList myDepInfoList = theData.getDepositInfo();</span>
<span class="nc" id="L266">        myDepositList.postProcessOnLoad();</span>
<span class="nc" id="L267">        myDepInfoList.postProcessOnLoad();</span>

        /* PostProcess the cash */
<span class="nc" id="L270">        final MoneyWiseCashList myCashList = theData.getCash();</span>
<span class="nc" id="L271">        final MoneyWiseCashInfoList myCashInfoList = theData.getCashInfo();</span>
<span class="nc" id="L272">        myCashList.postProcessOnLoad();</span>
<span class="nc" id="L273">        myCashInfoList.postProcessOnLoad();</span>

        /* PostProcess the loans */
<span class="nc" id="L276">        final MoneyWiseLoanList myLoanList = theData.getLoans();</span>
<span class="nc" id="L277">        final MoneyWiseLoanInfoList myLoanInfoList = theData.getLoanInfo();</span>
<span class="nc" id="L278">        myLoanList.postProcessOnLoad();</span>
<span class="nc" id="L279">        myLoanInfoList.postProcessOnLoad();</span>

        /* PostProcess the portfolios */
<span class="nc" id="L282">        final MoneyWisePortfolioList myPortfolioList = theData.getPortfolios();</span>
<span class="nc" id="L283">        final MoneyWisePortfolioInfoList myPortInfoList = theData.getPortfolioInfo();</span>
<span class="nc" id="L284">        myPortfolioList.postProcessOnLoad();</span>
<span class="nc" id="L285">        myPortInfoList.postProcessOnLoad();</span>

        /* Resolve Security Holdings */
<span class="nc" id="L288">        theCache.resolveSecurityHoldings(theData);</span>
<span class="nc" id="L289">    }</span>

    /**
     * Process payee row from archive.
     * @param pView the spreadsheet view
     * @param pRow the spreadsheet row
     * @throws OceanusException on error
     */
    private void processStdPayee(final PrometheusSheetView pView,
                                 final PrometheusSheetRow pRow) throws OceanusException {
        /* Access name and type */
<span class="nc" id="L300">        int iAdjust = -1;</span>
<span class="nc" id="L301">        final String myName = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>
<span class="nc" id="L302">        final String myType = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Skip class */
<span class="nc" id="L305">        ++iAdjust;</span>

        /* Handle closed which may be missing */
<span class="nc" id="L308">        final PrometheusSheetCell myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L309">        Boolean isClosed = Boolean.FALSE;</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L311">            isClosed = myCell.getBoolean();</span>
        }

        /* Build data values */
<span class="nc" id="L315">        final PrometheusDataValues myValues = new PrometheusDataValues(MoneyWisePayee.OBJECT_NAME);</span>
<span class="nc" id="L316">        myValues.addValue(PrometheusDataResource.DATAITEM_FIELD_NAME, myName);</span>
<span class="nc" id="L317">        myValues.addValue(MoneyWiseBasicResource.CATEGORY_NAME, myType);</span>
<span class="nc" id="L318">        myValues.addValue(MoneyWiseBasicResource.ASSET_CLOSED, isClosed);</span>

        /* Add the value into the list */
<span class="nc" id="L321">        final MoneyWisePayeeList myList = theData.getPayees();</span>
<span class="nc" id="L322">        final MoneyWisePayee myPayee = myList.addValuesItem(myValues);</span>

        /* Declare the payee */
<span class="nc" id="L325">        theCache.declareAsset(myPayee);</span>
<span class="nc" id="L326">    }</span>

    /**
     * Process cashPayee row from archive.
     * @param pView the spreadsheet view
     * @param pRow the spreadsheet row
     * @throws OceanusException on error
     */
    private void processCashPayee(final PrometheusSheetView pView,
                                  final PrometheusSheetRow pRow) throws OceanusException {
        /* Access name */
<span class="nc" id="L337">        int iAdjust = -1;</span>
<span class="nc" id="L338">        final String myName = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Skip type, class */
<span class="nc" id="L341">        ++iAdjust;</span>
<span class="nc" id="L342">        ++iAdjust;</span>

        /* Handle closed which may be missing */
<span class="nc" id="L345">        PrometheusSheetCell myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L346">        Boolean isClosed = Boolean.FALSE;</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L348">            isClosed = myCell.getBoolean();</span>
        }

        /*
         * Skip parent, alias, portfolio, maturity, openingBalance, symbol, region and currency
         * columns
         */
<span class="nc" id="L355">        ++iAdjust;</span>
<span class="nc" id="L356">        ++iAdjust;</span>
<span class="nc" id="L357">        ++iAdjust;</span>
<span class="nc" id="L358">        ++iAdjust;</span>
<span class="nc" id="L359">        ++iAdjust;</span>
<span class="nc" id="L360">        ++iAdjust;</span>
<span class="nc" id="L361">        ++iAdjust;</span>
<span class="nc" id="L362">        ++iAdjust;</span>

        /* Handle autoExpense which may be missing */
<span class="nc" id="L365">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L367">            final String myAutoPayee = myName + &quot;Expense&quot;;</span>

            /* Build values */
<span class="nc" id="L370">            final PrometheusDataValues myValues = new PrometheusDataValues(MoneyWisePayee.OBJECT_NAME);</span>
<span class="nc" id="L371">            myValues.addValue(PrometheusDataResource.DATAITEM_FIELD_NAME, myAutoPayee);</span>
<span class="nc" id="L372">            myValues.addValue(MoneyWiseBasicResource.CATEGORY_NAME, MoneyWisePayeeClass.PAYEE.toString());</span>
<span class="nc" id="L373">            myValues.addValue(MoneyWiseBasicResource.ASSET_CLOSED, isClosed);</span>

            /* Add the value into the list */
<span class="nc" id="L376">            final MoneyWisePayeeList myPayeeList = theData.getPayees();</span>
<span class="nc" id="L377">            myPayeeList.addValuesItem(myValues);</span>
        }
<span class="nc" id="L379">    }</span>

    /**
     * Process cash row from archive.
     * @param pView the spreadsheet view
     * @param pRow the spreadsheet row
     * @throws OceanusException on error
     */
    private void processCash(final PrometheusSheetView pView,
                             final PrometheusSheetRow pRow) throws OceanusException {
        /* Access name and type */
<span class="nc" id="L390">        int iAdjust = -1;</span>
<span class="nc" id="L391">        final String myName = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>
<span class="nc" id="L392">        final String myType = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Skip class */
<span class="nc" id="L395">        ++iAdjust;</span>

        /* Handle closed which may be missing */
<span class="nc" id="L398">        PrometheusSheetCell myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L399">        Boolean isClosed = Boolean.FALSE;</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L401">            isClosed = myCell.getBoolean();</span>
        }

        /* Skip parent, alias, portfolio, and maturity columns */
<span class="nc" id="L405">        ++iAdjust;</span>
<span class="nc" id="L406">        ++iAdjust;</span>
<span class="nc" id="L407">        ++iAdjust;</span>
<span class="nc" id="L408">        ++iAdjust;</span>

        /* Handle opening balance which may be missing */
<span class="nc" id="L411">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L412">        String myBalance = null;</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L414">            myBalance = myCell.getString();</span>
        }

        /* Skip symbol and region columns */
<span class="nc" id="L418">        ++iAdjust;</span>
<span class="nc" id="L419">        ++iAdjust;</span>

        /* Handle currency which may be missing */
<span class="nc" id="L422">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L423">        MoneyWiseCurrency myCurrency = theData.getReportingCurrency();</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L425">            final String myCurrName = myCell.getString();</span>
<span class="nc" id="L426">            myCurrency = theData.getAccountCurrencies().findItemByName(myCurrName);</span>
        }

        /* Handle autoExpense which may be missing */
<span class="nc" id="L430">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L431">        String myAutoExpense = null;</span>
<span class="nc" id="L432">        String myAutoPayee = null;</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L434">            myAutoExpense = myCell.getString();</span>
<span class="nc" id="L435">            myAutoPayee = myName + &quot;Expense&quot;;</span>
        }

        /* Build data values */
<span class="nc" id="L439">        final PrometheusDataValues myValues = new PrometheusDataValues(MoneyWiseCash.OBJECT_NAME);</span>
<span class="nc" id="L440">        myValues.addValue(PrometheusDataResource.DATAITEM_FIELD_NAME, myName);</span>
<span class="nc" id="L441">        myValues.addValue(MoneyWiseBasicResource.CATEGORY_NAME, myType);</span>
<span class="nc" id="L442">        myValues.addValue(MoneyWiseStaticDataType.CURRENCY, myCurrency);</span>
<span class="nc" id="L443">        myValues.addValue(MoneyWiseBasicResource.ASSET_CLOSED, isClosed);</span>

        /* Add the value into the list */
<span class="nc" id="L446">        final MoneyWiseCashList myList = theData.getCash();</span>
<span class="nc" id="L447">        final MoneyWiseCash myCash = myList.addValuesItem(myValues);</span>

        /* Add information relating to the cash */
<span class="nc" id="L450">        final MoneyWiseCashInfoList myInfoList = theData.getCashInfo();</span>
<span class="nc" id="L451">        myInfoList.addInfoItem(null, myCash, MoneyWiseAccountInfoClass.AUTOEXPENSE, myAutoExpense);</span>
<span class="nc" id="L452">        myInfoList.addInfoItem(null, myCash, MoneyWiseAccountInfoClass.AUTOPAYEE, myAutoPayee);</span>
<span class="nc" id="L453">        myInfoList.addInfoItem(null, myCash, MoneyWiseAccountInfoClass.OPENINGBALANCE, myBalance);</span>

        /* Declare the cash */
<span class="nc" id="L456">        theCache.declareAsset(myCash);</span>
<span class="nc" id="L457">    }</span>

    /**
     * Process deposit row from archive.
     * @param pView the spreadsheet view
     * @param pRow the spreadsheet row
     * @throws OceanusException on error
     */
    private void processDeposit(final PrometheusSheetView pView,
                                final PrometheusSheetRow pRow) throws OceanusException {
        /* Access name and type */
<span class="nc" id="L468">        int iAdjust = -1;</span>
<span class="nc" id="L469">        final String myName = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>
<span class="nc" id="L470">        final String myType = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Skip class */
<span class="nc" id="L473">        ++iAdjust;</span>

        /* Handle closed which may be missing */
<span class="nc" id="L476">        PrometheusSheetCell myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L477">        Boolean isClosed = Boolean.FALSE;</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L479">            isClosed = myCell.getBoolean();</span>
        }

        /* Access Parent account */
<span class="nc" id="L483">        final String myParent = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Skip alias and portfolio columns */
<span class="nc" id="L486">        ++iAdjust;</span>
<span class="nc" id="L487">        ++iAdjust;</span>

        /* Handle maturity which may be missing */
<span class="nc" id="L490">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L491">        OceanusDate myMaturity = null;</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L493">            myMaturity = myCell.getDate();</span>
        }

        /* Handle opening balance which may be missing */
<span class="nc" id="L497">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L498">        String myBalance = null;</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L500">            myBalance = myCell.getString();</span>
        }

        /* Skip symbol and region columns */
<span class="nc" id="L504">        ++iAdjust;</span>
<span class="nc" id="L505">        ++iAdjust;</span>

        /* Handle currency which may be missing */
<span class="nc" id="L508">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L509">        MoneyWiseCurrency myCurrency = theData.getReportingCurrency();</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L511">            final String myCurrName = myCell.getString();</span>
<span class="nc" id="L512">            myCurrency = theData.getAccountCurrencies().findItemByName(myCurrName);</span>
        }

        /* Build data values */
<span class="nc" id="L516">        final PrometheusDataValues myValues = new PrometheusDataValues(MoneyWiseDeposit.OBJECT_NAME);</span>
<span class="nc" id="L517">        myValues.addValue(PrometheusDataResource.DATAITEM_FIELD_NAME, myName);</span>
<span class="nc" id="L518">        myValues.addValue(MoneyWiseBasicResource.CATEGORY_NAME, myType);</span>
<span class="nc" id="L519">        myValues.addValue(MoneyWiseStaticDataType.CURRENCY, myCurrency);</span>
<span class="nc" id="L520">        myValues.addValue(MoneyWiseBasicResource.ASSET_PARENT, myParent);</span>
<span class="nc" id="L521">        myValues.addValue(MoneyWiseBasicResource.ASSET_CLOSED, isClosed);</span>

        /* Add the value into the list */
<span class="nc" id="L524">        final MoneyWiseDepositList myList = theData.getDeposits();</span>
<span class="nc" id="L525">        final MoneyWiseDeposit myDeposit = myList.addValuesItem(myValues);</span>

        /* Add information relating to the deposit */
<span class="nc" id="L528">        final MoneyWiseDepositInfoList myInfoList = theData.getDepositInfo();</span>
<span class="nc" id="L529">        myInfoList.addInfoItem(null, myDeposit, MoneyWiseAccountInfoClass.MATURITY, myMaturity);</span>
<span class="nc" id="L530">        myInfoList.addInfoItem(null, myDeposit, MoneyWiseAccountInfoClass.OPENINGBALANCE, myBalance);</span>

        /* Declare the deposit */
<span class="nc" id="L533">        theCache.declareAsset(myDeposit);</span>
<span class="nc" id="L534">    }</span>

    /**
     * Process loan row from archive.
      * @param pView the spreadsheet view
     * @param pRow the spreadsheet row
     * @throws OceanusException on error
     */
    private void processLoan(final PrometheusSheetView pView,
                             final PrometheusSheetRow pRow) throws OceanusException {
        /* Access name and type */
<span class="nc" id="L545">        int iAdjust = -1;</span>
<span class="nc" id="L546">        final String myName = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>
<span class="nc" id="L547">        final String myType = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Skip class */
<span class="nc" id="L550">        ++iAdjust;</span>

        /* Handle closed which may be missing */
<span class="nc" id="L553">        PrometheusSheetCell myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L554">        Boolean isClosed = Boolean.FALSE;</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L556">            isClosed = myCell.getBoolean();</span>
        }

        /* Access Parent account */
<span class="nc" id="L560">        final String myParent = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Skip alias, portfolio, maturity, openingBalance, symbol and region columns */
<span class="nc" id="L563">        ++iAdjust;</span>
<span class="nc" id="L564">        ++iAdjust;</span>
<span class="nc" id="L565">        ++iAdjust;</span>
<span class="nc" id="L566">        ++iAdjust;</span>
<span class="nc" id="L567">        ++iAdjust;</span>
<span class="nc" id="L568">        ++iAdjust;</span>

        /* Handle currency which may be missing */
<span class="nc" id="L571">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L572">        MoneyWiseCurrency myCurrency = theData.getReportingCurrency();</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L574">            final String myCurrName = myCell.getString();</span>
<span class="nc" id="L575">            myCurrency = theData.getAccountCurrencies().findItemByName(myCurrName);</span>
        }

        /* Build data values */
<span class="nc" id="L579">        final PrometheusDataValues myValues = new PrometheusDataValues(MoneyWiseLoan.OBJECT_NAME);</span>
<span class="nc" id="L580">        myValues.addValue(PrometheusDataResource.DATAITEM_FIELD_NAME, myName);</span>
<span class="nc" id="L581">        myValues.addValue(MoneyWiseBasicResource.CATEGORY_NAME, myType);</span>
<span class="nc" id="L582">        myValues.addValue(MoneyWiseStaticDataType.CURRENCY, myCurrency);</span>
<span class="nc" id="L583">        myValues.addValue(MoneyWiseBasicResource.ASSET_PARENT, myParent);</span>
<span class="nc" id="L584">        myValues.addValue(MoneyWiseBasicResource.ASSET_CLOSED, isClosed);</span>

        /* Add the value into the list */
<span class="nc" id="L587">        final MoneyWiseLoanList myList = theData.getLoans();</span>
<span class="nc" id="L588">        final MoneyWiseLoan myLoan = myList.addValuesItem(myValues);</span>

        /* Declare the loan */
<span class="nc" id="L591">        theCache.declareAsset(myLoan);</span>
<span class="nc" id="L592">    }</span>

    /**
     * Process portfolio row from archive.
     * @param pView the spreadsheet view
     * @param pRow the spreadsheet row
     * @throws OceanusException on error
     */
    private void processPortfolio(final PrometheusSheetView pView,
                                  final PrometheusSheetRow pRow) throws OceanusException {
        /* Access name */
<span class="nc" id="L603">        int iAdjust = -1;</span>
<span class="nc" id="L604">        final String myName = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Access portfolio type */
<span class="nc" id="L607">        final String myType = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Look for separator in category */
<span class="nc" id="L610">        final int iIndex = myType.indexOf(MoneyWiseCategoryBase.STR_SEP);</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">        if (iIndex == -1) {</span>
<span class="nc" id="L612">            throw new MoneyWiseLogicException(&quot;Unexpected Portfolio Class &quot; + myType);</span>
        }

        /* Access subCategory as portfolio type */
<span class="nc" id="L616">        final String myPortType = myType.substring(iIndex + 1);</span>

        /* Skip class */
<span class="nc" id="L619">        ++iAdjust;</span>

        /* Handle closed which may be missing */
<span class="nc" id="L622">        PrometheusSheetCell myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L623">        Boolean isClosed = Boolean.FALSE;</span>
<span class="nc bnc" id="L624" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L625">            isClosed = myCell.getBoolean();</span>
        }

        /* Access Parent account */
<span class="nc" id="L629">        final String myParent = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Skip alias, portfolio, maturity, openingBalance, symbol and region columns */
<span class="nc" id="L632">        ++iAdjust;</span>
<span class="nc" id="L633">        ++iAdjust;</span>
<span class="nc" id="L634">        ++iAdjust;</span>
<span class="nc" id="L635">        ++iAdjust;</span>
<span class="nc" id="L636">        ++iAdjust;</span>
<span class="nc" id="L637">        ++iAdjust;</span>

        /* Handle currency which may be missing */
<span class="nc" id="L640">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L641">        MoneyWiseCurrency myCurrency = theData.getReportingCurrency();</span>
<span class="nc bnc" id="L642" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L643">            final String myCurrName = myCell.getString();</span>
<span class="nc" id="L644">            myCurrency = theData.getAccountCurrencies().findItemByName(myCurrName);</span>
        }

        /* Build data values */
<span class="nc" id="L648">        final PrometheusDataValues myValues = new PrometheusDataValues(MoneyWisePortfolio.OBJECT_NAME);</span>
<span class="nc" id="L649">        myValues.addValue(PrometheusDataResource.DATAITEM_FIELD_NAME, myName);</span>
<span class="nc" id="L650">        myValues.addValue(MoneyWiseBasicResource.CATEGORY_NAME, myPortType);</span>
<span class="nc" id="L651">        myValues.addValue(MoneyWiseBasicResource.ASSET_PARENT, myParent);</span>
<span class="nc" id="L652">        myValues.addValue(MoneyWiseStaticDataType.CURRENCY, myCurrency);</span>
<span class="nc" id="L653">        myValues.addValue(MoneyWiseBasicResource.ASSET_CLOSED, isClosed);</span>

        /* Add the value into the list */
<span class="nc" id="L656">        final MoneyWisePortfolioList myList = theData.getPortfolios();</span>
<span class="nc" id="L657">        final MoneyWisePortfolio myPortfolio = myList.addValuesItem(myValues);</span>

        /* Declare the portfolio */
<span class="nc" id="L660">        theCache.declareAsset(myPortfolio);</span>
<span class="nc" id="L661">    }</span>

    /**
     * Process security row from archive.
     * @param pView the spreadsheet view
     * @param pRow the spreadsheet row
     * @throws OceanusException on error
     */
    private void processSecurity(final PrometheusSheetView pView,
                                 final PrometheusSheetRow pRow) throws OceanusException {
        /* Access name and type */
<span class="nc" id="L672">        int iAdjust = -1;</span>
<span class="nc" id="L673">        final String myName = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>
<span class="nc" id="L674">        final String myType = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Look for separator in category */
<span class="nc" id="L677">        final int iIndex = myType.indexOf(MoneyWiseCategoryBase.STR_SEP);</span>
<span class="nc bnc" id="L678" title="All 2 branches missed.">        if (iIndex == -1) {</span>
<span class="nc" id="L679">            throw new MoneyWiseLogicException(&quot;Unexpected Security Class &quot; + myType);</span>
        }

        /* Access subCategory as security type */
<span class="nc" id="L683">        final String mySecType = myType.substring(iIndex + 1);</span>

        /* Skip class */
<span class="nc" id="L686">        ++iAdjust;</span>

        /* Handle closed which may be missing */
<span class="nc" id="L689">        PrometheusSheetCell myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L690">        Boolean isClosed = Boolean.FALSE;</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L692">            isClosed = myCell.getBoolean();</span>
        }

        /* Access the list */
<span class="nc" id="L696">        final MoneyWiseSecurityList myList = theData.getSecurities();</span>

        /* Access Parent account */
<span class="nc" id="L699">        final String myParent = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* Access the alias account */
<span class="nc" id="L702">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L703">        String myAlias = null;</span>
<span class="nc bnc" id="L704" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L705">            myAlias = myCell.getString();</span>
        }

        /* Access Portfolio */
<span class="nc" id="L709">        final String myPortfolio = pView.getRowCellByIndex(pRow, ++iAdjust).getString();</span>

        /* If we have an alias */
<span class="nc bnc" id="L712" title="All 2 branches missed.">        if (myAlias != null) {</span>
            /* Declare the security alias */
<span class="nc" id="L714">            theCache.declareAliasHolding(myName, myAlias, myPortfolio);</span>

            /* return */
<span class="nc" id="L717">            return;</span>
        }

        /* Skip maturity and opening columns */
<span class="nc" id="L721">        ++iAdjust;</span>
<span class="nc" id="L722">        ++iAdjust;</span>

        /* Access Symbol which may be missing */
<span class="nc" id="L725">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L726">        String mySymbol = null;</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L728">            mySymbol = myCell.getString();</span>
        }

        /* Handle region which may be missing */
<span class="nc" id="L732">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L733">        String myRegion = null;</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L735">            myRegion = myCell.getString();</span>
        }

        /* Handle currency which may be missing */
<span class="nc" id="L739">        myCell = pView.getRowCellByIndex(pRow, ++iAdjust);</span>
<span class="nc" id="L740">        MoneyWiseCurrency myCurrency = theData.getReportingCurrency();</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">        if (myCell != null) {</span>
<span class="nc" id="L742">            final String myCurrName = myCell.getString();</span>
<span class="nc" id="L743">            myCurrency = theData.getAccountCurrencies().findItemByName(myCurrName);</span>
        }

        /* Build data values */
<span class="nc" id="L747">        final PrometheusDataValues myValues = new PrometheusDataValues(MoneyWiseSecurity.OBJECT_NAME);</span>
<span class="nc" id="L748">        myValues.addValue(PrometheusDataResource.DATAITEM_FIELD_NAME, myName);</span>
<span class="nc" id="L749">        myValues.addValue(MoneyWiseBasicResource.CATEGORY_NAME, mySecType);</span>
<span class="nc" id="L750">        myValues.addValue(MoneyWiseStaticDataType.CURRENCY, myCurrency);</span>
<span class="nc" id="L751">        myValues.addValue(MoneyWiseBasicResource.ASSET_PARENT, myParent);</span>
<span class="nc" id="L752">        myValues.addValue(MoneyWiseBasicResource.ASSET_CLOSED, isClosed);</span>

        /* Add the value into the list */
<span class="nc" id="L755">        final MoneyWiseSecurity mySecurity = myList.addValuesItem(myValues);</span>

        /* Add information relating to the security */
<span class="nc" id="L758">        final MoneyWiseSecurityInfoList myInfoList = theData.getSecurityInfo();</span>
<span class="nc" id="L759">        myInfoList.addInfoItem(null, mySecurity, MoneyWiseAccountInfoClass.SYMBOL, mySymbol);</span>
<span class="nc" id="L760">        myInfoList.addInfoItem(null, mySecurity, MoneyWiseAccountInfoClass.REGION, myRegion);</span>

        /* Declare the security holding */
<span class="nc" id="L763">        theCache.declareSecurityHolding(mySecurity, myPortfolio);</span>
<span class="nc" id="L764">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>