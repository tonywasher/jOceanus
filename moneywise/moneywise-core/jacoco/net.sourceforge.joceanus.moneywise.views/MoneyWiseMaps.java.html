<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MoneyWiseMaps.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MoneyWise Personal Finance - Core</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.moneywise.views</a> &gt; <span class="el_source">MoneyWiseMaps.java</span></div><h1>MoneyWiseMaps.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * MoneyWise: Finance Application
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.moneywise.views;

import net.sourceforge.joceanus.metis.list.MetisListKey;
import net.sourceforge.joceanus.metis.viewer.MetisViewerEntry;
import net.sourceforge.joceanus.metis.viewer.MetisViewerManager;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseBasicDataType;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseBasicResource;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWisePayee;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWisePortfolio;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseSecurity;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseSecurityHolding;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseTransCategory;
import net.sourceforge.joceanus.moneywise.data.statics.MoneyWiseAccountInfoClass;
import net.sourceforge.joceanus.moneywise.data.statics.MoneyWiseStaticDataType;
import net.sourceforge.joceanus.prometheus.data.PrometheusDataItem;
import net.sourceforge.joceanus.prometheus.data.PrometheusDataResource;
import net.sourceforge.joceanus.prometheus.data.PrometheusDataSet;
import net.sourceforge.joceanus.prometheus.maps.PrometheusMapsCtl;
import net.sourceforge.joceanus.prometheus.views.PrometheusEditSet;
import net.sourceforge.joceanus.prometheus.views.PrometheusViewerEntryId;

import java.util.ArrayList;
import java.util.List;

/**
 * MoneyWise Maps.
 */
public class MoneyWiseMaps {
    /**
     * The Map control.
     */
    private final PrometheusMapsCtl theMaps;

    /**
     * Constructor.
     * @param pView the view
     */
<span class="fc" id="L54">    MoneyWiseMaps(final MoneyWiseView pView) {</span>
        /* Create the control */
<span class="fc" id="L56">        theMaps = new PrometheusMapsCtl(MoneyWiseMaps::deconstructPair);</span>

        /* Build the maps */
<span class="fc" id="L59">        buildMaps();</span>

        /* Create the top level viewer entry for this view */
<span class="fc" id="L62">        final MetisViewerManager myViewer = pView.getViewerManager();</span>
<span class="fc" id="L63">        final MetisViewerEntry mySection = pView.getViewerEntry(PrometheusViewerEntryId.ANALYSIS);</span>
<span class="fc" id="L64">        final MetisViewerEntry myEntry = myViewer.newEntry(mySection, &quot;NewMaps&quot;);</span>
<span class="fc" id="L65">        myEntry.setObject(theMaps);</span>
<span class="fc" id="L66">    }</span>

    /**
     * Adjust for DataSet.
     * @param pDataSet the dataSet
     */
    public void adjustForDataSet(final PrometheusDataSet pDataSet) {
<span class="nc" id="L73">        theMaps.resetMaps();</span>
<span class="nc" id="L74">        theMaps.adjustForDataSet(pDataSet);</span>
<span class="nc" id="L75">    }</span>

    /**
     * Adjust for EditSet.
     * @param pEditSet the editSet
     */
    public void adjustForEditSet(final PrometheusEditSet pEditSet) {
<span class="nc" id="L82">        theMaps.resetMaps();</span>
<span class="nc" id="L83">        theMaps.adjustForEditSet(pEditSet);</span>
<span class="nc" id="L84">    }</span>

    /**
     * Build the maps.
     */
    private void buildMaps() {
        /* Build static maps */
<span class="fc" id="L91">        buildStaticMaps(MoneyWiseStaticDataType.DEPOSITTYPE);</span>
<span class="fc" id="L92">        buildStaticMaps(MoneyWiseStaticDataType.CASHTYPE);</span>
<span class="fc" id="L93">        buildStaticMaps(MoneyWiseStaticDataType.LOANTYPE);</span>
<span class="fc" id="L94">        buildStaticMaps(MoneyWiseStaticDataType.PAYEETYPE);</span>
<span class="fc" id="L95">        buildStaticMaps(MoneyWiseStaticDataType.SECURITYTYPE);</span>
<span class="fc" id="L96">        buildStaticMaps(MoneyWiseStaticDataType.PORTFOLIOTYPE);</span>
<span class="fc" id="L97">        buildStaticMaps(MoneyWiseStaticDataType.TRANSTYPE);</span>
<span class="fc" id="L98">        buildStaticMaps(MoneyWiseStaticDataType.CURRENCY);</span>
<span class="fc" id="L99">        buildStaticMaps(MoneyWiseStaticDataType.TAXBASIS);</span>
<span class="fc" id="L100">        buildStaticMaps(MoneyWiseStaticDataType.ACCOUNTINFOTYPE);</span>
<span class="fc" id="L101">        buildStaticMaps(MoneyWiseStaticDataType.TRANSINFOTYPE);</span>

        /* Build transTag and region maps */
<span class="fc" id="L104">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.TRANSTAG, PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
<span class="fc" id="L105">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.REGION, PrometheusDataResource.DATAITEM_FIELD_NAME);</span>

        /* Build category maps */
<span class="fc" id="L108">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.DEPOSITCATEGORY, PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
<span class="fc" id="L109">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.CASHCATEGORY, PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
<span class="fc" id="L110">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.LOANCATEGORY, PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
<span class="fc" id="L111">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.TRANSCATEGORY, PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
<span class="fc" id="L112">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.TRANSCATEGORY, MoneyWiseStaticDataType.TRANSTYPE,</span>
<span class="nc" id="L113">                t -&gt; ((MoneyWiseTransCategory) t).getCategoryType().getCategoryClass().isSingular());</span>

        /* Build asset maps */
<span class="fc" id="L116">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.PAYEE, PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
<span class="fc" id="L117">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.PAYEE, MoneyWiseBasicResource.CATEGORY_NAME,</span>
<span class="nc" id="L118">                t -&gt; ((MoneyWisePayee) t).getCategoryClass().isSingular());</span>
<span class="fc" id="L119">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.DEPOSIT, PrometheusDataResource.DATAITEM_FIELD_NAME, MoneyWiseBasicDataType.PAYEE);</span>
<span class="fc" id="L120">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.CASH, PrometheusDataResource.DATAITEM_FIELD_NAME, MoneyWiseBasicDataType.PAYEE);</span>
<span class="fc" id="L121">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.LOAN, PrometheusDataResource.DATAITEM_FIELD_NAME, MoneyWiseBasicDataType.PAYEE);</span>
<span class="fc" id="L122">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.PORTFOLIO, PrometheusDataResource.DATAITEM_FIELD_NAME, MoneyWiseBasicDataType.PAYEE);</span>
<span class="fc" id="L123">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.PORTFOLIO, MoneyWiseBasicResource.CATEGORY_NAME,</span>
<span class="nc" id="L124">                t -&gt; ((MoneyWisePortfolio) t).getCategoryClass().isSingular());</span>
<span class="fc" id="L125">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.SECURITY, PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
<span class="fc" id="L126">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.SECURITY, MoneyWiseBasicResource.CATEGORY_NAME,</span>
<span class="nc" id="L127">                t -&gt; ((MoneyWiseSecurity) t).getCategoryClass().isSingular());</span>
<span class="fc" id="L128">        theMaps.declareFieldIdMap(MoneyWiseBasicDataType.SECURITY, MoneyWiseAccountInfoClass.SYMBOL,</span>
<span class="nc" id="L129">                t -&gt; ((MoneyWiseSecurity) t).getCategoryClass().needsSymbol());</span>

        /* Build date maps */
<span class="fc" id="L132">        theMaps.declareDateIdMap(MoneyWiseBasicDataType.EXCHANGERATE, MoneyWiseBasicResource.XCHGRATE_TO,</span>
                MoneyWiseBasicResource.MONEYWISEDATA_FIELD_DATE);
<span class="fc" id="L134">        theMaps.declareDateIdMap(MoneyWiseBasicDataType.SECURITYPRICE, MoneyWiseBasicDataType.SECURITY,</span>
                MoneyWiseBasicResource.MONEYWISEDATA_FIELD_DATE);
<span class="fc" id="L136">        theMaps.declareDateIdMap(MoneyWiseBasicDataType.DEPOSITRATE, MoneyWiseBasicDataType.DEPOSIT,</span>
                MoneyWiseBasicResource.DEPOSITRATE_ENDDATE, true);
<span class="fc" id="L138">    }</span>

    /**
     * Build the static map.
     * @param pKey the key
     */
    private void buildStaticMaps(final MetisListKey pKey) {
<span class="fc" id="L145">        theMaps.declareFieldIdMap(pKey, PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
<span class="fc" id="L146">        theMaps.declareFieldIdMap(pKey, PrometheusDataResource.STATICDATA_SORT);</span>
<span class="fc" id="L147">    }</span>

    /**
     * Deconstruct linkedPair.
     * @param pPair the linked pair
     * @return the deconstructed items
     */
    private static List&lt;PrometheusDataItem&gt; deconstructPair(final Object pPair) {
<span class="nc" id="L155">        final List&lt;PrometheusDataItem&gt; myList = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if (pPair instanceof MoneyWiseSecurityHolding myHolding) {</span>
<span class="nc" id="L157">            myList.add(myHolding.getPortfolio());</span>
<span class="nc" id="L158">            myList.add(myHolding.getSecurity());</span>
        }
<span class="nc" id="L160">        return myList;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>