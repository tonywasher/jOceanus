<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MoneyWiseAccountPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MoneyWise Personal Finance - Core</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.moneywise.ui.panel</a> &gt; <span class="el_source">MoneyWiseAccountPanel.java</span></div><h1>MoneyWiseAccountPanel.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * MoneyWise: Finance Application
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.moneywise.ui.panel;

import net.sourceforge.joceanus.metis.ui.MetisErrorPanel;
import net.sourceforge.joceanus.metis.viewer.MetisViewerEntry;
import net.sourceforge.joceanus.metis.viewer.MetisViewerManager;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseAssetBase;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseBasicDataType;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseCash;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseDeposit;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseLoan;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWisePayee;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWisePortfolio;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseSecurity;
import net.sourceforge.joceanus.moneywise.ui.MoneyWiseGoToId;
import net.sourceforge.joceanus.moneywise.ui.MoneyWiseUIResource;
import net.sourceforge.joceanus.moneywise.views.MoneyWiseView;
import net.sourceforge.joceanus.oceanus.event.OceanusEventRegistrar.OceanusEventProvider;
import net.sourceforge.joceanus.prometheus.ui.PrometheusActionButtons;
import net.sourceforge.joceanus.prometheus.ui.PrometheusGoToEvent;
import net.sourceforge.joceanus.prometheus.views.PrometheusDataEvent;
import net.sourceforge.joceanus.prometheus.views.PrometheusEditSet;
import net.sourceforge.joceanus.prometheus.views.PrometheusUIEvent;
import net.sourceforge.joceanus.prometheus.views.PrometheusViewerEntryId;
import net.sourceforge.joceanus.oceanus.base.OceanusException;
import net.sourceforge.joceanus.oceanus.event.OceanusEvent;
import net.sourceforge.joceanus.oceanus.event.OceanusEventManager;
import net.sourceforge.joceanus.oceanus.event.OceanusEventRegistrar;
import net.sourceforge.joceanus.oceanus.profile.OceanusProfile;
import net.sourceforge.joceanus.tethys.api.base.TethysUIComponent;
import net.sourceforge.joceanus.tethys.api.base.TethysUIEvent;
import net.sourceforge.joceanus.tethys.api.button.TethysUIButtonFactory;
import net.sourceforge.joceanus.tethys.api.button.TethysUIScrollButtonManager;
import net.sourceforge.joceanus.tethys.api.control.TethysUIControlFactory;
import net.sourceforge.joceanus.tethys.api.control.TethysUILabel;
import net.sourceforge.joceanus.tethys.api.factory.TethysUIFactory;
import net.sourceforge.joceanus.tethys.api.menu.TethysUIScrollMenu;
import net.sourceforge.joceanus.tethys.api.pane.TethysUIBorderPaneManager;
import net.sourceforge.joceanus.tethys.api.pane.TethysUIBoxPaneManager;
import net.sourceforge.joceanus.tethys.api.pane.TethysUICardPaneManager;
import net.sourceforge.joceanus.tethys.api.pane.TethysUIPaneFactory;

/**
 * Top-level panel for Accounts.
 */
public class MoneyWiseAccountPanel
        implements OceanusEventProvider&lt;PrometheusDataEvent&gt;, TethysUIComponent {
    /**
     * Strut width.
     */
    protected static final int STRUT_WIDTH = 5;

    /**
     * Text for DataEntry Title.
     */
<span class="nc" id="L71">    private static final String NLS_DATAENTRY = MoneyWiseUIResource.ASSET_DATAENTRY.getValue();</span>

    /**
     * Text for Selection Title.
     */
<span class="nc" id="L76">    private static final String NLS_SELECT = MoneyWiseUIResource.ASSET_TITLE_SELECT.getValue();</span>

    /**
     * Text for Selection Prompt.
     */
<span class="nc" id="L81">    private static final String NLS_DATA = MoneyWiseUIResource.ASSET_PROMPT_SELECT.getValue();</span>

    /**
     * The Event Manager.
     */
    private final OceanusEventManager&lt;PrometheusDataEvent&gt; theEventManager;

    /**
     * The Data View.
     */
    private final MoneyWiseView theView;

    /**
     * The Panel.
     */
    private final TethysUIBorderPaneManager thePanel;

    /**
     * The select button.
     */
    private final TethysUIScrollButtonManager&lt;PanelName&gt; theSelectButton;

    /**
     * The card panel.
     */
    private final TethysUICardPaneManager&lt;TethysUIComponent&gt; theCardPanel;

    /**
     * The select panel.
     */
    private final TethysUIBorderPaneManager theSelectPanel;

    /**
     * The filter card panel.
     */
    private final TethysUICardPaneManager&lt;TethysUIComponent&gt; theFilterCardPanel;

    /**
     * Deposit Table.
     */
    private final MoneyWiseDepositTable theDepositTable;

    /**
     * Cash Table.
     */
    private final MoneyWiseCashTable theCashTable;

    /**
     * Loan Table.
     */
    private final MoneyWiseLoanTable theLoanTable;

    /**
     * Portfolio Table.
     */
    private final MoneyWisePortfolioTable thePortfolioTable;

    /**
     * Security Table.
     */
    private final MoneyWiseSecurityTable theSecurityTable;

    /**
     * Payee Table.
     */
    private final MoneyWisePayeeTable thePayeeTable;

    /**
     * The UpdateSet.
     */
    private final PrometheusEditSet theEditSet;

    /**
     * The data entry.
     */
    private final MetisViewerEntry theViewerEntry;

    /**
     * The error panel.
     */
    private final MetisErrorPanel theError;

    /**
     * The action buttons panel.
     */
    private final PrometheusActionButtons theActionButtons;

    /**
     * Are we refreshing?
     */
    private boolean isRefreshing;

    /**
     * The active panel.
     */
    private PanelName theActive;

    /**
     * Constructor.
     * @param pView the data view
     */
<span class="nc" id="L182">    MoneyWiseAccountPanel(final MoneyWiseView pView) {</span>
        /* Store details */
<span class="nc" id="L184">        theView = pView;</span>

        /* Access GUI Factory */
<span class="nc" id="L187">        final TethysUIFactory&lt;?&gt; myFactory = pView.getGuiFactory();</span>
<span class="nc" id="L188">        final MetisViewerManager myViewer = pView.getViewerManager();</span>

        /* Create the event manager */
<span class="nc" id="L191">        theEventManager = new OceanusEventManager&lt;&gt;();</span>

        /* Build the Update set */
<span class="nc" id="L194">        theEditSet = new PrometheusEditSet(pView);</span>

        /* Create the Panel */
<span class="nc" id="L197">        final TethysUIPaneFactory myPanes = myFactory.paneFactory();</span>
<span class="nc" id="L198">        thePanel = myPanes.newBorderPane();</span>

        /* Create the top level viewer entry for this view */
<span class="nc" id="L201">        final MetisViewerEntry mySection = pView.getViewerEntry(PrometheusViewerEntryId.MAINTENANCE);</span>
<span class="nc" id="L202">        theViewerEntry = myViewer.newEntry(mySection, NLS_DATAENTRY);</span>
<span class="nc" id="L203">        theViewerEntry.setTreeObject(theEditSet);</span>

        /* Create the error panel */
<span class="nc" id="L206">        theError = pView.getToolkit().getToolkit().newErrorPanel(theViewerEntry);</span>

        /* Create the action buttons panel */
<span class="nc" id="L209">        theActionButtons = new PrometheusActionButtons(myFactory, theEditSet);</span>

        /* Create the table panels */
<span class="nc" id="L212">        thePayeeTable = new MoneyWisePayeeTable(pView, theEditSet, theError);</span>
<span class="nc" id="L213">        theSecurityTable = new MoneyWiseSecurityTable(pView, theEditSet, theError);</span>
<span class="nc" id="L214">        theDepositTable = new MoneyWiseDepositTable(pView, theEditSet, theError);</span>
<span class="nc" id="L215">        theCashTable = new MoneyWiseCashTable(pView, theEditSet, theError);</span>
<span class="nc" id="L216">        theLoanTable = new MoneyWiseLoanTable(pView, theEditSet, theError);</span>
<span class="nc" id="L217">        thePortfolioTable = new MoneyWisePortfolioTable(pView, theEditSet, theError);</span>

        /* Create selection button and label */
<span class="nc" id="L220">        final TethysUIControlFactory myControls = myFactory.controlFactory();</span>
<span class="nc" id="L221">        final TethysUIButtonFactory&lt;?&gt; myButtons = myFactory.buttonFactory();</span>
<span class="nc" id="L222">        final TethysUILabel myLabel = myControls.newLabel(NLS_DATA);</span>
<span class="nc" id="L223">        theSelectButton = myButtons.newScrollButton(PanelName.class);</span>
<span class="nc" id="L224">        buildSelectMenu();</span>

        /* Create the card panel */
<span class="nc" id="L227">        theCardPanel = myPanes.newCardPane();</span>

        /* Add to the card panels */
<span class="nc" id="L230">        theCardPanel.addCard(PanelName.DEPOSITS.toString(), theDepositTable);</span>
<span class="nc" id="L231">        theCardPanel.addCard(PanelName.CASH.toString(), theCashTable);</span>
<span class="nc" id="L232">        theCardPanel.addCard(PanelName.LOANS.toString(), theLoanTable);</span>
<span class="nc" id="L233">        theCardPanel.addCard(PanelName.PORTFOLIOS.toString(), thePortfolioTable);</span>
<span class="nc" id="L234">        theCardPanel.addCard(PanelName.SECURITIES.toString(), theSecurityTable);</span>
<span class="nc" id="L235">        theCardPanel.addCard(PanelName.PAYEES.toString(), thePayeeTable);</span>
<span class="nc" id="L236">        theActive = PanelName.DEPOSITS;</span>
<span class="nc" id="L237">        theSelectButton.setFixedText(theActive.toString());</span>

        /* Create the new card panel */
<span class="nc" id="L240">        theFilterCardPanel = myPanes.newCardPane();</span>

        /* Build the new card panel */
<span class="nc" id="L243">        theFilterCardPanel.addCard(PanelName.DEPOSITS.toString(), theDepositTable.getFilterPanel());</span>
<span class="nc" id="L244">        theFilterCardPanel.addCard(PanelName.CASH.toString(), theCashTable.getFilterPanel());</span>
<span class="nc" id="L245">        theFilterCardPanel.addCard(PanelName.LOANS.toString(), theLoanTable.getFilterPanel());</span>
<span class="nc" id="L246">        theFilterCardPanel.addCard(PanelName.PORTFOLIOS.toString(), thePortfolioTable.getFilterPanel());</span>
<span class="nc" id="L247">        theFilterCardPanel.addCard(PanelName.SECURITIES.toString(), theSecurityTable.getFilterPanel());</span>
<span class="nc" id="L248">        theFilterCardPanel.addCard(PanelName.PAYEES.toString(), thePayeeTable.getFilterPanel());</span>

        /* Create the select prompt */
<span class="nc" id="L251">        final TethysUIBoxPaneManager mySelect = myPanes.newHBoxPane();</span>
<span class="nc" id="L252">        mySelect.addNode(myLabel);</span>
<span class="nc" id="L253">        mySelect.addNode(theSelectButton);</span>

        /* Create the selection panel */
<span class="nc" id="L256">        theSelectPanel = myPanes.newBorderPane();</span>
<span class="nc" id="L257">        theSelectPanel.setBorderTitle(NLS_SELECT);</span>
<span class="nc" id="L258">        theSelectPanel.setWest(mySelect);</span>
<span class="nc" id="L259">        theSelectPanel.setCentre(theFilterCardPanel);</span>

        /* Create the header panel */
<span class="nc" id="L262">        final TethysUIBorderPaneManager myHeader = myPanes.newBorderPane();</span>
<span class="nc" id="L263">        myHeader.setCentre(theSelectPanel);</span>
<span class="nc" id="L264">        myHeader.setNorth(theError);</span>
<span class="nc" id="L265">        myHeader.setEast(theActionButtons);</span>

        /* Now define the panel */
<span class="nc" id="L268">        thePanel.setNorth(myHeader);</span>
<span class="nc" id="L269">        thePanel.setCentre(theCardPanel);</span>

        /* Hide the action buttons initially */
<span class="nc" id="L272">        theActionButtons.setVisible(false);</span>

        /* Create the listeners */
<span class="nc" id="L275">        theSelectButton.getEventRegistrar().addEventListener(TethysUIEvent.NEWVALUE, e -&gt; handleSelection());</span>
<span class="nc" id="L276">        theError.getEventRegistrar().addEventListener(e -&gt; handleErrorPane());</span>
<span class="nc" id="L277">        theActionButtons.getEventRegistrar().addEventListener(this::handleActionButtons);</span>
<span class="nc" id="L278">        setChildListeners(theDepositTable.getEventRegistrar());</span>
<span class="nc" id="L279">        setChildListeners(theCashTable.getEventRegistrar());</span>
<span class="nc" id="L280">        setChildListeners(theLoanTable.getEventRegistrar());</span>
<span class="nc" id="L281">        setChildListeners(thePayeeTable.getEventRegistrar());</span>
<span class="nc" id="L282">        setChildListeners(thePortfolioTable.getEventRegistrar());</span>
<span class="nc" id="L283">        setChildListeners(theSecurityTable.getEventRegistrar());</span>
<span class="nc" id="L284">    }</span>

    @Override
    public TethysUIComponent getUnderlying() {
<span class="nc" id="L288">        return thePanel;</span>
    }

    @Override
    public OceanusEventRegistrar&lt;PrometheusDataEvent&gt; getEventRegistrar() {
<span class="nc" id="L293">        return theEventManager.getEventRegistrar();</span>
    }

    /**
     * setChildListeners.
     * @param pRegistrar the registrar
     */
    private void setChildListeners(final OceanusEventRegistrar&lt;PrometheusDataEvent&gt; pRegistrar) {
<span class="nc" id="L301">        pRegistrar.addEventListener(PrometheusDataEvent.ADJUSTVISIBILITY, e -&gt; {</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">            if (!isRefreshing) {</span>
<span class="nc" id="L303">                setVisibility();</span>
            }
<span class="nc" id="L305">        });</span>
<span class="nc" id="L306">        pRegistrar.addEventListener(PrometheusDataEvent.GOTOWINDOW, this::handleGoToEvent);</span>
<span class="nc" id="L307">    }</span>

    @Override
    public void setEnabled(final boolean pEnabled) {
<span class="nc" id="L311">        theSelectButton.setEnabled(pEnabled);</span>
<span class="nc" id="L312">        theCardPanel.setEnabled(pEnabled);</span>
<span class="nc" id="L313">        theFilterCardPanel.setEnabled(pEnabled);</span>
<span class="nc" id="L314">    }</span>

    @Override
    public void setVisible(final boolean pVisible) {
<span class="nc" id="L318">        thePanel.setVisible(pVisible);</span>
<span class="nc" id="L319">    }</span>

    /**
     * Build select menu.
     */
    private void buildSelectMenu() {
        /* Create builder */
<span class="nc" id="L326">        final TethysUIScrollMenu&lt;PanelName&gt; myMenu = theSelectButton.getMenu();</span>

        /* Loop through the panels */
<span class="nc bnc" id="L329" title="All 2 branches missed.">        for (PanelName myPanel : PanelName.values()) {</span>
            /* Create a new JMenuItem for the panel */
<span class="nc" id="L331">            myMenu.addItem(myPanel);</span>
        }
<span class="nc" id="L333">    }</span>

    /**
     * Show locked accounts.
     * @param pShow true/false
     */
    public void showLocked(final boolean pShow) {
        /* Adjust lock settings */
<span class="nc" id="L341">        thePayeeTable.setShowAll(pShow);</span>
<span class="nc" id="L342">        theSecurityTable.setShowAll(pShow);</span>
<span class="nc" id="L343">        theDepositTable.setShowAll(pShow);</span>
<span class="nc" id="L344">        theCashTable.setShowAll(pShow);</span>
<span class="nc" id="L345">        theLoanTable.setShowAll(pShow);</span>
<span class="nc" id="L346">        thePortfolioTable.setShowAll(pShow);</span>
<span class="nc" id="L347">    }</span>

    /**
     * Cancel Editing of underlying tables.
     */
    private void cancelEditing() {
        /* Cancel editing */
<span class="nc" id="L354">        thePayeeTable.cancelEditing();</span>
<span class="nc" id="L355">        theSecurityTable.cancelEditing();</span>
<span class="nc" id="L356">        theDepositTable.cancelEditing();</span>
<span class="nc" id="L357">        theCashTable.cancelEditing();</span>
<span class="nc" id="L358">        theLoanTable.cancelEditing();</span>
<span class="nc" id="L359">        thePortfolioTable.cancelEditing();</span>
<span class="nc" id="L360">    }</span>

    /**
     * Refresh data.
     * @throws OceanusException on error
     */
    public void refreshData() throws OceanusException {
        /* Obtain the active profile */
<span class="nc" id="L368">        OceanusProfile myTask = theView.getActiveTask();</span>
<span class="nc" id="L369">        myTask = myTask.startTask(&quot;Accounts&quot;);</span>

        /* Note that we are refreshing */
<span class="nc" id="L372">        isRefreshing = true;</span>
<span class="nc" id="L373">        theEditSet.setDataSet(theView.getData());</span>

        /* Must be done in dataType order to ensure that links are resolved correctly */
<span class="nc" id="L376">        thePayeeTable.refreshData();</span>
<span class="nc" id="L377">        theSecurityTable.refreshData();</span>
<span class="nc" id="L378">        theDepositTable.refreshData();</span>
<span class="nc" id="L379">        theCashTable.refreshData();</span>
<span class="nc" id="L380">        theLoanTable.refreshData();</span>
<span class="nc" id="L381">        thePortfolioTable.refreshData();</span>

        /* Clear refreshing flag */
<span class="nc" id="L384">        isRefreshing = false;</span>
<span class="nc" id="L385">        setVisibility();</span>

        /* Touch the updateSet */
<span class="nc" id="L388">        theViewerEntry.setTreeObject(theEditSet);</span>

        /* Complete the task */
<span class="nc" id="L391">        myTask.end();</span>
<span class="nc" id="L392">    }</span>

    /**
     * Determine Focus.
     */
    public void determineFocus() {
        /* Switch on active component */
<span class="nc bnc" id="L399" title="All 7 branches missed.">        switch (theActive) {</span>
            case DEPOSITS:
<span class="nc" id="L401">                theDepositTable.determineFocus(theViewerEntry);</span>
<span class="nc" id="L402">                break;</span>
            case CASH:
<span class="nc" id="L404">                theCashTable.determineFocus(theViewerEntry);</span>
<span class="nc" id="L405">                break;</span>
            case LOANS:
<span class="nc" id="L407">                theLoanTable.determineFocus(theViewerEntry);</span>
<span class="nc" id="L408">                break;</span>
            case PORTFOLIOS:
<span class="nc" id="L410">                thePortfolioTable.determineFocus(theViewerEntry);</span>
<span class="nc" id="L411">                break;</span>
            case SECURITIES:
<span class="nc" id="L413">                theSecurityTable.determineFocus(theViewerEntry);</span>
<span class="nc" id="L414">                break;</span>
            case PAYEES:
<span class="nc" id="L416">                thePayeeTable.determineFocus(theViewerEntry);</span>
<span class="nc" id="L417">                break;</span>
            default:
                break;
        }
<span class="nc" id="L421">    }</span>

    /**
     * Does this panel have updates?
     * @return true/false
     */
    public boolean hasUpdates() {
        /* Determine whether we have updates */
<span class="nc" id="L429">        boolean hasUpdates = theDepositTable.hasUpdates();</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">        if (!hasUpdates) {</span>
<span class="nc" id="L431">            hasUpdates = theCashTable.hasUpdates();</span>
        }
<span class="nc bnc" id="L433" title="All 2 branches missed.">        if (!hasUpdates) {</span>
<span class="nc" id="L434">            hasUpdates = theLoanTable.hasUpdates();</span>
        }
<span class="nc bnc" id="L436" title="All 2 branches missed.">        if (!hasUpdates) {</span>
<span class="nc" id="L437">            hasUpdates = thePortfolioTable.hasUpdates();</span>
        }
<span class="nc bnc" id="L439" title="All 2 branches missed.">        if (!hasUpdates) {</span>
<span class="nc" id="L440">            hasUpdates = theSecurityTable.hasUpdates();</span>
        }
<span class="nc bnc" id="L442" title="All 2 branches missed.">        if (!hasUpdates) {</span>
<span class="nc" id="L443">            hasUpdates = thePayeeTable.hasUpdates();</span>
        }

        /* Return to caller */
<span class="nc" id="L447">        return hasUpdates;</span>
    }

    /**
     * Has this set of panels got the session focus?
     * @return true/false
     */
    public boolean hasSession() {
        /* Determine whether we have session focus */
<span class="nc" id="L456">        boolean hasSession = theDepositTable.hasSession();</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">        if (!hasSession) {</span>
<span class="nc" id="L458">            hasSession = theCashTable.hasSession();</span>
        }
<span class="nc bnc" id="L460" title="All 2 branches missed.">        if (!hasSession) {</span>
<span class="nc" id="L461">            hasSession = theLoanTable.hasSession();</span>
        }
<span class="nc bnc" id="L463" title="All 2 branches missed.">        if (!hasSession) {</span>
<span class="nc" id="L464">            hasSession = thePortfolioTable.hasSession();</span>
        }
<span class="nc bnc" id="L466" title="All 2 branches missed.">        if (!hasSession) {</span>
<span class="nc" id="L467">            hasSession = theSecurityTable.hasSession();</span>
        }
<span class="nc bnc" id="L469" title="All 2 branches missed.">        if (!hasSession) {</span>
<span class="nc" id="L470">            hasSession = thePayeeTable.hasSession();</span>
        }

        /* Return to caller */
<span class="nc" id="L474">        return hasSession;</span>
    }

    /**
     * Does this panel have errors?
     * @return true/false
     */
    public boolean hasErrors() {
        /* Determine whether we have errors */
<span class="nc" id="L483">        boolean hasErrors = theDepositTable.hasErrors();</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">        if (!hasErrors) {</span>
<span class="nc" id="L485">            hasErrors = theCashTable.hasErrors();</span>
        }
<span class="nc bnc" id="L487" title="All 2 branches missed.">        if (!hasErrors) {</span>
<span class="nc" id="L488">            hasErrors = theLoanTable.hasErrors();</span>
        }
<span class="nc bnc" id="L490" title="All 2 branches missed.">        if (!hasErrors) {</span>
<span class="nc" id="L491">            hasErrors = thePortfolioTable.hasErrors();</span>
        }
<span class="nc bnc" id="L493" title="All 2 branches missed.">        if (!hasErrors) {</span>
<span class="nc" id="L494">            hasErrors = theSecurityTable.hasErrors();</span>
        }
<span class="nc bnc" id="L496" title="All 2 branches missed.">        if (!hasErrors) {</span>
<span class="nc" id="L497">            hasErrors = thePayeeTable.hasErrors();</span>
        }

        /* Return to caller */
<span class="nc" id="L501">        return hasErrors;</span>
    }

    /**
     * Does this panel have item editing occurring?
     * @return true/false
     */
    public boolean isItemEditing() {
        /* Determine whether we have item editing */
<span class="nc" id="L510">        boolean isEditing = theDepositTable.isItemEditing();</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">        if (!isEditing) {</span>
<span class="nc" id="L512">            isEditing = theCashTable.isItemEditing();</span>
        }
<span class="nc bnc" id="L514" title="All 2 branches missed.">        if (!isEditing) {</span>
<span class="nc" id="L515">            isEditing = theLoanTable.isItemEditing();</span>
        }
<span class="nc bnc" id="L517" title="All 2 branches missed.">        if (!isEditing) {</span>
<span class="nc" id="L518">            isEditing = thePortfolioTable.isItemEditing();</span>
        }
<span class="nc bnc" id="L520" title="All 2 branches missed.">        if (!isEditing) {</span>
<span class="nc" id="L521">            isEditing = theSecurityTable.isItemEditing();</span>
        }
<span class="nc bnc" id="L523" title="All 2 branches missed.">        if (!isEditing) {</span>
<span class="nc" id="L524">            isEditing = thePayeeTable.isItemEditing();</span>
        }

        /* Return to caller */
<span class="nc" id="L528">        return isEditing;</span>
    }

    /**
     * Select account.
     * @param pAccount the account to select
     */
    public void selectAccount(final MoneyWiseAssetBase pAccount) {
        /* Determine which panel to show */
<span class="nc bnc" id="L537" title="All 2 branches missed.">        if (pAccount instanceof MoneyWiseDeposit myDeposit) {</span>
<span class="nc" id="L538">            theDepositTable.selectDeposit(myDeposit);</span>
<span class="nc" id="L539">            showPanel(PanelName.DEPOSITS);</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">        } else if (pAccount instanceof MoneyWiseCash myCash) {</span>
<span class="nc" id="L541">            theCashTable.selectCash(myCash);</span>
<span class="nc" id="L542">            showPanel(PanelName.CASH);</span>
<span class="nc bnc" id="L543" title="All 2 branches missed.">        } else if (pAccount instanceof MoneyWiseLoan myLoan) {</span>
<span class="nc" id="L544">            theLoanTable.selectLoan(myLoan);</span>
<span class="nc" id="L545">            showPanel(PanelName.LOANS);</span>
<span class="nc bnc" id="L546" title="All 2 branches missed.">        } else if (pAccount instanceof MoneyWisePortfolio myPortfolio) {</span>
<span class="nc" id="L547">            thePortfolioTable.selectPortfolio(myPortfolio);</span>
<span class="nc" id="L548">            showPanel(PanelName.PORTFOLIOS);</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">        } else if (pAccount instanceof MoneyWiseSecurity mySecurity) {</span>
<span class="nc" id="L550">            theSecurityTable.selectSecurity(mySecurity);</span>
<span class="nc" id="L551">            showPanel(PanelName.SECURITIES);</span>
<span class="nc bnc" id="L552" title="All 2 branches missed.">        } else if (pAccount instanceof MoneyWisePayee myPayee) {</span>
<span class="nc" id="L553">            thePayeeTable.selectPayee(myPayee);</span>
<span class="nc" id="L554">            showPanel(PanelName.PAYEES);</span>
        }
<span class="nc" id="L556">    }</span>

    /**
     * Show panel.
     * @param pName the panel name
     */
    private void showPanel(final PanelName pName) {
        /* Obtain name of panel */
<span class="nc" id="L564">        final String myName = pName.toString();</span>

        /* Move correct card to front */
<span class="nc" id="L567">        theCardPanel.selectCard(myName);</span>
<span class="nc" id="L568">        theFilterCardPanel.selectCard(myName);</span>

        /* Note the active panel */
<span class="nc" id="L571">        theActive = pName;</span>
<span class="nc" id="L572">        theSelectButton.setFixedText(myName);</span>

        /* Determine the focus */
<span class="nc" id="L575">        determineFocus();</span>
<span class="nc" id="L576">    }</span>

    /**
     * Set Visibility.
     */
    protected void setVisibility() {
        /* Determine whether we have updates */
<span class="nc" id="L583">        final boolean hasUpdates = hasUpdates();</span>
<span class="nc" id="L584">        final boolean isItemEditing = isItemEditing();</span>

        /* Update the action buttons */
<span class="nc" id="L587">        theActionButtons.setEnabled(true);</span>
<span class="nc bnc" id="L588" title="All 4 branches missed.">        theActionButtons.setVisible(hasUpdates &amp;&amp; !isItemEditing);</span>

        /* Update the selection */
<span class="nc bnc" id="L591" title="All 2 branches missed.">        theSelectButton.setEnabled(!isItemEditing);</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">        theFilterCardPanel.setEnabled(!isItemEditing);</span>

        /* Alert listeners that there has been a change */
<span class="nc" id="L595">        theEventManager.fireEvent(PrometheusDataEvent.ADJUSTVISIBILITY);</span>
<span class="nc" id="L596">    }</span>

    /**
     * handleErrorPane.
     */
    private void handleErrorPane() {
        /* Determine whether we have an error */
<span class="nc" id="L603">        final boolean isError = theError.hasError();</span>

        /* Hide selection panel on error */
<span class="nc bnc" id="L606" title="All 2 branches missed.">        theSelectPanel.setVisible(!isError);</span>

        /* Lock card panel */
<span class="nc bnc" id="L609" title="All 2 branches missed.">        theCardPanel.setEnabled(!isError);</span>

        /* Lock Action Buttons */
<span class="nc bnc" id="L612" title="All 2 branches missed.">        theActionButtons.setEnabled(!isError);</span>
<span class="nc" id="L613">    }</span>

    /**
     * handleSelection.
     */
    private void handleSelection() {
        /* Cancel any editing */
<span class="nc" id="L620">        cancelEditing();</span>

        /* Show selected panel */
<span class="nc" id="L623">        showPanel(theSelectButton.getValue());</span>
<span class="nc" id="L624">    }</span>

    /**
     * handle Action Buttons.
     * @param pEvent the event
     */
    private void handleActionButtons(final OceanusEvent&lt;PrometheusUIEvent&gt; pEvent) {
        /* Cancel editing */
<span class="nc" id="L632">        cancelEditing();</span>

        /* Perform the command */
<span class="nc" id="L635">        theEditSet.processCommand(pEvent.getEventId(), theError);</span>
<span class="nc" id="L636">    }</span>

    /**
     * handle GoTo Event.
     * @param pEvent the event
     */
    private void handleGoToEvent(final OceanusEvent&lt;PrometheusDataEvent&gt; pEvent) {
        /* Access details */
        @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L645">        final PrometheusGoToEvent&lt;MoneyWiseGoToId&gt; myEvent = pEvent.getDetails(PrometheusGoToEvent.class);</span>

        /* Access event and obtain details */
<span class="nc bnc" id="L648" title="All 3 branches missed.">        switch (myEvent.getId()) {</span>
            /* Pass through the event */
            case STATEMENT:
            case CATEGORY:
            case REGION:
            case TAG:
            case STATIC:
<span class="nc" id="L655">                theEventManager.cascadeEvent(pEvent);</span>
<span class="nc" id="L656">                break;</span>

            /* Access subPanels */
            case ACCOUNT:
<span class="nc" id="L660">                selectAccount(myEvent.getDetails(MoneyWiseAssetBase.class));</span>
<span class="nc" id="L661">                break;</span>
            default:
                break;
        }
<span class="nc" id="L665">    }</span>

    /**
     * Panel names.
     */
<span class="nc" id="L670">    private enum PanelName {</span>
        /**
         * Deposits.
         */
<span class="nc" id="L674">        DEPOSITS(MoneyWiseBasicDataType.DEPOSIT),</span>

        /**
         * Cash.
         */
<span class="nc" id="L679">        CASH(MoneyWiseBasicDataType.CASH),</span>

        /**
         * Loans.
         */
<span class="nc" id="L684">        LOANS(MoneyWiseBasicDataType.LOAN),</span>

        /**
         * Portfolios.
         */
<span class="nc" id="L689">        PORTFOLIOS(MoneyWiseBasicDataType.PORTFOLIO),</span>

        /**
         * Securities.
         */
<span class="nc" id="L694">        SECURITIES(MoneyWiseBasicDataType.SECURITY),</span>

        /**
         * Payees.
         */
<span class="nc" id="L699">        PAYEES(MoneyWiseBasicDataType.PAYEE);</span>

        /**
         * The String name.
         */
        private String theName;

        /**
         * Constructor.
         * @param pDataType the dataType
         */
<span class="nc" id="L710">        PanelName(final MoneyWiseBasicDataType pDataType) {</span>
<span class="nc" id="L711">            theName = pDataType.getListName();</span>
<span class="nc" id="L712">        }</span>

        @Override
        public String toString() {
            /* return the name */
<span class="nc" id="L717">            return theName;</span>
        }
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>