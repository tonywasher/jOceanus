<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MoneyWiseXAnalysis.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MoneyWise Personal Finance - Core</a> &gt; <a href="index.source.html" class="el_package">io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets</a> &gt; <span class="el_source">MoneyWiseXAnalysis.java</span></div><h1>MoneyWiseXAnalysis.java</h1><pre class="source lang-java linenums">/*
 * MoneyWise: Finance Application
 * Copyright 2012-2026. Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets;

import io.github.tonywasher.joceanus.oceanus.date.OceanusDate;
import io.github.tonywasher.joceanus.oceanus.date.OceanusDateRange;
import io.github.tonywasher.joceanus.oceanus.decimal.OceanusMoney;
import io.github.tonywasher.joceanus.oceanus.format.OceanusDataFormatter;
import io.github.tonywasher.joceanus.oceanus.logger.OceanusLogManager;
import io.github.tonywasher.joceanus.oceanus.logger.OceanusLogger;
import io.github.tonywasher.joceanus.metis.field.MetisFieldItem;
import io.github.tonywasher.joceanus.metis.field.MetisFieldSet;
import io.github.tonywasher.joceanus.metis.preference.MetisPreferenceManager;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.base.MoneyWiseXAnalysisEventList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisCashBucket.MoneyWiseXAnalysisCashBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisCashCategoryBucket.MoneyWiseXAnalysisCashCategoryBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisDepositBucket.MoneyWiseXAnalysisDepositBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisDepositCategoryBucket.MoneyWiseXAnalysisDepositCategoryBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisInterfaces.MoneyWiseXAnalysisCursor;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisLoanBucket.MoneyWiseXAnalysisLoanBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisLoanCategoryBucket.MoneyWiseXAnalysisLoanCategoryBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisPayeeBucket.MoneyWiseXAnalysisPayeeBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisPortfolioBucket.MoneyWiseXAnalysisPortfolioBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisTaxBasisBucket.MoneyWiseXAnalysisTaxBasisBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisTransCategoryBucket.MoneyWiseXAnalysisTransCategoryBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisTransTagBucket.MoneyWiseXAnalysisTransTagBucketList;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.values.MoneyWiseXAnalysisAccountAttr;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.values.MoneyWiseXAnalysisPayeeAttr;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.values.MoneyWiseXAnalysisSecurityAttr;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.values.MoneyWiseXAnalysisTaxBasisAttr;
import io.github.tonywasher.joceanus.moneywise.atlas.data.analysis.values.MoneyWiseXAnalysisTransAttr;
import io.github.tonywasher.joceanus.moneywise.data.basic.MoneyWiseBasicDataType;
import io.github.tonywasher.joceanus.moneywise.data.basic.MoneyWiseBasicResource;
import io.github.tonywasher.joceanus.moneywise.data.basic.MoneyWiseDataSet;
import io.github.tonywasher.joceanus.moneywise.data.statics.MoneyWiseCurrency;
import io.github.tonywasher.joceanus.moneywise.data.statics.MoneyWiseStaticDataType;
import io.github.tonywasher.joceanus.moneywise.tax.MoneyWiseTaxAnalysis;
import io.github.tonywasher.joceanus.moneywise.tax.MoneyWiseTaxYear;
import io.github.tonywasher.joceanus.moneywise.tax.MoneyWiseTaxYearCache;
import io.github.tonywasher.joceanus.moneywise.tax.uk.MoneyWiseUKTaxYearCache;
import io.github.tonywasher.joceanus.prometheus.views.PrometheusEditSet;

/**
 * Data Analysis.
 *
 * @author Tony Washer
 */
public class MoneyWiseXAnalysis
        implements MetisFieldItem {
    /**
     * Logger.
     */
<span class="fc" id="L67">    private static final OceanusLogger LOGGER = OceanusLogManager.getLogger(MoneyWiseXAnalysis.class);</span>

    /**
     * Local Report fields.
     */
<span class="fc" id="L72">    private static final MetisFieldSet&lt;MoneyWiseXAnalysis&gt; FIELD_DEFS = MetisFieldSet.newFieldSet(MoneyWiseXAnalysis.class);</span>

    /*
     * Declare Fields.
     */
    static {
<span class="fc" id="L78">        FIELD_DEFS.declareLocalField(MoneyWiseBasicResource.MONEYWISEDATA_RANGE, MoneyWiseXAnalysis::getDateRange);</span>
<span class="fc" id="L79">        FIELD_DEFS.declareLocalField(MoneyWiseXAnalysisBucketResource.TAX_YEARS, MoneyWiseXAnalysis::getTaxYearCache);</span>
<span class="fc" id="L80">        FIELD_DEFS.declareLocalField(MoneyWiseStaticDataType.CURRENCY, MoneyWiseXAnalysis::getCurrency);</span>
<span class="fc" id="L81">        FIELD_DEFS.declareLocalField(MoneyWiseBasicDataType.DEPOSIT.getListId(), MoneyWiseXAnalysis::getDeposits);</span>
<span class="fc" id="L82">        FIELD_DEFS.declareLocalField(MoneyWiseBasicDataType.CASH.getListId(), MoneyWiseXAnalysis::getCash);</span>
<span class="fc" id="L83">        FIELD_DEFS.declareLocalField(MoneyWiseBasicDataType.LOAN.getListId(), MoneyWiseXAnalysis::getLoans);</span>
<span class="fc" id="L84">        FIELD_DEFS.declareLocalField(MoneyWiseBasicDataType.PAYEE.getListId(), MoneyWiseXAnalysis::getPayees);</span>
<span class="fc" id="L85">        FIELD_DEFS.declareLocalField(MoneyWiseBasicDataType.PORTFOLIO.getListId(), MoneyWiseXAnalysis::getPortfolios);</span>
<span class="fc" id="L86">        FIELD_DEFS.declareLocalField(MoneyWiseBasicDataType.DEPOSITCATEGORY.getListId(), MoneyWiseXAnalysis::getDepositCategories);</span>
<span class="fc" id="L87">        FIELD_DEFS.declareLocalField(MoneyWiseBasicDataType.CASHCATEGORY.getListId(), MoneyWiseXAnalysis::getCashCategories);</span>
<span class="fc" id="L88">        FIELD_DEFS.declareLocalField(MoneyWiseBasicDataType.LOANCATEGORY.getListId(), MoneyWiseXAnalysis::getLoanCategories);</span>
<span class="fc" id="L89">        FIELD_DEFS.declareLocalField(MoneyWiseBasicDataType.TRANSCATEGORY.getListId(), MoneyWiseXAnalysis::getTransCategories);</span>
<span class="fc" id="L90">        FIELD_DEFS.declareLocalField(MoneyWiseBasicDataType.TRANSTAG.getListId(), MoneyWiseXAnalysis::getTransactionTags);</span>
<span class="fc" id="L91">        FIELD_DEFS.declareLocalField(MoneyWiseStaticDataType.TAXBASIS.getListId(), MoneyWiseXAnalysis::getTaxBasis);</span>
<span class="fc" id="L92">        FIELD_DEFS.declareLocalField(MoneyWiseXAnalysisBucketResource.TAX_CALCULATION, MoneyWiseXAnalysis::getTaxAnalysis);</span>
<span class="fc" id="L93">    }</span>

    /**
     * The EditSet.
     */
    private final PrometheusEditSet theEditSet;

    /**
     * The Cursor.
     */
    private final MoneyWiseXAnalysisCursor theCursor;

    /**
     * The taxYear cache.
     */
    private final MoneyWiseTaxYearCache theTaxYearCache;

    /**
     * The Currency.
     */
    private final MoneyWiseCurrency theCurrency;

    /**
     * The Preference Manager.
     */
    private final MetisPreferenceManager thePreferences;

    /**
     * The DataRange.
     */
    private final OceanusDateRange theDateRange;

    /**
     * The deposit buckets.
     */
    private final MoneyWiseXAnalysisDepositBucketList theDeposits;

    /**
     * The cash buckets.
     */
    private final MoneyWiseXAnalysisCashBucketList theCash;

    /**
     * The loan buckets.
     */
    private final MoneyWiseXAnalysisLoanBucketList theLoans;

    /**
     * The payee buckets.
     */
    private final MoneyWiseXAnalysisPayeeBucketList thePayees;

    /**
     * The portfolio buckets.
     */
    private final MoneyWiseXAnalysisPortfolioBucketList thePortfolios;

    /**
     * The deposit category buckets.
     */
    private final MoneyWiseXAnalysisDepositCategoryBucketList theDepositCategories;

    /**
     * The cash category buckets.
     */
    private final MoneyWiseXAnalysisCashCategoryBucketList theCashCategories;

    /**
     * The loan category buckets.
     */
    private final MoneyWiseXAnalysisLoanCategoryBucketList theLoanCategories;

    /**
     * The transaction category buckets.
     */
    private final MoneyWiseXAnalysisTransCategoryBucketList theTransCategories;

    /**
     * The TransactionTag buckets.
     */
    private final MoneyWiseXAnalysisTransTagBucketList theTransTags;

    /**
     * The tax basis buckets.
     */
    private final MoneyWiseXAnalysisTaxBasisBucketList theTaxBasis;

    /**
     * The new tax calculations.
     */
    private final MoneyWiseTaxAnalysis theTaxAnalysis;

    /**
     * The Events.
     */
    private MoneyWiseXAnalysisEventList theEvents;

    /**
     * Do we have active securities?
     */
<span class="pc" id="L193">    private Boolean haveActiveSecurities = Boolean.FALSE;</span>

    /**
     * Do we have a foreign account?
     */
<span class="pc" id="L198">    private Boolean haveForeignCurrency = Boolean.FALSE;</span>

    /**
     * Constructor for a full analysis.
     *
     * @param pEditSet       the editSet to analyse events for
     * @param pCursor        the cursor
     * @param pPreferenceMgr the preference manager
     */
    public MoneyWiseXAnalysis(final PrometheusEditSet pEditSet,
                              final MoneyWiseXAnalysisCursor pCursor,
<span class="fc" id="L209">                              final MetisPreferenceManager pPreferenceMgr) {</span>
        /* Store the data */
<span class="fc" id="L211">        theEditSet = pEditSet;</span>
<span class="fc" id="L212">        theCursor = pCursor;</span>
<span class="fc" id="L213">        final MoneyWiseDataSet myDataSet = getData();</span>
<span class="fc" id="L214">        theCurrency = myDataSet.getReportingCurrency();</span>
<span class="fc" id="L215">        thePreferences = pPreferenceMgr;</span>
<span class="fc" id="L216">        theDateRange = myDataSet.getDateRange();</span>

        /* Access the TaxYearCache */
<span class="fc" id="L219">        theTaxYearCache = (MoneyWiseUKTaxYearCache) myDataSet.getTaxFactory();</span>

        /* Create a new set of buckets */
<span class="fc" id="L222">        theDeposits = new MoneyWiseXAnalysisDepositBucketList(this);</span>
<span class="fc" id="L223">        theCash = new MoneyWiseXAnalysisCashBucketList(this);</span>
<span class="fc" id="L224">        theLoans = new MoneyWiseXAnalysisLoanBucketList(this);</span>
<span class="fc" id="L225">        thePortfolios = new MoneyWiseXAnalysisPortfolioBucketList(this);</span>
<span class="fc" id="L226">        thePayees = new MoneyWiseXAnalysisPayeeBucketList(this);</span>
<span class="fc" id="L227">        theTaxBasis = new MoneyWiseXAnalysisTaxBasisBucketList(this);</span>
<span class="fc" id="L228">        theTransCategories = new MoneyWiseXAnalysisTransCategoryBucketList(this);</span>
<span class="fc" id="L229">        theTransTags = new MoneyWiseXAnalysisTransTagBucketList(this);</span>

        /* Create totalling buckets */
<span class="fc" id="L232">        theDepositCategories = new MoneyWiseXAnalysisDepositCategoryBucketList(this);</span>
<span class="fc" id="L233">        theCashCategories = new MoneyWiseXAnalysisCashCategoryBucketList(this);</span>
<span class="fc" id="L234">        theLoanCategories = new MoneyWiseXAnalysisLoanCategoryBucketList(this);</span>
<span class="fc" id="L235">        theTaxAnalysis = null;</span>
<span class="fc" id="L236">    }</span>

    /**
     * Constructor for a dated analysis.
     *
     * @param pBase the base analysis
     * @param pDate the date for the analysis
     */
    public MoneyWiseXAnalysis(final MoneyWiseXAnalysis pBase,
<span class="nc" id="L245">                              final OceanusDate pDate) {</span>
        /* Store the data */
<span class="nc" id="L247">        theEditSet = pBase.getEditSet();</span>
<span class="nc" id="L248">        final MoneyWiseDataSet myDataSet = getData();</span>
<span class="nc" id="L249">        theCurrency = pBase.getCurrency();</span>
<span class="nc" id="L250">        thePreferences = pBase.getPreferenceMgr();</span>
<span class="nc" id="L251">        theDateRange = new OceanusDateRange(myDataSet.getDateRange().getStart(), pDate);</span>
<span class="nc" id="L252">        theEvents = pBase.getEvents();</span>
<span class="nc" id="L253">        theCursor = null;</span>

        /* Access the TaxYearCache */
<span class="nc" id="L256">        theTaxYearCache = (MoneyWiseUKTaxYearCache) myDataSet.getTaxFactory();</span>

        /* Create a new set of buckets */
<span class="nc" id="L259">        theDeposits = new MoneyWiseXAnalysisDepositBucketList(this, pBase.getDeposits(), pDate);</span>
<span class="nc" id="L260">        theCash = new MoneyWiseXAnalysisCashBucketList(this, pBase.getCash(), pDate);</span>
<span class="nc" id="L261">        theLoans = new MoneyWiseXAnalysisLoanBucketList(this, pBase.getLoans(), pDate);</span>
<span class="nc" id="L262">        thePortfolios = new MoneyWiseXAnalysisPortfolioBucketList(this, pBase.getPortfolios(), pDate);</span>
<span class="nc" id="L263">        thePayees = new MoneyWiseXAnalysisPayeeBucketList(this, pBase.getPayees(), pDate);</span>
<span class="nc" id="L264">        theTaxBasis = new MoneyWiseXAnalysisTaxBasisBucketList(this, pBase.getTaxBasis(), pDate);</span>
<span class="nc" id="L265">        theTransCategories = new MoneyWiseXAnalysisTransCategoryBucketList(this, pBase.getTransCategories(), pDate);</span>
<span class="nc" id="L266">        theTransTags = new MoneyWiseXAnalysisTransTagBucketList(this, pBase.getTransactionTags(), pDate);</span>

        /* Create totalling buckets */
<span class="nc" id="L269">        theDepositCategories = new MoneyWiseXAnalysisDepositCategoryBucketList(this);</span>
<span class="nc" id="L270">        theCashCategories = new MoneyWiseXAnalysisCashCategoryBucketList(this);</span>
<span class="nc" id="L271">        theLoanCategories = new MoneyWiseXAnalysisLoanCategoryBucketList(this);</span>
<span class="nc" id="L272">        theTaxAnalysis = null;</span>
<span class="nc" id="L273">    }</span>

    /**
     * Constructor for a ranged analysis.
     *
     * @param pBase  the base analysis
     * @param pRange the range for the analysis
     */
    public MoneyWiseXAnalysis(final MoneyWiseXAnalysis pBase,
<span class="nc" id="L282">                              final OceanusDateRange pRange) {</span>
        /* Store the data */
<span class="nc" id="L284">        theEditSet = pBase.getEditSet();</span>
<span class="nc" id="L285">        final MoneyWiseDataSet myDataSet = getData();</span>
<span class="nc" id="L286">        theCurrency = pBase.getCurrency();</span>
<span class="nc" id="L287">        thePreferences = pBase.getPreferenceMgr();</span>
<span class="nc" id="L288">        theDateRange = pRange;</span>
<span class="nc" id="L289">        theEvents = pBase.getEvents();</span>
<span class="nc" id="L290">        theCursor = null;</span>

        /* Access the TaxYearCache */
<span class="nc" id="L293">        theTaxYearCache = (MoneyWiseUKTaxYearCache) myDataSet.getTaxFactory();</span>

        /* Create a new set of buckets */
<span class="nc" id="L296">        theDeposits = new MoneyWiseXAnalysisDepositBucketList(this, pBase.getDeposits(), pRange);</span>
<span class="nc" id="L297">        theCash = new MoneyWiseXAnalysisCashBucketList(this, pBase.getCash(), pRange);</span>
<span class="nc" id="L298">        theLoans = new MoneyWiseXAnalysisLoanBucketList(this, pBase.getLoans(), pRange);</span>
<span class="nc" id="L299">        thePortfolios = new MoneyWiseXAnalysisPortfolioBucketList(this, pBase.getPortfolios(), pRange);</span>
<span class="nc" id="L300">        thePayees = new MoneyWiseXAnalysisPayeeBucketList(this, pBase.getPayees(), pRange);</span>
<span class="nc" id="L301">        theTaxBasis = new MoneyWiseXAnalysisTaxBasisBucketList(this, pBase.getTaxBasis(), pRange);</span>
<span class="nc" id="L302">        theTransCategories = new MoneyWiseXAnalysisTransCategoryBucketList(this, pBase.getTransCategories(), pRange);</span>
<span class="nc" id="L303">        theTransTags = new MoneyWiseXAnalysisTransTagBucketList(this, pBase.getTransactionTags(), pRange);</span>

        /* Create totalling buckets */
<span class="nc" id="L306">        theDepositCategories = new MoneyWiseXAnalysisDepositCategoryBucketList(this);</span>
<span class="nc" id="L307">        theCashCategories = new MoneyWiseXAnalysisCashCategoryBucketList(this);</span>
<span class="nc" id="L308">        theLoanCategories = new MoneyWiseXAnalysisLoanCategoryBucketList(this);</span>

        /* Handle new tax calculations */
<span class="nc" id="L311">        final MoneyWiseTaxYear myYear = (MoneyWiseTaxYear) theTaxYearCache.findTaxYearForRange(theDateRange);</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">        theTaxAnalysis = myYear != null</span>
<span class="nc" id="L313">                ? myYear.analyseTaxYear(thePreferences, theTaxBasis)</span>
<span class="nc" id="L314">                : null;</span>
<span class="nc" id="L315">    }</span>

    /**
     * Is the analysis manager idle?
     *
     * @return true/false
     */
    public boolean isIdle() {
<span class="nc bnc" id="L323" title="All 2 branches missed.">        return theCurrency == null;</span>
    }

    @Override
    public MetisFieldSet&lt;MoneyWiseXAnalysis&gt; getDataFieldSet() {
<span class="nc" id="L328">        return FIELD_DEFS;</span>
    }

    @Override
    public String formatObject(final OceanusDataFormatter pFormatter) {
<span class="nc" id="L333">        return FIELD_DEFS.getName();</span>
    }

    /**
     * Do we have a foreign currency?
     *
     * @return true/false
     */
    public Boolean haveForeignCurrency() {
<span class="nc" id="L342">        return haveForeignCurrency;</span>
    }

    /**
     * Do we have active securities?
     *
     * @return true/false
     */
    public Boolean haveActiveSecurities() {
<span class="nc" id="L351">        return haveActiveSecurities;</span>
    }

    /**
     * Obtain the editSet.
     *
     * @return the editSet
     */
    public PrometheusEditSet getEditSet() {
<span class="fc" id="L360">        return theEditSet;</span>
    }

    /**
     * Obtain the events.
     *
     * @return the events
     */
    public MoneyWiseXAnalysisEventList getEvents() {
<span class="fc" id="L369">        return theEvents;</span>
    }

    /**
     * Set the events.
     *
     * @param pEvents the events
     */
    public void setEvents(final MoneyWiseXAnalysisEventList pEvents) {
<span class="fc" id="L378">        theEvents = pEvents;</span>
<span class="fc" id="L379">    }</span>

    /**
     * Obtain the cursor.
     *
     * @return the cursor
     */
    public MoneyWiseXAnalysisCursor getCursor() {
<span class="fc" id="L387">        return theCursor;</span>
    }

    /**
     * Obtain the data.
     *
     * @return the data
     */
    public MoneyWiseDataSet getData() {
<span class="fc" id="L396">        return (MoneyWiseDataSet) theEditSet.getDataSet();</span>
    }

    /**
     * Obtain the currency.
     *
     * @return the currency
     */
    private MoneyWiseTaxYearCache getTaxYearCache() {
<span class="nc" id="L405">        return theTaxYearCache;</span>
    }

    /**
     * Obtain the currency.
     *
     * @return the currency
     */
    public MoneyWiseCurrency getCurrency() {
<span class="fc" id="L414">        return theCurrency;</span>
    }

    /**
     * Obtain the preference manager.
     *
     * @return the data
     */
    public MetisPreferenceManager getPreferenceMgr() {
<span class="nc" id="L423">        return thePreferences;</span>
    }

    /**
     * Obtain the date range.
     *
     * @return the date range
     */
    public OceanusDateRange getDateRange() {
<span class="nc" id="L432">        return theDateRange;</span>
    }

    /**
     * Is this a ranged analysis?
     *
     * @return true/false
     */
    public boolean isRangedAnalysis() {
<span class="nc bnc" id="L441" title="All 2 branches missed.">        return theDateRange.getStart() == null;</span>
    }

    /**
     * Obtain the deposit buckets list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisDepositBucketList getDeposits() {
<span class="fc" id="L450">        return theDeposits;</span>
    }

    /**
     * Obtain the cash buckets list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisCashBucketList getCash() {
<span class="fc" id="L459">        return theCash;</span>
    }

    /**
     * Obtain the loan buckets list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisLoanBucketList getLoans() {
<span class="fc" id="L468">        return theLoans;</span>
    }

    /**
     * Obtain the portfolio buckets list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisPortfolioBucketList getPortfolios() {
<span class="fc" id="L477">        return thePortfolios;</span>
    }

    /**
     * Obtain the payee buckets list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisPayeeBucketList getPayees() {
<span class="fc" id="L486">        return thePayees;</span>
    }

    /**
     * Obtain the deposit categories list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisDepositCategoryBucketList getDepositCategories() {
<span class="fc" id="L495">        return theDepositCategories;</span>
    }

    /**
     * Obtain the cash categories list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisCashCategoryBucketList getCashCategories() {
<span class="fc" id="L504">        return theCashCategories;</span>
    }

    /**
     * Obtain the loan categories list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisLoanCategoryBucketList getLoanCategories() {
<span class="fc" id="L513">        return theLoanCategories;</span>
    }

    /**
     * Obtain the transaction categories list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisTransCategoryBucketList getTransCategories() {
<span class="fc" id="L522">        return theTransCategories;</span>
    }

    /**
     * Obtain the transactionTag list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisTransTagBucketList getTransactionTags() {
<span class="nc" id="L531">        return theTransTags;</span>
    }

    /**
     * Obtain the tax basis list.
     *
     * @return the list
     */
    public MoneyWiseXAnalysisTaxBasisBucketList getTaxBasis() {
<span class="fc" id="L540">        return theTaxBasis;</span>
    }

    /**
     * Obtain the tax analysis.
     *
     * @return the analysis
     */
    public MoneyWiseTaxAnalysis getTaxAnalysis() {
<span class="nc" id="L549">        return theTaxAnalysis;</span>
    }

    /**
     * Produce Totals.
     */
    public void produceTotals() {
        /* Analyse the deposits */
<span class="fc" id="L557">        theDepositCategories.analyseDeposits(theDeposits);</span>
<span class="fc" id="L558">        theDepositCategories.produceTotals();</span>
<span class="fc" id="L559">        haveForeignCurrency = theDepositCategories.haveForeignCurrency();</span>

        /* Analyse the cash */
<span class="fc" id="L562">        theCashCategories.analyseCash(theCash);</span>
<span class="fc" id="L563">        theCashCategories.produceTotals();</span>
<span class="fc" id="L564">        haveForeignCurrency |= theCashCategories.haveForeignCurrency();</span>

        /* Analyse the loans */
<span class="fc" id="L567">        theLoanCategories.analyseLoans(theLoans);</span>
<span class="fc" id="L568">        theLoanCategories.produceTotals();</span>
<span class="fc" id="L569">        haveForeignCurrency |= theLoanCategories.haveForeignCurrency();</span>

        /* Analyse the securities */
<span class="fc" id="L572">        thePortfolios.analyseSecurities();</span>
<span class="fc" id="L573">        haveForeignCurrency |= thePortfolios.haveForeignCurrency();</span>
<span class="fc" id="L574">        haveActiveSecurities = thePortfolios.haveActiveSecurities();</span>

        /* Analyse the Payees */
<span class="fc" id="L577">        thePayees.produceTotals();</span>

        /* Analyse the TransactionCategories */
<span class="fc" id="L580">        theTransCategories.produceTotals();</span>

        /* Analyse the TaxBasis */
<span class="fc" id="L583">        theTaxBasis.produceTotals();</span>

        /* Sort the transaction Tag list */
<span class="fc" id="L586">        theTransTags.sortBuckets();</span>
<span class="fc" id="L587">    }</span>

    /**
     * Check totals.
     */
    public void checkTotals() {
        /* Obtain Totals bucket */
<span class="fc" id="L594">        final MoneyWiseXAnalysisDepositCategoryBucket myDepCat = theDepositCategories.getTotals();</span>
<span class="fc" id="L595">        final MoneyWiseXAnalysisCashCategoryBucket myCashCat = theCashCategories.getTotals();</span>
<span class="fc" id="L596">        final MoneyWiseXAnalysisLoanCategoryBucket myLoanCat = theLoanCategories.getTotals();</span>
<span class="fc" id="L597">        final MoneyWiseXAnalysisPortfolioBucket myPort = thePortfolios.getTotals();</span>
<span class="fc" id="L598">        final MoneyWiseXAnalysisPayeeBucket myPayee = thePayees.getTotals();</span>
<span class="fc" id="L599">        final MoneyWiseXAnalysisTransCategoryBucket myTrans = theTransCategories.getTotals();</span>
<span class="fc" id="L600">        final MoneyWiseXAnalysisTaxBasisBucket myTax = theTaxBasis.getTotals();</span>

        /* Handle null data */
<span class="pc bpc" id="L603" title="1 of 2 branches missed.">        if (myDepCat == null) {</span>
<span class="nc" id="L604">            return;</span>
        }

        /* Access totals */
<span class="fc" id="L608">        OceanusMoney myDepTotal = myDepCat.getValues().getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA);</span>
<span class="fc" id="L609">        final OceanusMoney myCashTotal = myCashCat.getValues().getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA);</span>
<span class="fc" id="L610">        final OceanusMoney myLoanTotal = myLoanCat.getValues().getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA);</span>
<span class="fc" id="L611">        final OceanusMoney myPortTotal = myPort.getValues().getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUEDELTA);</span>
<span class="fc" id="L612">        final OceanusMoney myPayTotal = myPayee.getValues().getMoneyValue(MoneyWiseXAnalysisPayeeAttr.PROFIT);</span>
<span class="fc" id="L613">        final OceanusMoney myEvtTotal = myTrans.getValues().getMoneyValue(MoneyWiseXAnalysisTransAttr.PROFIT);</span>
<span class="fc" id="L614">        final OceanusMoney myTaxTotal = myTax.getValues().getMoneyValue(MoneyWiseXAnalysisTaxBasisAttr.GROSS);</span>

        /* Create a copy */
<span class="fc" id="L617">        myDepTotal = new OceanusMoney(myDepTotal);</span>

        /* Add sub-accounts */
<span class="fc" id="L620">        myDepTotal.addAmount(myCashTotal);</span>
<span class="fc" id="L621">        myDepTotal.addAmount(myLoanTotal);</span>
<span class="fc" id="L622">        myDepTotal.addAmount(myPortTotal);</span>

        /* Check identities */
<span class="fc bfc" id="L625" title="All 2 branches covered.">        if (!myDepTotal.equals(myPayTotal)) {</span>
<span class="fc" id="L626">            LOGGER.error(&quot;Payee total mismatch&quot;);</span>
        }
<span class="fc bfc" id="L628" title="All 2 branches covered.">        if (!myDepTotal.equals(myEvtTotal)) {</span>
<span class="fc" id="L629">            LOGGER.error(&quot;TransactionCategory total mismatch&quot;);</span>
        }
<span class="fc bfc" id="L631" title="All 2 branches covered.">        if (!myDepTotal.equals(myTaxTotal)) {</span>
<span class="fc" id="L632">            LOGGER.error(&quot;TaxBasis total mismatch&quot;);</span>
        }
<span class="fc" id="L634">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>