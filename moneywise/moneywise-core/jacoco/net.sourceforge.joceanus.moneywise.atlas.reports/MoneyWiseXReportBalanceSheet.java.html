<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MoneyWiseXReportBalanceSheet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MoneyWise Personal Finance - Core</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.moneywise.atlas.reports</a> &gt; <span class="el_source">MoneyWiseXReportBalanceSheet.java</span></div><h1>MoneyWiseXReportBalanceSheet.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * MoneyWise: Finance Application
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.moneywise.atlas.reports;

import net.sourceforge.joceanus.metis.data.MetisDataDifference;
import net.sourceforge.joceanus.metis.report.MetisReportBase;
import net.sourceforge.joceanus.metis.report.MetisReportHTMLBuilder;
import net.sourceforge.joceanus.metis.report.MetisReportHTMLBuilder.MetisHTMLTable;
import net.sourceforge.joceanus.metis.report.MetisReportManager;
import net.sourceforge.joceanus.metis.report.MetisReportReferenceManager.DelayedTable;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysis;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisCashBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisCashBucket.MoneyWiseXAnalysisCashBucketList;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisCashCategoryBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisCashCategoryBucket.MoneyWiseXAnalysisCashCategoryBucketList;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisDepositBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisDepositBucket.MoneyWiseXAnalysisDepositBucketList;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisDepositCategoryBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisDepositCategoryBucket.MoneyWiseXAnalysisDepositCategoryBucketList;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisLoanBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisLoanBucket.MoneyWiseXAnalysisLoanBucketList;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisLoanCategoryBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisLoanCategoryBucket.MoneyWiseXAnalysisLoanCategoryBucketList;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisPortfolioBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisPortfolioBucket.MoneyWiseXAnalysisPortfolioBucketList;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisPortfolioCashBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisSecurityBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisSecurityBucket.MoneyWiseXAnalysisSecurityBucketList;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.values.MoneyWiseXAnalysisAccountAttr;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.values.MoneyWiseXAnalysisAccountValues;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.values.MoneyWiseXAnalysisSecurityAttr;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.values.MoneyWiseXAnalysisSecurityValues;
import net.sourceforge.joceanus.moneywise.atlas.views.MoneyWiseXAnalysisFilter;
import net.sourceforge.joceanus.moneywise.atlas.views.MoneyWiseXAnalysisFilter.MoneyWiseXAnalysisCashFilter;
import net.sourceforge.joceanus.moneywise.atlas.views.MoneyWiseXAnalysisFilter.MoneyWiseXAnalysisDepositFilter;
import net.sourceforge.joceanus.moneywise.atlas.views.MoneyWiseXAnalysisFilter.MoneyWiseXAnalysisLoanFilter;
import net.sourceforge.joceanus.moneywise.atlas.views.MoneyWiseXAnalysisFilter.MoneyWiseXAnalysisPortfolioCashFilter;
import net.sourceforge.joceanus.moneywise.atlas.views.MoneyWiseXAnalysisFilter.MoneyWiseXAnalysisSecurityFilter;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseBasicDataType;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseBasicResource;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseCashCategory;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseDepositCategory;
import net.sourceforge.joceanus.moneywise.data.basic.MoneyWiseLoanCategory;
import net.sourceforge.joceanus.moneywise.data.statics.MoneyWiseCashCategoryClass;
import net.sourceforge.joceanus.moneywise.data.statics.MoneyWiseDepositCategoryClass;
import net.sourceforge.joceanus.moneywise.data.statics.MoneyWiseLoanCategoryClass;
import net.sourceforge.joceanus.oceanus.date.OceanusDateRange;
import net.sourceforge.joceanus.oceanus.decimal.OceanusMoney;
import net.sourceforge.joceanus.oceanus.format.OceanusDataFormatter;
import org.w3c.dom.Document;
import org.w3c.dom.Element;

import java.util.Iterator;

/**
 * BalanceSheet report builder.
 */
public class MoneyWiseXReportBalanceSheet
        extends MetisReportBase&lt;MoneyWiseXAnalysis, MoneyWiseXAnalysisFilter&lt;?, ?&gt;&gt; {
    /**
     * The Title text.
     */
<span class="nc" id="L77">    private static final String TEXT_TITLE = MoneyWiseXReportResource.BALANCESHEET_TITLE.getValue();</span>

    /**
     * The Portfolio cash account name.
     */
<span class="nc" id="L82">    protected static final String TEXT_CASH = MoneyWiseBasicResource.CASH_NAME.getValue();</span>

    /**
     * HTML builder.
     */
    private final MetisReportHTMLBuilder theBuilder;

    /**
     * The Formatter.
     */
    private final OceanusDataFormatter theFormatter;

    /**
     * Data Analysis.
     */
    private MoneyWiseXAnalysis theAnalysis;

    /**
     * Constructor.
     * @param pManager the Report Manager
     */
<span class="nc" id="L103">    MoneyWiseXReportBalanceSheet(final MetisReportManager&lt;MoneyWiseXAnalysisFilter&lt;?, ?&gt;&gt; pManager) {</span>
        /* Access underlying utilities */
<span class="nc" id="L105">        theBuilder = pManager.getBuilder();</span>
<span class="nc" id="L106">        theFormatter = theBuilder.getDataFormatter();</span>
<span class="nc" id="L107">    }</span>

    @Override
    public Document createReport(final MoneyWiseXAnalysis pAnalysis) {
        /* Access the bucket lists */
<span class="nc" id="L112">        theAnalysis = pAnalysis;</span>
<span class="nc" id="L113">        final MoneyWiseXAnalysisDepositCategoryBucketList myDeposits = theAnalysis.getDepositCategories();</span>
<span class="nc" id="L114">        final MoneyWiseXAnalysisCashCategoryBucketList myCash = theAnalysis.getCashCategories();</span>
<span class="nc" id="L115">        final MoneyWiseXAnalysisLoanCategoryBucketList myLoans = theAnalysis.getLoanCategories();</span>
<span class="nc" id="L116">        final MoneyWiseXAnalysisPortfolioBucketList myPortfolios = theAnalysis.getPortfolios();</span>
<span class="nc" id="L117">        final OceanusDateRange myDateRange = theAnalysis.getDateRange();</span>

        /* Create the totals */
<span class="nc" id="L120">        final OceanusMoney myTotal = new OceanusMoney();</span>
<span class="nc" id="L121">        final OceanusMoney myBase = new OceanusMoney();</span>
<span class="nc" id="L122">        final OceanusMoney myDelta = new OceanusMoney();</span>

        /* Start the report */
<span class="nc" id="L125">        final Element myBody = theBuilder.startReport();</span>
<span class="nc" id="L126">        theBuilder.makeTitle(myBody, TEXT_TITLE, theFormatter.formatObject(myDateRange));</span>

        /* Initialise the table */
<span class="nc" id="L129">        final MetisHTMLTable myTable = theBuilder.startTable(myBody);</span>
<span class="nc" id="L130">        theBuilder.startTotalRow(myTable);</span>
<span class="nc" id="L131">        theBuilder.makeTitleCell(myTable);</span>
<span class="nc" id="L132">        theBuilder.makeTitleCell(myTable, theFormatter.formatObject(myDateRange.getEnd()));</span>
<span class="nc" id="L133">        theBuilder.makeTitleCell(myTable, theFormatter.formatObject(myDateRange.getStart()));</span>
<span class="nc" id="L134">        theBuilder.makeTitleCell(myTable, MoneyWiseXReportBuilder.TEXT_PROFIT);</span>

        /* If we have deposits */
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (!myDeposits.isEmpty()) {</span>
            /* Loop through the SubTotal Buckets */
<span class="nc" id="L139">            final Iterator&lt;MoneyWiseXAnalysisDepositCategoryBucket&gt; myIterator = myDeposits.iterator();</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">            while (myIterator.hasNext()) {</span>
<span class="nc" id="L141">                final MoneyWiseXAnalysisDepositCategoryBucket myBucket = myIterator.next();</span>

                /* Only process subTotal items */
<span class="nc bnc" id="L144" title="All 2 branches missed.">                if (!myBucket.getAccountCategory().isCategoryClass(MoneyWiseDepositCategoryClass.PARENT)) {</span>
<span class="nc" id="L145">                    continue;</span>
                }

                /* Access values */
<span class="nc" id="L149">                final MoneyWiseXAnalysisAccountValues myValues = myBucket.getValues();</span>
<span class="nc" id="L150">                final MoneyWiseXAnalysisAccountValues myBaseValues = myBucket.getBaseValues();</span>

                /* Format the Category Total */
<span class="nc" id="L153">                theBuilder.startRow(myTable);</span>
<span class="nc" id="L154">                theBuilder.makeTableLinkCell(myTable, myBucket.getName());</span>
<span class="nc" id="L155">                theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L156">                theBuilder.makeTotalCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L157">                theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>

                /* Add the category report */
<span class="nc" id="L160">                makeDepositCategoryReport(myTable, myBucket);</span>
<span class="nc" id="L161">            }</span>

            /* Access totals */
<span class="nc" id="L164">            final MoneyWiseXAnalysisDepositCategoryBucket myTotals = myDeposits.getTotals();</span>
<span class="nc" id="L165">            final MoneyWiseXAnalysisAccountValues myValues = myTotals.getValues();</span>
<span class="nc" id="L166">            final MoneyWiseXAnalysisAccountValues myBaseValues = myTotals.getBaseValues();</span>

            /* Add to running totals */
<span class="nc" id="L169">            myTotal.addAmount(myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L170">            myBase.addAmount(myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L171">            myDelta.addAmount(myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>
        }

        /* If we have cash */
<span class="nc bnc" id="L175" title="All 2 branches missed.">        if (!myCash.isEmpty()) {</span>
            /* Loop through the SubTotal Buckets */
<span class="nc" id="L177">            final Iterator&lt;MoneyWiseXAnalysisCashCategoryBucket&gt; myIterator = myCash.iterator();</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            while (myIterator.hasNext()) {</span>
<span class="nc" id="L179">                final MoneyWiseXAnalysisCashCategoryBucket myBucket = myIterator.next();</span>

                /* Only process subTotal items */
<span class="nc bnc" id="L182" title="All 2 branches missed.">                if (!myBucket.getAccountCategory().isCategoryClass(MoneyWiseCashCategoryClass.PARENT)) {</span>
<span class="nc" id="L183">                    continue;</span>
                }

                /* Access values */
<span class="nc" id="L187">                final MoneyWiseXAnalysisAccountValues myValues = myBucket.getValues();</span>
<span class="nc" id="L188">                final MoneyWiseXAnalysisAccountValues myBaseValues = myBucket.getBaseValues();</span>

                /* Format the Category Total */
<span class="nc" id="L191">                theBuilder.startRow(myTable);</span>
<span class="nc" id="L192">                theBuilder.makeTableLinkCell(myTable, myBucket.getName());</span>
<span class="nc" id="L193">                theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L194">                theBuilder.makeTotalCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L195">                theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>

                /* Add the category report */
<span class="nc" id="L198">                makeCashCategoryReport(myTable, myBucket);</span>
<span class="nc" id="L199">            }</span>

            /* Access totals */
<span class="nc" id="L202">            final MoneyWiseXAnalysisCashCategoryBucket myTotals = myCash.getTotals();</span>
<span class="nc" id="L203">            final MoneyWiseXAnalysisAccountValues myValues = myTotals.getValues();</span>
<span class="nc" id="L204">            final MoneyWiseXAnalysisAccountValues myBaseValues = myTotals.getBaseValues();</span>

            /* Add to running totals */
<span class="nc" id="L207">            myTotal.addAmount(myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L208">            myBase.addAmount(myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L209">            myDelta.addAmount(myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>
        }

        /* If we have portfolios */
<span class="nc bnc" id="L213" title="All 2 branches missed.">        if (!myPortfolios.isEmpty()) {</span>
            /* Access totals */
<span class="nc" id="L215">            final MoneyWiseXAnalysisPortfolioBucket myTotals = myPortfolios.getTotals();</span>
<span class="nc" id="L216">            final MoneyWiseXAnalysisSecurityValues myValues = myTotals.getValues();</span>
<span class="nc" id="L217">            final MoneyWiseXAnalysisSecurityValues myBaseValues = myTotals.getBaseValues();</span>

            /* Access interesting values */
<span class="nc" id="L220">            final OceanusMoney myValuation = myValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUATION);</span>
<span class="nc" id="L221">            final OceanusMoney myBaseValuation = myBaseValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUATION);</span>
<span class="nc" id="L222">            final OceanusMoney myDeltaValuation = myValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUEDELTA);</span>

            /* Format the Portfolios Total */
<span class="nc" id="L225">            theBuilder.startRow(myTable);</span>
<span class="nc" id="L226">            theBuilder.makeTableLinkCell(myTable, MoneyWiseBasicDataType.PORTFOLIO.getListName());</span>
<span class="nc" id="L227">            theBuilder.makeTotalCell(myTable, myValuation);</span>
<span class="nc" id="L228">            theBuilder.makeTotalCell(myTable, myBaseValuation);</span>
<span class="nc" id="L229">            theBuilder.makeTotalCell(myTable, myDeltaValuation);</span>

            /* Make the portfolio report */
<span class="nc" id="L232">            makePortfolioReport(myTable);</span>

            /* Add to running totals */
<span class="nc" id="L235">            myTotal.addAmount(myValuation);</span>
<span class="nc" id="L236">            myBase.addAmount(myBaseValuation);</span>
<span class="nc" id="L237">            myDelta.addAmount(myDeltaValuation);</span>
        }

        /* If we have loans */
<span class="nc bnc" id="L241" title="All 2 branches missed.">        if (!myLoans.isEmpty()) {</span>
            /* Loop through the SubTotal Buckets */
<span class="nc" id="L243">            final Iterator&lt;MoneyWiseXAnalysisLoanCategoryBucket&gt; myIterator = myLoans.iterator();</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">            while (myIterator.hasNext()) {</span>
<span class="nc" id="L245">                final MoneyWiseXAnalysisLoanCategoryBucket myBucket = myIterator.next();</span>

                /* Only process subTotal items */
<span class="nc bnc" id="L248" title="All 2 branches missed.">                if (!myBucket.getAccountCategory().isCategoryClass(MoneyWiseLoanCategoryClass.PARENT)) {</span>
<span class="nc" id="L249">                    continue;</span>
                }

                /* Access values */
<span class="nc" id="L253">                final MoneyWiseXAnalysisAccountValues myValues = myBucket.getValues();</span>
<span class="nc" id="L254">                final MoneyWiseXAnalysisAccountValues myBaseValues = myBucket.getBaseValues();</span>

                /* Format the Category Total */
<span class="nc" id="L257">                theBuilder.startRow(myTable);</span>
<span class="nc" id="L258">                theBuilder.makeTableLinkCell(myTable, myBucket.getName());</span>
<span class="nc" id="L259">                theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L260">                theBuilder.makeTotalCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L261">                theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>

                /* Add the category report */
<span class="nc" id="L264">                makeLoanCategoryReport(myTable, myBucket);</span>
<span class="nc" id="L265">            }</span>

            /* Access totals */
<span class="nc" id="L268">            final MoneyWiseXAnalysisLoanCategoryBucket myTotals = myLoans.getTotals();</span>
<span class="nc" id="L269">            final MoneyWiseXAnalysisAccountValues myValues = myTotals.getValues();</span>
<span class="nc" id="L270">            final MoneyWiseXAnalysisAccountValues myBaseValues = myTotals.getBaseValues();</span>

            /* Add to running totals */
<span class="nc" id="L273">            myTotal.addAmount(myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L274">            myBase.addAmount(myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L275">            myDelta.addAmount(myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>
        }

        /* Format the total */
<span class="nc" id="L279">        theBuilder.startTotalRow(myTable);</span>
<span class="nc" id="L280">        theBuilder.makeTitleCell(myTable, MoneyWiseXReportBuilder.TEXT_TOTAL);</span>
<span class="nc" id="L281">        theBuilder.makeTotalCell(myTable, myTotal);</span>
<span class="nc" id="L282">        theBuilder.makeTotalCell(myTable, myBase);</span>
<span class="nc" id="L283">        theBuilder.makeTotalCell(myTable, myDelta);</span>

        /* Return the document */
<span class="nc" id="L286">        return theBuilder.getDocument();</span>
    }

    /**
     * Build a category report.
     * @param pParent the table parent
     * @param pCategory the category bucket
     */
    private void makeDepositCategoryReport(final MetisHTMLTable pParent,
                                           final MoneyWiseXAnalysisDepositCategoryBucket pCategory) {
        /* Access the category */
<span class="nc" id="L297">        final MoneyWiseXAnalysisDepositCategoryBucketList myCategories = theAnalysis.getDepositCategories();</span>
<span class="nc" id="L298">        final MoneyWiseDepositCategory myCategory = pCategory.getAccountCategory();</span>

        /* Create an embedded table */
<span class="nc" id="L301">        final MetisHTMLTable myTable = theBuilder.createEmbeddedTable(pParent);</span>

        /* Loop through the Category Buckets */
<span class="nc" id="L304">        final Iterator&lt;MoneyWiseXAnalysisDepositCategoryBucket&gt; myIterator = myCategories.iterator();</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">        while (myIterator.hasNext()) {</span>
<span class="nc" id="L306">            final MoneyWiseXAnalysisDepositCategoryBucket myBucket = myIterator.next();</span>

            /* Skip record if incorrect category */
<span class="nc" id="L309">            final MoneyWiseDepositCategory myCurr = myBucket.getAccountCategory();</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">            if (!MetisDataDifference.isEqual(myCurr.getParentCategory(), myCategory)) {</span>
<span class="nc" id="L311">                continue;</span>
            }

            /* Access bucket name */
<span class="nc" id="L315">            final String myName = myBucket.getName();</span>

            /* Access values */
<span class="nc" id="L318">            final MoneyWiseXAnalysisAccountValues myValues = myBucket.getValues();</span>
<span class="nc" id="L319">            final MoneyWiseXAnalysisAccountValues myBaseValues = myBucket.getBaseValues();</span>

            /* Create the SubCategory row */
<span class="nc" id="L322">            theBuilder.startRow(myTable);</span>
<span class="nc" id="L323">            theBuilder.makeDelayLinkCell(myTable, myName, myCurr.getSubCategory());</span>
<span class="nc" id="L324">            theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L325">            theBuilder.makeTotalCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L326">            theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>

            /* Note the delayed subTable */
<span class="nc" id="L329">            setDelayedTable(myName, myTable, myBucket);</span>
<span class="nc" id="L330">        }</span>

        /* Embed the table correctly */
<span class="nc" id="L333">        theBuilder.embedTable(myTable, pCategory.getName());</span>
<span class="nc" id="L334">    }</span>

    /**
     * Build a category report.
     * @param pParent the table parent
     * @param pCategory the category bucket
     */
    private void makeCashCategoryReport(final MetisHTMLTable pParent,
                                        final MoneyWiseXAnalysisCashCategoryBucket pCategory) {
        /* Access the category */
<span class="nc" id="L344">        final MoneyWiseXAnalysisCashCategoryBucketList myCategories = theAnalysis.getCashCategories();</span>
<span class="nc" id="L345">        final MoneyWiseCashCategory myCategory = pCategory.getAccountCategory();</span>

        /* Create an embedded table */
<span class="nc" id="L348">        final MetisHTMLTable myTable = theBuilder.createEmbeddedTable(pParent);</span>

        /* Loop through the Category Buckets */
<span class="nc" id="L351">        final Iterator&lt;MoneyWiseXAnalysisCashCategoryBucket&gt; myIterator = myCategories.iterator();</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">        while (myIterator.hasNext()) {</span>
<span class="nc" id="L353">            final MoneyWiseXAnalysisCashCategoryBucket myBucket = myIterator.next();</span>

            /* Skip record if incorrect category */
<span class="nc" id="L356">            final MoneyWiseCashCategory myCurr = myBucket.getAccountCategory();</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">            if (!MetisDataDifference.isEqual(myCurr.getParentCategory(), myCategory)) {</span>
<span class="nc" id="L358">                continue;</span>
            }

            /* Access bucket name */
<span class="nc" id="L362">            final String myName = myBucket.getName();</span>

            /* Access values */
<span class="nc" id="L365">            final MoneyWiseXAnalysisAccountValues myValues = myBucket.getValues();</span>
<span class="nc" id="L366">            final MoneyWiseXAnalysisAccountValues myBaseValues = myBucket.getBaseValues();</span>

            /* Create the SubCategory row */
<span class="nc" id="L369">            theBuilder.startRow(myTable);</span>
<span class="nc" id="L370">            theBuilder.makeDelayLinkCell(myTable, myName, myCurr.getSubCategory());</span>
<span class="nc" id="L371">            theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L372">            theBuilder.makeTotalCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L373">            theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>

            /* Note the delayed subTable */
<span class="nc" id="L376">            setDelayedTable(myName, myTable, myBucket);</span>
<span class="nc" id="L377">        }</span>

        /* Embed the table correctly */
<span class="nc" id="L380">        theBuilder.embedTable(myTable, pCategory.getName());</span>
<span class="nc" id="L381">    }</span>

    /**
     * Build a category report.
     * @param pParent the table parent
     * @param pCategory the category bucket
     */
    private void makeLoanCategoryReport(final MetisHTMLTable pParent,
                                        final MoneyWiseXAnalysisLoanCategoryBucket pCategory) {
        /* Access the category */
<span class="nc" id="L391">        final MoneyWiseXAnalysisLoanCategoryBucketList myCategories = theAnalysis.getLoanCategories();</span>
<span class="nc" id="L392">        final MoneyWiseLoanCategory myCategory = pCategory.getAccountCategory();</span>

        /* Create an embedded table */
<span class="nc" id="L395">        final MetisHTMLTable myTable = theBuilder.createEmbeddedTable(pParent);</span>

        /* Loop through the Category Buckets */
<span class="nc" id="L398">        final Iterator&lt;MoneyWiseXAnalysisLoanCategoryBucket&gt; myIterator = myCategories.iterator();</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">        while (myIterator.hasNext()) {</span>
<span class="nc" id="L400">            final MoneyWiseXAnalysisLoanCategoryBucket myBucket = myIterator.next();</span>

            /* Skip record if incorrect category */
<span class="nc" id="L403">            final MoneyWiseLoanCategory myCurr = myBucket.getAccountCategory();</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">            if (!MetisDataDifference.isEqual(myCurr.getParentCategory(), myCategory)) {</span>
<span class="nc" id="L405">                continue;</span>
            }

            /* Access bucket name */
<span class="nc" id="L409">            final String myName = myBucket.getName();</span>

            /* Access values */
<span class="nc" id="L412">            final MoneyWiseXAnalysisAccountValues myValues = myBucket.getValues();</span>
<span class="nc" id="L413">            final MoneyWiseXAnalysisAccountValues myBaseValues = myBucket.getBaseValues();</span>

            /* Create the SubCategory row */
<span class="nc" id="L416">            theBuilder.startRow(myTable);</span>
<span class="nc" id="L417">            theBuilder.makeDelayLinkCell(myTable, myName, myCurr.getSubCategory());</span>
<span class="nc" id="L418">            theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L419">            theBuilder.makeTotalCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L420">            theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>

            /* Note the delayed subTable */
<span class="nc" id="L423">            setDelayedTable(myName, myTable, myBucket);</span>
<span class="nc" id="L424">        }</span>

        /* Embed the table correctly */
<span class="nc" id="L427">        theBuilder.embedTable(myTable, pCategory.getName());</span>
<span class="nc" id="L428">    }</span>

    /**
     * Build a portfolio report.
     * @param pParent the table parent
     */
    private void makePortfolioReport(final MetisHTMLTable pParent) {
        /* Access the portfolios */
<span class="nc" id="L436">        final MoneyWiseXAnalysisPortfolioBucketList myPortfolios = theAnalysis.getPortfolios();</span>

        /* Create an embedded table */
<span class="nc" id="L439">        final MetisHTMLTable myTable = theBuilder.createEmbeddedTable(pParent);</span>

        /* Loop through the Portfolio Buckets */
<span class="nc" id="L442">        final Iterator&lt;MoneyWiseXAnalysisPortfolioBucket&gt; myIterator = myPortfolios.iterator();</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">        while (myIterator.hasNext()) {</span>
<span class="nc" id="L444">            final MoneyWiseXAnalysisPortfolioBucket myBucket = myIterator.next();</span>

            /* Access bucket name */
<span class="nc" id="L447">            final String myName = myBucket.getName();</span>

            /* Access values */
<span class="nc" id="L450">            final MoneyWiseXAnalysisSecurityValues myValues = myBucket.getValues();</span>
<span class="nc" id="L451">            final MoneyWiseXAnalysisSecurityValues myBaseValues = myBucket.getBaseValues();</span>

            /* Create the SubCategory row */
<span class="nc" id="L454">            theBuilder.startRow(myTable);</span>
<span class="nc" id="L455">            theBuilder.makeDelayLinkCell(myTable, myName);</span>
<span class="nc" id="L456">            theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUATION));</span>
<span class="nc" id="L457">            theBuilder.makeTotalCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUATION));</span>
<span class="nc" id="L458">            theBuilder.makeTotalCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUEDELTA));</span>

            /* Note the delayed subTable */
<span class="nc" id="L461">            setDelayedTable(myName, myTable, myBucket);</span>
<span class="nc" id="L462">        }</span>

        /* Embed the table correctly */
<span class="nc" id="L465">        theBuilder.embedTable(myTable, MoneyWiseBasicDataType.PORTFOLIO.getListName());</span>
<span class="nc" id="L466">    }</span>

    @Override
    public MetisHTMLTable createDelayedTable(final DelayedTable pTable) {
        /* Access the source */
<span class="nc" id="L471">        final Object mySource = pTable.getSource();</span>
<span class="nc bnc" id="L472" title="All 2 branches missed.">        if (mySource instanceof MoneyWiseXAnalysisDepositCategoryBucket mySourceBucket) {</span>
<span class="nc" id="L473">            return createDelayedDeposit(pTable.getParent(), mySourceBucket);</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">        } else if (mySource instanceof MoneyWiseXAnalysisCashCategoryBucket mySourceBucket) {</span>
<span class="nc" id="L475">            return createDelayedCash(pTable.getParent(), mySourceBucket);</span>
<span class="nc bnc" id="L476" title="All 2 branches missed.">        } else if (mySource instanceof MoneyWiseXAnalysisLoanCategoryBucket mySourceBucket) {</span>
<span class="nc" id="L477">            return createDelayedLoan(pTable.getParent(), mySourceBucket);</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">        } else if (mySource instanceof MoneyWiseXAnalysisPortfolioBucket mySourceBucket) {</span>
<span class="nc" id="L479">            return createDelayedPortfolio(pTable.getParent(), mySourceBucket);</span>
        }

        /* Return the null table */
<span class="nc" id="L483">        return null;</span>
    }

    /**
     * Create a delayed deposit category table.
     * @param pParent the parent table
     * @param pSource the source bucket
     * @return the new document fragment
     */
    private MetisHTMLTable createDelayedDeposit(final MetisHTMLTable pParent,
                                                final MoneyWiseXAnalysisDepositCategoryBucket pSource) {
        /* Access the category */
<span class="nc" id="L495">        final MoneyWiseXAnalysisDepositBucketList myDeposits = theAnalysis.getDeposits();</span>
<span class="nc" id="L496">        final MoneyWiseDepositCategory myCategory = pSource.getAccountCategory();</span>
<span class="nc" id="L497">        final boolean isForeign = pSource.hasForeignCurrency();</span>

        /* Create an embedded table */
<span class="nc" id="L500">        final MetisHTMLTable myTable = theBuilder.createEmbeddedTable(pParent);</span>

        /* Loop through the Deposit Buckets */
<span class="nc" id="L503">        final Iterator&lt;MoneyWiseXAnalysisDepositBucket&gt; myIterator = myDeposits.iterator();</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">        while (myIterator.hasNext()) {</span>
<span class="nc" id="L505">            final MoneyWiseXAnalysisDepositBucket myBucket = myIterator.next();</span>

            /* Skip record if incorrect category */
<span class="nc bnc" id="L508" title="All 2 branches missed.">            if (!MetisDataDifference.isEqual(myBucket.getCategory(), myCategory)) {</span>
<span class="nc" id="L509">                continue;</span>
            }

            /* Access bucket name */
<span class="nc" id="L513">            final String myName = myBucket.getName();</span>

            /* Access values */
<span class="nc" id="L516">            final MoneyWiseXAnalysisAccountValues myValues = myBucket.getValues();</span>
<span class="nc" id="L517">            final MoneyWiseXAnalysisAccountValues myBaseValues = myBucket.getBaseValues();</span>

            /* Create the detail row */
<span class="nc" id="L520">            theBuilder.startRow(myTable);</span>
<span class="nc" id="L521">            theBuilder.makeFilterLinkCell(myTable, myName);</span>

            /* Handle foreign accounts */
<span class="nc bnc" id="L524" title="All 2 branches missed.">            if (isForeign) {</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">                if (myBucket.isForeignCurrency()) {</span>
<span class="nc" id="L526">                    theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.BALANCE));</span>
<span class="nc" id="L527">                    theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L528">                    theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.BALANCE));</span>
<span class="nc" id="L529">                    theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
                } else {
<span class="nc" id="L531">                    theBuilder.makeStretchedValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L532">                    theBuilder.makeStretchedValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
                }
            } else {
<span class="nc" id="L535">                theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L536">                theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
            }
<span class="nc" id="L538">            theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>

            /* Record the filter */
<span class="nc" id="L541">            setFilterForId(myName, myBucket);</span>
<span class="nc" id="L542">        }</span>

        /* Return the table */
<span class="nc" id="L545">        return myTable;</span>
    }

    /**
     * Create a delayed cash category table.
     * @param pParent the parent table
     * @param pSource the source bucket
     * @return the new document fragment
     */
    private MetisHTMLTable createDelayedCash(final MetisHTMLTable pParent,
                                             final MoneyWiseXAnalysisCashCategoryBucket pSource) {
        /* Access the category */
<span class="nc" id="L557">        final MoneyWiseXAnalysisCashBucketList myCash = theAnalysis.getCash();</span>
<span class="nc" id="L558">        final MoneyWiseCashCategory myCategory = pSource.getAccountCategory();</span>
<span class="nc" id="L559">        final boolean isForeign = pSource.hasForeignCurrency();</span>

        /* Create an embedded table */
<span class="nc" id="L562">        final MetisHTMLTable myTable = theBuilder.createEmbeddedTable(pParent);</span>

        /* Loop through the Cash Buckets */
<span class="nc" id="L565">        final Iterator&lt;MoneyWiseXAnalysisCashBucket&gt; myIterator = myCash.iterator();</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">        while (myIterator.hasNext()) {</span>
<span class="nc" id="L567">            final MoneyWiseXAnalysisCashBucket myBucket = myIterator.next();</span>

            /* Skip record if incorrect category */
<span class="nc bnc" id="L570" title="All 2 branches missed.">            if (!MetisDataDifference.isEqual(myBucket.getCategory(), myCategory)) {</span>
<span class="nc" id="L571">                continue;</span>
            }

            /* Access bucket name */
<span class="nc" id="L575">            final String myName = myBucket.getName();</span>

            /* Access values */
<span class="nc" id="L578">            final MoneyWiseXAnalysisAccountValues myValues = myBucket.getValues();</span>
<span class="nc" id="L579">            final MoneyWiseXAnalysisAccountValues myBaseValues = myBucket.getBaseValues();</span>

            /* Create the detail row */
<span class="nc" id="L582">            theBuilder.startRow(myTable);</span>
<span class="nc" id="L583">            theBuilder.makeFilterLinkCell(myTable, myName);</span>

            /* Handle foreign accounts */
<span class="nc bnc" id="L586" title="All 2 branches missed.">            if (isForeign) {</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">                if (myBucket.isForeignCurrency()) {</span>
<span class="nc" id="L588">                    theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.BALANCE));</span>
<span class="nc" id="L589">                    theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L590">                    theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.BALANCE));</span>
<span class="nc" id="L591">                    theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
                } else {
<span class="nc" id="L593">                    theBuilder.makeStretchedValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L594">                    theBuilder.makeStretchedValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
                }
            } else {
<span class="nc" id="L597">                theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L598">                theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
            }
<span class="nc" id="L600">            theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>

            /* Record the filter */
<span class="nc" id="L603">            setFilterForId(myName, myBucket);</span>
<span class="nc" id="L604">        }</span>

        /* Return the table */
<span class="nc" id="L607">        return myTable;</span>
    }

    /**
     * Create a delayed loan category table.
     * @param pParent the parent table
     * @param pSource the source bucket
     * @return the new document fragment
     */
    private MetisHTMLTable createDelayedLoan(final MetisHTMLTable pParent,
                                             final MoneyWiseXAnalysisLoanCategoryBucket pSource) {
        /* Access the category */
<span class="nc" id="L619">        final MoneyWiseXAnalysisLoanBucketList myLoans = theAnalysis.getLoans();</span>
<span class="nc" id="L620">        final MoneyWiseLoanCategory myCategory = pSource.getAccountCategory();</span>
<span class="nc" id="L621">        final boolean isForeign = pSource.hasForeignCurrency();</span>

        /* Create an embedded table */
<span class="nc" id="L624">        final MetisHTMLTable myTable = theBuilder.createEmbeddedTable(pParent);</span>

        /* Loop through the Loan Buckets */
<span class="nc" id="L627">        final Iterator&lt;MoneyWiseXAnalysisLoanBucket&gt; myIterator = myLoans.iterator();</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">        while (myIterator.hasNext()) {</span>
<span class="nc" id="L629">            final MoneyWiseXAnalysisLoanBucket myBucket = myIterator.next();</span>

            /* Skip record if incorrect category */
<span class="nc bnc" id="L632" title="All 2 branches missed.">            if (!MetisDataDifference.isEqual(myBucket.getCategory(), myCategory)) {</span>
<span class="nc" id="L633">                continue;</span>
            }

            /* Access bucket name */
<span class="nc" id="L637">            final String myName = myBucket.getName();</span>

            /* Access values */
<span class="nc" id="L640">            final MoneyWiseXAnalysisAccountValues myValues = myBucket.getValues();</span>
<span class="nc" id="L641">            final MoneyWiseXAnalysisAccountValues myBaseValues = myBucket.getBaseValues();</span>

            /* Create the detail row */
<span class="nc" id="L644">            theBuilder.startRow(myTable);</span>
<span class="nc" id="L645">            theBuilder.makeFilterLinkCell(myTable, myName);</span>

            /* Handle foreign accounts */
<span class="nc bnc" id="L648" title="All 2 branches missed.">            if (isForeign) {</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">                if (myBucket.isForeignCurrency()) {</span>
<span class="nc" id="L650">                    theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.BALANCE));</span>
<span class="nc" id="L651">                    theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L652">                    theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.BALANCE));</span>
<span class="nc" id="L653">                    theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
                } else {
<span class="nc" id="L655">                    theBuilder.makeStretchedValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L656">                    theBuilder.makeStretchedValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
                }
            } else {
<span class="nc" id="L659">                theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L660">                theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
            }
<span class="nc" id="L662">            theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>

            /* Record the filter */
<span class="nc" id="L665">            setFilterForId(myName, myBucket);</span>
<span class="nc" id="L666">        }</span>

        /* Return the table */
<span class="nc" id="L669">        return myTable;</span>
    }

    /**
     * Create a delayed portfolio table.
     * @param pParent the parent table
     * @param pSource the source bucket
     * @return the new document fragment
     */
    private MetisHTMLTable createDelayedPortfolio(final MetisHTMLTable pParent,
                                                  final MoneyWiseXAnalysisPortfolioBucket pSource) {
        /* Access the securities */
<span class="nc" id="L681">        final MoneyWiseXAnalysisPortfolioCashBucket myCash = pSource.getPortfolioCash();</span>
<span class="nc" id="L682">        final MoneyWiseXAnalysisSecurityBucketList mySecurities = pSource.getSecurities();</span>
<span class="nc" id="L683">        final boolean isForeign = pSource.hasForeignCurrency();</span>

        /* Create an embedded table */
<span class="nc" id="L686">        final MetisHTMLTable myTable = theBuilder.createEmbeddedTable(pParent);</span>

        /* If the portfolio cash is not idle */
<span class="nc bnc" id="L689" title="All 2 branches missed.">        if (!myCash.isIdle()) {</span>
            /* Access values */
<span class="nc" id="L691">            final MoneyWiseXAnalysisAccountValues myValues = myCash.getValues();</span>
<span class="nc" id="L692">            final MoneyWiseXAnalysisAccountValues myBaseValues = myCash.getBaseValues();</span>

            /* Access bucket name */
<span class="nc" id="L695">            final String myName = pSource.getName();</span>

            /* Create the detail row */
<span class="nc" id="L698">            theBuilder.startRow(myTable);</span>
<span class="nc" id="L699">            theBuilder.makeFilterLinkCell(myTable, myName, TEXT_CASH);</span>

            /* Handle foreign accounts */
<span class="nc bnc" id="L702" title="All 2 branches missed.">            if (isForeign) {</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">                if (myCash.isForeignCurrency()) {</span>
<span class="nc" id="L704">                    theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.BALANCE));</span>
<span class="nc" id="L705">                    theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L706">                    theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.BALANCE));</span>
<span class="nc" id="L707">                    theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
                } else {
<span class="nc" id="L709">                    theBuilder.makeStretchedValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L710">                    theBuilder.makeStretchedValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
                }
            } else {
<span class="nc" id="L713">                theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
<span class="nc" id="L714">                theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUATION));</span>
            }
<span class="nc" id="L716">            theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisAccountAttr.VALUEDELTA));</span>

            /* Record the filter */
<span class="nc" id="L719">            setFilterForId(myName, pSource);</span>
        }

        /* Loop through the Security Buckets */
<span class="nc" id="L723">        final Iterator&lt;MoneyWiseXAnalysisSecurityBucket&gt; myIterator = mySecurities.iterator();</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">        while (myIterator.hasNext()) {</span>
<span class="nc" id="L725">            final MoneyWiseXAnalysisSecurityBucket myBucket = myIterator.next();</span>

            /* Access bucket name */
<span class="nc" id="L728">            final String myName = myBucket.getSecurityName();</span>
<span class="nc" id="L729">            String myFullName = myBucket.getDecoratedName();</span>
<span class="nc" id="L730">            myFullName = myFullName.replace(':', '-');</span>

            /* Access values */
<span class="nc" id="L733">            final MoneyWiseXAnalysisSecurityValues myValues = myBucket.getValues();</span>
<span class="nc" id="L734">            final MoneyWiseXAnalysisSecurityValues myBaseValues = myBucket.getBaseValues();</span>

            /* Create the detail row */
<span class="nc" id="L737">            theBuilder.startRow(myTable);</span>
<span class="nc" id="L738">            theBuilder.makeFilterLinkCell(myTable, myFullName, myName);</span>

            /* Handle foreign accounts */
<span class="nc bnc" id="L741" title="All 2 branches missed.">            if (isForeign) {</span>
<span class="nc bnc" id="L742" title="All 2 branches missed.">                if (myBucket.isForeignCurrency()) {</span>
<span class="nc" id="L743">                    theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUE));</span>
<span class="nc" id="L744">                    theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUATION));</span>
<span class="nc" id="L745">                    theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUE));</span>
<span class="nc" id="L746">                    theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUATION));</span>
                } else {
<span class="nc" id="L748">                    theBuilder.makeStretchedValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUATION));</span>
<span class="nc" id="L749">                    theBuilder.makeStretchedValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUATION));</span>
                }
            } else {
<span class="nc" id="L752">                theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUATION));</span>
<span class="nc" id="L753">                theBuilder.makeValueCell(myTable, myBaseValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUATION));</span>
            }
<span class="nc" id="L755">            theBuilder.makeValueCell(myTable, myValues.getMoneyValue(MoneyWiseXAnalysisSecurityAttr.VALUEDELTA));</span>

            /* Record the filter */
<span class="nc" id="L758">            setFilterForId(myFullName, myBucket);</span>
<span class="nc" id="L759">        }</span>

        /* Return the table */
<span class="nc" id="L762">        return myTable;</span>
    }

    @Override
    public MoneyWiseXAnalysisFilter&lt;?, ?&gt; processFilter(final Object pSource) {
        /* If this is a DepositBucket */
<span class="nc bnc" id="L768" title="All 2 branches missed.">        if (pSource instanceof MoneyWiseXAnalysisDepositBucket mySource) {</span>
            /* Create the new filter */
<span class="nc" id="L770">            return new MoneyWiseXAnalysisDepositFilter(mySource);</span>
        }
        /* If this is a CashBucket */
<span class="nc bnc" id="L773" title="All 2 branches missed.">        if (pSource instanceof MoneyWiseXAnalysisCashBucket mySource) {</span>
            /* Create the new filter */
<span class="nc" id="L775">            return new MoneyWiseXAnalysisCashFilter(mySource);</span>
        }
        /* If this is a LoanBucket */
<span class="nc bnc" id="L778" title="All 2 branches missed.">        if (pSource instanceof MoneyWiseXAnalysisLoanBucket mySource) {</span>
            /* Create the new filter */
<span class="nc" id="L780">            return new MoneyWiseXAnalysisLoanFilter(mySource);</span>
        }
        /* If this is a SecurityBucket */
<span class="nc bnc" id="L783" title="All 2 branches missed.">        if (pSource instanceof MoneyWiseXAnalysisSecurityBucket mySource) {</span>
            /* Create the new filter */
<span class="nc" id="L785">            return new MoneyWiseXAnalysisSecurityFilter(mySource);</span>
        }
        /* If this is a PortfolioBucket */
<span class="nc bnc" id="L788" title="All 2 branches missed.">        if (pSource instanceof MoneyWiseXAnalysisPortfolioBucket mySource) {</span>
            /* Create the new filter */
<span class="nc" id="L790">            return new MoneyWiseXAnalysisPortfolioCashFilter(mySource);</span>
        }
<span class="nc" id="L792">        return null;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>