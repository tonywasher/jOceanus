<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MoneyWiseXReportSelect.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MoneyWise Personal Finance - Core</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.moneywise.atlas.ui.controls</a> &gt; <span class="el_source">MoneyWiseXReportSelect.java</span></div><h1>MoneyWiseXReportSelect.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * MoneyWise: Finance Application
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.moneywise.atlas.ui.controls;

import net.sourceforge.joceanus.metis.data.MetisDataDifference;
import net.sourceforge.joceanus.metis.ui.MetisIcon;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysis;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisPortfolioBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisPortfolioBucket.MoneyWiseXAnalysisPortfolioBucketList;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisSecurityBucket;
import net.sourceforge.joceanus.moneywise.atlas.data.analysis.buckets.MoneyWiseXAnalysisSecurityBucket.MoneyWiseXAnalysisSecurityBucketList;
import net.sourceforge.joceanus.moneywise.atlas.reports.MoneyWiseXReportType;
import net.sourceforge.joceanus.moneywise.ui.MoneyWiseUIResource;
import net.sourceforge.joceanus.oceanus.date.OceanusDatePeriod;
import net.sourceforge.joceanus.oceanus.date.OceanusDateRange;
import net.sourceforge.joceanus.oceanus.event.OceanusEventManager;
import net.sourceforge.joceanus.oceanus.event.OceanusEventRegistrar;
import net.sourceforge.joceanus.oceanus.event.OceanusEventRegistrar.OceanusEventProvider;
import net.sourceforge.joceanus.prometheus.views.PrometheusDataEvent;
import net.sourceforge.joceanus.tethys.api.base.TethysUIComponent;
import net.sourceforge.joceanus.tethys.api.base.TethysUIEvent;
import net.sourceforge.joceanus.tethys.api.button.TethysUIButton;
import net.sourceforge.joceanus.tethys.api.button.TethysUIButtonFactory;
import net.sourceforge.joceanus.tethys.api.button.TethysUIDateRangeSelector;
import net.sourceforge.joceanus.tethys.api.button.TethysUIScrollButtonManager;
import net.sourceforge.joceanus.tethys.api.control.TethysUILabel;
import net.sourceforge.joceanus.tethys.api.factory.TethysUIFactory;
import net.sourceforge.joceanus.tethys.api.menu.TethysUIScrollItem;
import net.sourceforge.joceanus.tethys.api.menu.TethysUIScrollMenu;
import net.sourceforge.joceanus.tethys.api.menu.TethysUIScrollSubMenu;
import net.sourceforge.joceanus.tethys.api.pane.TethysUIBoxPaneManager;

import java.util.Iterator;

/**
 * Report selection panel.
 */
public class MoneyWiseXReportSelect
        implements OceanusEventProvider&lt;PrometheusDataEvent&gt;, TethysUIComponent {
    /**
     * Text for Report Label.
     */
<span class="nc" id="L57">    private static final String NLS_REPORT = MoneyWiseUIResource.REPORT_PROMPT.getValue();</span>

    /**
     * Text for Selection Title.
     */
<span class="nc" id="L62">    private static final String NLS_TITLE = MoneyWiseUIResource.REPORT_TITLE.getValue();</span>

    /**
     * The Event Manager.
     */
    private final OceanusEventManager&lt;PrometheusDataEvent&gt; theEventManager;

    /**
     * The panel.
     */
    private final TethysUIBoxPaneManager thePanel;

    /**
     * Reports scroll button.
     */
    private final TethysUIScrollButtonManager&lt;MoneyWiseXReportType&gt; theReportButton;

    /**
     * Holding scroll button.
     */
    private final TethysUIScrollButtonManager&lt;MoneyWiseXAnalysisSecurityBucket&gt; theHoldingButton;

    /**
     * Range select.
     */
    private final TethysUIDateRangeSelector theRangeSelect;

    /**
     * Print button.
     */
    private final TethysUIButton thePrintButton;

    /**
     * Save button.
     */
    private final TethysUIButton theSaveButton;

    /**
     * Current state.
     */
    private MoneyWiseReportState theState;

    /**
     * Saved state.
     */
    private MoneyWiseReportState theSavePoint;

    /**
     * Active flag.
     */
    private boolean isActive;

    /**
     * Constructor.
     * @param pFactory the GUI factory
     */
<span class="nc" id="L118">    public MoneyWiseXReportSelect(final TethysUIFactory&lt;?&gt; pFactory) {</span>
        /* Create the buttons */
<span class="nc" id="L120">        final TethysUIButtonFactory&lt;?&gt; myButtons = pFactory.buttonFactory();</span>
<span class="nc" id="L121">        theReportButton = myButtons.newScrollButton(MoneyWiseXReportType.class);</span>
<span class="nc" id="L122">        theHoldingButton = myButtons.newScrollButton(MoneyWiseXAnalysisSecurityBucket.class);</span>

        /* Create the Range Select and disable its border */
<span class="nc" id="L125">        theRangeSelect = myButtons.newDateRangeSelector();</span>

        /* Create the labels */
<span class="nc" id="L128">        final TethysUILabel myRepLabel = pFactory.controlFactory().newLabel(NLS_REPORT);</span>

        /* Create the print button */
<span class="nc" id="L131">        thePrintButton = myButtons.newButton();</span>
<span class="nc" id="L132">        MetisIcon.configurePrintIconButton(thePrintButton);</span>

        /* Create the save button */
<span class="nc" id="L135">        theSaveButton = myButtons.newButton();</span>
<span class="nc" id="L136">        MetisIcon.configureSaveIconButton(theSaveButton);</span>

        /* Create initial state */
<span class="nc" id="L139">        theState = new MoneyWiseReportState();</span>
<span class="nc" id="L140">        theState.setRange(theRangeSelect);</span>
<span class="nc" id="L141">        theState.setType(MoneyWiseXReportType.getDefault());</span>

        /* Create Event Manager */
<span class="nc" id="L144">        theEventManager = new OceanusEventManager&lt;&gt;();</span>

        /* Create the selection panel */
<span class="nc" id="L147">        thePanel = pFactory.paneFactory().newHBoxPane();</span>
<span class="nc" id="L148">        thePanel.setBorderTitle(NLS_TITLE);</span>

        /* Define the layout */
<span class="nc" id="L151">        thePanel.addNode(myRepLabel);</span>
<span class="nc" id="L152">        thePanel.addNode(theReportButton);</span>
<span class="nc" id="L153">        thePanel.addSpacer();</span>
<span class="nc" id="L154">        thePanel.addNode(theHoldingButton);</span>
<span class="nc" id="L155">        thePanel.addSpacer();</span>
<span class="nc" id="L156">        thePanel.addNode(theRangeSelect);</span>
<span class="nc" id="L157">        thePanel.addSpacer();</span>
<span class="nc" id="L158">        thePanel.addNode(thePrintButton);</span>
<span class="nc" id="L159">        thePanel.addNode(theSaveButton);</span>

        /* Add the listeners */
<span class="nc" id="L162">        theReportButton.getEventRegistrar().addEventListener(TethysUIEvent.NEWVALUE, e -&gt; handleNewReport());</span>
<span class="nc" id="L163">        theReportButton.setMenuConfigurator(e -&gt; buildReportMenu());</span>
<span class="nc" id="L164">        theHoldingButton.getEventRegistrar().addEventListener(TethysUIEvent.NEWVALUE, e -&gt; handleNewSecurity());</span>
<span class="nc" id="L165">        theHoldingButton.setMenuConfigurator(e -&gt; buildHoldingMenu());</span>
<span class="nc" id="L166">        thePrintButton.getEventRegistrar().addEventListener(e -&gt; theEventManager.fireEvent(PrometheusDataEvent.PRINT));</span>
<span class="nc" id="L167">        theSaveButton.getEventRegistrar().addEventListener(e -&gt; theEventManager.fireEvent(PrometheusDataEvent.SAVETOFILE));</span>
<span class="nc" id="L168">        theRangeSelect.getEventRegistrar().addEventListener(TethysUIEvent.NEWVALUE, e -&gt; handleNewRange());</span>
<span class="nc" id="L169">    }</span>

    @Override
    public TethysUIComponent getUnderlying() {
<span class="nc" id="L173">        return thePanel;</span>
    }

    @Override
    public OceanusEventRegistrar&lt;PrometheusDataEvent&gt; getEventRegistrar() {
<span class="nc" id="L178">        return theEventManager.getEventRegistrar();</span>
    }

    /**
     * Obtain the report type.
     * @return the report type
     */
    public MoneyWiseXReportType getReportType() {
<span class="nc" id="L186">        return theState.getType();</span>
    }

    /**
     * Obtain the selected date range.
     * @return the date range
     */
    public OceanusDateRange getDateRange() {
<span class="nc" id="L194">        return theState.getRange();</span>
    }

    /**
     * Obtain the securityBucket.
     * @return the security
     */
    public MoneyWiseXAnalysisSecurityBucket getSecurity() {
<span class="nc" id="L202">        return theState.getSecurity();</span>
    }

    /**
     * Obtain the date range selection control.
     * @return the date range selection
     */
    public TethysUIDateRangeSelector getDateRangeSelector() {
<span class="nc" id="L210">        return theRangeSelect;</span>
    }

    /**
     * Build report menu.
     */
    private void buildReportMenu() {
        /* Access builder */
<span class="nc" id="L218">        final boolean hasSecurities = theState.hasSecurities();</span>
<span class="nc" id="L219">        final TethysUIScrollMenu&lt;MoneyWiseXReportType&gt; myBuilder = theReportButton.getMenu();</span>
<span class="nc" id="L220">        myBuilder.removeAllItems();</span>

        /* Loop through the reports */
<span class="nc bnc" id="L223" title="All 2 branches missed.">        for (MoneyWiseXReportType myType : MoneyWiseXReportType.values()) {</span>
            /* If we can produce the report */
<span class="nc bnc" id="L225" title="All 2 branches missed.">            if (hasSecurities</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">                    || !myType.needSecurities()) {</span>
                /* Create a new MenuItem for the report type */
<span class="nc" id="L228">                myBuilder.addItem(myType);</span>
            }
        }
<span class="nc" id="L231">    }</span>

    /**
     * Build holding menu.
     */
    private void buildHoldingMenu() {
        /* Access state details */
<span class="nc" id="L238">        final MoneyWiseXAnalysis myAnalysis = theState.getAnalysis();</span>
<span class="nc" id="L239">        final MoneyWiseXAnalysisSecurityBucket mySecurity = theState.getSecurity();</span>
<span class="nc" id="L240">        final MoneyWiseXAnalysisPortfolioBucketList myPortfolios = myAnalysis.getPortfolios();</span>

        /* Access builder */
<span class="nc" id="L243">        final TethysUIScrollMenu&lt;MoneyWiseXAnalysisSecurityBucket&gt; myBuilder = theHoldingButton.getMenu();</span>
<span class="nc" id="L244">        myBuilder.removeAllItems();</span>
<span class="nc" id="L245">        TethysUIScrollItem&lt;MoneyWiseXAnalysisSecurityBucket&gt; myActive = null;</span>

        /* Loop through the Portfolio Buckets */
<span class="nc" id="L248">        final Iterator&lt;MoneyWiseXAnalysisPortfolioBucket&gt; myPortIterator = myPortfolios.iterator();</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">        while (myPortIterator.hasNext()) {</span>
<span class="nc" id="L250">            final MoneyWiseXAnalysisPortfolioBucket myPortBucket = myPortIterator.next();</span>

            /* Create subMenu */
<span class="nc" id="L253">            final String myName = myPortBucket.getName();</span>
<span class="nc" id="L254">            final TethysUIScrollSubMenu&lt;MoneyWiseXAnalysisSecurityBucket&gt; myMenu = myBuilder.addSubMenu(myName);</span>

            /* Loop through the Security Buckets */
<span class="nc" id="L257">            final MoneyWiseXAnalysisSecurityBucketList mySecurities = myPortBucket.getSecurities();</span>
<span class="nc" id="L258">            final Iterator&lt;MoneyWiseXAnalysisSecurityBucket&gt; myIterator = mySecurities.iterator();</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">            while (myIterator.hasNext()) {</span>
<span class="nc" id="L260">                final MoneyWiseXAnalysisSecurityBucket myBucket = myIterator.next();</span>

                /* Add menuItem */
<span class="nc" id="L263">                final TethysUIScrollItem&lt;MoneyWiseXAnalysisSecurityBucket&gt; myItem = myMenu.getSubMenu().addItem(myBucket, myBucket.getSecurityName());</span>

                /* Record active item */
<span class="nc bnc" id="L266" title="All 2 branches missed.">                if (myBucket.equals(mySecurity)) {</span>
<span class="nc" id="L267">                    myActive = myItem;</span>
                }
<span class="nc" id="L269">            }</span>
<span class="nc" id="L270">        }</span>

        /* Ensure that active item is displayed */
<span class="nc bnc" id="L273" title="All 2 branches missed.">        if (myActive != null) {</span>
<span class="nc" id="L274">            myActive.scrollToItem();</span>
        }
<span class="nc" id="L276">    }</span>

    /**
     * Set the range for the date box.
     * @param pRange the date range
     */
    public final void setRange(final OceanusDateRange pRange) {
        /* Set up range */
<span class="nc" id="L284">        theRangeSelect.setOverallRange(pRange);</span>
<span class="nc" id="L285">    }</span>

    /**
     * Set securities flag.
     * @param pSecurities do we have securities?
     */
    public void setSecurities(final boolean pSecurities) {
<span class="nc" id="L292">        theState.setSecurities(pSecurities);</span>
<span class="nc" id="L293">    }</span>

    /**
     * Set analysis.
     * @param pAnalysis the analysis.
     */
    public void setAnalysis(final MoneyWiseXAnalysis pAnalysis) {
        /* Record the analysis */
<span class="nc" id="L301">        theState.setAnalysis(pAnalysis);</span>

        /* Access the portfolios */
<span class="nc" id="L304">        final MoneyWiseXAnalysisPortfolioBucketList myPortfolios = pAnalysis.getPortfolios();</span>

        /* If we have an existing security bucket */
<span class="nc" id="L307">        MoneyWiseXAnalysisSecurityBucket mySecurity = theState.getSecurity();</span>

        /* If we have a selected Security */
<span class="nc bnc" id="L310" title="All 2 branches missed.">        if (mySecurity != null) {</span>
            /* Look for the equivalent bucket */
<span class="nc" id="L312">            mySecurity = myPortfolios.getMatchingSecurityHolding(mySecurity.getSecurityHolding());</span>
        }

        /* If we no longer have a selected security */
<span class="nc bnc" id="L316" title="All 2 branches missed.">        if (mySecurity == null) {</span>
            /* Obtain the default security holding */
<span class="nc" id="L318">            mySecurity = myPortfolios.getDefaultSecurityHolding();</span>
        }

        /* Set the selected security */
<span class="nc" id="L322">        theState.setSecurity(mySecurity);</span>
<span class="nc" id="L323">    }</span>

    /**
     * Set security.
     * @param pSecurity the security.
     */
    public void setSecurity(final MoneyWiseXAnalysisSecurityBucket pSecurity) {
        /* Set the selected security */
<span class="nc" id="L331">        theState.setSecurity(pSecurity);</span>
<span class="nc" id="L332">        theState.setType(MoneyWiseXReportType.CAPITALGAINS);</span>

        /* Notify that the state has changed */
<span class="nc" id="L335">        theEventManager.fireEvent(PrometheusDataEvent.SELECTIONCHANGED);</span>
<span class="nc" id="L336">    }</span>

    /**
     * Create SavePoint.
     */
    public void createSavePoint() {
        /* Create the savePoint */
<span class="nc" id="L343">        theSavePoint = new MoneyWiseReportState(theState);</span>
<span class="nc" id="L344">    }</span>

    /**
     * Restore SavePoint.
     */
    public void restoreSavePoint() {
        /* Restore the savePoint */
<span class="nc" id="L351">        theState = new MoneyWiseReportState(theSavePoint);</span>

        /* Apply the state */
<span class="nc" id="L354">        theState.applyState();</span>
<span class="nc" id="L355">    }</span>

    @Override
    public void setEnabled(final boolean bEnable) {
<span class="nc" id="L359">        theRangeSelect.setEnabled(bEnable);</span>
<span class="nc" id="L360">        theReportButton.setEnabled(bEnable);</span>
<span class="nc" id="L361">        theHoldingButton.setEnabled(bEnable);</span>
<span class="nc" id="L362">        thePrintButton.setEnabled(bEnable);</span>
<span class="nc" id="L363">        theSaveButton.setEnabled(bEnable);</span>
<span class="nc" id="L364">    }</span>

    @Override
    public void setVisible(final boolean pVisible) {
<span class="nc" id="L368">        thePanel.setVisible(pVisible);</span>
<span class="nc" id="L369">    }</span>

    /**
     * Handle new report.
     */
    private void handleNewReport() {
        /* Set active flag */
<span class="nc" id="L376">        isActive = true;</span>

        /* Look for a changed report type */
<span class="nc bnc" id="L379" title="All 2 branches missed.">        if (theState.setType(theReportButton.getValue())) {</span>
            /* Notify that the state has changed */
<span class="nc" id="L381">            theEventManager.fireEvent(PrometheusDataEvent.SELECTIONCHANGED);</span>
        }

        /* Clear active flag */
<span class="nc" id="L385">        isActive = false;</span>
<span class="nc" id="L386">    }</span>

    /**
     * Handle new holding.
     */
    private void handleNewSecurity() {
        /* Set active flag */
<span class="nc" id="L393">        isActive = true;</span>

        /* Look for a changed report type */
<span class="nc bnc" id="L396" title="All 2 branches missed.">        if (theState.setSecurity(theHoldingButton.getValue())) {</span>
            /* Notify that the state has changed */
<span class="nc" id="L398">            theEventManager.fireEvent(PrometheusDataEvent.SELECTIONCHANGED);</span>
        }

        /* Clear active flag */
<span class="nc" id="L402">        isActive = false;</span>
<span class="nc" id="L403">    }</span>

    /**
     * Handle new range.
     */
    private void handleNewRange() {
        /* if we have a changed range and are not changing report */
<span class="nc bnc" id="L410" title="All 4 branches missed.">        if (theState.setRange(theRangeSelect)</span>
                &amp;&amp; !isActive) {
            /* Notify that the state has changed */
<span class="nc" id="L413">            theEventManager.fireEvent(PrometheusDataEvent.SELECTIONCHANGED);</span>
        }
<span class="nc" id="L415">    }</span>

    /**
     * SavePoint values.
     */
    private final class MoneyWiseReportState {
        /**
         * The analysis.
         */
        private MoneyWiseXAnalysis theAnalysis;

        /**
         * The selected range.
         */
        private OceanusDateRange theRange;

        /**
         * Do we have securities?
         */
        private boolean hasSecurities;

        /**
         * The securityBucket.
         */
        private MoneyWiseXAnalysisSecurityBucket theSecurity;

        /**
         * The selected report type.
         */
        private MoneyWiseXReportType theType;

        /**
         * Constructor.
         */
<span class="nc" id="L449">        private MoneyWiseReportState() {</span>
<span class="nc" id="L450">        }</span>

        /**
         * Constructor.
         * @param pState state to copy from
         */
<span class="nc" id="L456">        private MoneyWiseReportState(final MoneyWiseReportState pState) {</span>
<span class="nc" id="L457">            theAnalysis = pState.getAnalysis();</span>
<span class="nc" id="L458">            theRange = pState.getRange();</span>
<span class="nc" id="L459">            hasSecurities = pState.hasSecurities();</span>
<span class="nc" id="L460">            theSecurity = pState.getSecurity();</span>
<span class="nc" id="L461">            theType = pState.getType();</span>
<span class="nc" id="L462">        }</span>

        /**
         * Obtain the analysis.
         * @return the analysis
         */
        private MoneyWiseXAnalysis getAnalysis() {
<span class="nc" id="L469">            return theAnalysis;</span>
        }

        /**
         * Obtain the selected range.
         * @return the range
         */
        private OceanusDateRange getRange() {
<span class="nc" id="L477">            return theRange;</span>
        }

        /**
         * Do we have securities?
         * @return true/false
         */
        private boolean hasSecurities() {
<span class="nc" id="L485">            return hasSecurities;</span>
        }

        /**
         * Obtain the security bucket.
         * @return the bucket
         */
        private MoneyWiseXAnalysisSecurityBucket getSecurity() {
<span class="nc" id="L493">            return theSecurity;</span>
        }

        /**
         * Obtain the selected report type.
         * @return the report type
         */
        private MoneyWiseXReportType getType() {
<span class="nc" id="L501">            return theType;</span>
        }

        /**
         * Set new Range.
         * @param pSelect the Panel with the new range
         * @return true/false did a change occur
         */
        private boolean setRange(final TethysUIDateRangeSelector pSelect) {
            /* Adjust the date and build the new range */
<span class="nc" id="L511">            final OceanusDateRange myRange = pSelect.getRange();</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">            if (!MetisDataDifference.isEqual(myRange, theRange)) {</span>
<span class="nc" id="L513">                theRange = new OceanusDateRange(myRange);</span>
<span class="nc" id="L514">                return true;</span>
            }
<span class="nc" id="L516">            return false;</span>
        }

        /**
         * Set securities flag.
         * @param pSecurities do we have securities?
         */
        private void setSecurities(final boolean pSecurities) {
            /* Adjust the flag */
<span class="nc bnc" id="L525" title="All 2 branches missed.">            if (pSecurities != hasSecurities) {</span>
<span class="nc" id="L526">                hasSecurities = pSecurities;</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">                if (!hasSecurities</span>
<span class="nc bnc" id="L528" title="All 2 branches missed.">                        &amp;&amp; theType.needSecurities()) {</span>
<span class="nc" id="L529">                    theType = MoneyWiseXReportType.getDefault();</span>
                }
            }
<span class="nc" id="L532">        }</span>

        /**
         * Set analysis.
         * @param pAnalysis the analysis
         */
        private void setAnalysis(final MoneyWiseXAnalysis pAnalysis) {
<span class="nc" id="L539">            theAnalysis = pAnalysis;</span>
<span class="nc" id="L540">        }</span>

        /**
         * Set security.
         * @param pSecurity the security
         * @return true/false did a change occur
         */
        private boolean setSecurity(final MoneyWiseXAnalysisSecurityBucket pSecurity) {
<span class="nc bnc" id="L548" title="All 2 branches missed.">            if (!pSecurity.equals(theSecurity)) {</span>
<span class="nc" id="L549">                theSecurity = pSecurity;</span>
<span class="nc" id="L550">                applyState();</span>
<span class="nc" id="L551">                return true;</span>
            }
<span class="nc" id="L553">            return false;</span>
        }

        /**
         * Set new Report Type.
         * @param pType the new type
         * @return true/false did a change occur
         */
        private boolean setType(final MoneyWiseXReportType pType) {
<span class="nc bnc" id="L562" title="All 2 branches missed.">            if (!pType.equals(theType)) {</span>
                /* Are we currently point in time */
<span class="nc bnc" id="L564" title="All 2 branches missed.">                final boolean isPointInTime = theType != null</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">                        &amp;&amp; theType.isPointInTime();</span>

                /* Store the new type */
<span class="nc" id="L568">                theType = pType;</span>

                /* If we need to switch point in time */
<span class="nc bnc" id="L571" title="All 2 branches missed.">                if (theType.isPointInTime() != isPointInTime) {</span>
                    /* Switch it appropriately */
<span class="nc bnc" id="L573" title="All 2 branches missed.">                    theRangeSelect.setPeriod(isPointInTime</span>
<span class="nc" id="L574">                            ? OceanusDatePeriod.FISCALYEAR</span>
<span class="nc" id="L575">                            : OceanusDatePeriod.DATESUPTO);</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">                    theRangeSelect.lockPeriod(!isPointInTime);</span>

                    /* else if we are switching to tax calculation */
<span class="nc bnc" id="L579" title="All 2 branches missed.">                } else if (theType == MoneyWiseXReportType.TAXCALC) {</span>
                    /* Switch explicitly to Fiscal Year */
<span class="nc" id="L581">                    theRangeSelect.setPeriod(OceanusDatePeriod.FISCALYEAR);</span>
                }

                /* Apply the state */
<span class="nc" id="L585">                applyState();</span>
<span class="nc" id="L586">                return true;</span>
            }
<span class="nc" id="L588">            return false;</span>
        }

        /**
         * Apply the State.
         */
        private void applyState() {
            /* Adjust the lock-down */
<span class="nc" id="L596">            setEnabled(true);</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">            theReportButton.setFixedText(theType == null</span>
<span class="nc" id="L598">                    ? null</span>
<span class="nc" id="L599">                    : theType.toString());</span>
<span class="nc" id="L600">            theHoldingButton.setValue(theSecurity);</span>
<span class="nc" id="L601">            theHoldingButton.setVisible(MoneyWiseXReportType.CAPITALGAINS.equals(theType));</span>
<span class="nc" id="L602">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>