<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrometheusFieldSet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Prometheus Core Application Framework</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.prometheus.ui.fieldset</a> &gt; <span class="el_source">PrometheusFieldSet.java</span></div><h1>PrometheusFieldSet.java</h1><pre class="source lang-java linenums">/* *****************************************************************************
 * Prometheus: Application Framework
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.prometheus.ui.fieldset;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.function.BiPredicate;
import java.util.function.Consumer;
import java.util.function.Function;

import net.sourceforge.joceanus.metis.data.MetisDataItem.MetisDataFieldId;
import net.sourceforge.joceanus.prometheus.ui.fieldset.PrometheusFieldSetTableTab.PrometheusFieldSetTable;
import net.sourceforge.joceanus.oceanus.event.OceanusEventManager;
import net.sourceforge.joceanus.oceanus.event.OceanusEventRegistrar;
import net.sourceforge.joceanus.oceanus.event.OceanusEventRegistrar.OceanusEventProvider;
import net.sourceforge.joceanus.tethys.api.base.TethysUIComponent;
import net.sourceforge.joceanus.tethys.api.base.TethysUIEvent;
import net.sourceforge.joceanus.tethys.api.factory.TethysUIFactory;
import net.sourceforge.joceanus.tethys.api.field.TethysUIDataEditField;
import net.sourceforge.joceanus.tethys.api.field.TethysUIDataEditField.TethysUICharArrayTextAreaField;
import net.sourceforge.joceanus.tethys.api.pane.TethysUIGridPaneManager;

/**
 * FieldSet.
 * @param &lt;T&gt; the item type
 */
public class PrometheusFieldSet&lt;T&gt;
        implements OceanusEventProvider&lt;TethysUIEvent&gt; {
    /**
     * The gui factory.
     */
    private final TethysUIFactory&lt;?&gt; theFactory;

    /**
     * The Event Manager.
     */
    private final OceanusEventManager&lt;TethysUIEvent&gt; theEventManager;

    /**
     * The map of Fields to panels.
     */
    private final Map&lt;MetisDataFieldId, PrometheusFieldSetPanel&lt;T&gt;&gt; theFieldMap;

    /**
     * The list of panels.
     */
    private final List&lt;PrometheusFieldSetPanel&lt;T&gt;&gt; thePanels;

    /**
     * The panel.
     */
    private final TethysUIGridPaneManager thePanel;

    /**
     * The currently active panel.
     */
    private PrometheusFieldSetFields&lt;T&gt; theCurrentPanel;

    /**
     * The tabPanel.
     */
    private PrometheusFieldSetTabs theTabs;

    /**
     * is field changed predicate.
     */
    private BiPredicate&lt;T, MetisDataFieldId&gt; theChanged;

    /**
     * Reporter consumer.
     */
    private Consumer&lt;String&gt; theReporter;

    /**
     * Is the data being refreshed?
     */
    private boolean isRefreshing;

    /**
     * Labels adjusted?
     */
    private boolean areLabelsAdjusted;

    /**
     * Constructor.
     * @param pFactory the gui factory
     */
<span class="nc" id="L104">    public PrometheusFieldSet(final TethysUIFactory&lt;?&gt; pFactory) {</span>
        /* Store parameters */
<span class="nc" id="L106">        theFactory = pFactory;</span>

        /* Create event manager */
<span class="nc" id="L109">        theEventManager = new OceanusEventManager&lt;&gt;();</span>

        /* Create maps and lists */
<span class="nc" id="L112">        theFieldMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L113">        thePanels = new ArrayList&lt;&gt;();</span>

        /* Create the initial panel */
<span class="nc" id="L116">        theCurrentPanel = new PrometheusFieldSetFields&lt;&gt;(pFactory, this);</span>
<span class="nc" id="L117">        thePanels.add(theCurrentPanel);</span>

        /* Create the main panel */
<span class="nc" id="L120">        thePanel = theFactory.paneFactory().newGridPane();</span>
<span class="nc" id="L121">        thePanel.addCell(theCurrentPanel);</span>
<span class="nc" id="L122">        thePanel.allowCellGrowth(theCurrentPanel);</span>
<span class="nc" id="L123">    }</span>

    /**
     * Obtain the component.
     * @return the component
     */
    public TethysUIComponent getComponent() {
<span class="nc" id="L130">        return thePanel;</span>
    }

    @Override
    public OceanusEventRegistrar&lt;TethysUIEvent&gt; getEventRegistrar() {
<span class="nc" id="L135">        return theEventManager.getEventRegistrar();</span>
    }

    /**
     * Switch to subsidiary panel.
     * @param pName the name of the tab.
     */
    public void newPanel(final String pName) {
        /* If we do not currently have any tabs */
<span class="nc bnc" id="L144" title="All 2 branches missed.">        if (theTabs == null) {</span>
            /* Create the tab pane and add to main panel */
<span class="nc" id="L146">            theTabs = new PrometheusFieldSetTabs(theFactory);</span>
<span class="nc" id="L147">            thePanel.addCell(theTabs.getComponent());</span>
<span class="nc" id="L148">            thePanel.allowCellGrowth(theTabs.getComponent());</span>
        }

        /* Create the new panel and add as tab */
<span class="nc" id="L152">        theCurrentPanel = new PrometheusFieldSetFields&lt;&gt;(theFactory, this);</span>
<span class="nc" id="L153">        thePanels.add(theCurrentPanel);</span>
<span class="nc" id="L154">        theTabs.addPanel(pName, theCurrentPanel);</span>
<span class="nc" id="L155">    }</span>

    /**
     * Add a textArea tab.
     * @param pName the name of the tab.
     * @param pFieldId the fieldId
     * @param pField the edit field
     * @param pValueFactory the valueFactory
     */
    public void newTextArea(final String pName,
                            final MetisDataFieldId pFieldId,
                            final TethysUICharArrayTextAreaField pField,
                            final Function&lt;T, char[]&gt; pValueFactory) {
        /* If we do not currently have any tabs */
<span class="nc bnc" id="L169" title="All 2 branches missed.">        if (theTabs == null) {</span>
            /* Create the tab pane and add to main panel */
<span class="nc" id="L171">            theTabs = new PrometheusFieldSetTabs(theFactory);</span>
<span class="nc" id="L172">            thePanel.addCell(theTabs.getComponent());</span>
<span class="nc" id="L173">            thePanel.allowCellGrowth(theTabs.getComponent());</span>
        }

        /* Create the new panel and add as tab */
<span class="nc" id="L177">        final PrometheusFieldSetTextArea&lt;T&gt; myTextArea = new PrometheusFieldSetTextArea&lt;&gt;(theFactory, this);</span>
<span class="nc" id="L178">        thePanels.add(myTextArea);</span>
<span class="nc" id="L179">        theTabs.addPanel(pName, myTextArea);</span>

        /* Add the field */
<span class="nc" id="L182">        myTextArea.addField(pFieldId, pField, pValueFactory);</span>
<span class="nc" id="L183">    }</span>

    /**
     * Add a table tab.
     * @param pName the name of the tab.
     * @param pTable the table
     */
    public void newTable(final String pName,
                         final PrometheusFieldSetTable&lt;T&gt; pTable) {
        /* If we do not currently have any tabs */
<span class="nc bnc" id="L193" title="All 2 branches missed.">        if (theTabs == null) {</span>
            /* Create the tab pane and add to main panel */
<span class="nc" id="L195">            theTabs = new PrometheusFieldSetTabs(theFactory);</span>
<span class="nc" id="L196">            thePanel.addCell(theTabs.getComponent());</span>
<span class="nc" id="L197">            thePanel.allowCellGrowth(theTabs.getComponent());</span>
        }

        /* Create the new panel and add as tab */
<span class="nc" id="L201">        final PrometheusFieldSetTableTab&lt;T&gt; myTable = new PrometheusFieldSetTableTab&lt;&gt;(theFactory, pTable);</span>
<span class="nc" id="L202">        thePanels.add(myTable);</span>
<span class="nc" id="L203">        theTabs.addPanel(pName, myTable);</span>
<span class="nc" id="L204">    }</span>

    /**
     * Add field to current panel.
     * @param pFieldId the fieldId
     * @param pField the edit field
     * @param pValueFactory the valueFactory
     */
    public void addField(final MetisDataFieldId pFieldId,
                         final TethysUIDataEditField&lt;?&gt; pField,
                         final Function&lt;T, Object&gt; pValueFactory) {
<span class="nc" id="L215">        theCurrentPanel.addField(pFieldId, pField, pValueFactory);</span>
<span class="nc" id="L216">    }</span>

    /**
     * Set the changed predicate.
     * @param pChanged the changed predicate
     */
    public void setChanged(final BiPredicate&lt;T, MetisDataFieldId&gt; pChanged) {
<span class="nc" id="L223">        theChanged = pChanged;</span>
<span class="nc" id="L224">    }</span>

    /**
     * Is the cell changed?
     * @param pItem the item
     * @param pField the field id
     * @return true/false
     */
    boolean isChanged(final T pItem,
                      final MetisDataFieldId pField) {
<span class="nc bnc" id="L234" title="All 2 branches missed.">        return theChanged != null</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">                &amp;&amp; theChanged.test(pItem, pField);</span>
    }

    /**
     * Set editable item.
     * @param isEditable true/false
     */
    public void setEditable(final boolean isEditable) {
        /* Update all the panels */
<span class="nc bnc" id="L244" title="All 2 branches missed.">        for (PrometheusFieldSetPanel&lt;T&gt; myPanel : thePanels) {</span>
<span class="nc" id="L245">            myPanel.setEditable(isEditable);</span>
<span class="nc" id="L246">        }</span>
<span class="nc" id="L247">    }</span>

    /**
     * Adjust changed indications.
     */
    public void adjustChanged() {
        /* Update all the panels */
<span class="nc bnc" id="L254" title="All 2 branches missed.">        for (PrometheusFieldSetPanel&lt;T&gt; myPanel : thePanels) {</span>
<span class="nc" id="L255">            myPanel.adjustChanged();</span>
<span class="nc" id="L256">        }</span>
<span class="nc" id="L257">    }</span>

    /**
     * Set item.
     * @param pItem the item.
     */
    public void setItem(final T pItem) {
        /* Note that we are refreshing */
<span class="nc" id="L265">        isRefreshing = true;</span>

        /* Update all the panels */
<span class="nc bnc" id="L268" title="All 2 branches missed.">        for (PrometheusFieldSetPanel&lt;T&gt; myPanel : thePanels) {</span>
<span class="nc" id="L269">            myPanel.setItem(pItem);</span>
<span class="nc" id="L270">            myPanel.setReporter(theReporter);</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">            if (!areLabelsAdjusted) {</span>
<span class="nc" id="L272">                myPanel.adjustLabelWidth();</span>
            }
<span class="nc" id="L274">        }</span>

        /* Note that we have finished refreshing */
<span class="nc" id="L277">        isRefreshing = false;</span>
<span class="nc" id="L278">        areLabelsAdjusted = true;</span>
<span class="nc" id="L279">    }</span>

    /**
     * Register a field.
     * @param pFieldId the field.
     * @param pPanel the panel.
     */
    void registerField(final MetisDataFieldId pFieldId,
                       final PrometheusFieldSetPanel&lt;T&gt; pPanel) {
<span class="nc" id="L288">        theFieldMap.put(pFieldId, pPanel);</span>
<span class="nc" id="L289">    }</span>

    /**
     * Set field visibility.
     * @param pFieldId the field.
     * @param pVisible is visible true/false?
     */
    public void setFieldVisible(final MetisDataFieldId pFieldId,
                                final boolean pVisible) {
        /* Adjust visibility of field */
<span class="nc" id="L299">        final PrometheusFieldSetPanel&lt;T&gt; myPanel = theFieldMap.get(pFieldId);</span>
<span class="nc" id="L300">        myPanel.setVisible(pFieldId, pVisible);</span>
<span class="nc" id="L301">    }</span>

    /**
     * Adjust tab visibility.
     */
    public void adjustTabVisibility() {
        /* Adjust visibility of tabs if present */
<span class="nc bnc" id="L308" title="All 2 branches missed.">        if (theTabs != null) {</span>
<span class="nc" id="L309">            theTabs.adjustVisibility();</span>
        }
<span class="nc" id="L311">        adjustChanged();</span>
<span class="nc" id="L312">    }</span>

    /**
     * Set field editability.
     * @param pFieldId the fieldId.
     * @param pEditable is editable true/false?
     */
    public void setFieldEditable(final MetisDataFieldId pFieldId,
                                 final boolean pEditable) {
        /* Adjust edit-ability of field */
<span class="nc" id="L322">        final PrometheusFieldSetPanel&lt;T&gt; myPanel = theFieldMap.get(pFieldId);</span>
<span class="nc" id="L323">        myPanel.setEditable(pFieldId, pEditable);</span>
<span class="nc" id="L324">    }</span>

    /**
     * Notify listeners of new data.
     * @param pFieldId the fieldId.
     * @param pNewValue the new value
     */
    void newData(final MetisDataFieldId pFieldId,
                 final Object pNewValue) {
        /* If we are not refreshing data */
<span class="nc bnc" id="L334" title="All 2 branches missed.">        if (!isRefreshing) {</span>
            /* Create the notification */
<span class="nc" id="L336">            final PrometheusFieldSetEvent myUpdate = new PrometheusFieldSetEvent(pFieldId, pNewValue);</span>

            /* Fire the notification */
<span class="nc" id="L339">            theEventManager.fireEvent(TethysUIEvent.NEWVALUE, myUpdate);</span>
        }
<span class="nc" id="L341">    }</span>

    /**
     * Set preferred width and height.
     * @param pWidth the width.
     * @param pHeight the height
     */
    public void setPreferredWidthAndHeight(final int pWidth,
                                           final int pHeight) {
        /* If we have Tabs */
<span class="nc" id="L351">        int myWidth = pWidth;</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">        if (theTabs != null) {</span>
            /* Everything is half width */
<span class="nc" id="L354">            myWidth &gt;&gt;= 1;</span>

            /* Set all tabs visible */
<span class="nc" id="L357">            theTabs.setAllVisible();</span>

            /* Set the tab size */
<span class="nc" id="L360">            final TethysUIComponent myComponent = theTabs.getComponent();</span>
<span class="nc" id="L361">            myComponent.setPreferredWidth(myWidth);</span>
<span class="nc" id="L362">            myComponent.setPreferredHeight(pHeight);</span>
        }

        /* Update the initial panel */
<span class="nc" id="L366">        final PrometheusFieldSetPanel&lt;T&gt; myPanel = thePanels.iterator().next();</span>
<span class="nc" id="L367">        final TethysUIComponent myComponent = myPanel.getUnderlying();</span>
<span class="nc" id="L368">        myComponent.setPreferredWidth(myWidth);</span>
<span class="nc" id="L369">        myComponent.setPreferredHeight(pHeight);</span>
<span class="nc" id="L370">    }</span>

    /**
     * Set reporter.
     * @param pReporter the reporter
     */
    public void setReporter(final Consumer&lt;String&gt; pReporter) {
<span class="nc" id="L377">        theReporter = pReporter;</span>
<span class="nc" id="L378">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>