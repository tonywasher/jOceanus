<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrometheusFieldSet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Prometheus Core Application Framework</a> &gt; <a href="index.source.html" class="el_package">io.github.tonywasher.joceanus.prometheus.ui.fieldset</a> &gt; <span class="el_source">PrometheusFieldSet.java</span></div><h1>PrometheusFieldSet.java</h1><pre class="source lang-java linenums">/*
 * Prometheus: Application Framework
 * Copyright 2012-2026. Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package io.github.tonywasher.joceanus.prometheus.ui.fieldset;

import io.github.tonywasher.joceanus.oceanus.event.OceanusEventManager;
import io.github.tonywasher.joceanus.oceanus.event.OceanusEventRegistrar;
import io.github.tonywasher.joceanus.oceanus.event.OceanusEventRegistrar.OceanusEventProvider;
import io.github.tonywasher.joceanus.metis.data.MetisDataItem.MetisDataFieldId;
import io.github.tonywasher.joceanus.prometheus.ui.fieldset.PrometheusFieldSetTableTab.PrometheusFieldSetTable;
import io.github.tonywasher.joceanus.tethys.api.base.TethysUIComponent;
import io.github.tonywasher.joceanus.tethys.api.base.TethysUIEvent;
import io.github.tonywasher.joceanus.tethys.api.factory.TethysUIFactory;
import io.github.tonywasher.joceanus.tethys.api.field.TethysUIDataEditField;
import io.github.tonywasher.joceanus.tethys.api.field.TethysUIDataEditField.TethysUICharArrayTextAreaField;
import io.github.tonywasher.joceanus.tethys.api.pane.TethysUIGridPaneManager;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.function.BiPredicate;
import java.util.function.Consumer;
import java.util.function.Function;

/**
 * FieldSet.
 *
 * @param &lt;T&gt; the item type
 */
public class PrometheusFieldSet&lt;T&gt;
        implements OceanusEventProvider&lt;TethysUIEvent&gt; {
    /**
     * The gui factory.
     */
    private final TethysUIFactory&lt;?&gt; theFactory;

    /**
     * The Event Manager.
     */
    private final OceanusEventManager&lt;TethysUIEvent&gt; theEventManager;

    /**
     * The map of Fields to panels.
     */
    private final Map&lt;MetisDataFieldId, PrometheusFieldSetPanel&lt;T&gt;&gt; theFieldMap;

    /**
     * The list of panels.
     */
    private final List&lt;PrometheusFieldSetPanel&lt;T&gt;&gt; thePanels;

    /**
     * The panel.
     */
    private final TethysUIGridPaneManager thePanel;

    /**
     * The currently active panel.
     */
    private PrometheusFieldSetFields&lt;T&gt; theCurrentPanel;

    /**
     * The tabPanel.
     */
    private PrometheusFieldSetTabs theTabs;

    /**
     * is field changed predicate.
     */
    private BiPredicate&lt;T, MetisDataFieldId&gt; theChanged;

    /**
     * Reporter consumer.
     */
    private Consumer&lt;String&gt; theReporter;

    /**
     * Is the data being refreshed?
     */
    private boolean isRefreshing;

    /**
     * Labels adjusted?
     */
    private boolean areLabelsAdjusted;

    /**
     * Constructor.
     *
     * @param pFactory the gui factory
     */
<span class="nc" id="L106">    public PrometheusFieldSet(final TethysUIFactory&lt;?&gt; pFactory) {</span>
        /* Store parameters */
<span class="nc" id="L108">        theFactory = pFactory;</span>

        /* Create event manager */
<span class="nc" id="L111">        theEventManager = new OceanusEventManager&lt;&gt;();</span>

        /* Create maps and lists */
<span class="nc" id="L114">        theFieldMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L115">        thePanels = new ArrayList&lt;&gt;();</span>

        /* Create the initial panel */
<span class="nc" id="L118">        theCurrentPanel = new PrometheusFieldSetFields&lt;&gt;(pFactory, this);</span>
<span class="nc" id="L119">        thePanels.add(theCurrentPanel);</span>

        /* Create the main panel */
<span class="nc" id="L122">        thePanel = theFactory.paneFactory().newGridPane();</span>
<span class="nc" id="L123">        thePanel.addCell(theCurrentPanel);</span>
<span class="nc" id="L124">        thePanel.allowCellGrowth(theCurrentPanel);</span>
<span class="nc" id="L125">    }</span>

    /**
     * Obtain the component.
     *
     * @return the component
     */
    public TethysUIComponent getComponent() {
<span class="nc" id="L133">        return thePanel;</span>
    }

    @Override
    public OceanusEventRegistrar&lt;TethysUIEvent&gt; getEventRegistrar() {
<span class="nc" id="L138">        return theEventManager.getEventRegistrar();</span>
    }

    /**
     * Switch to subsidiary panel.
     *
     * @param pName the name of the tab.
     */
    public void newPanel(final String pName) {
        /* If we do not currently have any tabs */
<span class="nc bnc" id="L148" title="All 2 branches missed.">        if (theTabs == null) {</span>
            /* Create the tab pane and add to main panel */
<span class="nc" id="L150">            theTabs = new PrometheusFieldSetTabs(theFactory);</span>
<span class="nc" id="L151">            thePanel.addCell(theTabs.getComponent());</span>
<span class="nc" id="L152">            thePanel.allowCellGrowth(theTabs.getComponent());</span>
        }

        /* Create the new panel and add as tab */
<span class="nc" id="L156">        theCurrentPanel = new PrometheusFieldSetFields&lt;&gt;(theFactory, this);</span>
<span class="nc" id="L157">        thePanels.add(theCurrentPanel);</span>
<span class="nc" id="L158">        theTabs.addPanel(pName, theCurrentPanel);</span>
<span class="nc" id="L159">    }</span>

    /**
     * Add a textArea tab.
     *
     * @param pName         the name of the tab.
     * @param pFieldId      the fieldId
     * @param pField        the edit field
     * @param pValueFactory the valueFactory
     */
    public void newTextArea(final String pName,
                            final MetisDataFieldId pFieldId,
                            final TethysUICharArrayTextAreaField pField,
                            final Function&lt;T, char[]&gt; pValueFactory) {
        /* If we do not currently have any tabs */
<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (theTabs == null) {</span>
            /* Create the tab pane and add to main panel */
<span class="nc" id="L176">            theTabs = new PrometheusFieldSetTabs(theFactory);</span>
<span class="nc" id="L177">            thePanel.addCell(theTabs.getComponent());</span>
<span class="nc" id="L178">            thePanel.allowCellGrowth(theTabs.getComponent());</span>
        }

        /* Create the new panel and add as tab */
<span class="nc" id="L182">        final PrometheusFieldSetTextArea&lt;T&gt; myTextArea = new PrometheusFieldSetTextArea&lt;&gt;(theFactory, this);</span>
<span class="nc" id="L183">        thePanels.add(myTextArea);</span>
<span class="nc" id="L184">        theTabs.addPanel(pName, myTextArea);</span>

        /* Add the field */
<span class="nc" id="L187">        myTextArea.addField(pFieldId, pField, pValueFactory);</span>
<span class="nc" id="L188">    }</span>

    /**
     * Add a table tab.
     *
     * @param pName  the name of the tab.
     * @param pTable the table
     */
    public void newTable(final String pName,
                         final PrometheusFieldSetTable&lt;T&gt; pTable) {
        /* If we do not currently have any tabs */
<span class="nc bnc" id="L199" title="All 2 branches missed.">        if (theTabs == null) {</span>
            /* Create the tab pane and add to main panel */
<span class="nc" id="L201">            theTabs = new PrometheusFieldSetTabs(theFactory);</span>
<span class="nc" id="L202">            thePanel.addCell(theTabs.getComponent());</span>
<span class="nc" id="L203">            thePanel.allowCellGrowth(theTabs.getComponent());</span>
        }

        /* Create the new panel and add as tab */
<span class="nc" id="L207">        final PrometheusFieldSetTableTab&lt;T&gt; myTable = new PrometheusFieldSetTableTab&lt;&gt;(theFactory, pTable);</span>
<span class="nc" id="L208">        thePanels.add(myTable);</span>
<span class="nc" id="L209">        theTabs.addPanel(pName, myTable);</span>
<span class="nc" id="L210">    }</span>

    /**
     * Add field to current panel.
     *
     * @param pFieldId      the fieldId
     * @param pField        the edit field
     * @param pValueFactory the valueFactory
     */
    public void addField(final MetisDataFieldId pFieldId,
                         final TethysUIDataEditField&lt;?&gt; pField,
                         final Function&lt;T, Object&gt; pValueFactory) {
<span class="nc" id="L222">        theCurrentPanel.addField(pFieldId, pField, pValueFactory);</span>
<span class="nc" id="L223">    }</span>

    /**
     * Set the changed predicate.
     *
     * @param pChanged the changed predicate
     */
    public void setChanged(final BiPredicate&lt;T, MetisDataFieldId&gt; pChanged) {
<span class="nc" id="L231">        theChanged = pChanged;</span>
<span class="nc" id="L232">    }</span>

    /**
     * Is the cell changed?
     *
     * @param pItem  the item
     * @param pField the field id
     * @return true/false
     */
    boolean isChanged(final T pItem,
                      final MetisDataFieldId pField) {
<span class="nc bnc" id="L243" title="All 2 branches missed.">        return theChanged != null</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">                &amp;&amp; theChanged.test(pItem, pField);</span>
    }

    /**
     * Set editable item.
     *
     * @param isEditable true/false
     */
    public void setEditable(final boolean isEditable) {
        /* Update all the panels */
<span class="nc bnc" id="L254" title="All 2 branches missed.">        for (PrometheusFieldSetPanel&lt;T&gt; myPanel : thePanels) {</span>
<span class="nc" id="L255">            myPanel.setEditable(isEditable);</span>
<span class="nc" id="L256">        }</span>
<span class="nc" id="L257">    }</span>

    /**
     * Adjust changed indications.
     */
    public void adjustChanged() {
        /* Update all the panels */
<span class="nc bnc" id="L264" title="All 2 branches missed.">        for (PrometheusFieldSetPanel&lt;T&gt; myPanel : thePanels) {</span>
<span class="nc" id="L265">            myPanel.adjustChanged();</span>
<span class="nc" id="L266">        }</span>
<span class="nc" id="L267">    }</span>

    /**
     * Set item.
     *
     * @param pItem the item.
     */
    public void setItem(final T pItem) {
        /* Note that we are refreshing */
<span class="nc" id="L276">        isRefreshing = true;</span>

        /* Update all the panels */
<span class="nc bnc" id="L279" title="All 2 branches missed.">        for (PrometheusFieldSetPanel&lt;T&gt; myPanel : thePanels) {</span>
<span class="nc" id="L280">            myPanel.setItem(pItem);</span>
<span class="nc" id="L281">            myPanel.setReporter(theReporter);</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">            if (!areLabelsAdjusted) {</span>
<span class="nc" id="L283">                myPanel.adjustLabelWidth();</span>
            }
<span class="nc" id="L285">        }</span>

        /* Note that we have finished refreshing */
<span class="nc" id="L288">        isRefreshing = false;</span>
<span class="nc" id="L289">        areLabelsAdjusted = true;</span>
<span class="nc" id="L290">    }</span>

    /**
     * Register a field.
     *
     * @param pFieldId the field.
     * @param pPanel   the panel.
     */
    void registerField(final MetisDataFieldId pFieldId,
                       final PrometheusFieldSetPanel&lt;T&gt; pPanel) {
<span class="nc" id="L300">        theFieldMap.put(pFieldId, pPanel);</span>
<span class="nc" id="L301">    }</span>

    /**
     * Set field visibility.
     *
     * @param pFieldId the field.
     * @param pVisible is visible true/false?
     */
    public void setFieldVisible(final MetisDataFieldId pFieldId,
                                final boolean pVisible) {
        /* Adjust visibility of field */
<span class="nc" id="L312">        final PrometheusFieldSetPanel&lt;T&gt; myPanel = theFieldMap.get(pFieldId);</span>
<span class="nc" id="L313">        myPanel.setVisible(pFieldId, pVisible);</span>
<span class="nc" id="L314">    }</span>

    /**
     * Adjust tab visibility.
     */
    public void adjustTabVisibility() {
        /* Adjust visibility of tabs if present */
<span class="nc bnc" id="L321" title="All 2 branches missed.">        if (theTabs != null) {</span>
<span class="nc" id="L322">            theTabs.adjustVisibility();</span>
        }
<span class="nc" id="L324">        adjustChanged();</span>
<span class="nc" id="L325">    }</span>

    /**
     * Set field editability.
     *
     * @param pFieldId  the fieldId.
     * @param pEditable is editable true/false?
     */
    public void setFieldEditable(final MetisDataFieldId pFieldId,
                                 final boolean pEditable) {
        /* Adjust edit-ability of field */
<span class="nc" id="L336">        final PrometheusFieldSetPanel&lt;T&gt; myPanel = theFieldMap.get(pFieldId);</span>
<span class="nc" id="L337">        myPanel.setEditable(pFieldId, pEditable);</span>
<span class="nc" id="L338">    }</span>

    /**
     * Notify listeners of new data.
     *
     * @param pFieldId  the fieldId.
     * @param pNewValue the new value
     */
    void newData(final MetisDataFieldId pFieldId,
                 final Object pNewValue) {
        /* If we are not refreshing data */
<span class="nc bnc" id="L349" title="All 2 branches missed.">        if (!isRefreshing) {</span>
            /* Create the notification */
<span class="nc" id="L351">            final PrometheusFieldSetEvent myUpdate = new PrometheusFieldSetEvent(pFieldId, pNewValue);</span>

            /* Fire the notification */
<span class="nc" id="L354">            theEventManager.fireEvent(TethysUIEvent.NEWVALUE, myUpdate);</span>
        }
<span class="nc" id="L356">    }</span>

    /**
     * Set preferred width and height.
     *
     * @param pWidth  the width.
     * @param pHeight the height
     */
    public void setPreferredWidthAndHeight(final int pWidth,
                                           final int pHeight) {
        /* If we have Tabs */
<span class="nc" id="L367">        int myWidth = pWidth;</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">        if (theTabs != null) {</span>
            /* Everything is half width */
<span class="nc" id="L370">            myWidth &gt;&gt;= 1;</span>

            /* Set all tabs visible */
<span class="nc" id="L373">            theTabs.setAllVisible();</span>

            /* Set the tab size */
<span class="nc" id="L376">            final TethysUIComponent myComponent = theTabs.getComponent();</span>
<span class="nc" id="L377">            myComponent.setPreferredWidth(myWidth);</span>
<span class="nc" id="L378">            myComponent.setPreferredHeight(pHeight);</span>
        }

        /* Update the initial panel */
<span class="nc" id="L382">        final PrometheusFieldSetPanel&lt;T&gt; myPanel = thePanels.iterator().next();</span>
<span class="nc" id="L383">        final TethysUIComponent myComponent = myPanel.getUnderlying();</span>
<span class="nc" id="L384">        myComponent.setPreferredWidth(myWidth);</span>
<span class="nc" id="L385">        myComponent.setPreferredHeight(pHeight);</span>
<span class="nc" id="L386">    }</span>

    /**
     * Set reporter.
     *
     * @param pReporter the reporter
     */
    public void setReporter(final Consumer&lt;String&gt; pReporter) {
<span class="nc" id="L394">        theReporter = pReporter;</span>
<span class="nc" id="L395">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>