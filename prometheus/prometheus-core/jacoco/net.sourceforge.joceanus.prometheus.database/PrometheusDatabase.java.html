<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrometheusDatabase.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Prometheus Core Application Framework</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.prometheus.database</a> &gt; <span class="el_source">PrometheusDatabase.java</span></div><h1>PrometheusDatabase.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Prometheus: Application Framework
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.prometheus.database;

import java.util.EnumSet;
import java.util.Set;

import net.sourceforge.joceanus.metis.preference.MetisPreferenceKey;
import net.sourceforge.joceanus.metis.preference.MetisPreferenceManager;
import net.sourceforge.joceanus.prometheus.preference.PrometheusPreferenceManager;
import net.sourceforge.joceanus.prometheus.preference.PrometheusPreferenceSet;
import net.sourceforge.joceanus.oceanus.base.OceanusException;

/**
 * Preferences for a database.
 */
public interface PrometheusDatabase {
    /**
     * databasePreferenceKeys.
     */
<span class="nc" id="L35">    enum PrometheusDatabasePreferenceKey implements MetisPreferenceKey {</span>
        /**
         * Database Driver.
         */
<span class="nc" id="L39">        DBDRIVER(&quot;DBDriver&quot;, PrometheusDBResource.DBPREF_DRIVER),</span>

        /**
         * Database Server.
         */
<span class="nc" id="L44">        DBSERVER(&quot;DBServer&quot;, PrometheusDBResource.DBPREF_SERVER),</span>

        /**
         * Database Instance.
         */
<span class="nc" id="L49">        DBINSTANCE(&quot;DBInstance&quot;, PrometheusDBResource.DBPREF_INSTANCE),</span>

        /**
         * Database Port.
         */
<span class="nc" id="L54">        DBPORT(&quot;DBPort&quot;, PrometheusDBResource.DBPREF_PORT),</span>

        /**
         * Database Name.
         */
<span class="nc" id="L59">        DBNAME(&quot;DBName&quot;, PrometheusDBResource.DBPREF_NAME),</span>

        /**
         * Database Batch.
         */
<span class="nc" id="L64">        DBBATCH(&quot;DBBatchSize&quot;, PrometheusDBResource.DBPREF_BATCH),</span>

        /**
         * Database User.
         */
<span class="nc" id="L69">        DBUSER(&quot;DBUser&quot;, PrometheusDBResource.DBPREF_USER),</span>

        /**
         * Database Password.
         */
<span class="nc" id="L74">        DBPASS(&quot;DBPass&quot;, PrometheusDBResource.DBPREF_PASS);</span>

        /**
         * The name of the Preference.
         */
        private final String theName;

        /**
         * The display string.
         */
        private final String theDisplay;

        /**
         * Constructor.
         * @param pName the name
         * @param pDisplay the display string;
         */
        PrometheusDatabasePreferenceKey(final String pName,
<span class="nc" id="L92">                                        final PrometheusDBResource pDisplay) {</span>
<span class="nc" id="L93">            theName = pName;</span>
<span class="nc" id="L94">            theDisplay = pDisplay.getValue();</span>
<span class="nc" id="L95">        }</span>

        @Override
        public String getName() {
<span class="nc" id="L99">            return theName;</span>
        }

        @Override
        public String getDisplay() {
<span class="nc" id="L104">            return theDisplay;</span>
        }
    }

    /**
     * PrometheusDatabasePreferences.
     */
    class PrometheusDatabasePreferences
            extends PrometheusPreferenceSet {
        /**
         * Default Database batch size.
         */
<span class="nc" id="L116">        private static final Integer DEFAULT_DBBATCH = 50;</span>

        /**
         * Valid lengths.
         */
<span class="nc" id="L121">        private static final Set&lt;PrometheusJDBCDriver&gt; VALID_DBS = EnumSet.of(PrometheusJDBCDriver.SQLSERVER, PrometheusJDBCDriver.POSTGRESQL,</span>
                PrometheusJDBCDriver.MYSQL, PrometheusJDBCDriver.MARIADB);

        /**
         * Constructor.
         * @param pManager the preference manager
         * @throws OceanusException on error
         */
        public PrometheusDatabasePreferences(final MetisPreferenceManager pManager) throws OceanusException {
<span class="nc" id="L130">            super((PrometheusPreferenceManager) pManager, PrometheusDBResource.DBPREF_PREFNAME);</span>
<span class="nc" id="L131">        }</span>

        @Override
        protected void definePreferences() throws OceanusException {
<span class="nc" id="L135">            defineEnumPreference(PrometheusDatabasePreferenceKey.DBDRIVER, PrometheusJDBCDriver.class);</span>
<span class="nc" id="L136">            defineStringPreference(PrometheusDatabasePreferenceKey.DBSERVER);</span>
<span class="nc" id="L137">            defineStringPreference(PrometheusDatabasePreferenceKey.DBINSTANCE);</span>
<span class="nc" id="L138">            defineIntegerPreference(PrometheusDatabasePreferenceKey.DBPORT);</span>
<span class="nc" id="L139">            defineStringPreference(PrometheusDatabasePreferenceKey.DBNAME);</span>
<span class="nc" id="L140">            defineIntegerPreference(PrometheusDatabasePreferenceKey.DBBATCH);</span>
<span class="nc" id="L141">            defineStringPreference(PrometheusDatabasePreferenceKey.DBUSER);</span>
<span class="nc" id="L142">            defineCharArrayPreference(PrometheusDatabasePreferenceKey.DBPASS);</span>
<span class="nc" id="L143">        }</span>

        @Override
        public void autoCorrectPreferences() {
            /* Make sure that the enum is specified */
<span class="nc" id="L148">            final MetisEnumPreference&lt;PrometheusJDBCDriver&gt; myTypePref = getEnumPreference(PrometheusDatabasePreferenceKey.DBDRIVER, PrometheusJDBCDriver.class);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">            if (!myTypePref.isAvailable()) {</span>
<span class="nc" id="L150">                myTypePref.setValue(PrometheusJDBCDriver.POSTGRESQL);</span>
            }
<span class="nc" id="L152">            myTypePref.setFilter(VALID_DBS::contains);</span>
<span class="nc" id="L153">            final PrometheusJDBCDriver myDriver = myTypePref.getValue();</span>

            /* Make sure that the hostName is specified */
<span class="nc" id="L156">            MetisStringPreference myPref = getStringPreference(PrometheusDatabasePreferenceKey.DBSERVER);</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">            if (!myPref.isAvailable()) {</span>
<span class="nc" id="L158">                myPref.setValue(&quot;localhost&quot;);</span>
            }

            /* Make sure that the instance is specified (for SQLSERVER) */
<span class="nc" id="L162">            myPref = getStringPreference(PrometheusDatabasePreferenceKey.DBINSTANCE);</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">            myPref.setHidden(!PrometheusJDBCDriver.SQLSERVER.equals(myDriver));</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">            if (myPref.isHidden()) {</span>
<span class="nc" id="L165">                myPref.setValue(null);</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">            } else if (!myPref.isAvailable()) {</span>
<span class="nc" id="L167">                myPref.setValue(PrometheusJDBCDriver.INSTANCE_SQLEXPRESS);</span>
            }

            /* Make sure that the port is specified (for MARIADB/MYSQL/POSTGRESQL) */
<span class="nc" id="L171">            final MetisIntegerPreference myIntPref = getIntegerPreference(PrometheusDatabasePreferenceKey.DBPORT);</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">            myIntPref.setHidden(!myDriver.usePort());</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">            if (myIntPref.isHidden()) {</span>
<span class="nc" id="L174">                myIntPref.setValue(null);</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">            } else if (!myIntPref.isAvailable()) {</span>
<span class="nc" id="L176">                myIntPref.setValue(myDriver.getDefaultPort());</span>
            }

            /* Make sure that the database is specified */
<span class="nc" id="L180">            myPref = getStringPreference(PrometheusDatabasePreferenceKey.DBNAME);</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">            if (!myPref.isAvailable()) {</span>
<span class="nc" id="L182">                myPref.setValue(&quot;MoneyWise&quot;);</span>
            }

            /* Make sure that the user is specified */
<span class="nc" id="L186">            myPref = getStringPreference(PrometheusDatabasePreferenceKey.DBUSER);</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">            if (!myPref.isAvailable()) {</span>
<span class="nc" id="L188">                myPref.setValue(System.getProperty(&quot;user.name&quot;));</span>
            }

            /* Make sure that the passWord is specified */
<span class="nc" id="L192">            final PrometheusCharArrayPreference myPassPref = getCharArrayPreference(PrometheusDatabasePreferenceKey.DBPASS);</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">            if (!myPassPref.isAvailable()) {</span>
<span class="nc" id="L194">                myPassPref.setValue(&quot;secret&quot;.toCharArray());</span>
            }

            /* Make sure that the value is specified */
<span class="nc" id="L198">            final MetisIntegerPreference myBatchPref = getIntegerPreference(PrometheusDatabasePreferenceKey.DBBATCH);</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">            if (!myBatchPref.isAvailable()) {</span>
<span class="nc" id="L200">                myBatchPref.setValue(DEFAULT_DBBATCH);</span>
            }

            /* Define the range */
<span class="nc" id="L204">            myBatchPref.setRange(DEFAULT_DBBATCH, null);</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">            if (!myBatchPref.validate()) {</span>
<span class="nc" id="L206">                myBatchPref.setValue(DEFAULT_DBBATCH);</span>
            }
<span class="nc" id="L208">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>