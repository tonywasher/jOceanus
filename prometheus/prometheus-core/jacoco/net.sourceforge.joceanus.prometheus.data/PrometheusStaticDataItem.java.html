<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrometheusStaticDataItem.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Prometheus Core Application Framework</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.prometheus.data</a> &gt; <span class="el_source">PrometheusStaticDataItem.java</span></div><h1>PrometheusStaticDataItem.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Prometheus: Application Framework
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.prometheus.data;

import net.sourceforge.joceanus.metis.data.MetisDataDifference;
import net.sourceforge.joceanus.metis.data.MetisDataItem.MetisDataFieldId;
import net.sourceforge.joceanus.metis.data.MetisDataItem.MetisDataNamedItem;
import net.sourceforge.joceanus.metis.field.MetisFieldSet;
import net.sourceforge.joceanus.metis.list.MetisListKey;
import net.sourceforge.joceanus.oceanus.base.OceanusException;
import net.sourceforge.joceanus.oceanus.format.OceanusDataFormatter;
import net.sourceforge.joceanus.prometheus.exc.PrometheusDataException;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

/**
 * Template for a Static Data item and List.
 * @author Tony Washer
 */
public abstract class PrometheusStaticDataItem
        extends PrometheusEncryptedDataItem
        implements MetisDataNamedItem {
    /**
     * Report fields.
     */
<span class="nc" id="L44">    private static final PrometheusEncryptedFieldSet&lt;PrometheusStaticDataItem&gt; FIELD_DEFS = PrometheusEncryptedFieldSet.newEncryptedFieldSet(PrometheusStaticDataItem.class);</span>

    /*
     * FieldIds.
     */
    static {
<span class="nc" id="L50">        FIELD_DEFS.declareEncryptedStringField(PrometheusDataResource.DATAITEM_FIELD_NAME, NAMELEN);</span>
<span class="nc" id="L51">        FIELD_DEFS.declareEncryptedStringField(PrometheusDataResource.DATAITEM_FIELD_DESC, DESCLEN);</span>
<span class="nc" id="L52">        FIELD_DEFS.declareBooleanField(PrometheusDataResource.STATICDATA_ENABLED);</span>
<span class="nc" id="L53">        FIELD_DEFS.declareIntegerField(PrometheusDataResource.STATICDATA_SORT);</span>
<span class="nc" id="L54">        FIELD_DEFS.declareEnumField(PrometheusDataResource.STATICDATA_CLASS);</span>
    }

    /**
     * BadId error.
     */
<span class="nc" id="L60">    public static final String ERROR_BADID = PrometheusDataResource.STATICDATA_ERROR_ID.getValue();</span>

    /**
     * BadName error.
     */
<span class="nc" id="L65">    public static final String ERROR_BADNAME = PrometheusDataResource.STATICDATA_ERROR_NAME.getValue();</span>

    /**
     * The Enum Class for this Static Data.
     */
    private final Class&lt;? extends PrometheusStaticDataClass&gt; theEnumClass;

    /**
     * Copy Constructor.
     * @param pList The list to associate the Static Data with
     * @param pSource The static data to copy
     */
    protected PrometheusStaticDataItem(final PrometheusStaticList&lt;?&gt; pList,
                                       final PrometheusStaticDataItem pSource) {
<span class="nc" id="L79">        super(pList, pSource);</span>
<span class="nc" id="L80">        theEnumClass = pSource.getEnumClass();</span>
<span class="nc" id="L81">        setIndexedId(pSource.getIndexedId());</span>
<span class="nc" id="L82">    }</span>

    /**
     * Basic Constructor.
     * @param pList The list to associate the Static Data with
     * @param pValue the name of the new item
     * @throws OceanusException on error
     */
    protected PrometheusStaticDataItem(final PrometheusStaticList&lt;?&gt; pList,
                                       final String pValue) throws OceanusException {
        /* Call super constructor */
<span class="nc" id="L93">        super(pList, 0);</span>

        /* Determine the class */
<span class="nc" id="L96">        theEnumClass = pList.getEnumClass();</span>
<span class="nc" id="L97">        parseEnumValue(pValue);</span>

        /* Record the name */
<span class="nc" id="L100">        setValueName(pValue);</span>
<span class="nc" id="L101">        setValueEnabled(Boolean.TRUE);</span>
<span class="nc" id="L102">    }</span>

    /**
     * Basic Constructor.
     * @param pList The list to associate the Static Data with
     * @param pClass the class of the new item
     * @throws OceanusException on error
     */
    protected PrometheusStaticDataItem(final PrometheusStaticList&lt;?&gt; pList,
                                       final PrometheusStaticDataClass pClass) throws OceanusException {
        /* Call super constructor */
<span class="nc" id="L113">        super(pList, 0);</span>

        /* Determine the class */
<span class="nc" id="L116">        theEnumClass = pList.getEnumClass();</span>

        /* Store the class */
<span class="nc" id="L119">        setValueClass(pClass);</span>

        /* Set encryption */
<span class="nc" id="L122">        setNextDataKeySet();</span>

        /* Access classId and order */
<span class="nc" id="L125">        setIndexedId(pClass.getClassId());</span>
<span class="nc" id="L126">        setValueOrder(pClass.getOrder());</span>

        /* Record the name */
<span class="nc" id="L129">        setValueName(pClass.toString());</span>
<span class="nc" id="L130">        setValueEnabled(Boolean.TRUE);</span>

        /* Set the DataKeySet */
<span class="nc" id="L133">        setNextDataKeySet();</span>
<span class="nc" id="L134">    }</span>

    /**
     * Values constructor.
     * @param pList the List to add to
     * @param pValues the values constructor
     * @throws OceanusException on error
     */
    protected PrometheusStaticDataItem(final PrometheusStaticList&lt;?&gt; pList,
                                       final PrometheusDataValues pValues) throws OceanusException {
        /* Initialise the item */
<span class="nc" id="L145">        super(pList, pValues);</span>

        /* Access formatter */
<span class="nc" id="L148">        final OceanusDataFormatter myFormatter = getDataSet().getDataFormatter();</span>

        /* Protect against exceptions */
        try {
            /* Determine the class */
<span class="nc" id="L153">            theEnumClass = pList.getEnumClass();</span>

            /* Store the Name */
<span class="nc" id="L156">            Object myValue = pValues.getValue(PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">            if (myValue instanceof String s) {</span>
<span class="nc" id="L158">                setValueName(s);</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">            } else if (myValue instanceof byte[] ba) {</span>
<span class="nc" id="L160">                setValueName(ba);</span>
            }

            /* Store the Description */
<span class="nc" id="L164">            myValue = pValues.getValue(PrometheusDataResource.DATAITEM_FIELD_DESC);</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">            if (myValue instanceof String s) {</span>
<span class="nc" id="L166">                setValueDesc(s);</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">            } else if (myValue instanceof byte[] ba) {</span>
<span class="nc" id="L168">                setValueDesc(ba);</span>
            }

            /* Store the class */
<span class="nc" id="L172">            myValue = pValues.getValue(PrometheusDataResource.STATICDATA_CLASS);</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">            if (myValue instanceof String s) {</span>
<span class="nc" id="L174">                parseEnumValue(s);</span>
            } else {
<span class="nc" id="L176">                parseEnumValue(getIndexedId());</span>
            }

            /* Store the Order */
<span class="nc" id="L180">            myValue = pValues.getValue(PrometheusDataResource.STATICDATA_SORT);</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">            if (myValue instanceof Integer i) {</span>
<span class="nc" id="L182">                setValueOrder(i);</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">            } else if (myValue instanceof String s) {</span>
<span class="nc" id="L184">                setValueOrder(myFormatter.parseValue(s, Integer.class));</span>
            }

            /* Store the Enabled flag */
<span class="nc" id="L188">            myValue = pValues.getValue(PrometheusDataResource.STATICDATA_ENABLED);</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">            if (myValue instanceof Boolean b) {</span>
<span class="nc" id="L190">                setValueEnabled(b);</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">            } else if (myValue instanceof String s) {</span>
<span class="nc" id="L192">                setValueEnabled(myFormatter.parseValue(s, Boolean.class));</span>
            } else {
<span class="nc" id="L194">                setValueEnabled(Boolean.TRUE);</span>
            }

            /* Catch Exceptions */
<span class="nc" id="L198">        } catch (NumberFormatException</span>
                 | OceanusException e) {
            /* Pass on exception */
<span class="nc" id="L201">            throw new PrometheusDataException(this, ERROR_CREATEITEM, e);</span>
<span class="nc" id="L202">        }</span>
<span class="nc" id="L203">    }</span>

    @Override
    public MetisFieldSetDef getDataFieldSet() {
<span class="nc" id="L207">        return FIELD_DEFS;</span>
    }

    @Override
    public String formatObject(final OceanusDataFormatter pFormatter) {
<span class="nc" id="L212">        return toString();</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L217">        return getName();</span>
    }

    @Override
    public boolean includeXmlField(final MetisDataFieldId pField) {
        /* Determine whether fields should be included */
<span class="nc bnc" id="L223" title="All 2 branches missed.">        if (PrometheusDataResource.DATAITEM_FIELD_NAME.equals(pField)) {</span>
<span class="nc" id="L224">            return true;</span>
        }
<span class="nc bnc" id="L226" title="All 2 branches missed.">        if (PrometheusDataResource.DATAITEM_FIELD_DESC.equals(pField)) {</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">            return getDesc() != null;</span>
        }
<span class="nc bnc" id="L229" title="All 2 branches missed.">        if (PrometheusDataResource.STATICDATA_ENABLED.equals(pField)) {</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">            return !getEnabled();</span>
        }
<span class="nc bnc" id="L232" title="All 2 branches missed.">        if (PrometheusDataResource.STATICDATA_CLASS.equals(pField)) {</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">            return !getName().equalsIgnoreCase(getStaticClass().name());</span>
        }

        /* Pass call on */
<span class="nc" id="L237">        return super.includeXmlField(pField);</span>
    }

    @Override
    public final String getName() {
<span class="nc" id="L242">        return getValues().getValue(PrometheusDataResource.DATAITEM_FIELD_NAME, String.class);</span>
    }

    /**
     * Return the encrypted name of the Static Data.
     * @return the encrypted name
     */
    public final byte[] getNameBytes() {
<span class="nc" id="L250">        return getValues().getEncryptedBytes(PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
    }

    /**
     * Return the encrypted name field of the Static Data.
     * @return the encrypted field
     */
    private PrometheusEncryptedPair getNameField() {
<span class="nc" id="L258">        return getValues().getEncryptedPair(PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
    }

    /**
     * Return the description of the Static Data.
     * @return the description
     */
    public final String getDesc() {
<span class="nc" id="L266">        return getValues().getValue(PrometheusDataResource.DATAITEM_FIELD_DESC, String.class);</span>
    }

    /**
     * Return the encrypted description of the Static Data.
     * @return the encrypted description
     */
    public final byte[] getDescBytes() {
<span class="nc" id="L274">        return getValues().getEncryptedBytes(PrometheusDataResource.DATAITEM_FIELD_DESC);</span>
    }

    /**
     * Return the encrypted description field of the Static Data.
     * @return the encrypted name
     */
    private PrometheusEncryptedPair getDescField() {
<span class="nc" id="L282">        return getValues().getEncryptedPair(PrometheusDataResource.DATAITEM_FIELD_DESC);</span>
    }

    /**
     * Return the sort order of the Static Data.
     * @return the order
     */
    public final Integer getOrder() {
<span class="nc" id="L290">        return getValues().getValue(PrometheusDataResource.STATICDATA_SORT, Integer.class);</span>
    }

    /**
     * Return the Static class of the Static Data.
     * @return the class
     */
    public final PrometheusStaticDataClass getStaticClass() {
<span class="nc" id="L298">        return getValues().getValue(PrometheusDataResource.STATICDATA_CLASS, PrometheusStaticDataClass.class);</span>
    }

    /**
     * Is the Static item enabled.
     * @return &lt;code&gt;true/false&lt;/code&gt;
     */
    public final boolean getEnabled() {
<span class="nc" id="L306">        return getValues().getValue(PrometheusDataResource.STATICDATA_ENABLED, Boolean.class);</span>
    }

    @Override
    public boolean isDisabled() {
<span class="nc bnc" id="L311" title="All 2 branches missed.">        return !getEnabled();</span>
    }

    /**
     * Obtain the Enum class of this Static Data.
     * @return the class
     */
    protected final Class&lt;? extends PrometheusStaticDataClass&gt; getEnumClass() {
<span class="nc" id="L319">        return theEnumClass;</span>
    }

    /**
     * Set the Name.
     * @param pValue the name
     * @throws OceanusException on error
     */
    private void setValueName(final String pValue) throws OceanusException {
<span class="nc" id="L328">        setEncryptedValue(PrometheusDataResource.DATAITEM_FIELD_NAME, pValue);</span>
<span class="nc" id="L329">    }</span>

    /**
     * Set the Name.
     * @param pBytes the encrypted name
     * @throws OceanusException on error
     */
    private void setValueName(final byte[] pBytes) throws OceanusException {
<span class="nc" id="L337">        setEncryptedValue(PrometheusDataResource.DATAITEM_FIELD_NAME, pBytes, String.class);</span>
<span class="nc" id="L338">    }</span>

    /**
     * Set the Name field.
     * @param pField the encrypted name
     */
    private void setValueName(final PrometheusEncryptedPair pField) {
<span class="nc" id="L345">        getValues().setUncheckedValue(PrometheusDataResource.DATAITEM_FIELD_NAME, pField);</span>
<span class="nc" id="L346">    }</span>

    /**
     * Set the Description.
     * @param pValue the description
     * @throws OceanusException on error
     */
    protected final void setValueDesc(final String pValue) throws OceanusException {
<span class="nc" id="L354">        setEncryptedValue(PrometheusDataResource.DATAITEM_FIELD_DESC, pValue);</span>
<span class="nc" id="L355">    }</span>

    /**
     * Set the Description.
     * @param pBytes the encrypted description
     * @throws OceanusException on error
     */
    private void setValueDesc(final byte[] pBytes) throws OceanusException {
<span class="nc" id="L363">        setEncryptedValue(PrometheusDataResource.DATAITEM_FIELD_DESC, pBytes, String.class);</span>
<span class="nc" id="L364">    }</span>

    /**
     * Set the Description field.
     * @param pField the encrypted description
     */
    private void setValueDesc(final PrometheusEncryptedPair pField) {
<span class="nc" id="L371">        getValues().setUncheckedValue(PrometheusDataResource.DATAITEM_FIELD_DESC, pField);</span>
<span class="nc" id="L372">    }</span>

    /**
     * Set the Enabled flag.
     * @param isEnabled TRUE/FALSE
     */
    protected final void setValueEnabled(final Boolean isEnabled) {
<span class="nc" id="L379">        getValues().setUncheckedValue(PrometheusDataResource.STATICDATA_ENABLED, isEnabled);</span>
<span class="nc" id="L380">    }</span>

    /**
     * Set the Order.
     * @param pOrder the order
     */
    private void setValueOrder(final Integer pOrder) {
<span class="nc" id="L387">        getValues().setUncheckedValue(PrometheusDataResource.STATICDATA_SORT, pOrder);</span>
<span class="nc" id="L388">    }</span>

    /**
     * Set the Class.
     * @param pClass the class
     */
    private void setValueClass(final PrometheusStaticDataClass pClass) {
<span class="nc" id="L395">        getValues().setUncheckedValue(PrometheusDataResource.STATICDATA_CLASS, pClass);</span>
<span class="nc" id="L396">    }</span>

    @Override
    public int compareValues(final PrometheusDataItem pThat) {
        /* Access as StaticDataItem */
<span class="nc" id="L401">        final PrometheusStaticDataItem myThat = (PrometheusStaticDataItem) pThat;</span>

        /* Make sure that the object is the same enumeration class */
<span class="nc bnc" id="L404" title="All 2 branches missed.">        if (!MetisDataDifference.isEqual(getEnumClass(), myThat.getEnumClass())) {</span>
            /* Order the classes by canonical name */
<span class="nc" id="L406">            return getEnumClass().getCanonicalName().compareTo(myThat.getEnumClass().getCanonicalName());</span>
        }

        /* Compare on order and name */
<span class="nc" id="L410">        final int iDiff = getOrder() - myThat.getOrder();</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">        return iDiff != 0 ? iDiff : MetisDataDifference.compareObject(getName(), myThat.getName());</span>
    }

    @Override
    public PrometheusStaticList&lt;?&gt; getList() {
<span class="nc" id="L416">        return (PrometheusStaticList&lt;?&gt;) super.getList();</span>
    }

    /**
     * Parse enum type.
     * @param pValue the value
     * @throws OceanusException on error
     */
    private void parseEnumValue(final String pValue) throws OceanusException {
<span class="nc" id="L425">        final Class&lt;? extends PrometheusStaticDataClass&gt; myClass = getEnumClass();</span>
<span class="nc" id="L426">        final PrometheusStaticDataClass[] myEnums = myClass.getEnumConstants();</span>

        /* Loop through the enum constants */
<span class="nc bnc" id="L429" title="All 2 branches missed.">        for (PrometheusStaticDataClass myValue : myEnums) {</span>
            /* If this is the desired value */
<span class="nc bnc" id="L431" title="All 2 branches missed.">            if (myValue.toString().equalsIgnoreCase(pValue)) {</span>
                /* Store the class */
<span class="nc" id="L433">                setValueClass(myValue);</span>

                /* Access classId and order */
<span class="nc" id="L436">                setIndexedId(myValue.getClassId());</span>
<span class="nc" id="L437">                setValueOrder(myValue.getOrder());</span>
<span class="nc" id="L438">                break;</span>
            }
        }

        /* Reject if we didn't find the class */
<span class="nc bnc" id="L443" title="All 2 branches missed.">        if (getStaticClass() == null) {</span>
<span class="nc" id="L444">            throw new PrometheusDataException(ERROR_BADNAME + &quot; &quot; + myClass.getSimpleName() + &quot;: &quot; + pValue);</span>
        }
<span class="nc" id="L446">    }</span>

    /**
     * Parse enum type.
     * @param pValue the value
     * @throws OceanusException on error
     */
    private void parseEnumValue(final Integer pValue) throws OceanusException {
<span class="nc" id="L454">        final Class&lt;? extends PrometheusStaticDataClass&gt; myClass = getEnumClass();</span>
<span class="nc" id="L455">        final PrometheusStaticDataClass[] myEnums = myClass.getEnumConstants();</span>

        /* Loop through the enum constants */
<span class="nc bnc" id="L458" title="All 2 branches missed.">        for (PrometheusStaticDataClass myValue : myEnums) {</span>
            /* If this is the desired value */
<span class="nc bnc" id="L460" title="All 2 branches missed.">            if (pValue.equals(myValue.getClassId())) {</span>
                /* Store the class */
<span class="nc" id="L462">                setValueClass(myValue);</span>

                /* Access classId and order */
<span class="nc" id="L465">                setIndexedId(myValue.getClassId());</span>
<span class="nc" id="L466">                setValueOrder(myValue.getOrder());</span>
<span class="nc" id="L467">                break;</span>
            }
        }

        /* Reject if we didn't find the class */
<span class="nc bnc" id="L472" title="All 2 branches missed.">        if (getStaticClass() == null) {</span>
<span class="nc" id="L473">            throw new PrometheusDataException(ERROR_BADNAME + &quot; &quot; + myClass.getSimpleName() + &quot;: &quot; + pValue);</span>
        }
<span class="nc" id="L475">    }</span>

    /**
     * Set a new name.
     * @param pName the name
     * @throws OceanusException on error
     */
    public void setName(final String pName) throws OceanusException {
<span class="nc" id="L483">        setValueName(pName);</span>
<span class="nc" id="L484">    }</span>

    /**
     * Set a new description.
     * @param pDesc the description
     * @throws OceanusException on error
     */
    public void setDescription(final String pDesc) throws OceanusException {
        /* Set the appropriate value */
<span class="nc" id="L493">        setValueDesc(pDesc);</span>
<span class="nc" id="L494">    }</span>

    /**
     * Set Enabled indicator.
     * @param isEnabled TRUE/FALSE
     */
    public void setEnabled(final boolean isEnabled) {
        /* Set the appropriate value */
<span class="nc" id="L502">        setValueEnabled(isEnabled);</span>
<span class="nc" id="L503">    }</span>

    /**
     * Set Order indicator.
     * @param iOrder the order
     */
    public void setOrder(final int iOrder) {
        /* Set the appropriate value */
<span class="nc" id="L511">        setValueOrder(iOrder);</span>
<span class="nc" id="L512">    }</span>

    @Override
    public boolean applyChanges(final PrometheusDataItem pData) {
        /* Can only apply changes for Static Data */
<span class="nc bnc" id="L517" title="All 2 branches missed.">        if (!(pData instanceof PrometheusStaticDataItem)) {</span>
<span class="nc" id="L518">            return false;</span>
        }

        /* Access the data */
<span class="nc" id="L522">        final PrometheusStaticDataItem myData = (PrometheusStaticDataItem) pData;</span>

        /* Store the current detail into history */
<span class="nc" id="L525">        pushHistory();</span>

        /* Apply basic changes */
<span class="nc" id="L528">        applyBasicChanges(myData);</span>

        /* Check for changes */
<span class="nc" id="L531">        return checkForHistory();</span>
    }

    /**
     * Apply basic changes.
     * @param pData the changed element
     */
    protected void applyBasicChanges(final PrometheusStaticDataItem pData) {
        /* Update the name if required */
<span class="nc bnc" id="L540" title="All 2 branches missed.">        if (!MetisDataDifference.isEqual(getName(), pData.getName())) {</span>
<span class="nc" id="L541">            setValueName(pData.getNameField());</span>
        }

        /* Update the description if required */
<span class="nc bnc" id="L545" title="All 2 branches missed.">        if (!MetisDataDifference.isEqual(getDesc(), pData.getDesc())) {</span>
<span class="nc" id="L546">            setValueDesc(pData.getDescField());</span>
        }

        /* Update the enabled indication if required */
<span class="nc bnc" id="L550" title="All 2 branches missed.">        if (!MetisDataDifference.isEqual(getEnabled(), pData.getEnabled())) {</span>
<span class="nc" id="L551">            setEnabled(pData.getEnabled());</span>
        }

        /* Update the order indication if required */
<span class="nc bnc" id="L555" title="All 2 branches missed.">        if (!MetisDataDifference.isEqual(getOrder(), pData.getOrder())) {</span>
<span class="nc" id="L556">            setOrder(pData.getOrder());</span>
        }
<span class="nc" id="L558">    }</span>

    @Override
    public void adjustMapForItem() {
<span class="nc" id="L562">        final PrometheusStaticList&lt;?&gt; myList = getList();</span>
<span class="nc" id="L563">        final PrometheusStaticDataMap&lt;?&gt; myMap = myList.getDataMap();</span>
<span class="nc" id="L564">        myMap.adjustForItem(myList.getBaseClass().cast(this));</span>
<span class="nc" id="L565">    }</span>

    /**
     * Represents a list of StaticData objects.
     * @param &lt;T&gt; the item type
     */
    public abstract static class PrometheusStaticList&lt;T extends PrometheusStaticDataItem&gt;
            extends PrometheusEncryptedList&lt;T&gt; {
        /*
         * Report fields.
         */
        static {
<span class="nc" id="L577">            MetisFieldSet.newFieldSet(PrometheusStaticList.class);</span>
<span class="nc" id="L578">        }</span>

        /**
         * Construct a generic static data list.
         * @param pBaseClass the class of the underlying object
         * @param pData the dataSet
         * @param pItemType the item type
         * @param pStyle the style of the list
         */
        protected PrometheusStaticList(final Class&lt;T&gt; pBaseClass,
                                       final PrometheusDataSet pData,
                                       final MetisListKey pItemType,
                                       final PrometheusListStyle pStyle) {
<span class="nc" id="L591">            super(pBaseClass, pData, pItemType, pStyle);</span>
<span class="nc" id="L592">        }</span>

        /**
         * Constructor for a cloned List.
         * @param pSource the source List
         */
        protected PrometheusStaticList(final PrometheusStaticList&lt;T&gt; pSource) {
<span class="nc" id="L599">            super(pSource);</span>
<span class="nc" id="L600">        }</span>

        /**
         * Obtain the enumClass.
         * @return the enumClass
         */
        protected abstract Class&lt;? extends PrometheusStaticDataClass&gt; getEnumClass();

        @Override
        @SuppressWarnings(&quot;unchecked&quot;)
        public PrometheusStaticDataMap&lt;T&gt; getDataMap() {
<span class="nc" id="L611">            return (PrometheusStaticDataMap&lt;T&gt;) super.getDataMap();</span>
        }

        /**
         * Search for a particular item by class.
         * @param eClass The class of the item to search for
         * @return The Item if present (or &lt;code&gt;null&lt;/code&gt; if not found)
         */
        public T findItemByClass(final PrometheusStaticDataClass eClass) {
            /* Look for item by class Id */
<span class="nc" id="L621">            return findItemById(eClass.getClassId());</span>
        }

        @Override
        public T findItemByName(final String pName) {
            /* look up the name in the map */
<span class="nc" id="L627">            return getDataMap().findItemByName(pName);</span>
        }

        /**
         * Is the list full?
         * @return true/false
         */
        public boolean isFull() {
            /* We can only be full with the correct number of items */
<span class="nc bnc" id="L636" title="All 2 branches missed.">            if (size() &lt; getEnumClass().getEnumConstants().length) {</span>
<span class="nc" id="L637">                return false;</span>
            }

            /* Loop through all elements */
<span class="nc" id="L641">            final Iterator&lt;T&gt; myIterator = iterator();</span>
<span class="nc bnc" id="L642" title="All 2 branches missed.">            while (myIterator.hasNext()) {</span>
<span class="nc" id="L643">                final T myCurr = myIterator.next();</span>

                /* If the item is deleted */
<span class="nc bnc" id="L646" title="All 2 branches missed.">                if (myCurr.isDeleted()) {</span>
                    /* Not full */
<span class="nc" id="L648">                    return false;</span>
                }
<span class="nc" id="L650">            }</span>

            /* Must be full */
<span class="nc" id="L653">            return true;</span>
        }

        /**
         * Obtain a list of classes that are missing/deleted.
         * @return The List of classes
         */
        public List&lt;PrometheusStaticDataClass&gt; getMissingClasses() {
            /* Allocate the list */
<span class="nc" id="L662">            final List&lt;PrometheusStaticDataClass&gt; myList = new ArrayList&lt;&gt;();</span>

            /* Loop through all elements */
<span class="nc bnc" id="L665" title="All 2 branches missed.">            for (PrometheusStaticDataClass myClass : getEnumClass().getEnumConstants()) {</span>
                /* Locate the element */
<span class="nc" id="L667">                final T myItem = findItemById(myClass.getClassId());</span>

                /* If the item is missing or deleted */
<span class="nc bnc" id="L670" title="All 2 branches missed.">                if ((myItem == null)</span>
<span class="nc bnc" id="L671" title="All 2 branches missed.">                        || myItem.isDeleted()) {</span>
                    /* Add it to the list */
<span class="nc" id="L673">                    myList.add(myClass);</span>
                }
            }

            /* Return the list */
<span class="nc" id="L678">            return myList;</span>
        }

        /**
         * Add Item for class.
         * @param pClass the class to add
         * @return the added class
         * @throws OceanusException on error
         */
        public T addNewItem(final PrometheusStaticDataClass pClass) throws OceanusException {
            /* Create the new item */
<span class="nc" id="L689">            return newItem(pClass);</span>
        }

        /**
         * Create new Item for class.
         * @param pClass the class to create
         * @return the created class
         * @throws OceanusException on error
         */
        protected abstract T newItem(PrometheusStaticDataClass pClass) throws OceanusException;

        /**
         * Populate default values.
         * @throws OceanusException on error
         */
        public void populateDefaults() throws OceanusException {
            /* Loop through all elements */
<span class="nc bnc" id="L706" title="All 2 branches missed.">            for (PrometheusStaticDataClass myClass : getEnumClass().getEnumConstants()) {</span>
                /* Create new element */
<span class="nc" id="L708">                final T myItem = newItem(myClass);</span>

                /* Validate the item */
<span class="nc" id="L711">                myItem.validate();</span>

                /* Handle validation failure */
<span class="nc bnc" id="L714" title="All 2 branches missed.">                if (myItem.hasErrors()) {</span>
<span class="nc" id="L715">                    throw new PrometheusDataException(myItem, ERROR_VALIDATION);</span>
                }
            }

            /* Ensure that the list is sorted */
<span class="nc" id="L720">            reSort();</span>
<span class="nc" id="L721">        }</span>

        @Override
        protected PrometheusDataMapItem allocateDataMap() {
<span class="nc" id="L725">            return new PrometheusStaticDataMap&lt;&gt;();</span>
        }
    }

    /**
     * The dataMap class.
     * @param &lt;T&gt; the item type
     */
    public static class PrometheusStaticDataMap&lt;T extends PrometheusStaticDataItem&gt;
            extends PrometheusDataInstanceMap&lt;T, String&gt; {
        /**
         * Report fields.
         */
        @SuppressWarnings(&quot;rawtypes&quot;)
<span class="nc" id="L739">        private static final MetisFieldSet&lt;PrometheusStaticDataMap&gt; FIELD_DEFS = MetisFieldSet.newFieldSet(PrometheusStaticDataMap.class);</span>

        /*
         * Declare Fields.
         */
        static {
<span class="nc" id="L745">            FIELD_DEFS.declareLocalField(PrometheusDataResource.STATICDATAMAP_ORDERCOUNTS, PrometheusStaticDataMap::getOrderCountMap);</span>
<span class="nc" id="L746">        }</span>

        /**
         * Map of order counts.
         */
        private final Map&lt;Integer, Integer&gt; theOrderCountMap;

        /**
         * Constructor.
         */
<span class="nc" id="L756">        public PrometheusStaticDataMap() {</span>
            /* Create the maps */
<span class="nc" id="L758">            theOrderCountMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L759">        }</span>

        @SuppressWarnings(&quot;rawtypes&quot;)
        @Override
        public MetisFieldSet&lt;? extends PrometheusStaticDataMap&gt; getDataFieldSet() {
<span class="nc" id="L764">            return FIELD_DEFS;</span>
        }

        @Override
        public String formatObject(final OceanusDataFormatter pFormatter) {
<span class="nc" id="L769">            return FIELD_DEFS.getName();</span>
        }

        /**
         * Obtain the keyMap.
         * @return the map
         */
        private Map&lt;Integer, Integer&gt; getOrderCountMap() {
<span class="nc" id="L777">            return theOrderCountMap;</span>
        }

        @Override
        public void resetMap() {
<span class="nc" id="L782">            super.resetMap();</span>
<span class="nc" id="L783">            theOrderCountMap.clear();</span>
<span class="nc" id="L784">        }</span>

        @Override
        @SuppressWarnings(&quot;unchecked&quot;)
        public void adjustForItem(final PrometheusDataItem pItem) {
            /* Access item */
<span class="nc" id="L790">            final T myItem = (T) pItem;</span>

            /* Adjust order count */
<span class="nc" id="L793">            final Integer myOrder = myItem.getOrder();</span>
<span class="nc" id="L794">            final Integer myCount = theOrderCountMap.get(myOrder);</span>
<span class="nc bnc" id="L795" title="All 2 branches missed.">            if (myCount == null) {</span>
<span class="nc" id="L796">                theOrderCountMap.put(myOrder, ONE);</span>
            } else {
<span class="nc" id="L798">                theOrderCountMap.put(myOrder, myCount + 1);</span>
            }

            /* Adjust name count */
<span class="nc" id="L802">            adjustForItem(myItem, myItem.getName());</span>
<span class="nc" id="L803">        }</span>

        /**
         * find item by name.
         * @param pName the name to look up
         * @return the matching item
         */
        public T findItemByName(final String pName) {
<span class="nc" id="L811">            return findItemByKey(pName);</span>
        }

        /**
         * Check validity of name.
         * @param pName the name to look up
         * @return true/false
         */
        public boolean validNameCount(final String pName) {
<span class="nc" id="L820">            return validKeyCount(pName);</span>
        }

        /**
         * Check availability of name.
         * @param pName the key to look up
         * @return true/false
         */
        public boolean availableName(final String pName) {
<span class="nc" id="L829">            return availableKey(pName);</span>
        }

        /**
         * Check validity of order.
         * @param pOrder the order to look up
         * @return true/false
         */
        public boolean validOrderCount(final Integer pOrder) {
<span class="nc" id="L838">            final Integer myResult = theOrderCountMap.get(pOrder);</span>
<span class="nc" id="L839">            return ONE.equals(myResult);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>