<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrometheusEncryptor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Prometheus Core Application Framework</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.prometheus.data</a> &gt; <span class="el_source">PrometheusEncryptor.java</span></div><h1>PrometheusEncryptor.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Prometheus: Application Framework
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.prometheus.data;

import net.sourceforge.joceanus.gordianknot.api.base.GordianException;
import net.sourceforge.joceanus.gordianknot.api.keyset.GordianKeySet;
import net.sourceforge.joceanus.metis.data.MetisDataDifference;
import net.sourceforge.joceanus.metis.data.MetisDataType;
import net.sourceforge.joceanus.metis.field.MetisFieldItem.MetisFieldDef;
import net.sourceforge.joceanus.oceanus.base.OceanusException;
import net.sourceforge.joceanus.oceanus.convert.OceanusDataConverter;
import net.sourceforge.joceanus.oceanus.date.OceanusDate;
import net.sourceforge.joceanus.oceanus.decimal.OceanusDecimal;
import net.sourceforge.joceanus.oceanus.decimal.OceanusMoney;
import net.sourceforge.joceanus.oceanus.decimal.OceanusPrice;
import net.sourceforge.joceanus.oceanus.decimal.OceanusRate;
import net.sourceforge.joceanus.oceanus.decimal.OceanusRatio;
import net.sourceforge.joceanus.oceanus.decimal.OceanusUnits;
import net.sourceforge.joceanus.oceanus.format.OceanusDataFormatter;
import net.sourceforge.joceanus.prometheus.exc.PrometheusDataException;
import net.sourceforge.joceanus.prometheus.exc.PrometheusLogicException;
import net.sourceforge.joceanus.prometheus.exc.PrometheusSecurityException;

import java.util.EnumMap;
import java.util.Map;

/**
 * Encryptor/Decryptor.
 */
public class PrometheusEncryptor {
    /**
     * Encrypted data conversion failure message.
     */
    private static final String ERROR_BYTES_CONVERT = &quot;Failed to convert value from bytes&quot;;

    /**
     * Invalid class error text.
     */
    private static final String ERROR_CLASS = &quot;Invalid Object Class for Encryption &quot;;

    /**
     * Unsupported dataType error text.
     */
    private static final String ERROR_DATATYPE = &quot;Unsupported Data Type&quot;;

    /**
     * The Encryptor map.
     */
<span class="nc" id="L63">    private static final Map&lt;MetisDataType, PrometheusDataEncryptor&gt; ENCRYPTORS = buildEncryptorMap();</span>

    /**
     * The KeySet.
     */
    private final GordianKeySet theKeySet;

    /**
     * The Data formatter.
     */
    private final OceanusDataFormatter theFormatter;

    /**
     * Constructor.
     * @param pFormatter the formatter
     * @param pKeySet the keySet
     */
    public PrometheusEncryptor(final OceanusDataFormatter pFormatter,
<span class="nc" id="L81">                               final GordianKeySet pKeySet) {</span>
<span class="nc" id="L82">        theFormatter = pFormatter;</span>
<span class="nc" id="L83">        theKeySet = pKeySet;</span>
<span class="nc" id="L84">    }</span>

    /**
     * Obtain the keySet.
     * @return the keySet
     */
    public GordianKeySet getKeySet() {
<span class="nc" id="L91">        return theKeySet;</span>
    }

    /**
     * Encrypt a value.
     * @param pValue the value to encrypt.
     * @return the encryptedBytes
     * @throws OceanusException on error
     */
    public byte[] encryptValue(final Object pValue) throws OceanusException {
        /* Protect against exceptions */
        try {
            /* Access the encryptor */
<span class="nc" id="L104">            final MetisDataType myDataType = getDataTypeForValue(pValue);</span>
<span class="nc" id="L105">            final PrometheusDataEncryptor myEncryptor = ENCRYPTORS.get(myDataType);</span>

<span class="nc" id="L107">            final byte[] myBytes = myEncryptor.convertValue(theFormatter, pValue);</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">            return theKeySet == null ? null : theKeySet.encryptBytes(myBytes);</span>
<span class="nc" id="L109">        } catch (GordianException e) {</span>
<span class="nc" id="L110">            throw new PrometheusSecurityException(e);</span>
        }
    }

    /**
     * Encrypt a value.
     * @param pCurrent the current value
     * @param pValue the value to encrypt.
     * @return the encryptedPair.
     * @throws OceanusException on error
     */
    public PrometheusEncryptedPair encryptValue(final PrometheusEncryptedPair pCurrent,
                                                final Object pValue) throws OceanusException {
        /* If we are passed a null value just return null */
<span class="nc bnc" id="L124" title="All 2 branches missed.">        if (pValue == null) {</span>
<span class="nc" id="L125">            return null;</span>
        }

        /* If we have no keySet or else a different keySet, ignore the current value */
<span class="nc" id="L129">        PrometheusEncryptedPair myCurrent = pCurrent;</span>
<span class="nc bnc" id="L130" title="All 4 branches missed.">        if (myCurrent != null</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">                &amp;&amp; (theKeySet == null || !theKeySet.equals(myCurrent.getKeySet()))) {</span>
<span class="nc" id="L132">            myCurrent = null;</span>
        }

        /* If the value is not changed return the current value */
<span class="nc bnc" id="L136" title="All 2 branches missed.">        if (myCurrent != null</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">                &amp;&amp; MetisDataDifference.isEqual(myCurrent.getValue(), pValue)) {</span>
<span class="nc" id="L138">            return pCurrent;</span>
        }

        /* Encrypt the data */
<span class="nc" id="L142">        final byte[] myEncrypted = encryptValue(pValue);</span>
<span class="nc" id="L143">        return new PrometheusEncryptedPair(theKeySet, pValue, myEncrypted);</span>
    }

    /**
     * Encrypt a value.
     * @param pValue the value to encrypt.
     * @param pField the field definition
     * @return the encryptedPair.
     * @throws OceanusException on error
     */
    public PrometheusEncryptedPair encryptValue(final Object pValue,
                                                final MetisFieldDef pField) throws OceanusException {
        /* Protect against exceptions */
        try {
            /* If we are passed a null value just return null */
<span class="nc bnc" id="L158" title="All 2 branches missed.">            if (pValue == null) {</span>
<span class="nc" id="L159">                return null;</span>
            }

            /* Handle Context dataType */
<span class="nc" id="L163">            MetisDataType myDataType = pField.getDataType();</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">            if (myDataType == MetisDataType.CONTEXT) {</span>
<span class="nc" id="L165">                myDataType = getDataTypeForValue(pValue);</span>
            }

            /* Access the encryptor */
<span class="nc" id="L169">            final PrometheusDataEncryptor myEncryptor = ENCRYPTORS.get(myDataType);</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">            if (myEncryptor == null) {</span>
<span class="nc" id="L171">                throw new PrometheusLogicException(ERROR_DATATYPE);</span>
            }

            /* Encrypt the data */
<span class="nc" id="L175">            final byte[] myBytes = myEncryptor.convertValue(theFormatter, pValue);</span>
<span class="nc" id="L176">            final byte[] myEncrypted = theKeySet.encryptBytes(myBytes);</span>
<span class="nc" id="L177">            return new PrometheusEncryptedPair(theKeySet, pValue, myEncrypted);</span>
<span class="nc" id="L178">        } catch (GordianException e) {</span>
<span class="nc" id="L179">            throw new PrometheusSecurityException(e);</span>
        }
    }

    /**
     * Decrypt bytes.
     * @param pBytes the bytes to decrypt.
     * @param pField the field definition
     * @return the encryptedPair.
     * @throws OceanusException on error
     */
    PrometheusEncryptedPair decryptValue(final byte[] pBytes,
                                         final MetisFieldDef pField) throws OceanusException {
        /* Protect agains exceptions */
        try {
            /* Access the encryptor */
<span class="nc" id="L195">            final PrometheusDataEncryptor myEncryptor = ENCRYPTORS.get(pField.getDataType());</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">            if (myEncryptor == null) {</span>
<span class="nc" id="L197">                throw new PrometheusLogicException(ERROR_DATATYPE);</span>
            }

            /* Decrypt the data */
<span class="nc" id="L201">            final byte[] myDecrypted = theKeySet.decryptBytes(pBytes);</span>
<span class="nc" id="L202">            final Object myValue = myEncryptor.parseValue(theFormatter, myDecrypted);</span>
<span class="nc" id="L203">            return new PrometheusEncryptedPair(theKeySet, myValue, pBytes);</span>
<span class="nc" id="L204">        } catch (GordianException e) {</span>
<span class="nc" id="L205">            throw new PrometheusSecurityException(e);</span>
        }
    }

    /**
     * Decrypt bytes.
     * @param pBytes the bytes to decrypt.
     * @param pClazz the class to decrypt to
     * @return the encryptedPair.
     * @throws OceanusException on error
     */
    PrometheusEncryptedPair decryptValue(final byte[] pBytes,
                                         final Class&lt;?&gt; pClazz) throws OceanusException {
        /* Protect agains exceptions */
        try {
            /* Access the encryptor */
<span class="nc" id="L221">            final MetisDataType myDataType = getDataTypeForClass(pClazz);</span>
<span class="nc" id="L222">            final PrometheusDataEncryptor myEncryptor = ENCRYPTORS.get(myDataType);</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">            if (myEncryptor == null) {</span>
<span class="nc" id="L224">                throw new PrometheusLogicException(ERROR_DATATYPE);</span>
            }

            /* Decrypt the data */
<span class="nc" id="L228">            final byte[] myDecrypted = theKeySet.decryptBytes(pBytes);</span>
<span class="nc" id="L229">            final Object myValue = myEncryptor.parseValue(theFormatter, myDecrypted);</span>
<span class="nc" id="L230">            return new PrometheusEncryptedPair(theKeySet, myValue, pBytes);</span>
<span class="nc" id="L231">        } catch (GordianException e) {</span>
<span class="nc" id="L232">            throw new PrometheusSecurityException(e);</span>
        }
    }

    /**
     * Determine dataType.
     * @param pValue the value
     * @return the dataType
     * @throws OceanusException on error
     */
    public static MetisDataType getDataTypeForValue(final Object pValue) throws OceanusException {
<span class="nc bnc" id="L243" title="All 2 branches missed.">        if (pValue instanceof String) {</span>
<span class="nc" id="L244">            return MetisDataType.STRING;</span>
        }
<span class="nc bnc" id="L246" title="All 2 branches missed.">        if (pValue instanceof Short) {</span>
<span class="nc" id="L247">            return MetisDataType.SHORT;</span>
        }
<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (pValue instanceof Integer) {</span>
<span class="nc" id="L250">            return MetisDataType.INTEGER;</span>
        }
<span class="nc bnc" id="L252" title="All 2 branches missed.">        if (pValue instanceof Long) {</span>
<span class="nc" id="L253">            return MetisDataType.LONG;</span>
        }
<span class="nc bnc" id="L255" title="All 2 branches missed.">        if (pValue instanceof Boolean) {</span>
<span class="nc" id="L256">            return MetisDataType.BOOLEAN;</span>
        }
<span class="nc bnc" id="L258" title="All 2 branches missed.">        if (pValue instanceof char[]) {</span>
<span class="nc" id="L259">            return MetisDataType.CHARARRAY;</span>
        }

        /* Handle decimal instances */
<span class="nc bnc" id="L263" title="All 2 branches missed.">        if (pValue instanceof OceanusDate) {</span>
<span class="nc" id="L264">            return MetisDataType.DATE;</span>
        }
<span class="nc bnc" id="L266" title="All 2 branches missed.">        if (pValue instanceof OceanusUnits) {</span>
<span class="nc" id="L267">            return MetisDataType.UNITS;</span>
        }
<span class="nc bnc" id="L269" title="All 2 branches missed.">        if (pValue instanceof OceanusRate) {</span>
<span class="nc" id="L270">            return MetisDataType.RATE;</span>
        }
<span class="nc bnc" id="L272" title="All 2 branches missed.">        if (pValue instanceof OceanusPrice) {</span>
<span class="nc" id="L273">            return MetisDataType.PRICE;</span>
        }
<span class="nc bnc" id="L275" title="All 2 branches missed.">        if (pValue instanceof OceanusMoney) {</span>
<span class="nc" id="L276">            return MetisDataType.MONEY;</span>
        }
<span class="nc bnc" id="L278" title="All 2 branches missed.">        if (pValue instanceof OceanusRatio) {</span>
<span class="nc" id="L279">            return MetisDataType.RATIO;</span>
        }

        /* Unsupported so reject */
<span class="nc" id="L283">        throw new PrometheusLogicException(ERROR_CLASS</span>
<span class="nc" id="L284">                + pValue.getClass().getCanonicalName());</span>
    }

    /**
     * Determine dataType.
     * @param pClazz the class
     * @return the dataType
     * @throws OceanusException on error
     */
    static MetisDataType getDataTypeForClass(final Class&lt;?&gt; pClazz) throws OceanusException {
<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (String.class.equals(pClazz)) {</span>
<span class="nc" id="L295">            return MetisDataType.STRING;</span>
        }
<span class="nc bnc" id="L297" title="All 2 branches missed.">        if (Short.class.equals(pClazz)) {</span>
<span class="nc" id="L298">            return MetisDataType.SHORT;</span>
        }
<span class="nc bnc" id="L300" title="All 2 branches missed.">        if (Integer.class.equals(pClazz)) {</span>
<span class="nc" id="L301">            return MetisDataType.INTEGER;</span>
        }
<span class="nc bnc" id="L303" title="All 2 branches missed.">        if (Long.class.equals(pClazz)) {</span>
<span class="nc" id="L304">            return MetisDataType.LONG;</span>
        }
<span class="nc bnc" id="L306" title="All 2 branches missed.">        if (Boolean.class.equals(pClazz)) {</span>
<span class="nc" id="L307">            return MetisDataType.BOOLEAN;</span>
        }
<span class="nc bnc" id="L309" title="All 2 branches missed.">        if (char[].class.equals(pClazz)) {</span>
<span class="nc" id="L310">            return MetisDataType.CHARARRAY;</span>
        }

        /* Handle decimal instances */
<span class="nc bnc" id="L314" title="All 2 branches missed.">        if (OceanusDate.class.equals(pClazz)) {</span>
<span class="nc" id="L315">            return MetisDataType.DATE;</span>
        }
<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (OceanusUnits.class.equals(pClazz)) {</span>
<span class="nc" id="L318">            return MetisDataType.UNITS;</span>
        }
<span class="nc bnc" id="L320" title="All 2 branches missed.">        if (OceanusRate.class.equals(pClazz)) {</span>
<span class="nc" id="L321">            return MetisDataType.RATE;</span>
        }
<span class="nc bnc" id="L323" title="All 2 branches missed.">        if (OceanusPrice.class.equals(pClazz)) {</span>
<span class="nc" id="L324">            return MetisDataType.PRICE;</span>
        }
<span class="nc bnc" id="L326" title="All 2 branches missed.">        if (OceanusMoney.class.equals(pClazz)) {</span>
<span class="nc" id="L327">            return MetisDataType.MONEY;</span>
        }
<span class="nc bnc" id="L329" title="All 2 branches missed.">        if (OceanusRatio.class.equals(pClazz)) {</span>
<span class="nc" id="L330">            return MetisDataType.RATIO;</span>
        }

        /* Unsupported so reject */
<span class="nc" id="L334">        throw new PrometheusLogicException(ERROR_CLASS</span>
<span class="nc" id="L335">                + pClazz.getCanonicalName());</span>
    }

    /**
     * Build the encryptor map.
     * @return the map
     */
    private static Map&lt;MetisDataType, PrometheusDataEncryptor&gt; buildEncryptorMap() {
<span class="nc" id="L343">        final Map&lt;MetisDataType, PrometheusDataEncryptor&gt; myMap = new EnumMap&lt;&gt;(MetisDataType.class);</span>
<span class="nc" id="L344">        myMap.put(MetisDataType.DATE, new PrometheusDateEncryptor());</span>
<span class="nc" id="L345">        myMap.put(MetisDataType.SHORT, new PrometheusShortEncryptor());</span>
<span class="nc" id="L346">        myMap.put(MetisDataType.INTEGER, new PrometheusIntegerEncryptor());</span>
<span class="nc" id="L347">        myMap.put(MetisDataType.LONG, new PrometheusLongEncryptor());</span>
<span class="nc" id="L348">        myMap.put(MetisDataType.STRING, new PrometheusStringEncryptor());</span>
<span class="nc" id="L349">        myMap.put(MetisDataType.CHARARRAY, new PrometheusCharArrayEncryptor());</span>
<span class="nc" id="L350">        myMap.put(MetisDataType.BOOLEAN, new PrometheusBooleanEncryptor());</span>
<span class="nc" id="L351">        myMap.put(MetisDataType.MONEY, new PrometheusMoneyEncryptor());</span>
<span class="nc" id="L352">        myMap.put(MetisDataType.PRICE, new PrometheusPriceEncryptor());</span>
<span class="nc" id="L353">        myMap.put(MetisDataType.RATE, new PrometheusRateEncryptor());</span>
<span class="nc" id="L354">        myMap.put(MetisDataType.UNITS, new PrometheusUnitsEncryptor());</span>
<span class="nc" id="L355">        myMap.put(MetisDataType.RATIO, new PrometheusRatioEncryptor());</span>
<span class="nc" id="L356">        return myMap;</span>
    }

    /**
     * Adopt Encryption.
     * @param pTarget the target field
     * @param pSource the source field
     * @throws OceanusException on error
     */
    public void adoptEncryption(final PrometheusEncryptedPair pTarget,
                                final PrometheusEncryptedPair pSource) throws OceanusException {
        /* Adopt the encryption */
<span class="nc" id="L368">        pTarget.adoptEncryption(this, pSource);</span>
<span class="nc" id="L369">    }</span>

    /**
     * Encryptor Base.
     */
    private interface PrometheusDataEncryptor {
        /**
         * Convert a value to bytes.
         * @param pFormatter the data formatter
         * @param pValue the value to convert.
         * @return the converted bytes.
         * @throws OceanusException on error
         */
        byte[] convertValue(OceanusDataFormatter pFormatter,
                            Object pValue) throws OceanusException;

        /**
         * Parse a value from bytes.
         * @param pFormatter the data formatter
         * @param pBytes the bytes to parse.
         * @return the parsed value.
         * @throws OceanusException on error
         */
        Object parseValue(OceanusDataFormatter pFormatter,
                          byte[] pBytes) throws OceanusException;
    }

    /**
     * DateEncryptor.
     */
    private static final class PrometheusDateEncryptor
        implements PrometheusDataEncryptor {
        @Override
        public byte[] convertValue(final OceanusDataFormatter pFormatter,
                                   final Object pValue) {
<span class="nc" id="L404">            return pFormatter.getDateFormatter().toBytes((OceanusDate) pValue);</span>
        }

        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) throws OceanusException {
            try {
<span class="nc" id="L411">                return pFormatter.getDateFormatter().fromBytes(pBytes);</span>
<span class="nc" id="L412">            } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L413">                throw new PrometheusDataException(ERROR_BYTES_CONVERT, e);</span>
            }
        }
    }

    /**
     * IntegerEncryptor.
     */
    private static final class PrometheusShortEncryptor
            implements PrometheusDataEncryptor {
        @Override
        public byte[] convertValue(final OceanusDataFormatter pFormatter,
                                   final Object pValue) {
<span class="nc" id="L426">            return OceanusDataConverter.shortToByteArray((short) pValue);</span>
        }

        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) throws OceanusException {
<span class="nc" id="L432">            return OceanusDataConverter.byteArrayToShort(pBytes);</span>
        }
    }

    /**
     * IntegerEncryptor.
     */
    private static final class PrometheusIntegerEncryptor
            implements PrometheusDataEncryptor {
        @Override
        public byte[] convertValue(final OceanusDataFormatter pFormatter,
                                   final Object pValue) {
<span class="nc" id="L444">            return OceanusDataConverter.integerToByteArray((int) pValue);</span>
        }

        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) throws OceanusException {
<span class="nc" id="L450">            return OceanusDataConverter.byteArrayToInteger(pBytes);</span>
        }
    }

    /**
     * LongEncryptor.
     */
    private static final class PrometheusLongEncryptor
            implements PrometheusDataEncryptor {
        @Override
        public byte[] convertValue(final OceanusDataFormatter pFormatter,
                                   final Object pValue) {
<span class="nc" id="L462">            return OceanusDataConverter.longToByteArray((long) pValue);</span>
        }

        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) throws OceanusException {
<span class="nc" id="L468">            return OceanusDataConverter.byteArrayToLong(pBytes);</span>
        }
    }

    /**
     * BooleanEncryptor.
     */
    private static final class PrometheusBooleanEncryptor
            implements PrometheusDataEncryptor {
        @Override
        public byte[] convertValue(final OceanusDataFormatter pFormatter,
                                   final Object pValue) {
<span class="nc" id="L480">            return OceanusDataConverter.stringToByteArray(pValue.toString());</span>
        }

        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) {
<span class="nc" id="L486">            final String myBoolString = OceanusDataConverter.byteArrayToString(pBytes);</span>
<span class="nc" id="L487">            return Boolean.parseBoolean(myBoolString);</span>
        }
    }

    /**
     * StringEncryptor.
     */
    private static final class PrometheusStringEncryptor
            implements PrometheusDataEncryptor {
        @Override
        public byte[] convertValue(final OceanusDataFormatter pFormatter,
                                   final Object pValue) {
<span class="nc" id="L499">            return OceanusDataConverter.stringToByteArray((String) pValue);</span>
        }

        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) {
<span class="nc" id="L505">            return OceanusDataConverter.byteArrayToString(pBytes);</span>
        }
    }

    /**
     * CharArrayEncryptor.
     */
    private static final class PrometheusCharArrayEncryptor
            implements PrometheusDataEncryptor {
        @Override
        public byte[] convertValue(final OceanusDataFormatter pFormatter,
                                   final Object pValue) throws OceanusException {
<span class="nc" id="L517">            return OceanusDataConverter.charsToByteArray((char[]) pValue);</span>
        }

        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) throws OceanusException {
<span class="nc" id="L523">            return OceanusDataConverter.bytesToCharArray(pBytes);</span>
        }
    }

    /**
     * DecimalEncryptor.
     */
    private abstract static class PrometheusDecimalEncryptor
            implements PrometheusDataEncryptor {
        @Override
        public byte[] convertValue(final OceanusDataFormatter pFormatter,
                                   final Object pValue) {
<span class="nc" id="L535">            return ((OceanusDecimal) pValue).toBytes();</span>
        }
    }

    /**
     * MoneyEncryptor.
     */
    private static final class PrometheusMoneyEncryptor
            extends PrometheusDecimalEncryptor {
        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) throws OceanusException {
<span class="nc" id="L547">            return new OceanusMoney(pBytes);</span>
        }
    }

    /**
     * PriceEncryptor.
     */
    private static final class PrometheusPriceEncryptor
            extends PrometheusDecimalEncryptor {
        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) throws OceanusException {
<span class="nc" id="L559">            return new OceanusPrice(pBytes);</span>
        }
    }

    /**
     * RatioEncryptor.
     */
    private static final class PrometheusRatioEncryptor
            extends PrometheusDecimalEncryptor {
        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) throws OceanusException {
<span class="nc" id="L571">            return new OceanusRatio(pBytes);</span>
        }
    }

    /**
     * UnitsEncryptor.
     */
    private static final class PrometheusUnitsEncryptor
            extends PrometheusDecimalEncryptor {
        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) throws OceanusException {
<span class="nc" id="L583">            return new OceanusUnits(pBytes);</span>
        }
    }

    /**
     * RateEncryptor.
     */
    private static final class PrometheusRateEncryptor
            extends PrometheusDecimalEncryptor {
        @Override
        public Object parseValue(final OceanusDataFormatter pFormatter,
                                 final byte[] pBytes) throws OceanusException {
<span class="nc" id="L595">            return new OceanusRate(pBytes);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>