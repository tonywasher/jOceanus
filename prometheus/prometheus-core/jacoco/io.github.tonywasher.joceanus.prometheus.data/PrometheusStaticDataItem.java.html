<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrometheusStaticDataItem.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Prometheus Core Application Framework</a> &gt; <a href="index.source.html" class="el_package">io.github.tonywasher.joceanus.prometheus.data</a> &gt; <span class="el_source">PrometheusStaticDataItem.java</span></div><h1>PrometheusStaticDataItem.java</h1><pre class="source lang-java linenums">/*
 * Prometheus: Application Framework
 * Copyright 2012-2026. Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package io.github.tonywasher.joceanus.prometheus.data;

import io.github.tonywasher.joceanus.oceanus.base.OceanusException;
import io.github.tonywasher.joceanus.oceanus.format.OceanusDataFormatter;
import io.github.tonywasher.joceanus.metis.data.MetisDataDifference;
import io.github.tonywasher.joceanus.metis.data.MetisDataItem.MetisDataFieldId;
import io.github.tonywasher.joceanus.metis.data.MetisDataItem.MetisDataNamedItem;
import io.github.tonywasher.joceanus.metis.field.MetisFieldSet;
import io.github.tonywasher.joceanus.metis.list.MetisListKey;
import io.github.tonywasher.joceanus.prometheus.exc.PrometheusDataException;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

/**
 * Template for a Static Data item and List.
 *
 * @author Tony Washer
 */
public abstract class PrometheusStaticDataItem
        extends PrometheusEncryptedDataItem
        implements MetisDataNamedItem {
    /**
     * Report fields.
     */
<span class="nc" id="L45">    private static final PrometheusEncryptedFieldSet&lt;PrometheusStaticDataItem&gt; FIELD_DEFS = PrometheusEncryptedFieldSet.newEncryptedFieldSet(PrometheusStaticDataItem.class);</span>

    /*
     * FieldIds.
     */
    static {
<span class="nc" id="L51">        FIELD_DEFS.declareEncryptedStringField(PrometheusDataResource.DATAITEM_FIELD_NAME, NAMELEN);</span>
<span class="nc" id="L52">        FIELD_DEFS.declareEncryptedStringField(PrometheusDataResource.DATAITEM_FIELD_DESC, DESCLEN);</span>
<span class="nc" id="L53">        FIELD_DEFS.declareBooleanField(PrometheusDataResource.STATICDATA_ENABLED);</span>
<span class="nc" id="L54">        FIELD_DEFS.declareIntegerField(PrometheusDataResource.STATICDATA_SORT);</span>
<span class="nc" id="L55">        FIELD_DEFS.declareEnumField(PrometheusDataResource.STATICDATA_CLASS);</span>
    }

    /**
     * BadId error.
     */
<span class="nc" id="L61">    public static final String ERROR_BADID = PrometheusDataResource.STATICDATA_ERROR_ID.getValue();</span>

    /**
     * BadName error.
     */
<span class="nc" id="L66">    public static final String ERROR_BADNAME = PrometheusDataResource.STATICDATA_ERROR_NAME.getValue();</span>

    /**
     * The Enum Class for this Static Data.
     */
    private final Class&lt;? extends PrometheusStaticDataClass&gt; theEnumClass;

    /**
     * Copy Constructor.
     *
     * @param pList   The list to associate the Static Data with
     * @param pSource The static data to copy
     */
    protected PrometheusStaticDataItem(final PrometheusStaticList&lt;?&gt; pList,
                                       final PrometheusStaticDataItem pSource) {
<span class="nc" id="L81">        super(pList, pSource);</span>
<span class="nc" id="L82">        theEnumClass = pSource.getEnumClass();</span>
<span class="nc" id="L83">        setIndexedId(pSource.getIndexedId());</span>
<span class="nc" id="L84">    }</span>

    /**
     * Basic Constructor.
     *
     * @param pList  The list to associate the Static Data with
     * @param pValue the name of the new item
     * @throws OceanusException on error
     */
    protected PrometheusStaticDataItem(final PrometheusStaticList&lt;?&gt; pList,
                                       final String pValue) throws OceanusException {
        /* Call super constructor */
<span class="nc" id="L96">        super(pList, 0);</span>

        /* Determine the class */
<span class="nc" id="L99">        theEnumClass = pList.getEnumClass();</span>
<span class="nc" id="L100">        parseEnumValue(pValue);</span>

        /* Record the name */
<span class="nc" id="L103">        setValueName(pValue);</span>
<span class="nc" id="L104">        setValueEnabled(Boolean.TRUE);</span>
<span class="nc" id="L105">    }</span>

    /**
     * Basic Constructor.
     *
     * @param pList  The list to associate the Static Data with
     * @param pClass the class of the new item
     * @throws OceanusException on error
     */
    protected PrometheusStaticDataItem(final PrometheusStaticList&lt;?&gt; pList,
                                       final PrometheusStaticDataClass pClass) throws OceanusException {
        /* Call super constructor */
<span class="nc" id="L117">        super(pList, 0);</span>

        /* Determine the class */
<span class="nc" id="L120">        theEnumClass = pList.getEnumClass();</span>

        /* Store the class */
<span class="nc" id="L123">        setValueClass(pClass);</span>

        /* Set encryption */
<span class="nc" id="L126">        setNextDataKeySet();</span>

        /* Access classId and order */
<span class="nc" id="L129">        setIndexedId(pClass.getClassId());</span>
<span class="nc" id="L130">        setValueOrder(pClass.getOrder());</span>

        /* Record the name */
<span class="nc" id="L133">        setValueName(pClass.toString());</span>
<span class="nc" id="L134">        setValueEnabled(Boolean.TRUE);</span>

        /* Set the DataKeySet */
<span class="nc" id="L137">        setNextDataKeySet();</span>
<span class="nc" id="L138">    }</span>

    /**
     * Values constructor.
     *
     * @param pList   the List to add to
     * @param pValues the values constructor
     * @throws OceanusException on error
     */
    protected PrometheusStaticDataItem(final PrometheusStaticList&lt;?&gt; pList,
                                       final PrometheusDataValues pValues) throws OceanusException {
        /* Initialise the item */
<span class="nc" id="L150">        super(pList, pValues);</span>

        /* Access formatter */
<span class="nc" id="L153">        final OceanusDataFormatter myFormatter = getDataSet().getDataFormatter();</span>

        /* Protect against exceptions */
        try {
            /* Determine the class */
<span class="nc" id="L158">            theEnumClass = pList.getEnumClass();</span>

            /* Store the Name */
<span class="nc" id="L161">            Object myValue = pValues.getValue(PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">            if (myValue instanceof String s) {</span>
<span class="nc" id="L163">                setValueName(s);</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">            } else if (myValue instanceof byte[] ba) {</span>
<span class="nc" id="L165">                setValueName(ba);</span>
            }

            /* Store the Description */
<span class="nc" id="L169">            myValue = pValues.getValue(PrometheusDataResource.DATAITEM_FIELD_DESC);</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">            if (myValue instanceof String s) {</span>
<span class="nc" id="L171">                setValueDesc(s);</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">            } else if (myValue instanceof byte[] ba) {</span>
<span class="nc" id="L173">                setValueDesc(ba);</span>
            }

            /* Store the class */
<span class="nc" id="L177">            myValue = pValues.getValue(PrometheusDataResource.STATICDATA_CLASS);</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (myValue instanceof String s) {</span>
<span class="nc" id="L179">                parseEnumValue(s);</span>
            } else {
<span class="nc" id="L181">                parseEnumValue(getIndexedId());</span>
            }

            /* Store the Order */
<span class="nc" id="L185">            myValue = pValues.getValue(PrometheusDataResource.STATICDATA_SORT);</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">            if (myValue instanceof Integer i) {</span>
<span class="nc" id="L187">                setValueOrder(i);</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">            } else if (myValue instanceof String s) {</span>
<span class="nc" id="L189">                setValueOrder(myFormatter.parseValue(s, Integer.class));</span>
            }

            /* Store the Enabled flag */
<span class="nc" id="L193">            myValue = pValues.getValue(PrometheusDataResource.STATICDATA_ENABLED);</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">            if (myValue instanceof Boolean b) {</span>
<span class="nc" id="L195">                setValueEnabled(b);</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">            } else if (myValue instanceof String s) {</span>
<span class="nc" id="L197">                setValueEnabled(myFormatter.parseValue(s, Boolean.class));</span>
            } else {
<span class="nc" id="L199">                setValueEnabled(Boolean.TRUE);</span>
            }

            /* Catch Exceptions */
<span class="nc" id="L203">        } catch (NumberFormatException</span>
                 | OceanusException e) {
            /* Pass on exception */
<span class="nc" id="L206">            throw new PrometheusDataException(this, ERROR_CREATEITEM, e);</span>
<span class="nc" id="L207">        }</span>
<span class="nc" id="L208">    }</span>

    @Override
    public MetisFieldSetDef getDataFieldSet() {
<span class="nc" id="L212">        return FIELD_DEFS;</span>
    }

    @Override
    public String formatObject(final OceanusDataFormatter pFormatter) {
<span class="nc" id="L217">        return toString();</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L222">        return getName();</span>
    }

    @Override
    public boolean includeXmlField(final MetisDataFieldId pField) {
        /* Determine whether fields should be included */
<span class="nc bnc" id="L228" title="All 2 branches missed.">        if (PrometheusDataResource.DATAITEM_FIELD_NAME.equals(pField)) {</span>
<span class="nc" id="L229">            return true;</span>
        }
<span class="nc bnc" id="L231" title="All 2 branches missed.">        if (PrometheusDataResource.DATAITEM_FIELD_DESC.equals(pField)) {</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">            return getDesc() != null;</span>
        }
<span class="nc bnc" id="L234" title="All 2 branches missed.">        if (PrometheusDataResource.STATICDATA_ENABLED.equals(pField)) {</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">            return !getEnabled();</span>
        }
<span class="nc bnc" id="L237" title="All 2 branches missed.">        if (PrometheusDataResource.STATICDATA_CLASS.equals(pField)) {</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">            return !getName().equalsIgnoreCase(getStaticClass().name());</span>
        }

        /* Pass call on */
<span class="nc" id="L242">        return super.includeXmlField(pField);</span>
    }

    @Override
    public final String getName() {
<span class="nc" id="L247">        return getValues().getValue(PrometheusDataResource.DATAITEM_FIELD_NAME, String.class);</span>
    }

    /**
     * Return the encrypted name of the Static Data.
     *
     * @return the encrypted name
     */
    public final byte[] getNameBytes() {
<span class="nc" id="L256">        return getValues().getEncryptedBytes(PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
    }

    /**
     * Return the encrypted name field of the Static Data.
     *
     * @return the encrypted field
     */
    private PrometheusEncryptedPair getNameField() {
<span class="nc" id="L265">        return getValues().getEncryptedPair(PrometheusDataResource.DATAITEM_FIELD_NAME);</span>
    }

    /**
     * Return the description of the Static Data.
     *
     * @return the description
     */
    public final String getDesc() {
<span class="nc" id="L274">        return getValues().getValue(PrometheusDataResource.DATAITEM_FIELD_DESC, String.class);</span>
    }

    /**
     * Return the encrypted description of the Static Data.
     *
     * @return the encrypted description
     */
    public final byte[] getDescBytes() {
<span class="nc" id="L283">        return getValues().getEncryptedBytes(PrometheusDataResource.DATAITEM_FIELD_DESC);</span>
    }

    /**
     * Return the encrypted description field of the Static Data.
     *
     * @return the encrypted name
     */
    private PrometheusEncryptedPair getDescField() {
<span class="nc" id="L292">        return getValues().getEncryptedPair(PrometheusDataResource.DATAITEM_FIELD_DESC);</span>
    }

    /**
     * Return the sort order of the Static Data.
     *
     * @return the order
     */
    public final Integer getOrder() {
<span class="nc" id="L301">        return getValues().getValue(PrometheusDataResource.STATICDATA_SORT, Integer.class);</span>
    }

    /**
     * Return the Static class of the Static Data.
     *
     * @return the class
     */
    public final PrometheusStaticDataClass getStaticClass() {
<span class="nc" id="L310">        return getValues().getValue(PrometheusDataResource.STATICDATA_CLASS, PrometheusStaticDataClass.class);</span>
    }

    /**
     * Is the Static item enabled.
     *
     * @return &lt;code&gt;true/false&lt;/code&gt;
     */
    public final boolean getEnabled() {
<span class="nc" id="L319">        return getValues().getValue(PrometheusDataResource.STATICDATA_ENABLED, Boolean.class);</span>
    }

    @Override
    public boolean isDisabled() {
<span class="nc bnc" id="L324" title="All 2 branches missed.">        return !getEnabled();</span>
    }

    /**
     * Obtain the Enum class of this Static Data.
     *
     * @return the class
     */
    protected final Class&lt;? extends PrometheusStaticDataClass&gt; getEnumClass() {
<span class="nc" id="L333">        return theEnumClass;</span>
    }

    /**
     * Set the Name.
     *
     * @param pValue the name
     * @throws OceanusException on error
     */
    private void setValueName(final String pValue) throws OceanusException {
<span class="nc" id="L343">        setEncryptedValue(PrometheusDataResource.DATAITEM_FIELD_NAME, pValue);</span>
<span class="nc" id="L344">    }</span>

    /**
     * Set the Name.
     *
     * @param pBytes the encrypted name
     * @throws OceanusException on error
     */
    private void setValueName(final byte[] pBytes) throws OceanusException {
<span class="nc" id="L353">        setEncryptedValue(PrometheusDataResource.DATAITEM_FIELD_NAME, pBytes, String.class);</span>
<span class="nc" id="L354">    }</span>

    /**
     * Set the Name field.
     *
     * @param pField the encrypted name
     */
    private void setValueName(final PrometheusEncryptedPair pField) {
<span class="nc" id="L362">        getValues().setUncheckedValue(PrometheusDataResource.DATAITEM_FIELD_NAME, pField);</span>
<span class="nc" id="L363">    }</span>

    /**
     * Set the Description.
     *
     * @param pValue the description
     * @throws OceanusException on error
     */
    protected final void setValueDesc(final String pValue) throws OceanusException {
<span class="nc" id="L372">        setEncryptedValue(PrometheusDataResource.DATAITEM_FIELD_DESC, pValue);</span>
<span class="nc" id="L373">    }</span>

    /**
     * Set the Description.
     *
     * @param pBytes the encrypted description
     * @throws OceanusException on error
     */
    private void setValueDesc(final byte[] pBytes) throws OceanusException {
<span class="nc" id="L382">        setEncryptedValue(PrometheusDataResource.DATAITEM_FIELD_DESC, pBytes, String.class);</span>
<span class="nc" id="L383">    }</span>

    /**
     * Set the Description field.
     *
     * @param pField the encrypted description
     */
    private void setValueDesc(final PrometheusEncryptedPair pField) {
<span class="nc" id="L391">        getValues().setUncheckedValue(PrometheusDataResource.DATAITEM_FIELD_DESC, pField);</span>
<span class="nc" id="L392">    }</span>

    /**
     * Set the Enabled flag.
     *
     * @param isEnabled TRUE/FALSE
     */
    protected final void setValueEnabled(final Boolean isEnabled) {
<span class="nc" id="L400">        getValues().setUncheckedValue(PrometheusDataResource.STATICDATA_ENABLED, isEnabled);</span>
<span class="nc" id="L401">    }</span>

    /**
     * Set the Order.
     *
     * @param pOrder the order
     */
    private void setValueOrder(final Integer pOrder) {
<span class="nc" id="L409">        getValues().setUncheckedValue(PrometheusDataResource.STATICDATA_SORT, pOrder);</span>
<span class="nc" id="L410">    }</span>

    /**
     * Set the Class.
     *
     * @param pClass the class
     */
    private void setValueClass(final PrometheusStaticDataClass pClass) {
<span class="nc" id="L418">        getValues().setUncheckedValue(PrometheusDataResource.STATICDATA_CLASS, pClass);</span>
<span class="nc" id="L419">    }</span>

    @Override
    public int compareValues(final PrometheusDataItem pThat) {
        /* Access as StaticDataItem */
<span class="nc" id="L424">        final PrometheusStaticDataItem myThat = (PrometheusStaticDataItem) pThat;</span>

        /* Make sure that the object is the same enumeration class */
<span class="nc bnc" id="L427" title="All 2 branches missed.">        if (!MetisDataDifference.isEqual(getEnumClass(), myThat.getEnumClass())) {</span>
            /* Order the classes by canonical name */
<span class="nc" id="L429">            return getEnumClass().getCanonicalName().compareTo(myThat.getEnumClass().getCanonicalName());</span>
        }

        /* Compare on order and name */
<span class="nc" id="L433">        final int iDiff = getOrder() - myThat.getOrder();</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">        return iDiff != 0 ? iDiff : MetisDataDifference.compareObject(getName(), myThat.getName());</span>
    }

    @Override
    public PrometheusStaticList&lt;?&gt; getList() {
<span class="nc" id="L439">        return (PrometheusStaticList&lt;?&gt;) super.getList();</span>
    }

    /**
     * Parse enum type.
     *
     * @param pValue the value
     * @throws OceanusException on error
     */
    private void parseEnumValue(final String pValue) throws OceanusException {
<span class="nc" id="L449">        final Class&lt;? extends PrometheusStaticDataClass&gt; myClass = getEnumClass();</span>
<span class="nc" id="L450">        final PrometheusStaticDataClass[] myEnums = myClass.getEnumConstants();</span>

        /* Loop through the enum constants */
<span class="nc bnc" id="L453" title="All 2 branches missed.">        for (PrometheusStaticDataClass myValue : myEnums) {</span>
            /* If this is the desired value */
<span class="nc bnc" id="L455" title="All 2 branches missed.">            if (myValue.toString().equalsIgnoreCase(pValue)) {</span>
                /* Store the class */
<span class="nc" id="L457">                setValueClass(myValue);</span>

                /* Access classId and order */
<span class="nc" id="L460">                setIndexedId(myValue.getClassId());</span>
<span class="nc" id="L461">                setValueOrder(myValue.getOrder());</span>
<span class="nc" id="L462">                break;</span>
            }
        }

        /* Reject if we didn't find the class */
<span class="nc bnc" id="L467" title="All 2 branches missed.">        if (getStaticClass() == null) {</span>
<span class="nc" id="L468">            throw new PrometheusDataException(ERROR_BADNAME + &quot; &quot; + myClass.getSimpleName() + &quot;: &quot; + pValue);</span>
        }
<span class="nc" id="L470">    }</span>

    /**
     * Parse enum type.
     *
     * @param pValue the value
     * @throws OceanusException on error
     */
    private void parseEnumValue(final Integer pValue) throws OceanusException {
<span class="nc" id="L479">        final Class&lt;? extends PrometheusStaticDataClass&gt; myClass = getEnumClass();</span>
<span class="nc" id="L480">        final PrometheusStaticDataClass[] myEnums = myClass.getEnumConstants();</span>

        /* Loop through the enum constants */
<span class="nc bnc" id="L483" title="All 2 branches missed.">        for (PrometheusStaticDataClass myValue : myEnums) {</span>
            /* If this is the desired value */
<span class="nc bnc" id="L485" title="All 2 branches missed.">            if (pValue.equals(myValue.getClassId())) {</span>
                /* Store the class */
<span class="nc" id="L487">                setValueClass(myValue);</span>

                /* Access classId and order */
<span class="nc" id="L490">                setIndexedId(myValue.getClassId());</span>
<span class="nc" id="L491">                setValueOrder(myValue.getOrder());</span>
<span class="nc" id="L492">                break;</span>
            }
        }

        /* Reject if we didn't find the class */
<span class="nc bnc" id="L497" title="All 2 branches missed.">        if (getStaticClass() == null) {</span>
<span class="nc" id="L498">            throw new PrometheusDataException(ERROR_BADNAME + &quot; &quot; + myClass.getSimpleName() + &quot;: &quot; + pValue);</span>
        }
<span class="nc" id="L500">    }</span>

    /**
     * Set a new name.
     *
     * @param pName the name
     * @throws OceanusException on error
     */
    public void setName(final String pName) throws OceanusException {
<span class="nc" id="L509">        setValueName(pName);</span>
<span class="nc" id="L510">    }</span>

    /**
     * Set a new description.
     *
     * @param pDesc the description
     * @throws OceanusException on error
     */
    public void setDescription(final String pDesc) throws OceanusException {
        /* Set the appropriate value */
<span class="nc" id="L520">        setValueDesc(pDesc);</span>
<span class="nc" id="L521">    }</span>

    /**
     * Set Enabled indicator.
     *
     * @param isEnabled TRUE/FALSE
     */
    public void setEnabled(final boolean isEnabled) {
        /* Set the appropriate value */
<span class="nc" id="L530">        setValueEnabled(isEnabled);</span>
<span class="nc" id="L531">    }</span>

    /**
     * Set Order indicator.
     *
     * @param iOrder the order
     */
    public void setOrder(final int iOrder) {
        /* Set the appropriate value */
<span class="nc" id="L540">        setValueOrder(iOrder);</span>
<span class="nc" id="L541">    }</span>

    @Override
    public boolean applyChanges(final PrometheusDataItem pData) {
        /* Can only apply changes for Static Data */
<span class="nc bnc" id="L546" title="All 2 branches missed.">        if (!(pData instanceof PrometheusStaticDataItem)) {</span>
<span class="nc" id="L547">            return false;</span>
        }

        /* Access the data */
<span class="nc" id="L551">        final PrometheusStaticDataItem myData = (PrometheusStaticDataItem) pData;</span>

        /* Store the current detail into history */
<span class="nc" id="L554">        pushHistory();</span>

        /* Apply basic changes */
<span class="nc" id="L557">        applyBasicChanges(myData);</span>

        /* Check for changes */
<span class="nc" id="L560">        return checkForHistory();</span>
    }

    /**
     * Apply basic changes.
     *
     * @param pData the changed element
     */
    protected void applyBasicChanges(final PrometheusStaticDataItem pData) {
        /* Update the name if required */
<span class="nc bnc" id="L570" title="All 2 branches missed.">        if (!MetisDataDifference.isEqual(getName(), pData.getName())) {</span>
<span class="nc" id="L571">            setValueName(pData.getNameField());</span>
        }

        /* Update the description if required */
<span class="nc bnc" id="L575" title="All 2 branches missed.">        if (!MetisDataDifference.isEqual(getDesc(), pData.getDesc())) {</span>
<span class="nc" id="L576">            setValueDesc(pData.getDescField());</span>
        }

        /* Update the enabled indication if required */
<span class="nc bnc" id="L580" title="All 2 branches missed.">        if (!MetisDataDifference.isEqual(getEnabled(), pData.getEnabled())) {</span>
<span class="nc" id="L581">            setEnabled(pData.getEnabled());</span>
        }

        /* Update the order indication if required */
<span class="nc bnc" id="L585" title="All 2 branches missed.">        if (!MetisDataDifference.isEqual(getOrder(), pData.getOrder())) {</span>
<span class="nc" id="L586">            setOrder(pData.getOrder());</span>
        }
<span class="nc" id="L588">    }</span>

    @Override
    public void adjustMapForItem() {
<span class="nc" id="L592">        final PrometheusStaticList&lt;?&gt; myList = getList();</span>
<span class="nc" id="L593">        final PrometheusStaticDataMap&lt;?&gt; myMap = myList.getDataMap();</span>
<span class="nc" id="L594">        myMap.adjustForItem(myList.getBaseClass().cast(this));</span>
<span class="nc" id="L595">    }</span>

    /**
     * Represents a list of StaticData objects.
     *
     * @param &lt;T&gt; the item type
     */
    public abstract static class PrometheusStaticList&lt;T extends PrometheusStaticDataItem&gt;
            extends PrometheusEncryptedList&lt;T&gt; {
        /*
         * Report fields.
         */
        static {
<span class="nc" id="L608">            MetisFieldSet.newFieldSet(PrometheusStaticList.class);</span>
<span class="nc" id="L609">        }</span>

        /**
         * Construct a generic static data list.
         *
         * @param pBaseClass the class of the underlying object
         * @param pData      the dataSet
         * @param pItemType  the item type
         * @param pStyle     the style of the list
         */
        protected PrometheusStaticList(final Class&lt;T&gt; pBaseClass,
                                       final PrometheusDataSet pData,
                                       final MetisListKey pItemType,
                                       final PrometheusListStyle pStyle) {
<span class="nc" id="L623">            super(pBaseClass, pData, pItemType, pStyle);</span>
<span class="nc" id="L624">        }</span>

        /**
         * Constructor for a cloned List.
         *
         * @param pSource the source List
         */
        protected PrometheusStaticList(final PrometheusStaticList&lt;T&gt; pSource) {
<span class="nc" id="L632">            super(pSource);</span>
<span class="nc" id="L633">        }</span>

        /**
         * Obtain the enumClass.
         *
         * @return the enumClass
         */
        protected abstract Class&lt;? extends PrometheusStaticDataClass&gt; getEnumClass();

        @Override
        @SuppressWarnings(&quot;unchecked&quot;)
        public PrometheusStaticDataMap&lt;T&gt; getDataMap() {
<span class="nc" id="L645">            return (PrometheusStaticDataMap&lt;T&gt;) super.getDataMap();</span>
        }

        /**
         * Search for a particular item by class.
         *
         * @param eClass The class of the item to search for
         * @return The Item if present (or &lt;code&gt;null&lt;/code&gt; if not found)
         */
        public T findItemByClass(final PrometheusStaticDataClass eClass) {
            /* Look for item by class Id */
<span class="nc" id="L656">            return findItemById(eClass.getClassId());</span>
        }

        @Override
        public T findItemByName(final String pName) {
            /* look up the name in the map */
<span class="nc" id="L662">            return getDataMap().findItemByName(pName);</span>
        }

        /**
         * Is the list full?
         *
         * @return true/false
         */
        public boolean isFull() {
            /* We can only be full with the correct number of items */
<span class="nc bnc" id="L672" title="All 2 branches missed.">            if (size() &lt; getEnumClass().getEnumConstants().length) {</span>
<span class="nc" id="L673">                return false;</span>
            }

            /* Loop through all elements */
<span class="nc" id="L677">            final Iterator&lt;T&gt; myIterator = iterator();</span>
<span class="nc bnc" id="L678" title="All 2 branches missed.">            while (myIterator.hasNext()) {</span>
<span class="nc" id="L679">                final T myCurr = myIterator.next();</span>

                /* If the item is deleted */
<span class="nc bnc" id="L682" title="All 2 branches missed.">                if (myCurr.isDeleted()) {</span>
                    /* Not full */
<span class="nc" id="L684">                    return false;</span>
                }
<span class="nc" id="L686">            }</span>

            /* Must be full */
<span class="nc" id="L689">            return true;</span>
        }

        /**
         * Obtain a list of classes that are missing/deleted.
         *
         * @return The List of classes
         */
        public List&lt;PrometheusStaticDataClass&gt; getMissingClasses() {
            /* Allocate the list */
<span class="nc" id="L699">            final List&lt;PrometheusStaticDataClass&gt; myList = new ArrayList&lt;&gt;();</span>

            /* Loop through all elements */
<span class="nc bnc" id="L702" title="All 2 branches missed.">            for (PrometheusStaticDataClass myClass : getEnumClass().getEnumConstants()) {</span>
                /* Locate the element */
<span class="nc" id="L704">                final T myItem = findItemById(myClass.getClassId());</span>

                /* If the item is missing or deleted */
<span class="nc bnc" id="L707" title="All 2 branches missed.">                if ((myItem == null)</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">                        || myItem.isDeleted()) {</span>
                    /* Add it to the list */
<span class="nc" id="L710">                    myList.add(myClass);</span>
                }
            }

            /* Return the list */
<span class="nc" id="L715">            return myList;</span>
        }

        /**
         * Add Item for class.
         *
         * @param pClass the class to add
         * @return the added class
         * @throws OceanusException on error
         */
        public T addNewItem(final PrometheusStaticDataClass pClass) throws OceanusException {
            /* Create the new item */
<span class="nc" id="L727">            return newItem(pClass);</span>
        }

        /**
         * Create new Item for class.
         *
         * @param pClass the class to create
         * @return the created class
         * @throws OceanusException on error
         */
        protected abstract T newItem(PrometheusStaticDataClass pClass) throws OceanusException;

        /**
         * Populate default values.
         *
         * @throws OceanusException on error
         */
        public void populateDefaults() throws OceanusException {
            /* Loop through all elements */
<span class="nc bnc" id="L746" title="All 2 branches missed.">            for (PrometheusStaticDataClass myClass : getEnumClass().getEnumConstants()) {</span>
                /* Create new element */
<span class="nc" id="L748">                final T myItem = newItem(myClass);</span>

                /* Validate the item */
<span class="nc" id="L751">                myItem.validate();</span>

                /* Handle validation failure */
<span class="nc bnc" id="L754" title="All 2 branches missed.">                if (myItem.hasErrors()) {</span>
<span class="nc" id="L755">                    throw new PrometheusDataException(myItem, ERROR_VALIDATION);</span>
                }
            }

            /* Ensure that the list is sorted */
<span class="nc" id="L760">            reSort();</span>
<span class="nc" id="L761">        }</span>

        @Override
        protected PrometheusDataMapItem allocateDataMap() {
<span class="nc" id="L765">            return new PrometheusStaticDataMap&lt;&gt;();</span>
        }
    }

    /**
     * The dataMap class.
     *
     * @param &lt;T&gt; the item type
     */
    public static class PrometheusStaticDataMap&lt;T extends PrometheusStaticDataItem&gt;
            extends PrometheusDataInstanceMap&lt;T, String&gt; {
        /**
         * Report fields.
         */
        @SuppressWarnings(&quot;rawtypes&quot;)
<span class="nc" id="L780">        private static final MetisFieldSet&lt;PrometheusStaticDataMap&gt; FIELD_DEFS = MetisFieldSet.newFieldSet(PrometheusStaticDataMap.class);</span>

        /*
         * Declare Fields.
         */
        static {
<span class="nc" id="L786">            FIELD_DEFS.declareLocalField(PrometheusDataResource.STATICDATAMAP_ORDERCOUNTS, PrometheusStaticDataMap::getOrderCountMap);</span>
<span class="nc" id="L787">        }</span>

        /**
         * Map of order counts.
         */
        private final Map&lt;Integer, Integer&gt; theOrderCountMap;

        /**
         * Constructor.
         */
<span class="nc" id="L797">        public PrometheusStaticDataMap() {</span>
            /* Create the maps */
<span class="nc" id="L799">            theOrderCountMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L800">        }</span>

        @SuppressWarnings(&quot;rawtypes&quot;)
        @Override
        public MetisFieldSet&lt;? extends PrometheusStaticDataMap&gt; getDataFieldSet() {
<span class="nc" id="L805">            return FIELD_DEFS;</span>
        }

        @Override
        public String formatObject(final OceanusDataFormatter pFormatter) {
<span class="nc" id="L810">            return FIELD_DEFS.getName();</span>
        }

        /**
         * Obtain the keyMap.
         *
         * @return the map
         */
        private Map&lt;Integer, Integer&gt; getOrderCountMap() {
<span class="nc" id="L819">            return theOrderCountMap;</span>
        }

        @Override
        public void resetMap() {
<span class="nc" id="L824">            super.resetMap();</span>
<span class="nc" id="L825">            theOrderCountMap.clear();</span>
<span class="nc" id="L826">        }</span>

        @Override
        @SuppressWarnings(&quot;unchecked&quot;)
        public void adjustForItem(final PrometheusDataItem pItem) {
            /* Access item */
<span class="nc" id="L832">            final T myItem = (T) pItem;</span>

            /* Adjust order count */
<span class="nc" id="L835">            final Integer myOrder = myItem.getOrder();</span>
<span class="nc" id="L836">            final Integer myCount = theOrderCountMap.get(myOrder);</span>
<span class="nc bnc" id="L837" title="All 2 branches missed.">            if (myCount == null) {</span>
<span class="nc" id="L838">                theOrderCountMap.put(myOrder, ONE);</span>
            } else {
<span class="nc" id="L840">                theOrderCountMap.put(myOrder, myCount + 1);</span>
            }

            /* Adjust name count */
<span class="nc" id="L844">            adjustForItem(myItem, myItem.getName());</span>
<span class="nc" id="L845">        }</span>

        /**
         * find item by name.
         *
         * @param pName the name to look up
         * @return the matching item
         */
        public T findItemByName(final String pName) {
<span class="nc" id="L854">            return findItemByKey(pName);</span>
        }

        /**
         * Check validity of name.
         *
         * @param pName the name to look up
         * @return true/false
         */
        public boolean validNameCount(final String pName) {
<span class="nc" id="L864">            return validKeyCount(pName);</span>
        }

        /**
         * Check availability of name.
         *
         * @param pName the key to look up
         * @return true/false
         */
        public boolean availableName(final String pName) {
<span class="nc" id="L874">            return availableKey(pName);</span>
        }

        /**
         * Check validity of order.
         *
         * @param pOrder the order to look up
         * @return true/false
         */
        public boolean validOrderCount(final Integer pOrder) {
<span class="nc" id="L884">            final Integer myResult = theOrderCountMap.get(pOrder);</span>
<span class="nc" id="L885">            return ONE.equals(myResult);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>