<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PrometheusPreferenceSet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Prometheus Core Application Framework</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.joceanus.prometheus.preference</a> &gt; <span class="el_source">PrometheusPreferenceSet.java</span></div><h1>PrometheusPreferenceSet.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Prometheus: Application Framework
 * Copyright 2012,2025 Tony Washer
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 ******************************************************************************/
package net.sourceforge.joceanus.prometheus.preference;

import net.sourceforge.joceanus.metis.preference.MetisPreferenceKey;
import net.sourceforge.joceanus.metis.preference.MetisPreferenceSet;
import net.sourceforge.joceanus.oceanus.base.OceanusException;
import net.sourceforge.joceanus.oceanus.resource.OceanusBundleId;

/**
 * Prometheus PreferenceSet.
 */
public abstract class PrometheusPreferenceSet
    extends MetisPreferenceSet {
    /**
     * The Security Manager.
     */
    private PrometheusPreferenceSecurity theSecurity;

    /**
     * Constructor.
     * @param pManager the preference manager
     * @param pId the Id
     * @throws OceanusException on error
     */
    protected PrometheusPreferenceSet(final PrometheusPreferenceManager pManager,
                                      final OceanusBundleId pId) throws OceanusException {
<span class="nc" id="L42">        this(pManager, pId.getValue());</span>
<span class="nc" id="L43">    }</span>

    /**
     * Constructor.
     * @param pManager the preference manager
     * @param pName the name
     * @throws OceanusException on error
     */
    protected PrometheusPreferenceSet(final PrometheusPreferenceManager pManager,
                                      final String pName) throws OceanusException {
        /* Initialize super-class */
<span class="nc" id="L54">        super(pManager, pName);</span>
<span class="nc" id="L55">    }</span>

    @Override
    public PrometheusPreferenceManager getPreferenceManager() {
<span class="nc" id="L59">        return (PrometheusPreferenceManager) super.getPreferenceManager();</span>
    }

    /**
     * Obtain the security.
     * @return the security
     * @throws OceanusException on error
     */
    public PrometheusPreferenceSecurity getSecurity() throws OceanusException {
<span class="nc bnc" id="L68" title="All 2 branches missed.">        if (theSecurity == null) {</span>
<span class="nc" id="L69">            theSecurity = getPreferenceManager().getSecurity();</span>
        }
<span class="nc" id="L71">        return theSecurity;</span>
    }

    /**
     * Define new ByteArray preference.
     * @param pKey the key for the preference
     * @return the preference item
     */
    protected PrometheusByteArrayPreference defineByteArrayPreference(final MetisPreferenceKey pKey) {
        /* Define the preference */
<span class="nc" id="L81">        final PrometheusByteArrayPreference myPref = new PrometheusByteArrayPreference(this, pKey);</span>

        /* Add it to the list of preferences */
<span class="nc" id="L84">        definePreference(myPref);</span>

        /* Return the preference */
<span class="nc" id="L87">        return myPref;</span>
    }

    /**
     * Define new CharArray preference.
     * @param pKey the key for the preference
     * @return the preference item
     * @throws OceanusException on error
     */
    protected PrometheusCharArrayPreference defineCharArrayPreference(final MetisPreferenceKey pKey) throws OceanusException {
        /* Define the preference */
<span class="nc" id="L98">        final PrometheusCharArrayPreference myPref = new PrometheusCharArrayPreference(this, pKey);</span>

        /* Add it to the list of preferences */
<span class="nc" id="L101">        definePreference(myPref);</span>

        /* Return the preference */
<span class="nc" id="L104">        return myPref;</span>
    }

    /**
     * Obtain ByteArray preference.
     * @param pKey the key of the preference
     * @return the ByteArray preference
     */
    public PrometheusByteArrayPreference getByteArrayPreference(final MetisPreferenceKey pKey) {
        /* Access preference */
<span class="nc" id="L114">        final MetisPreferenceItem myPref = getPreference(pKey);</span>

        /* Reject if not found */
<span class="nc bnc" id="L117" title="All 2 branches missed.">        if (myPref == null) {</span>
<span class="nc" id="L118">            throw new IllegalArgumentException(ERROR_UNKNOWN</span>
                    + pKey);
        }

        /* Reject if wrong type */
<span class="nc bnc" id="L123" title="All 2 branches missed.">        if (!(myPref instanceof PrometheusByteArrayPreference)) {</span>
<span class="nc" id="L124">            throw new IllegalArgumentException(ERROR_INVALID</span>
                    + pKey);
        }

        /* Return the preference */
<span class="nc" id="L129">        return (PrometheusByteArrayPreference) myPref;</span>
    }

    /**
     * Obtain ByteArray value.
     * @param pKey the key of the preference
     * @return the ByteArray value
     */
    public byte[] getByteArrayValue(final MetisPreferenceKey pKey) {
        /* Access preference */
<span class="nc" id="L139">        final PrometheusByteArrayPreference myPref = getByteArrayPreference(pKey);</span>

        /* Return the value */
<span class="nc" id="L142">        return myPref.getValue();</span>
    }

    /**
     * Obtain CharArray preference.
     * @param pKey the key of the preference
     * @return the CharArray preference
     */
    public PrometheusCharArrayPreference getCharArrayPreference(final MetisPreferenceKey pKey) {
        /* Access preference */
<span class="nc" id="L152">        final MetisPreferenceItem myPref = getPreference(pKey);</span>

        /* Reject if not found */
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (myPref == null) {</span>
<span class="nc" id="L156">            throw new IllegalArgumentException(ERROR_UNKNOWN</span>
                    + pKey);
        }

        /* Reject if wrong type */
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (!(myPref instanceof PrometheusCharArrayPreference)) {</span>
<span class="nc" id="L162">            throw new IllegalArgumentException(ERROR_INVALID</span>
                    + pKey);
        }

        /* Return the preference */
<span class="nc" id="L167">        return (PrometheusCharArrayPreference) myPref;</span>
    }

    /**
     * Obtain CharArray value.
     * @param pKey the key of the preference
     * @return the CharArray value
     */
    public char[] getCharArrayValue(final MetisPreferenceKey pKey) {
        /* Access preference */
<span class="nc" id="L177">        final PrometheusCharArrayPreference myPref = getCharArrayPreference(pKey);</span>

        /* Return the value */
<span class="nc" id="L180">        return myPref.getValue();</span>
    }

    /**
     * ByteArray preference.
     */
    public static class PrometheusByteArrayPreference
            extends MetisPreferenceItem {
        /**
         * Constructor.
         * @param pSet the preference Set
         * @param pKey the key of the preference
         */
        protected PrometheusByteArrayPreference(final PrometheusPreferenceSet pSet,
                                                final MetisPreferenceKey pKey) {
            /* Store name */
<span class="nc" id="L196">            super(pSet, pKey, PrometheusPreferenceType.BYTEARRAY);</span>

            /* Check whether we have an existing value */
<span class="nc bnc" id="L199" title="All 2 branches missed.">            if (pSet.checkExists(pKey)) {</span>
                /* Access the value */
<span class="nc" id="L201">                final byte[] myValue = getHandle().getByteArray(getPreferenceName(), null);</span>

                /* Set as initial value */
<span class="nc" id="L204">                setTheValue(myValue);</span>
            }
<span class="nc" id="L206">        }</span>

        @Override
        public byte[] getValue() {
<span class="nc" id="L210">            return (byte[]) super.getValue();</span>
        }

        /**
         * Set value.
         * @param pNewValue the new value
         */
        public void setValue(final byte[] pNewValue) {
<span class="nc" id="L218">            setNewValue(pNewValue);</span>
<span class="nc" id="L219">        }</span>

        @Override
        protected void storeThePreference(final Object pNewValue) {
<span class="nc" id="L223">            getHandle().putByteArray(getPreferenceName(), (byte[]) pNewValue);</span>
<span class="nc" id="L224">        }</span>
    }

    /**
     * CharArray preference.
     */
    public static class PrometheusCharArrayPreference
            extends MetisPreferenceItem {
        /**
         * Constructor.
         * @param pSet the preference Set
         * @param pKey the key of the preference
         * @throws OceanusException on error
         */
        protected PrometheusCharArrayPreference(final PrometheusPreferenceSet pSet,
                                                final MetisPreferenceKey pKey) throws OceanusException {
            /* Store name */
<span class="nc" id="L241">            super(pSet, pKey, PrometheusPreferenceType.CHARARRAY);</span>

            /* Check whether we have an existing value */
<span class="nc bnc" id="L244" title="All 2 branches missed.">            if (pSet.checkExists(pKey)) {</span>
                /* Access the value */
<span class="nc" id="L246">                final byte[] myBytes = getHandle().getByteArray(getPreferenceName(), null);</span>
<span class="nc" id="L247">                final PrometheusPreferenceSecurity mySecurity = getSet().getSecurity();</span>

                /* Decrypt the value */
<span class="nc bnc" id="L250" title="All 2 branches missed.">                final char[] myValue = myBytes == null</span>
<span class="nc" id="L251">                        ? null</span>
<span class="nc" id="L252">                        : mySecurity.decryptValue(myBytes);</span>

                /* Set as initial value */
<span class="nc" id="L255">                setTheValue(myValue);</span>
            }
<span class="nc" id="L257">        }</span>

        @Override
        protected PrometheusPreferenceSet getSet() {
<span class="nc" id="L261">            return (PrometheusPreferenceSet) super.getSet();</span>
        }

        @Override
        public char[] getValue() {
<span class="nc" id="L266">            return (char[]) super.getValue();</span>
        }

        /**
         * Set value.
         * @param pNewValue the new value
         */
        public void setValue(final char[] pNewValue) {
<span class="nc" id="L274">            setNewValue(pNewValue);</span>
<span class="nc" id="L275">        }</span>

        @Override
        protected void storeThePreference(final Object pNewValue) throws OceanusException {
            /* Store the value */
<span class="nc" id="L280">            final PrometheusPreferenceSecurity mySecurity = getSet().getSecurity();</span>
<span class="nc" id="L281">            getHandle().putByteArray(getPreferenceName(), mySecurity.encryptValue((char[]) pNewValue));</span>
<span class="nc" id="L282">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>